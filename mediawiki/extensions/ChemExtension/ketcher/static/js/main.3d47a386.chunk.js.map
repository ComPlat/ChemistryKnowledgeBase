{"version":3,"sources":["../../packages/ketcher-core/src/domain/constants/ElementColor.ts","../../packages/ketcher-core/src/domain/constants/Elements.ts","../../packages/ketcher-core/src/domain/constants/Generics.ts","../../packages/ketcher-core/src/domain/entities/AtomList.ts","../../packages/ketcher-core/src/domain/entities/Atom.ts","../../packages/ketcher-core/src/domain/entities/Pile.ts","../../packages/ketcher-core/src/domain/entities/Vec2.ts","../../packages/ketcher-core/src/domain/entities/Fragment.ts","../../packages/ketcher-core/src/domain/entities/Bond.ts","../../packages/ketcher-core/src/domain/entities/RxnArrow.ts","../../packages/ketcher-core/src/domain/entities/HalfBond.ts","../../packages/ketcher-core/src/domain/entities/Loop.ts","../../packages/ketcher-core/src/domain/entities/RGroup.ts","../../packages/ketcher-core/src/domain/entities/RxnPlus.ts","../../packages/ketcher-core/src/domain/entities/Box2Abs.ts","../../packages/ketcher-core/src/domain/entities/SGroup.ts","../../packages/ketcher-core/src/domain/entities/SimpleObject.ts","../../packages/ketcher-core/src/domain/entities/SGroupForest.ts","../../packages/ketcher-core/src/domain/entities/Pool.ts","../../packages/ketcher-core/src/domain/entities/Struct.ts","../../packages/ketcher-core/src/domain/entities/Text.ts","../../packages/ketcher-core/src/utils/ifDef.ts","../../packages/ketcher-core/src/domain/serializers/ket/toGraph/moleculeToGraph.ts","../../packages/ketcher-core/src/domain/serializers/ket/fromGraph/moleculeToStruct.ts","../../packages/ketcher-core/src/domain/serializers/ket/toGraph/prepare.ts","../../packages/ketcher-core/src/domain/serializers/ket/toGraph/rgroupToGraph.ts","../../packages/ketcher-core/src/domain/serializers/ket/fromGraph/rgroupToStruct.ts","../../packages/ketcher-core/src/domain/serializers/ket/fromGraph/rxnToStruct.ts","../../packages/ketcher-core/src/domain/serializers/ket/fromGraph/simpleObjectToStruct.ts","../../packages/ketcher-core/src/domain/serializers/ket/KetSerializer.ts","../../packages/ketcher-core/src/domain/serializers/ket/fromGraph/textToStruct.ts","../../packages/ketcher-core/src/domain/serializers/ket/validate.ts","../../packages/ketcher-core/src/domain/serializers/ket/toGraph/headerToGraph.ts","../../packages/ketcher-core/src/domain/serializers/ket/toGraph/rxnToGraph.ts","../../packages/ketcher-core/src/domain/serializers/ket/toGraph/simpleObjectToGraph.ts","../../packages/ketcher-core/src/domain/serializers/ket/toGraph/textToGraph.ts","../../packages/ketcher-core/src/domain/serializers/mol/utils.js","../../packages/ketcher-core/src/domain/serializers/mol/parseSGroup.js","../../packages/ketcher-core/src/domain/serializers/mol/v2000.js","../../packages/ketcher-core/src/domain/serializers/mol/v3000.js","../../packages/ketcher-core/src/domain/serializers/mol/common.js","../../packages/ketcher-core/src/domain/serializers/mol/Molfile.ts","../../packages/ketcher-core/src/domain/serializers/mol/MolSerializer.ts","../../packages/ketcher-core/src/domain/serializers/smi/cis_trans.js","../../packages/ketcher-core/src/domain/serializers/smi/dfs.js","../../packages/ketcher-core/src/domain/serializers/smi/stereocenters.js","../../packages/ketcher-core/src/domain/serializers/smi/Smiles.js","../../packages/ketcher-core/src/domain/serializers/smi/SmiSerializer.ts","../../packages/ketcher-core/src/domain/serializers/sdf/SdfSerializer.ts","../../packages/ketcher-core/src/domain/services/struct/structService.types.ts","../../packages/ketcher-core/src/domain/helpers/Scale.ts","../../packages/ketcher-core/src/domain/helpers/utils/StereoValidator.ts","../../packages/ketcher-core/src/infrastructure/services/struct/RemoteStructService.ts","../../packages/ketcher-core/src/infrastructure/services/struct/RemoteStructServiceProvider.ts","../../packages/ketcher-core/src/application/formatters/SupportedFormatProperties.ts","../../packages/ketcher-core/src/application/formatters/formatProperties.ts","../../packages/ketcher-core/src/application/formatters/GraphFormatter.ts","../../packages/ketcher-core/src/application/formatters/MolfileV2000Formatter.ts","../../packages/ketcher-core/src/application/formatters/RxnFormatter.ts","../../packages/ketcher-core/src/application/formatters/ServerFormatter.ts","../../packages/ketcher-core/src/application/formatters/SmilesFormatter.ts","../../packages/ketcher-core/src/application/formatters/FormatterFactory.ts","../../packages/ketcher-core/src/application/formatters/identifyStructFormat.ts","App.tsx","../../packages/ketcher-react/src/script/render/restruct/GeneralEnumTypes.ts","../../packages/ketcher-react/src/script/raphael-ext.js","../../packages/ketcher-react/src/script/render/restruct/visel.js","../../packages/ketcher-react/src/script/render/restruct/ReObject.ts","../../packages/ketcher-react/src/script/render/util.js","../../packages/ketcher-react/src/script/render/draw.js","../../packages/ketcher-react/src/script/render/restruct/reatom.ts","../../packages/ketcher-react/src/script/render/restruct/rebond.ts","../../packages/ketcher-react/src/script/render/restruct/rerxnplus.js","../../packages/ketcher-react/src/script/render/restruct/rerxnarrow.js","../../packages/ketcher-react/src/script/render/restruct/refrag.js","../../packages/ketcher-react/src/script/render/restruct/rergroup.js","../../packages/ketcher-react/src/script/render/restruct/ReEnhancedFlag.ts","../../packages/ketcher-react/src/script/render/restruct/redatasgroupdata.js","../../packages/ketcher-react/src/script/render/restruct/resgroup.js","../../packages/ketcher-react/src/script/render/restruct/ReSimpleObject.ts","../../packages/ketcher-react/src/script/render/restruct/ReText.ts","../../packages/ketcher-react/src/script/render/restruct/reloop.js","../../packages/ketcher-react/src/script/render/restruct/ReStruct.ts","../../packages/ketcher-react/src/script/editor/shared/utils.js","../../packages/ketcher-react/src/script/render/index.js","../../packages/ketcher-react/src/script/render/options.js","../../packages/ketcher-react/src/script/ketcher.ts","../../packages/ketcher-react/src/contexts/settingsContext.tsx","../../packages/ketcher-react/src/contexts/formContext.tsx","../../packages/ketcher-react/src/contexts/appContext.tsx","../../packages/ketcher-react/src/script/ui/action/atoms.js","../../packages/ketcher-react/src/script/ui/action/debug.js","../../packages/ketcher-react/src/script/ui/component/cliparea.jsx","../../packages/ketcher-react/src/script/ui/data/schema/options-schema.ts","../../packages/ketcher-react/src/script/ui/storage-ext.js","../../packages/ketcher-react/src/script/ui/state/options/index.js","../../packages/ketcher-react/src/script/ui/data/schema/schema-helper.js","../../packages/ketcher-react/src/script/ui/data/schema/sdata-schema.js","../../packages/ketcher-react/src/script/ui/state/modal/sdata.js","../../packages/ketcher-react/src/script/ui/state/modal/form.js","../../packages/ketcher-react/src/script/ui/state/request/index.ts","../../packages/ketcher-react/src/script/ui/state/request/request.types.ts","../../packages/ketcher-react/src/script/editor/operations/base.ts","../../packages/ketcher-react/src/script/editor/operations/OperationType.ts","../../packages/ketcher-react/src/script/editor/operations/atom/AtomAttr.ts","../../packages/ketcher-react/src/script/editor/operations/atom/AtomMove.ts","../../packages/ketcher-react/src/script/editor/operations/atom/index.ts","../../packages/ketcher-react/src/script/editor/operations/bond/BondAttr.ts","../../packages/ketcher-react/src/script/editor/operations/bond/BondMove.ts","../../packages/ketcher-react/src/script/editor/operations/bond/index.ts","../../packages/ketcher-react/src/script/editor/operations/CanvasLoad.ts","../../packages/ketcher-react/src/script/editor/operations/descriptors.ts","../../packages/ketcher-react/src/script/editor/operations/EnhancedFlagMove.ts","../../packages/ketcher-react/src/script/editor/operations/ifThen.ts","../../packages/ketcher-react/src/script/editor/operations/fragment.ts","../../packages/ketcher-react/src/script/editor/operations/fragmentStereoAtom.ts","../../packages/ketcher-react/src/script/editor/operations/FragmentStereoFlag.ts","../../packages/ketcher-react/src/script/editor/operations/calcimplicitH.ts","../../packages/ketcher-react/src/script/editor/operations/LoopMove.ts","../../packages/ketcher-react/src/script/editor/operations/rgroup/RGroupAttr.ts","../../packages/ketcher-react/src/script/editor/operations/rgroup/RGroupFragment.ts","../../packages/ketcher-react/src/script/editor/operations/rxn/RxnArrowMove.ts","../../packages/ketcher-react/src/script/editor/operations/rxn/plus/RxnPlusMove.ts","../../packages/ketcher-react/src/script/editor/operations/rxn/plus/index.ts","../../packages/ketcher-react/src/script/editor/operations/rxn/index.ts","../../packages/ketcher-react/src/script/editor/operations/simpleObject.ts","../../packages/ketcher-react/src/script/editor/operations/sgroup/sgroupAtom.ts","../../packages/ketcher-react/src/script/editor/operations/sgroup/SGroupAttr.ts","../../packages/ketcher-react/src/script/editor/operations/sgroup/SGroupDataMove.ts","../../packages/ketcher-react/src/script/editor/operations/sgroup/sgroupHierarchy.ts","../../packages/ketcher-react/src/script/editor/operations/sgroup/index.ts","../../packages/ketcher-react/src/script/editor/operations/Text/TextCreateDelete.ts","../../packages/ketcher-react/src/script/editor/operations/Text/TextUpdate.ts","../../packages/ketcher-react/src/script/editor/operations/Text/TextMove.ts","../../packages/ketcher-react/src/script/editor/shared/closest.js","../../packages/ketcher-react/src/script/editor/actions/utils.js","../../packages/ketcher-react/src/script/editor/shared/action.ts","../../packages/ketcher-react/src/script/editor/actions/rgroup.js","../../packages/ketcher-react/src/script/editor/shared/constants.js","../../packages/ketcher-react/src/script/editor/actions/sgroup.js","../../packages/ketcher-react/src/script/editor/actions/atom.js","../../packages/ketcher-react/src/script/editor/actions/bond.ts","../../packages/ketcher-react/src/script/ui/state/shared.js","../../packages/ketcher-react/src/script/ui/state/server/index.js","../../packages/ketcher-react/src/script/ui/action/server.js","../../packages/ketcher-react/src/script/ui/data/templates.js","../../packages/ketcher-react/src/script/ui/action/templates.js","../../packages/ketcher-react/src/script/ui/data/schema/struct-schema.js","../../packages/ketcher-react/src/script/ui/data/convert/structconv.js","../../packages/ketcher-react/src/script/ui/action/tools.js","../../packages/ketcher-react/src/script/ui/action/zoom.js","../../packages/ketcher-react/src/script/ui/action/index.js","../../packages/ketcher-react/src/script/ui/state/action/index.js","../../packages/ketcher-react/src/script/ui/state/modal/index.js","../../packages/ketcher-react/src/script/ui/state/templates/init-lib.js","../../packages/ketcher-react/src/script/ui/state/templates/index.js","../../packages/ketcher-react/src/script/ui/state/toolbar/index.js","../../packages/ketcher-react/src/script/ui/state/index.js","../../packages/ketcher-react/src/script/ui/data/convert/keynorm.js","../../packages/ketcher-react/src/script/ui/state/hotkeys.js","../../packages/ketcher-react/src/script/ui/views/AppClipArea.tsx","../../packages/ketcher-react/src/script/ui/state/editor/index.js","../../packages/ketcher-react/src/script/ui/views/components/Dialog/Dialog.tsx","../../packages/ketcher-react/src/script/editor/actions/basic.js","../../packages/ketcher-react/src/script/editor/tool/apoint.js","../../packages/ketcher-react/src/script/editor/tool/atom.js","../../packages/ketcher-react/src/script/editor/tool/attach.js","../../packages/ketcher-react/src/script/editor/tool/bond.js","../../packages/ketcher-react/src/script/editor/actions/closely-fusing.js","../../packages/ketcher-react/src/script/editor/tool/chain.js","../../packages/ketcher-react/src/script/editor/tool/charge.js","../../packages/ketcher-react/src/script/editor/actions/fragment.js","../../packages/ketcher-react/src/script/editor/actions/erase.js","../../packages/ketcher-react/src/script/editor/tool/helper/locate.js","../../packages/ketcher-react/src/script/editor/actions/chain.js","../../packages/ketcher-react/src/script/editor/tool/helper/lasso.js","../../packages/ketcher-react/src/script/editor/actions/simpleobject.ts","../../packages/ketcher-react/src/script/editor/actions/text.ts","../../packages/ketcher-react/src/script/editor/tool/eraser.js","../../packages/ketcher-react/src/script/editor/actions/paste.js","../../packages/ketcher-react/src/script/editor/tool/paste.js","../../packages/ketcher-react/src/script/editor/tool/rgroupatom.js","../../packages/ketcher-react/src/script/editor/tool/rgroupfragment.js","../../packages/ketcher-react/src/script/editor/tool/reactionarrow.js","../../packages/ketcher-react/src/script/editor/tool/reactionmap.js","../../packages/ketcher-react/src/script/editor/tool/reactionplus.js","../../packages/ketcher-react/src/script/editor/tool/reactionunmap.js","../../packages/ketcher-react/src/script/editor/actions/rotate.js","../../packages/ketcher-react/src/script/editor/tool/rotate.js","../../packages/ketcher-react/src/script/editor/actions/reaction.js","../../packages/ketcher-react/src/script/editor/tool/sgroup.js","../../packages/ketcher-react/src/script/editor/tool/select.js","../../packages/ketcher-react/src/script/editor/tool/simpleobject.js","../../packages/ketcher-react/src/script/editor/actions/aromatic-fusing.js","../../packages/ketcher-react/src/script/editor/actions/template.js","../../packages/ketcher-react/src/script/editor/tool/template.js","../../packages/ketcher-react/src/script/editor/tool/text.ts","../../packages/ketcher-react/src/script/editor/tool/index.js","../../packages/ketcher-react/src/script/editor/tool/enhanced-stereo.ts","../../packages/ketcher-react/src/script/editor/Editor.ts","../../packages/ketcher-react/src/script/editor/utils/customOnChangeHandler.ts","../../packages/ketcher-react/src/script/editor/utils/elementOffset.ts","../../packages/ketcher-react/src/script/ui/views/components/Spinner/Spinner.tsx","../../packages/ketcher-react/src/script/ui/views/components/StructEditor/StructEditor.jsx","../../packages/ketcher-react/src/script/ui/views/Editor.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/meta/About/About.jsx","../../packages/ketcher-react/src/hooks/useSettingsContext.ts","../../packages/ketcher-react/src/hooks/useResizeObserver.ts","../../packages/ketcher-react/src/hooks/useFormContext.tsx","../../packages/ketcher-react/src/hooks/useAppContext.ts","../../packages/ketcher-react/src/script/ui/component/form/input.jsx","../../packages/ketcher-react/src/script/ui/component/form/form.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/meta/Settings/components/Accordion/Accordion.tsx","../../packages/ketcher-react/src/script/ui/component/view/savebutton.jsx","../../packages/ketcher-react/src/script/ui/component/view/openbutton.jsx","../../packages/ketcher-react/src/script/ui/component/form/measure-input.jsx","../../packages/ketcher-react/src/script/ui/component/form/systemfonts.jsx","../../packages/ketcher-react/src/script/ui/component/form/select-checkbox.jsx","../../packages/ketcher-react/src/script/ui/component/form/colorPicker/ColorPicker.tsx","../../packages/ketcher-react/src/script/ui/views/modal/components/meta/Settings/Settings.tsx","../../packages/ketcher-react/src/script/ui/component/view/Tabs/Tabs.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/process/Check/components/ErrorsCheck.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/process/Check/Check.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/process/Analyse/components/FormulaInput/FormulaInput.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/process/Analyse/components/FrozenInput/FrozenInput.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/process/Analyse/Analyse.jsx","../../packages/ketcher-react/src/script/ui/component/structrender.jsx","../../packages/ketcher-react/src/script/ui/component/view/spin.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/process/Recognize/Recognize.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/process/Miew/Miew.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/Atom/ElementNumber/ElementNumber.tsx","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/Atom/Atom.container.ts","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/Atom/Atom.tsx","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/Bond/Bond.tsx","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/Bond/Bond.container.ts","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/Attach/Attach.tsx","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/Attach/Attach.container.ts","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/Automap/Automap.tsx","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/Automap/Automap.container.ts","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/RgroupLogic/components/IfThenSelect/IfThenSelect.tsx","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/RgroupLogic/RgroupLogic.container.ts","../../packages/ketcher-react/src/script/ui/views/modal/components/toolbox/RgroupLogic/RgroupLogic.tsx","../../packages/ketcher-react/src/script/ui/views/modal/components/document/Open/Open.container.ts","../../packages/ketcher-react/src/script/ui/views/modal/components/document/Open/Open.tsx","../../packages/ketcher-react/src/script/ui/views/modal/components/document/Save/SaveImageTab.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/document/Save/Save.jsx","../../packages/ketcher-react/src/script/ui/data/convert/structConverter.ts","../../packages/ketcher-react/src/script/ui/dialog/toolbox/enhancedStereo.tsx","../../packages/ketcher-react/src/script/ui/dialog/toolbox/labeledit.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/PeriodTable/components/ElementsTable/components/Header.jsx","../../packages/ketcher-react/src/script/ui/component/view/Atom/Atom.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/PeriodTable/components/ElementsTable/components/MainRow.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/PeriodTable/components/ElementsTable/components/OutinerRow.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/PeriodTable/components/ElementsTable/ElementsTable.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/PeriodTable/components/AtomInfo/AtomInfo.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/PeriodTable/components/TypeChoice/TypeChoice.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/PeriodTable/components/GenericGroups/components/components/GenSet.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/PeriodTable/components/GenericGroups/components/GenGroup.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/PeriodTable/components/GenericGroups/GenericGroups.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/PeriodTable/PeriodTable.jsx","../../packages/ketcher-react/src/script/ui/component/form/buttonlist.jsx","../../packages/ketcher-react/src/script/ui/dialog/toolbox/rgroup.jsx","../../packages/ketcher-react/src/script/ui/component/form/combobox.jsx","../../packages/ketcher-react/src/script/ui/dialog/toolbox/sdata.jsx","../../packages/ketcher-react/src/script/ui/dialog/toolbox/sgroup.jsx","../../packages/ketcher-react/src/script/ui/dialog/template/template-attach.jsx","../../packages/ketcher-react/src/script/ui/dialog/template/TemplateTable.tsx","../../packages/ketcher-react/src/script/ui/component/form/select.jsx","../../packages/ketcher-react/src/script/ui/dialog/template/TemplateLib.tsx","../../packages/ketcher-react/src/icons/index.tsx","../../packages/ketcher-react/src/script/ui/component/view/icon.jsx","../../packages/ketcher-react/src/script/ui/views/modal/components/Text/TextButton/TextButton.tsx","../../packages/ketcher-react/src/script/ui/views/modal/components/Text/Text.tsx","../../packages/ketcher-react/src/script/ui/dialog/index.ts","../../packages/ketcher-react/src/script/ui/views/modal/components/meta/Help/Help.jsx","../../packages/ketcher-react/src/script/ui/views/modal/mediaSizes.ts","../../packages/ketcher-react/src/script/ui/views/modal/Modal.container.ts","../../packages/ketcher-react/src/script/ui/views/modal/Modal.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/shortcutStr.ts","../../packages/ketcher-react/src/script/ui/views/toolbars/ToolbarGroupItem/ActionButton/ActionButton.tsx","../../packages/ketcher-react/src/script/ui/Portal/Portal.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/ToolbarGroupItem/ToolbarMultiToolItem/variants/DefaultMultiTool/DefaultMultiTool.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/ToolbarGroupItem/ToolbarMultiToolItem/variants/GroupedMultiTool/GroupedMultiTool.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/ToolbarGroupItem/ToolbarMultiToolItem/ToolbarMultiToolItem.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/ToolbarGroupItem/ToolbarMultiToolItem/usePortalOpening.ts","../../packages/ketcher-react/src/script/ui/views/toolbars/ToolbarGroupItem/ToolbarMultiToolItem/usePortalStyle.ts","../../packages/ketcher-react/src/script/ui/views/toolbars/ToolbarGroupItem/ToolbarMultiToolItem/variants/chooseMultiTool.ts","../../packages/ketcher-react/src/script/ui/views/toolbars/ToolbarGroupItem/ToolbarGroupItem.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/BottomToolbar/TemplatesList/TemplatesList.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/BottomToolbar/BottomToolbar.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/BottomToolbar/BottomToolbar.container.ts","../../packages/ketcher-react/src/script/ui/views/toolbars/mediaSizes.ts","../../packages/ketcher-react/src/script/ui/views/toolbars/ToolbarGroupItem/utils/makeItems.ts","../../packages/ketcher-react/src/script/ui/views/toolbars/LeftToolbar/Bond/options.ts","../../packages/ketcher-react/src/script/ui/views/toolbars/LeftToolbar/Bond/Bond.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/LeftToolbar/RGroup/RGroup.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/LeftToolbar/Shape/Shape.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/LeftToolbar/Transform/Transform.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/LeftToolbar/LeftToolbar.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/LeftToolbar/LeftToolbar.container.ts","../../packages/ketcher-react/src/script/ui/views/toolbars/RightToolbar/AtomsList/AtomsList.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/RightToolbar/RightToolbar.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/RightToolbar/RightToolbar.container.ts","../../packages/ketcher-react/src/script/ui/views/toolbars/TopToolbar/ZoomList/ZoomList.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/TopToolbar/TopToolbar.tsx","../../packages/ketcher-react/src/script/ui/views/toolbars/TopToolbar/TopToolbar.container.ts","../../packages/ketcher-react/src/script/ui/App/AppHidden/AppHidden.container.ts","../../packages/ketcher-react/src/script/ui/App/AppHidden/AppHidden.tsx","../../packages/ketcher-react/src/script/ui/App/App.container.ts","../../packages/ketcher-react/src/script/ui/App/App.tsx","../../packages/ketcher-react/src/script/ui/App/initApp.tsx","../../packages/ketcher-react/src/script/builders/ketcher/KetcherBuilder.ts","../../packages/ketcher-react/src/script/api.ts","../../packages/ketcher-react/src/script/index.ts","../../packages/ketcher-react/src/Editor.tsx","index.tsx","../../node_modules/@babel/runtime/helpers/objectWithoutPropertiesLoose.js","../../node_modules/@babel/runtime/helpers/objectWithoutProperties.js","../../node_modules/@babel/runtime/helpers/arrayWithHoles.js","../../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js","../../node_modules/@babel/runtime/helpers/arrayLikeToArray.js","../../node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","../../node_modules/@babel/runtime/helpers/nonIterableRest.js","../../node_modules/@babel/runtime/helpers/slicedToArray.js","../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/@babel/runtime/helpers/createClass.js","../../node_modules/@babel/runtime/helpers/defineProperty.js","../../packages/ketcher-standalone/src/infrastructure/services/struct/indigoWorker.types.ts","../../node_modules/@babel/runtime/helpers/setPrototypeOf.js","../../node_modules/@babel/runtime/helpers/inherits.js","../../node_modules/@babel/runtime/helpers/typeof.js","../../node_modules/@babel/runtime/helpers/assertThisInitialized.js","../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js","../../node_modules/@babel/runtime/helpers/getPrototypeOf.js","../../node_modules/@babel/runtime/helpers/isNativeFunction.js","../../node_modules/@babel/runtime/helpers/isNativeReflectConstruct.js","../../node_modules/@babel/runtime/helpers/construct.js","../../node_modules/@babel/runtime/helpers/wrapNativeSuper.js","../../node_modules/@babel/runtime/helpers/classPrivateFieldSet.js","../../node_modules/@babel/runtime/helpers/classPrivateFieldGet.js","../../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","../../node_modules/@babel/runtime/helpers/iterableToArray.js","../../node_modules/@babel/runtime/helpers/nonIterableSpread.js","../../node_modules/@babel/runtime/helpers/toConsumableArray.js","../../node_modules/@babel/runtime/helpers/superPropBase.js","../../node_modules/@babel/runtime/helpers/get.js","../../node_modules/jsonschema/lib/helpers.js","../../node_modules/jsonschema/lib/attribute.js","../../node_modules/jsonschema/lib/scan.js","../../node_modules/jsonschema/lib/validator.js","../../node_modules/jsonschema/lib/index.js","../../node_modules/@babel/runtime/regenerator/index.js","../../node_modules/regenerator-runtime/runtime.js","../../node_modules/@babel/runtime/helpers/asyncToGenerator.js","../../packages/ketcher-core/dist/index.modern.js","../../packages/ketcher-standalone/src/infrastructure/services/struct/StandaloneStructService.ts","../../packages/ketcher-standalone/src/infrastructure/services/struct/StandaloneStructServiceProvider.ts"],"names":["ElementColor","H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr","Rf","Db","Sg","Bh","Hs","Mt","Ds","Rg","Cn","Nh","Fl","Mc","Lv","Ts","Og","elementsArray","number","label","period","group","title","state","origin","type","mass","leftH","elementsMap","reduce","acc","element","set","Map","Elements","get","key","filter","predicate","Generics","atom","any","labels","metal","halogen","acyclic","carbo","alkynyl","alkyl","alkenyl","hetero","alkoxy","cyclic","aryl","cycloalkyl","cycloalkenyl","special","AtomList","params","this","notList","ids","id","currenElement","push","labelList","join","atomList","sort","toString","StereoLabel","Pile","item","setB","isSuperset","subset","has","expression","Array","from","union","add","Set","Vec2","args","length","x","y","z","arguments","parseFloat","Error","Math","sqrt","v","s","y1","f","scaled","l","toFixed","console","assert","max","min","ceil","floor","angle","sin","cos","rotateSC","atan2","a","b","diff","v1","v2","cross","dot","i","addScaled","f1","f2","lc2","getValueOrDefault","value","defaultValue","radicalElectrons","radical","Atom","PATTERN","RADICAL","DOUPLET","SINGLET","TRIPLET","fragment","alias","attrlist","isotope","charge","rglabel","attpnt","explicitValence","valence","implicitH","pp","sgs","ringBondCount","substitutionCount","unsaturatedAtom","hCount","aam","invRet","exactChangeFlag","rxnFragmentType","stereoLabel","stereoParity","neighbors","badConn","Object","defineProperty","enumerable","fidMap","ret","conn","isQuery","groupno","rad","hyd","absCharge","abs","attrs","attr","NONE","STEREO_PARITY","ODD","EVEN","EITHER","StereoFlag","Bond","begin","end","xxx","stereo","STEREO","topology","TOPOLOGY","reactingCenterStatus","len","sb","sa","center","struct","p1","atoms","p2","sub","normalized","aidMap","cp","bond","calcStereoFlag","stereoAids","filteredStereoAtoms","map","aid","stereoFlag","some","Mixed","match","Abs","And","Or","TYPE","SINGLE","DOUBLE","TRIPLE","AROMATIC","SINGLE_OR_DOUBLE","SINGLE_OR_AROMATIC","DOUBLE_OR_AROMATIC","ANY","DATIVE","HYDROGEN","UP","DOWN","CIS_TRANS","RING","CHAIN","REACTING_CENTER","NOT_CENTER","UNMARKED","CENTER","UNCHANGED","MADE_OR_BROKEN","ORDER_CHANGED","MADE_OR_BROKEN_AND_CHANGED","RxnArrowMode","Fragment","stereoFlagPosition","fr","stereoAtoms","frId","isAdd","includes","bonds","values","fragmentId","getFragment","bb","getCoordBoundingBox","HalfBond","bid","dir","norm","ang","p","loop","contra","next","leftSin","leftCos","leftNeighbor","rightSin","rightCos","rightNeighbor","Loop","hbs","isConvex","dblBonds","aromatic","convex","forEach","hb","halfBonds","RGroup","frags","resth","range","ifthen","fid","rgroups","frid","find","_rgid","rgroup","RxnArrow","mode","simple","RxnPlus","Box2Abs","p0","lp","rb","ext","d","options","centre","relBox","width","height","b1","b2","c","dc","dd","da","db","SGroupBracketParams","w","h","n","SGroup","bracketBox","bracketDir","areas","highlight","highlighting","selected","selectionPlate","patoms","xBonds","neiAtoms","data","mul","connectivity","name","subscript","attached","absolute","showUnits","nCharsToDisplay","tagChar","daspPos","fieldType","fieldName","fieldValue","units","query","queryOp","keys","oldValue","offset","sum","topLeftPoint","sgroups","size","descriptorIntersects","sAtom","sAtomPP","sgroup","newAtoms","j","_mol","sg","atomMap","removeNegative","filterAtoms","field","elem","allAtoms","splice","mol","parentAtomSet","crossBonds","sGroup","crossBondsPerAtom","flat","getCenter","braketBox","contentBoxes","pos","bba","extend","bbb","include","vext","atomSet","brackets","crossBondsPerAtomValues","bracketWidth","sz","cl","cr","bracketHeight","negated","cl0","cr0","dr","dl","getDir","a0","_atom","getAtoms","indexOf","inBonds","xAtom1","xAtom2","crossBond","bond1","bond2","tailAtom","amap","aid2","newBond","newCrossBond","xBond2","sGroupForest","getPathToRoot","reverse","sgid","atomAddToSGroup","sgBottomRightPoint","bottomRightPoint","segmentIntersection","MUL","SRU","SUP","DAT","GEN","SimpleObjectMode","SGroupForest","parent","children","atomSets","order","queue","shift","concat","newId","isStrictSuperset","isSubset","equals","parents","childs","findIndex","childId","path","guess","getAtomSetRelations","resetParentLink","parentId","childIndex","checkOverlapping","res","sid","sgAtoms","SimpleObject","currentP","rectangle","Pool","nextId","entries","arrayAddIfMissing","array","TextCommand","Struct","loops","isReaction","rxnArrows","rxnPluses","simpleObjects","texts","_aid","hasRxnProps","_bid","hasRxnArrow","hasRxnPluses","bondSet","dropRxnSymbols","simpleObjectsSet","textsSet","mergeInto","rg","_fnum","clone","getFragmentIds","keepAllRGroups","fidMask","_frag","rgroupsIds","rgid","keepGroup","newfid","oldfid","JSON","parse","stringify","bidMap","insert","soid","initHalfBonds","initNeighbors","updateHalfBonds","sortNeighbors","findLoops","addAtom","a1","a2","hb1","hb2","hbid","dist","turnLeft","oxAngle","clear","bondInitHalfBonds","left","hbl","ir","il","setHbNext","halfBondSetAngle","nei","nei2","nextNei","list","atomSortNeighbors","halfBondUpdate","atomUpdateHalfBonds","remove","position","global","totalLength","cnt","bld","getBondLengthData","minDist","k","totalDist","undefined","firstaid","pop","neiId","discardExistingFragments","addedAtoms","components","component","findConnectedComponent","idSet","frag","updateStereoAtom","findConnectedComponents","comp","markFragment","scale","avg","getAvgBondLength","getAvgClosestAtomDistance","hbi","ai","bi","hbj","aj","bj","subloops","continueFlag","atomToHalfBond","aid1","subloop","slice","hbid1","hbid2","hba","hbb","every","loopArr","halfBondAngle","totalAngle","PI","hbida","hbidb","hbIdNext","newLoops","bondsToMark","hbId","partitionLoop","loopId","loopIsInner","loopHasSelfIntersections","loopIsConvex","calcConn","isAromatic","correctConn","hasImplicitH","calcValenceMinusHyd","calcValence","calcImplicitHydrogen","connectedComponents","barriers","arrowPos","reactants","products","defineRxnFragmentTypeForAtomset","atomset","arrowpos","Text","content","ifDef","target","isArray","moleculeToGraph","body","source","result","refsToRGroups","rgi","val","fromRlabel","rgnumber","rglabelToGraph","atomListToGraph","stereoCare","weight","parseInt","atomToGraph","bondToGraph","toUpperCase","context","getBonds","sgroupToGraph","moleculeToStruct","graphItem","location","attachmentPoints","toRlabel","$refs","el","rglabelToStruct","elements","atomListToStruct","mapping","atomToStruct","bondToStruct","toLowerCase","placement","display","fieldData","sgroupToStruct","markFragments","getFragmentCenter","rgroupLogicToGraph","rglogic","rgroupToStruct","rgroupLogicToStruct","rlogic","_value","rxnToStruct","simpleObjectToStruct","object","radius","pos0","ellipse","circleToEllipse","parseNode","node","currentStruct","textToStruct","KetSerializer","resultingStruct","graph","Validator","validate","schema","valid","header","moleculeName","nodes","root","$ref","headerToGraph","graphNodes","rgFrags","fragsAtoms","fragAtoms","prepareStructForGraph","moleculeId","rgroupToGraph","plusNode","coord","prop","plusToGraph","arrowNode","arrowToGraph","fmtInfo","bondTypeMap","1","2","3","4","5","6","7","8","9","10","bondStereoMap","0","v30bondStereoMap","bondTopologyMap","countsLinePartition","atomLinePartition","bondLinePartition","atomListHeaderPartition","atomListHeaderLength","atomListHeaderItemLength","chargeMap","valenceMap","implicitHydrogenMap","v30atomPropMap","CHG","RAD","MASS","VAL","HCOUNT","INVRET","SUBST","UNSAT","RBCNT","rxnItemsPartition","FRAGMENT","paddedNum","precision","numStr","replace","padStart","parseDecimalInt","str","isNaN","partitionLine","parts","withspace","partitionLineFixed","itemLength","rxnMerge","mols","nReactants","nProducts","nAgents","shouldReactionRelayout","bbReact","bbAgent","bbProd","molReact","molAgent","molProd","bondLengthData","bondLengthDataMol","bb1","bb2","avgBondLength","getCoordBoundingBoxObj","fragmentType","shiftMol","xorig","over","add_","bbReactAll","bbProdAll","readKeyValuePairs","valueString","partition","utils","count","trim","postLoadMul","atomReductionMap","m","raid","patomsMap","identityMap","bondsToRemove","beginIn","endIn","postLoadSru","postLoadSup","postLoadGen","postLoadDat","getMassCentre","applyDataSGroupInfo","propData","split","applyDataSGroupData","finalize","startsWith","endsWith","substr","readKeyMultiValuePairs","loadSGroup","postLoadMap","initSGroup","sGroups","TYPES","applySGroupProp","propName","numeric","core","kv","applySGroupArrayProp","num","part","strArray","toIntArray","applyDataSGroupName","applyDataSGroupQuery","applyDataSGroupQueryOp","applyDataSGroupDesc","applyDataSGroupInfoLine","applyDataSGroupDataLine","parseAtomLine","atomLine","atomSplit","massDifference","parseBondLine","bondLine","bondSplit","parseAtomListLine","atomListLine","parseCTabV2000","ctabLines","countsSplit","ctab","atomCount","bondCount","atomListCount","isAbs","isAnd","stextLinesCount","propertyLinesCount","atomLines","bondLines","atomListLines","pair","rLogic","props","line","charAt","propValue","isPseudo","test","propertyData","rglabels","a2rs","a2ri","a2r","iii","hhh","ooo","logic","pool","parsePropertyLineAtomList","parsePropertyLines","propId","propVal","applyAtomProp","psg","call","emptyGroups","parseRg2000","coreLines","fragmentLines","parseCTab","strId","scaffold","rgMerge","hdr","lst","labelsListToIds","parseRxn2000","lines","search","parseAtomLineV3000","subsplit","spaceparsplit","atomListParams","splitonce","ival","rgrsplit","parseBondLineV3000","v3000parseCollection","v3000parseSGroup","stripV30","splitSGroupDef","parseBracedNumberList","brkxyzStrs","brkxyz","stripQuotes","parseCTabV3000","norgroups","vals","substring","readRGroups3000","rfrags","rfrag","rlsplit","pc","i0","quoted","delim","braceBalance","parseRxn3000","findCtabEnd","findRGroupEnd","molLinesReactants","molLinesProducts","current","rGroups","molLines","version","v2000","v3000","prepareForSaving","prepareMulForSaving","message","saveToMolfile","sgMap","bondMap","idstr","makeAtomBondLines","smtLine","bracketsToMolfile","sdtLine","padEnd","sddLine","nCharnCharsToDisplay","nlRe","chars","prefix","rem","salLine","getCrossBonds","bracketPos","getBracketParameters","bracket","yComplement","parseMol","parseRxn","Molfile","molecule","molfile","reaction","bondMapping","molfileLines","common","skipErrors","preserveIndigoDesc","toRemove","errors","getSGroupsBFS","errorIgnore","ex","sGroupDelete","prepareSGroups","writeCTab2000","skipSGroupErrors","getComponents","all","saver","submol","saveMolecule","getCTab","getScaffold","writePaddedNumber","writeHeader","date","Date","writeCR","writeWhiteSpace","write","getMonth","getDate","getFullYear","getHours","getMinutes","repeat","isAbsFlag","enhancedStereoFlag","writeCTab2000Header","atomsIds","atomsProps","writeAtom","writeBond","writeAtomProps","chargeList","isotopeList","radicalList","rglabelList","rglogicList","aplabelList","rbcountList","unsaturatedList","substcountList","writeAtomPropList","atomId","writePadded","sgmap","sgmapback","q","atomLabel","writePaddedFloat","MolSerializer","DefaultOptions","parseCTFile","reactionRelayout","badHeaderRecover","ex1","ex2","ignoreErrors","noRgroups","CisTrans","neighborsFunc","getNeighbors","swap","arr","i1","i2","tmp","Dfs","atomData","atom_data","nComponentsInReactants","vertices","VertexDesc","edges","EdgeDesc","v_seq","Stereocenters","Smiles","smiles","writtenAtoms","writtenComponents","PARITY","CIS","TRANS","prototype","each","func","getParity","idx","parity","getSubstituents","substituents","sameside","beg","neiBeg","neiEnd","normalize","normBeg","normEnd","prodBeg","prodEnd","samesides","iBeg","iEnd","iNeiBeg","iNeiEnd","sortSubstituents","h0","pureHydrogen","h1","h2","h3","isGeomStereoBond","bondIdx","label1","label2","neiBegin","neiЕnd","build","excludeBonds","ct","sign","dfs_state","parent_vertex","parent_edge","branches","opening_cycles","closing_cycle","SeqElem","vIdx","parVertex","parEdge","walk","vStack","cid","parentVertex","seqElem","atomD","neighbours","neiIdx","edgeIdx","edgeClosingCycle","eIdx","numBranches","numOpeningCycles","buildFromBonds","alleneMask","neiList","nei1","nei1nei","nei2nei","stereocenter","buildOneCenter","allowed_stereocenters","degree","n_double_bonds","implicit_degree","atomIdx","implicitDegree","pyramid","edgeIds","lastAtomDir","nDoubleBonds","nPureHydrogens","neiAtom","edge_idx","nei_idx","rank","vec","as","xyz1","xyz2","main1","main2","side1","side2","mainDir","getBondStereo","xyzzy","stereo0","stereo1","stereo2","nUp","nDown","xyz","centerIdx","u","sine1","cosine1","sine2","cosine2","v3","isPyramidMappingRigid","rigid","_Atom","hСount","lowercase","chirality","branch_cnt","paren_written","h_count","isBondInRing","inLoop","setImplicitHydrogen","allowedLowercase","prepareLoopStructure","bondsInLoops","hbids","touchedCistransbonds","markCisTrans","componentsAll","seqEl","vPrevIdx","openingCycles","stereocenters","sc","implicitHIdx","pyramidMapping","counter","cycleNumbers","firstComponent","writeCycleNumber","calcBondDirection","comma","writeRadicals","needBrackets","hydro","cis_trans","dbonds","ctbond_beg","ctbond_end","saved","aromFailBeg","aromFailEnd","updateSideBonds","subst","sidebonds","findBondId","n1","n2","n3","n4","vprev","ntouched","marked","SmiSerializer","_content","ChemicalMimeType","DelimeterRegex","SdfSerializer","molSerializer","exec","chunk","propChunks","deserialize","Number","isFinite","sdfItems","serialize","Scale","scaled2obj","obj2scaled","StereoValidator","isCorrectStereoCenter","beginNeighs","endNeighs","beginAtom","EndAtomNeigh","NaN","atomGetNeighbors","request","method","url","headers","responseHandler","requestUrl","_","parametrizeUrl","response","fetch","assign","Accept","credentials","then","json","ok","Promise","reject","error","err","indigoCall","baseUrl","defaultOptions","RemoteStructService","apiPath","isAvailable","indigoVersion","imagoVersions","blob","parVersion","req","status","bind","process","upload_id","complete","timeGap","startTimeGap","resolve","setTimeout","iterate","e","metadata","mol_str","outputFormat","resp","text","btoa","RemoteStructServiceProvider","currentApiPath","URLSearchParams","document","SupportedFormatProperties","mime","extensions","supportsCoords","formatProperties","Mol","molV3000","rxn","Rxn","rxnV3000","DaylightSmiles","smilesExt","ExtendedSmiles","smarts","DaylightSmarts","inChI","InChI","inChIAuxInfo","InChIAuxInfo","cml","CML","KET","getPropertiesByFormat","format","GraphFormatter","serializer","MolfileV2000Formatter","molfileManager","stringifiedMolfile","stringifiedStruct","RxnFormatter","ServerFormatter","structService","info","convert","output_format","convertResult","withCoords","promise","layout","parsedStruct","rescale","formatError","SmilesFormatter","smiSerializer","getStructureFromStringAsync","FormatterFactory","structServiceOptions","molfileParseOptions","formatter","separateOptions","molSerializerOptions","identifyStructFormat","sanitizedString","er","index","Miew","structServiceProvider","StandaloneStructServiceProvider","require","App","staticResourcesUrl","LayerMap","StereoColoringType","StereLabelStyleType","Raphael","translateAbs","delta","transform","st","Visel","paths","boxes","boundingBox","exts","translate","ReObject","viselType","visel","render","vbox","highLight","noredraw","removed","show","paper","setStart","drawHighlight","setFinish","hide","restruct","styles","tfx","box","shiftRayBox","r","rc","rd","pid","nid","id0","id1","util","makeStroke","dashedPath","dash","t0","t1","black","t2","coordStr","recenterText","rbb","vml","gap","arrow","lineattr","equilibriumArrow","fill","plus","aromaticBondPaths","a3","b3","mask","bondSingle","color","stroke","bondSingleUp","bondSingleStereoBold","a4","bondDoubleStereoBold","sgBondPath","bondSingleDown","nlines","step","bsp","stereoBond","bondSingleEither","bondDouble","cisTrans","bondSingleOrDouble","nSect","pi","bondSpace","bondTriple","bondAromatic","bondShift","l1","l2","bondAny","bondHydrogen","bondDative","reactingCenter","pathdesc","topologyMark","mark","font","fontszsub","getBBox","radicalCap","lineWidth","dw","dh","radicalBullet","circle","b0","sgroupBracketStyle","selectionRectangle","rect","lassoStyle","selectionPolygon","pstr","selectionLine","rx","ry","polyline","ShowHydrogenLabels","ReAtom","showLabel","hydrogenOnTheLeft","getVBoxObj","makeHighlightPlate","addReObjectPath","ps","atomSelectionPlateRadius","highlightStyle","selectionStyle","rightMargin","leftMargin","implh","isHydrogen","Boolean","yl","yr","nl","nr","setHydrogenPos","visibleTerminal","showHydrogenLabels","Off","Hetero","carbonExplicitly","showValenceWarnings","isLabelVisible","pseudo","getLabelText","atomColoring","fontsz","draw","pathAndRBoxTranslate","buildLabel","showAtomIds","indices","setHighlight","hydroIndex","showHydroIndex","hshift","vshift","showRadical","showIsotope","hydrogenLabels","On","Terminal","TerminalAndHetero","displayHydrogen","hydrogenLeft","hydrogen","showHydrogen","showCharge","showValence","11","12","13","14","showExplicitValence","warning","showWarning","warnings","lsb","attpntText","pos1","attpntPath1","attpntRbb","lsbn","fromRelBox","shiftBondEnd","arrowLeft","arrowRight","attpntPath","rotate","showAttpnt","bisectLargestSector","aamText","getAamText","queryAttrsText","getQueryAttrsText","labelStyle","flag","stereoLabelType","Classic","IUPAC","shouldDisplayStereoLabel","stereoLabelStyle","aamPath","colorStereogenicCenters","BondsOnly","getColorFromStereoLabel","getStereoAtomColor","childNodes","setAttribute","opacity","stereoLabelNumber","getStereoAtomOpacity","aamBox","t","colorOfAndCenters","colorOfOrCenters","colorOfAbsoluteCenters","angles","daMax","margin","ReBond","doubleBondShift","bondRecalc","bid0","halfbonds","findIncomingStereoUpBond","boldStereo","checkStereoBold","loop1","loop2","selectDoubleBondShiftChain","d1","d2","selectDoubleBondShift","setDoubleBondShift","shiftA","shiftB","findIncomingUpBonds","neihbid1","neihbid2","getBondSingleStereoBoldPath","coords","stereoUpBondGetCoordinates","getStereoBondColor","getBondSingleUpPath","interval","getBondSingleDownPath","getBondSingleEitherPath","getBondLineShift","getBondDoubleStereoBoldPath","s1","s2","getBondDoublePath","inAromaticLoop","getBondAromaticPath","getSingleOrDoublePath","getBondPath","lw","bs","alongIntRc","alongIntMadeBroken","alongSz","acrossInt","acrossSz","getReactingCenterPath","fixed","getTopologyMark","ipath","bondIdxOff","subFontSize","showBondIds","getIdsPath","showHalfBondIds","showLoopIds","includeBoldStereoBond","neibond","beginAtomStereoLabel","endAtomStereoLabel","LabelsOnly","coords1","coords2","neihbid","neihb","cosHalf","biss","dashdotPattern","getAromaticBondPaths","param1","param2","pb","lc","irbb","atom1","atom2","nLeft","nRight","ReRxnPlus","highlightPath","ReRxnArrow","startPoint","endPoint","equilibrium","ReFrag","firstFrag","secondFrag","_ui_editor","calcBBox","keyOf","BORDER_EXT","ReRGroup","labelBox","fragGetAtoms","fragGetBonds","bbf","rGroupdrawBrackets","labelSet","fontRLabel","logicStyle","fontRLogic","rLogicToString","logicPath","logicBox","_draw","fnum","drawing","cy","leftBracket","rightBracket","ifThen","rangeExists","restH","nextRg","ReEnhancedFlag","getDefaultStereoFlagPosition","stereoFlagMap","absFlagLabel","andFlagLabel","mixedFlagLabel","orFlagLabel","showStereoFlags","ReDataSGroupData","dataArea","ReSGroup","remol","SGroupdrawBrackets","calculatePP","nameI","showValue","boxI","sboxI","drawAttachedDat","sbox","sgroupData","drawAbsoluteDat","drawGroupDat","sGroupItem","lowerIndexText","upperIndexText","indexAttribute","BracketParams","crossBondsValues","tl","tr","tt","tb","cc","dt","bracketR","renderIndex","indexPos","indexPath","indexBox","toFront","ReSimpleObject","simpleObject","distRef","point","pointToCenter","calculateDistanceToLine","topX","topY","bottomX","bottomY","distances","refPoint","getReferencePointDistance","getReferencePoints","rp","onlyOnObject","refPoints","scaleFactor","poly","atan","stylesApplied","enhPath","selectionSet","generatePath","highlightStyleSimpleObject","scaledRP","per","ReText","getRelBox","topLeft","leftEdge","firstRow","topEdge","widestRow","nextRow","getRowWidth","lastElOfWidestRow","rightEdge","lastRow","bottomEdge","row","rowWidth","_id","paperScale","shiftY","rawContentState","blocks","block","ranges","getRanges","shiftX","start","flatten","getStyles","nextStyles","isEqual","inlineStyleRanges","inlineRange","textRange","style","Bold","Italic","Subscript","Superscript","ReLoop","rlid","apos","bpos","aromaticCircle","pathStr","halfAngle","qi","ReStruct","initLayers","clearMarks","lid","reloops","enhancedFlags","reAtom","adjacentComponents","neighbor","halfBond","compId","aidSet","getConnectedComponent","ccFragmentType","ccid","removeConnectedComponent","addConnectedComponent","layers","class","visible","parentNode","insertBefore","maps","structChanged","markItem","mapChanged","clearVisel","selection","isSelectionEmpty","eachItem","scaleRPath","scaleVisel","force","initialized","_item","atomsChanged","connectedComponentRemoveAtom","clearConnectedComponents","atomsChangedArray","assignConnectedComponents","verifyLoops","updLoops","updateLoops","showLabels","showBonds","showLoops","showReactionSymbols","showSGroups","showFragments","showRGroups","showEnhancedFlags","showSimpleObjects","showTexts","reloop","markBond","simpleObjectsChanged","textsChanged","rxnArrowsChanged","rxnPlusesChanged","resgroup","bondlist","markAtom","isValid","loopRemove","enhancedFlagsChanged","chid","bondsChanged","redraw","isSelectable","showItemSelection","exists","items","isSelectionSvgObjectExists","makeSelectionPlate","FRAC","calcAngle","fracAngle","angle2","round","degrees","calcNewAtomPos","ctrlKey","setFracAngle","mergeBondsParams","struct1","struct2","begin1","begin2","end1","end2","mergeAngle","merged","inRange","DEBUG","debug","logcnt","logmouse","hl","Render","clientArea","opt","renderWidth","clientWidth","renderHeight","clientHeight","userOpts","ZERO","rotationStep","labelFontSize","autoScale","autoScaleMargin","maxBondLength","hideImplicitHydrogen","hideTerminalLabels","zoom","doubleBondWidth","stereoBondWidth","bondThickness","getStructureAsync","structureFormat","formatterFactory","create","getStructureFromStructAsync","logMethod","view2obj","isRelative","scroll","scrollPos","useOldZoom","obj2view","scrollLeft","scrollTop","page2obj","pagePos","curtop","curleft","offsetTop","offsetLeft","offsetParent","top","cumulativeOffset","pageX","pageY","setPaperSize","setSize","setViewBox","setOffset","newoffset","setZoom","setScrollOffset","cx","sSz","x0","y0","x1","ey","calcExtend","update","setScale","canvas","setMolecule","viewSz","changes","setSelection","sf","sz1","marg","mv","csz","sz2","UNIT","eb","vb","cb","oldCb","oldBb","Ketcher","editor","server","ui","isExtended","molfileFormat","containsReaction","molString","load","bondLength","historyPtr","historyStack","meta","generateImageAsBase64","base64","byteCharacters","atob","byteNumbers","charCodeAt","byteArray","Uint8Array","Blob","settingsContext","React","createContext","formContext","appContext","basicAtoms","atomCuts","A","shortcut","action","tool","opts","debugObj","molStr","molQs","encodeURIComponent","qs","ieCb","window","clipboardData","ClipArea","textAreaRef","createRef","listeners","mouseup","event","cliparea","isActiveElement","focused","focus","select","mousedown","shiftKey","preventDefault","copy","onCopy","cut","onCut","paste","onPaste","formats","getData","fmt","en","addEventListener","removeEventListener","ref","className","contentEditable","autoFocus","suppressContentEditableWarning","Component","tagName","setData","actions","enabled","queryCommandSupported","execCommand","ClipboardEvent","default","enum","enumNames","LabelsAndBonds","minimum","maximum","SERVER_OPTIONS","miew","miewMode","miewTheme","miewAtomLabel","MIEW_OPTIONS","optionsSchema","required","properties","resetToSelect","getDefaultOptions","storage","localStorage","getItem","isSet","setItem","initOptionsState","app","templates","analyse","roundWeight","roundMass","roundElAnalysis","check","checkOptions","recognize","file","structStr","settings","errProps","jsonschema","property","validation","getServerSettings","pick","appUpdate","dispatch","recognizeActions","setStruct","mapOf","oneOf","desc","constant","radioButtonsSchema","contextSchema","sData","radiobuttons","minLength","invalidMessage","Multifragment","Group","sdataCustomSchema","sdataSchema","firstKeyOf","obj","getSdataDefault","correctErrors","payload","onContextChange","fValue","onFieldNameChange","formsState","atomProps","primary","secondary","automap","bondProps","moleculeErrors","labelEdit","rgroupLogic","save","filename","sdata","initSdata","updateFormState","formReducer","formName","init","actionContext","actionFieldName","newstate","sdataReducer","indigoVerification","initialState","BaseOperation","priority","execute","_inverted","invert","level","halfBondId","invalidateLoop","bondId","halfBond1","halfBond2","invalidateAtom","invalidateBond","invalidateItem","OperationType","freeze","ATOM_ADD","ATOM_DELETE","ATOM_ATTR","ATOM_MOVE","CALC_IMPLICIT_H","BOND_ADD","BOND_DELETE","BOND_ATTR","BOND_MOVE","LOOP_MOVE","S_GROUP_ATOM_ADD","S_GROUP_ATOM_REMOVE","S_GROUP_ATTR","S_GROUP_CREATE","S_GROUP_DELETE","S_GROUP_ADD_TO_HIERACHY","S_GROUP_REMOVE_FROM_HIERACHY","R_GROUP_ATTR","R_GROUP_FRAGMENT","UPDATE_IF_THEN","RESTORE_IF_THEN","RXN_ARROW_ADD","RXN_ARROW_DELETE","RXN_ARROW_MOVE","RXN_PLUS_ADD","RXN_PLUS_DELETE","RXN_PLUS_MOVE","S_GROUP_DATA_MOVE","CANVAS_LOAD","ALIGN_DESCRIPTORS","SIMPLE_OBJECT_ADD","SIMPLE_OBJECT_DELETE","SIMPLE_OBJECT_MOVE","SIMPLE_OBJECT_RESIZE","RESTORE_DESCRIPTORS_POSITION","FRAGMENT_ADD","FRAGMENT_DELETE","FRAGMENT_STEREO_FLAG","FRAGMENT_ADD_STEREO_ATOM","FRAGMENT_DELETE_STEREO_ATOM","ENHANCED_FLAG_MOVE","TEXT_CREATE","TEXT_UPDATE","TEXT_DELETE","TEXT_MOVE","AtomAttr","attribute","data2","inverted","AtomMove","noinvalidate","reatom","AtomAdd","atomSetPos","AtomDelete","restructedAtom","markItemRemoved","BondAttr","BondMove","BondAdd","structBond","atomAddNeighbor","BondDelete","rebond","prev","CanvasLoad","oldStruct","clearVisels","AlignDescriptors","history","structBox","alignPoint","RestoreDescriptorsPosition","EnhancedFlagMove","currentPosition","newPosition","UpdateIfThen","rgNew","rgOld","skipRgids","rgid_new","rgid_old","ifThenHistory","RestoreIfThen","rgValue","FragmentAdd","FragmentDelete","enhancedFalg","FragmentAddStereoAtom","invalidateEnhancedFlag","FragmentDeleteStereoAtom","FragmentStereoFlag","updateStereoFlag","CalcImplicitH","aids","atomIds","aIds","LoopMove","RGroupAttr","rgroupId","rgp","RGroupFragment","rg_new","rg_old","findRGroupByFragment","removeOld","setNew","RxnArrowMove","RxnPlusMove","RxnPlusAdd","plid","newRxn","structRxn","rxnPlusSetPos","RxnPlusDelete","RxnArrowAdd","arid","rxnArrowSetPos","RxnArrowDelete","SimpleObjectAdd","toCircle","itemId","positions","makeCircleFromEllipse","simpleObjectSetPos","Base","SimpleObjectDelete","performed","SimpleObjectMove","move","handleRectangleChangeWithAnchor","anchor","previousPos0","get_xy0","previousPos1","SimpleObjectResize","circlePoint","position0","position1","SGroupAtomAdd","sgroupId","SGroupAtomRemove","removeAtom","SGroupAttr","setAttr","SGroupDataMove","SGroupAddToHierarchy","relations","SGroupRemoveFromHierarchy","SGroupCreate","SGroupDelete","TextCreate","textSetPosition","TextDelete","TextUpdate","previousContent","TextMove","difference","findMaps","findClosestAtom","findClosestBond","inBox","xDist","pg","skip","closestAtom","closestBond","contains","calcDistance","cursorPosition","referencePoints","skipId","closestBondCenter","minCDist","mid","cdist","mp","merge","srcId","atomGetAttr","atomGetDegree","atomGetSGroups","atomGetPos","structSelection","atomForNewBond","neiPos","maxI","maxAngle","neiNeighbours","neiV","neiAngle","neiNei","neiNeiPos","vDiff","closest","getRelSgroupsBySelection","selectedAtoms","Action","operations","operation","isDummy","invertedOperation","perform","addOp","fromRGroupAttrs","fromRGroupFragment","rgidNew","fromUpdateIfThen","rgidOld","SgContexts","fromSeveralSgroupAddition","descriptors","fromSgroupAddition","localAttrs","mergeWith","sGroupAttributeAction","fromSgroupDeletion","sG","sGroupsRecalcCrossBonds","getAttrs","asteriskAction","plainCarbon","isPlainCarbon","fromSgroupAttrs","fromSgroupAction","newSg","sourceAtoms","currSelection","getAtomsBondIds","uniq","bondid","fromBondAction","atomsFromBonds","newSourceAtoms","fromGroupAction","fromMultiFragmentAction","fromAtomAction","targetAtoms","allFragments","fragId","removeAtomFromSgroupIfNeeded","removeSgroupIfNeeded","sgCounts","fromAtomAddition","fromAtomsAttrs","reset","attrGetDefault","atomNeighbors","fromBondStereoUpdate","fromAtomsFragmentAttr","newfrid","oldfrid","fromAtomMerge","dstId","fragAction","mergeFragmentsIfNeeded","mergeBondId","getAttrHash","dstAtomNeighbors","frid2","fridAtoms","atomsToNewFrag","moveAtomsAction","mergeSgroups","srcAtoms","dstAtom","without","fromBondAddition","pos2","mergeFragments","bnd","fromBondsAttrs","withReverse","beginFrId","endFrId","fragmentStereoBonds","getStereoAtomsMap","stereoProp","aId","fromStereoAtomAttrs","stereoAtomsMap","correctAtomIds","getStereoParity","newAtomParity","bondChangingAction","itemID","newItemId","isInteger","fromBondFlipping","plainBondTypes","onAction","dialog","thunk","loadStruct","getState","formatterOptions","parseStruct","sgId","getOffset","updateOffset","stereAtomsMap","isBlank","alert","optsTypes","ketcherErrors","checkParams","badVal","ketcherCheck","types","serverCall","serverTransform","previousStruct","loadedStruct","explicitSelected","reindexMap","getReindexMap","omit","config","disabled","hidden","isHidden","clean","arom","dearom","cip","ketcher","standalone","buttonName","buttons","maxLength","pattern","rgroupSchema","sgroupMap","minium","fromElement","selem","satom","fromAtom","ap","sap","toElement","toAtomList","capitalize","toAtom","pch","atomSchema","conv","toBond","toBondType","caption","bondCaptionMap","fromBondType","single","up","down","updown","double","crossed","triple","singledouble","singlearomatic","doublearomatic","dative","fromSgroup","ssgroup","toSgroup","toolActions","erase","chain","bondCuts","typeSchema","bondSchema","zoomList","findLastIndex","new","tools","open","undo","historySize","redo","dontClipMessage","hasSelection","active","help","about","selectionTool","toolbar","visibleTools","alignDescriptors","activeTool","actObj","actionName","pickBy","openDialog","dialogName","onResult","onCancel","initLib","lib","initTmplLib","cacheEl","sdfSerializer","prefetchStatic","tmpls","files","tmpl","prefetchSplit","fn","svgs","svgContent","innerHTML","prefetchRender","cachedFiles","pr","prerender","userLib","userTmpls","updateLocalStore","initTmplsState","attach","tmplActions","attachActions","initial","freqAtoms","currentAtom","opened","updateVisibleTools","visibleTool","regExp","menuHeight","innerHeight","addFreqAtom","toolInMenu","toolName","sel","getElementById","dropdown","base","findEl","getComputedStyle","overflow","classList","hiddenAncestor","shared","combineReducers","actionState","isEmpty","newState","correctTools","isSelected","menuName","modal","formState","form","store","loading","currentState","requestsStatuses","setEditor","restOptions","initState","middleware","rootReducer","sh","finalState","getRootReducer","createStore","applyMiddleware","mac","navigator","platform","normalizeKeyName","alt","ctrl","mod","normalizeKeyMap","modifiers","altKey","metaKey","rusToEng","KN","keyCode","normalizeKeyEvent","isChar","keyNorm","KeyboardEvent","initKeydownListener","hotKeys","act","actName","setHotKey","initHotKeys","actionTool","atomsSelected","letter","lookup","checkGroupOnTool","clipArea","newAction","keyHandle","baseName","rxnTextPlain","initClipboard","debAction","debounce","clipData","structSelected","AppClipArea","connect","initEditor","updateAction","sleep","time","selectMode","resetOption","acts","onInit","onChange","onSelectionChange","onElementEdit","dlg","disabledIds","onEnhancedStereoEdit","orNumber","andNumber","fromStereoLabel","toStereoLabel","onQuickEdit","onBondEdit","sbond","onRgroupEdit","rgroupLabels","onSgroupEdit","onSdataEdit","onMessage","msg","onAromatizeStruct","serverOpts","onDearomatizeStruct","onMouseDown","Dialog","rest","dialogRef","useRef","useEffect","getElementsByClassName","exit","role","onSubmit","onKeyDown","activeElement","activeTextarea","stopPropagation","tabIndex","clsx","onClick","button","fromNewCanvas","APointTool","AtomTool","atomLongtapEvent","dragCtx","atomid","timeout","quickEdit","newatom","xy0","stopTapping","clearTimeout","AttachTool","attachPoints","BondTool","fromItemsFuse","usedAtoms","dst","src","mergeMap","atomPairs","bondCI","fromBondsMerge","getItemsToFuse","mergeItems","closestMap","closestToMerge","findMerge","getHoverToFuse","hoverItems","now","ChainTool","ChargeTool","fromMultipleMove","lists","atomsToInvalidate","rxnArrow","rxnPulse","sgData","processAtom","usedIds","fromFragmentSplit","rgForRemove","fromBondDeletion","skipAtoms","atomsToRemove","fromFragmentDeletion","frids","actionRemoveDataSGroups","actionRemoveBonds","getBondFragment","frid3","isPointInPolygon","v0","n0","d0","w0","flag1","flag0","w1","mousemove","hover","findItem","click","ci","elementEdit","rnd","newAtomPos","attachEdit","MAX_VALUE","xy1","xy","bondAddition","sectCount","dx","dy","chainItems","fromChain","newItems","cancel","mouseleave","inRectangle","bondList","rxnArrowsList","rxnPlusesList","simpleObjectsList","enhancedFlagList","sgroupDataList","textsList","inPolygon","rr","LassoHelper","fromSimpleObjectDeletion","fromSimpleObjectAddition","fromSimpleObjectResizing","fromTextUpdating","fromTextDeletion","EraserTool","lassoHelper","fromPaste","pstruct","getStructCenter","fridMap","pasteItems","tmpAtom","newsgid","oper","newRgId","xmin","ymin","xmax","ymax","PasteTool","lastEvent","RGroupAtomTool","propsDialog","RGroupFragmentTool","ReactionArrowTool","ReactionMapTool","isValidMap","rcs","ri","ro","po","ReactionPlusTool","ReactionUnmapTool","fromFlip","fids","bbox","calcCenter","flipItemByCenter","fromRotate","rotateDelta","did","stereoFlags","flagId","RotateTool","fromBondAlign","getSelection","locate","points","running","addPoint","dp","fromOneAtomDeletion","fromOneBondDeletion","fromArrowDeletion","fromPlusDeletion","rgroupEdit","newRg","fromArrowAddition","updateLine","aam1","aam2","fromPlusAddition","rotId","rotAll","neiHb","angle1","expSel","searchMaps","SGroupTool","sgroupDialog","defaultType","eventName","manyComponentsSelected","singleComponentSelected","anyChainedBonds","getContextBySgroup","getContextBySelection","fromContextType","allBondsSelected","fixedBond","countOfSelectedComponents","SelectTool","closestToSel","selMerge","reversible","dest","xor","uniqArray","SimpleObjectTool","fromAromaticTemplateOnBond","template","events","simpleFusing","atomsInStruct","getFragmentWithBondMap","fromTemplateOnCanvas","fromTemplateOnAtom","extraBond","extraRes","additionalAtom","middleAtom","actionRes","extraBondAction","angle0","fromTemplateOnBondAction","flip","fromTemplateOnBond","tmplBond","tmplBegin","atomsMap","bondAtoms","mergeA","tBond","existId","TemplateTool","findItems","getSign","selectFragment","dblclick","ra","bondEdit","newbond","isNew","previous","frIds","sign1","sign2","hasOwnProperty","extra_bond","completeAction","TextTool","origilContent","fromTextCreation","rgroupatom","eraser","rgroupfragment","apoint","reactionarrow","reactionplus","reactionmap","reactionunmap","enhancedStereo","EnhancedStereoTool","stereoLabels","stereoAtom","hasAnotherLabel","enhancedStereoEdit","fromStereoFlagUpdate","changeAtomsStereoAction","simpleobject","structObjects","highlightTargets","selectStereoFlagsIfNecessary","expAtoms","atomsOfFragments","shouldSelSFlag","Editor","_selection","_tool","Subscription","PipelineSubscription","sgroupEdit","sdataEdit","change","selectionChange","aromatizeStruct","dearomatizeStruct","DOMSubscription","subs","which","isMouseRight","nodeName","EditorTool","domEventSetup","toolMap","recoordinate","newTool","item1","item2","ignoreHistory","HISTORY_SIZE","handler","subscriber","subscribeFuncWrapper","op","to","sGroupId","customOnChangeHandler","elementOffset","srcItems","isRxn","fromDescriptorsAlign","Spinner","classes","setupEditor","oldProps","toolOpts","upperFirst","StructEditor","editorRef","logRef","nextProps","removeEditorHandlers","Tag","onAttachEdit","onCipChange","About","indigoInfo","href","rel","Logo","buildDate","useSettingsContext","useContext","SettingsContext","useThrottleResizeObserver","useState","onResize","useMemo","throttle","useResizeObserver","useFormContext","FormContext","GenericInput","onInput","TextArea","CheckBox","checked","Select","onSelect","multiple","enumSchema","FieldSet","defaultChecked","cbOrIndex","isTypeValue","inputCtrl","ev","ctrlMap","testVal","multipleSelectCtrl","singleSelectCtrl","input","isNumber","o","selectedIndex","fieldset","querySelectorAll","inp","Input","componentMap","shallowCompare","Form","onUpdate","propSchema","errs","getErrorsObj","prevProps","customValid","updateState","instance","self","dataError","Provider","stateStore","Label","labelPos","Field","fieldOpts","formField","SelectOneOf","selectDesc","validator","customFormats","inst","rewrite","serializeRewrite","deserializeRewrite","serializeMap","deserializeMap","getInvalidMessage","Accordion","setState","prevState","childrenWithProps","Children","child","isActive","groupIsActive","onActive","isValidElement","cloneElement","SaveButton","noop","onSave","onError","getKetcherInstance","AppContext","saveFile","fileSaver","saveImage","generateImageAsync","saveAs","OpenButton","FileReader","throughFileReader","ActiveXObject","fso","fd","OpenTextFile","ReadAll","Close","throughFileSystemObject","fileOpener","opener","onLoad","btn","accept","onload","msClose","onerror","readAsText","MeasureInput","cust","meas","calcValue","handleChange","handleMeasChange","convValue","convertValue","onBlur","measureMap","px","cm","pt","inch","measureFrom","measureTo","commonFonts","SystemFonts","availableFonts","setAvailableFonts","onChangeCallback","useCallback","mounted","availableFontsPromises","fontName","FontFaceObserver","checkInSystem","results","fonts","SelectCheckbox","currentSchema","ColorPicker","isOpen","setIsOpen","hex","backgroundColor","CompactPicker","Settings","appOpts","ownProps","onOpenFile","newOpts","onReset","onOk","newSettings","settingsSchema","Tabs","changeTab","tabs","contentClassName","tabPanel","componentProps","ErrorsCheck","checkSchema","moleculeErrorsTypes","option","nameIndex","getOptionName","Check","checkState","onCheck","captions","formulaRegexp","errorRegexp","formulaInputMarkdown","onKeyPress","FormulaInput","cnd","FrozenInput","spellCheck","roundOff","AnalyseDialog","onAnalyse","onChangeRound","withSelector","Analyse","serverSettings","roundName","changeRound","StructRender","tagRef","renderStruct","Spin","isImage","URL","webkitURL","createObjectURL","Recognize","isFragment","onImage","changeImage","onRecognize","ver","rec","onChangeImago","partProps","canPreviewImage","setCanPreviewImage","clearFile","BACKGROUND_COLOR","dark","light","MIEW_TX_TYPES","no","bright","colorer","blackAndWhite","bg","createMiewOptions","autoPreset","editing","inversePanning","reps","textMode","selector","showBg","TXoptions","MiewDialog","miewOpts","viewer","container","miewContainer","run","sourceType","fileType","setOptions","cmlStruct","exportCML","onExportCML","ElementNumber","readOnly","AtomContainer","currentLabel","setCurrentLabel","onLabelChangeCallback","newValue","atomValid","chargeValid","BondContainer","AttachPointsContainer","attachmentPointsSchema","automapSchema","AutomapContainer","IfThenSelect","rgroupLabel","RgroupLogicContainer","rangeConv","OpenContainer","setStructStr","setFragment","structAcceptMimes","SaveImageTab","changeImageFormat","extension","renderOptions","saveSchema","SaveDialog","disableControls","onResetForm","saveWarning","formatName","rxnArrowsSize","rxnArrowMode","ind","structFormat","showStructWarningMessage","imageFormat","getWarnings","changeType","isCleanStruct","onTmplSave","renderSaveFile","getButtons","tab","Save","saveUserTmpl","findStereLabels","maxAnd","stereLabels","numbers","maxOfAnds","maxOr","maxOfOrs","labelEditSchema","Header","MainRow","refer","currentEvents","atomClassNames","colSpan","OutinerRow","metalPrefix","beforeSpan","main","lanthanides","actinides","ElementsTable","callbacks","table","summary","getAtomClassNames","main_row","outiner_row","AtomInfo","isInfo","numberStyle","fontSize","elemStyle","fontWeight","TypeChoice","GenSet","viewSchema","GenGroup","gen","pk","subgroup","GenericGroups","col","Table","firstType","onMouseEnter","onMouseLeave","genType","periodicTable","changeTabType","mapSelectionToProps","PeriodTable","ButtonList","multipl","oneOrMore","ComboBox","suggestsHidden","blur","updateInput","textContent","suggestList","suggestListStyles","autoComplete","SelectInput","inputSelect","formSchema","schemes","EDITOR_STYLES","Attach","normTmpl","structNormalization","initTmpl","onNameEdit","getScale","placeholder","initAttach","setTmplName","normStruct","cbb","rxnPlus","GREEK_SIMBOLS","Alpha","alpha","Beta","beta","Gamma","gamma","greekRe","RegExp","greekify","sym","tmplName","RenderTmpl","xlinkHref","TemplateTable","onDelete","onAttach","ITEMS_COUNT","ITEM_SIZE","tmplStyles","minWidth","AutoSizer","itemsPerRow","rowCount","List","rowHeight","rowRenderer","fromIndex","toIndex","SelectList","splitIndexes","isSplitIndex","filterLibSelector","createSelector","re","escapeRegExp","flow","_filter","onFilter","changeFilter","selectTmpl","onChangeGroup","changeGroup","editTmpl","deleteUserTmpl","deleteTmpl","String","g","icons","logo","emptyIcon","Icon","findIconByName","TextButton","command","toggleStyle","Open","Rgroup","TemplateAttach","TemplatesLib","setContent","transfromImageUri","uri","plugins","gfm","transformImageUri","AttachPoints","Automap","EnhancedStereo","LabelEdit","RgroupLogic","Sgroup","Sdata","EditorState","moveFocusToEnd","createWithContent","convertFromRaw","entityMap","editorState","setEditorState","currentStyle","getCurrentInlineStyle","newEditorState","RichUtils","toggleInlineStyle","getCurrentContent","hasText","convertToRaw","keyBindingFn","getDefaultKeyBinding","customStyleMap","SUBSCRIPT","verticalAlign","SUPERSCRIPT","mediaSizes","ModalContainer","_result","stateProps","dispatchProps","initProps","containerRef","modals","shortcutAliasMap","Escape","Delete","Mod","shortcutStr","ActionButton","disableableButtons","Portal","createElement","isElementInDom","addElementInDOM","addClassName","updateStyle","removeElementFromDOM","removeClassNames","querySelector","appendChild","removeChild","classNames","prevStyle","ReactDOM","createPortal","DefaultMultiTool","toolbarItem","currentStatus","GroupedMultiTool","groups","descriptor","ToolbarMultiToolItem","variant","onOpen","currentId","usePortalOpening","portalStyle","setPortalStyle","getBoundingClientRect","scrollOffset","scrollingElement","usePortalStyle","selectedTool","actionButtonProps","defaultClasses","chooseMultiTool","portalClassName","ToolbarGroupItem","TemplatesList","isTemplate","makeAction","BottomToolbarContainer","makeItems","bondCommon","bondStereo","bondQuery","bondSpecial","groupOptions","groupDescriptors","accum","rGroupOptions","shapeOptions","Shape","transformOptions","Transform","selectOptions","reactionOptions","LeftToolbarContainer","Item","AtomsList","isAtom","RightToolbarContainer","ZoomList","parsedValue","toPercent","TopToolbarContainer","AppHiddenContainer","onInitTmpls","mapDispatchToProps","checkServer","AppContainer","AppModalContainer","initApp","KetcherBuilder","serviceMode","tempUIDataContainer","createStructService","aromatize","dearomatize","calculateCip","calculate","createApi","appendUiAsync","tempRef","buildNumber","builder","appendApiAsync","appendServiceMode","rootElRef","buildKetcherAsync","small","excluded","sourceKeys","objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","Symbol","iterator","_arr","_n","_d","_e","_s","_i","done","arr2","minLen","arrayLikeToArray","constructor","TypeError","arrayWithHoles","iterableToArrayLimit","unsupportedIterableToArray","nonIterableRest","Constructor","_defineProperties","configurable","writable","protoProps","staticProps","Command","SupportedFormat","_setPrototypeOf","module","exports","setPrototypeOf","__proto__","subClass","superClass","_typeof","ReferenceError","assertThisInitialized","_getPrototypeOf","getPrototypeOf","Function","Reflect","construct","sham","Proxy","_construct","Parent","Class","isNativeReflectConstruct","apply","_wrapNativeSuper","_cache","isNativeFunction","Wrapper","receiver","privateMap","iter","arrayWithoutHoles","iterableToArray","nonIterableSpread","_get","superPropBase","getOwnPropertyDescriptor","ValidationError","argument","makeSuffix","$id","stack","ValidatorResult","ctx","propertyPath","throwError","throwFirst","throwAll","disableFormat","stringizer","ValidatorResultError","captureStackTrace","addError","detail","importErrors","validatorType","SchemaError","SchemaContext","schemas","makeChild","propertyName","FORMAT_REGEXPS","regexp","regex","ipv4","isFormat","deepMerger","deepMerge","copyist","copyistWithDeepMerge","pathEncoder","deepCompareStrict","aKeys","bKeys","objectGetPath","decodeURIComponent","encodePath","getDecimalPlaces","decimalPlaces","decimalParts","isSchema","helpers","validators","testSchemaNoThrow","callback","validateSchema","getEnumerableProperty","testAdditionalProperty","additionalProperties","preValidateProperty","testType","anyOf","inner","nestedErrors","allOf","if","ifValid","else","propertyNames","subschema","patternProperties","minProperties","maxProperties","additionalItems","exclusiveMinimum","exclusiveMaximum","validateMultipleOfOrDivisbleBy","validationType","errorMessage","validationArgument","instanceDecimals","divisorDecimals","maxDecimals","multiplier","pow","testArrays","multipleOf","divisibleBy","string","hsp","minItems","maxItems","uniqueItems","dependencies","dep","childContext","not","disallow","notTypes","schemaId","SchemaScanResult","found","scanSchema","baseuri","resolvedUri","ourBase","scanArray","extends","scanObject","definitions","require$$0","scan","unresolvedRefs","attributes","shouldResolve","addSchema","ourUri","addSubSchemaArray","addSubSchema","addSubSchemaObject","setSchemas","getSchema","urn","sch","schemaobj","schemaTraverser","superResolve","switchSchema","resolved","subctx","skipAttributes","ignoreProperties","validatorErr","allowUnknownAttributes","parsed","hash","integer","boolean","require$$1","require$$2","runtime","Op","hasOwn","$Symbol","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","wrap","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","Context","_invoke","arg","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","makeInvokeMethod","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","NativeIteratorPrototype","Gp","defineIteratorMethods","AsyncIterator","PromiseImpl","previousPromise","callInvokeWithMethodAndArg","invoke","__await","unwrapped","resultName","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","iterable","iteratorMethod","displayName","isGeneratorFunction","genFun","ctor","awrap","async","skipTempReset","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","finish","thrown","delegateYield","regeneratorRuntime","accidentalStrictMode","asyncGeneratorStep","_next","_throw","_createForOfIteratorHelper","allowArrayLike","it","_arrayLikeToArray","_unsupportedIterableToArray","normalCompletion","didErr","_e2","_classCallCheck","_defineProperty","_createClass","_step","_iterator","_createForOfIteratorHelper$1","_arrayLikeToArray$1","_unsupportedIterableToArray$1","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","Super","NewTarget","_possibleConstructorReturn","_Set","_inherits","_super","_step2","_iterator2","_step3","_iterator3","_len","_key","_len2","_key2","_stereoLabel$match","_enhancedStereoFlag","WeakMap","_classPrivateFieldGet","_classPrivateFieldSet","_struct$atoms$get","_this","_loop","_ref","_this$children$get","_this2","_this$children$get2","_this3","_this3$children$get","_createForOfIteratorHelper$2","_arrayLikeToArray$2","_unsupportedIterableToArray$2","_createSuper$1","_isNativeReflectConstruct$1","_Map","_assertThisInitialized","_step$value","_slicedToArray","_step2$value","_ref2","_this4","_this5","_this6","_this7","_this8","_this9","_this10","_this11","_this12","_this13","_this14","_this15","_scale","_this16","_this17","_this18","_toConsumableArray","_this$calcConn","_this$calcConn2","_this19","_this$atoms$get","_this20","_this21","_this$bonds$get","_this$atoms$get2","ownKeys","enumerableOnly","symbols","getOwnPropertyDescriptors","defineProperties","_objectSpread","_Elements$get","_createForOfIteratorHelper$3","_arrayLikeToArray$3","_unsupportedIterableToArray$3","ownKeys$1","_objectSpread$1","$schema","description","rsite","atomlist","stereobox","structure","entityType","_createForOfIteratorHelper$4","_arrayLikeToArray$4","_unsupportedIterableToArray$4","labelsListToIds$1","parseCTab$1","partitionLine$1","_struct","_j","ownKeys$2","_objectSpread$2","swap$1","ownKeys$3","_objectSpread$3","_info","_asyncToGenerator","_regeneratorRuntime","_callee","_context","_getStructureFromStructAsync","_x","_getStructureFromStringAsync","_callee2","_context2","_x2","ownKeys$4","_objectSpread$4","_objectWithoutProperties","_this$separateOptions","_this$separateOptions2","IndigoService","worker","IndigoWorker","onmessage","terminate","hasError","postMessage","Info","mimeType","Smarts","convertMimeTypeToOutputFormat","commandOptions","commandData","inputMessage","Convert","Layout","Clean","Aromatize","Dearomatize","CalculateCip","curr","mappedProperty","mapWarningGroup","calculatedProperties","mappedPropertyName","mapCalculatedPropertyName","Calculate","GenerateImageAsBase64","StandaloneStructService"],"mappings":"ojDAqBaA,EAAiC,CAC5CC,EAAG,UACHC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,EAAG,UACHC,EAAG,UACHC,EAAG,UACHC,EAAG,UACHC,EAAG,UACHC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,EAAG,UACHC,EAAG,UACHC,GAAI,UACJC,GAAI,UACJC,EAAG,UACHC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,EAAG,UACHC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,EAAG,UACHC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,EAAG,UACHC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,EAAG,UACHC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,EAAG,UACHC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UAEJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,GAAI,UACJC,G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,kBA1sBuB,CACvB,eAAgB,CACfr9F,KAAM,wBAEP,WAAY,CACXA,KAAM,2BAssBPy8F,sBAnsB0B,EAosB1BmD,YAnsBiB,CACjBsN,MAAO,CACNt1H,KAAM,SACNu+D,SAAU,CACT,OACA,YAEDC,WAAY,CACXx+D,KAAM,CACL,MAAS,YAEVslB,SAAU,CACTtlB,KAAM,QACN6mH,SAAU,EACVC,SAAU,EACV90D,MAAO,CACNhyD,KAAM,WAGRylB,MAAO,CACNzlB,KAAM,QACNgyD,MAAO,CACNhyD,KAAM,SACN84E,QAAS,kBAGXvzD,iBAAkB,CACjBvlB,KAAM,UACN,KAAQ,CACP,EACA,EACA,EACA,MAKJe,KAAM,CACLf,KAAM,SACNu+D,SAAU,CACT,SAEDC,WAAY,CACX9+D,MAAO,CACNM,KAAM,UAEPslB,SAAU,CACTtlB,KAAM,QACN6mH,SAAU,EACVC,SAAU,EACV90D,MAAO,CACNhyD,KAAM,WAGRkH,OAAQ,CACPlH,KAAM,UACN89D,SAAU,IACVC,QAAS,KAEV12D,gBAAiB,CAChBrH,KAAM,UACN,KAAQ,EACN,EACD,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,KAGFiH,QAAS,CACRjH,KAAM,UACN89D,QAAS,EACTC,QAAS,KAEVx3D,QAAS,CACRvG,KAAM,UACN,KAAQ,CACP,EACA,EACA,EACA,IAGFulB,iBAAkB,CACjBvlB,KAAM,UACN,KAAQ,CACP,EACA,EACA,EACA,IAGFkI,YAAa,CACZlI,KAAM,SACN84E,QAAS,kCAEV3wE,aAAc,CACbnI,KAAM,UACN,KAAQ,CACP,EACA,EACA,EACA,IAGF0H,cAAe,CACd1H,KAAM,UACN,KAAQ,CACP,GACC,GACA,EACD,EACA,EACA,IAGF2H,kBAAmB,CAClB3H,KAAM,UACN,KAAQ,CACP,GACC,GACA,EACD,EACA,EACA,EACA,EACA,EACA,IAGF4H,gBAAiB,CAChB5H,KAAM,WAEP6H,OAAQ,CACP7H,KAAM,UACN,KAAQ,EACN,EACD,EACA,EACA,EACA,EACA,EACA,IAGF8lB,QAAS,CACR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","file":"static/js/main.3d47a386.chunk.js","sourcesContent":["/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport type { ElementLabel } from './element.types'\n\ntype ElementColorType = {\n  [key in ElementLabel]: string\n}\n\nexport const ElementColor: ElementColorType = {\n  H: '#000000',\n  He: '#89a1a1',\n  Li: '#bd77ed',\n  Be: '#8fbc00',\n  B: '#c18989',\n  C: '#000000',\n  N: '#304ff7',\n  O: '#ff0d0d',\n  F: '#78bc42',\n  Ne: '#80a2af',\n  Na: '#ab5cf2',\n  Mg: '#6fcd00',\n  Al: '#a99393',\n  Si: '#b29478',\n  P: '#ff8000',\n  S: '#c99a19',\n  Cl: '#1fd01f',\n  Ar: '#69acba',\n  K: '#8f40d4',\n  Ca: '#38e900',\n  Sc: '#999999',\n  Ti: '#979a9e',\n  V: '#99999e',\n  Cr: '#8a99c7',\n  Mn: '#9c7ac7',\n  Fe: '#e06633',\n  Co: '#d37e8e',\n  Ni: '#4ece4e',\n  Cu: '#c78033',\n  Zn: '#7d80b0',\n  Ga: '#bc8b8b',\n  Ge: '#668f8f',\n  As: '#b87ddd',\n  Se: '#e59100',\n  Br: '#a62929',\n  Kr: '#59b1c9',\n  Rb: '#702eb0',\n  Sr: '#00ff00',\n  Y: '#66afaf',\n  Zr: '#71abab',\n  Nb: '#67aeb4',\n  Mo: '#54b5b5',\n  Tc: '#3b9e9e',\n  Ru: '#248f8f',\n  Rh: '#0a7d8c',\n  Pd: '#006985',\n  Ag: '#9a9a9a',\n  Cd: '#b29764',\n  In: '#a67573',\n  Sn: '#668080',\n  Sb: '#9e63b5',\n  Te: '#d47a00',\n  I: '#940094',\n  Xe: '#429eb0',\n  Cs: '#57178f',\n  Ba: '#00c900',\n  La: '#5caed1',\n  Ce: '#9d9d7b',\n  Pr: '#8ca581',\n  Nd: '#84a984',\n  Pm: '#71b18a',\n  Sm: '#66b68e',\n  Eu: '#4ac298',\n  Gd: '#37cb9e',\n  Tb: '#28d1a4',\n  Dy: '#1bd7a8',\n  Ho: '#00e98f',\n  Er: '#00e675',\n  Tm: '#00d452',\n  Yb: '#00bf38',\n  Lu: '#00ab24',\n  Hf: '#47b3ec',\n  Ta: '#4da6ff',\n  W: '#2194d6',\n  Re: '#267dab',\n  Os: '#266696',\n  Ir: '#175487',\n  Pt: '#9898a3',\n  Au: '#c19e1c',\n  Hg: '#9797ac',\n  Tl: '#a6544d',\n  Pb: '#575961',\n  Bi: '#9e4fb5',\n  Po: '#ab5c00',\n  At: '#754f45',\n  Rn: '#428296',\n  Fr: '#420066',\n  Ra: '#007d00',\n  Ac: '#6aa2ec',\n  Th: '#00baff',\n  Pa: '#00a1ff',\n  U: '#008fff',\n  Np: '#0080ff',\n  Pu: '#006bff',\n  Am: '#545cf2',\n  Cm: '#785ce3',\n  Bk: '#8a4fe3',\n  Cf: '#a136d4',\n  Es: '#b31fd4',\n  // Need to fix colors for the elements below (c)\n  Fm: '#000000',\n  Md: '#000000',\n  No: '#000000',\n  Lr: '#000000',\n  Rf: '#47b3ec',\n  Db: '#4da6ff',\n  Sg: '#2194d6',\n  Bh: '#267dab',\n  Hs: '#266696',\n  Mt: '#175487',\n  Ds: '#9898a3',\n  Rg: '#c19e1c',\n  Cn: '#9797ac',\n  Nh: '#000000',\n  Fl: '#000000',\n  Mc: '#000000',\n  Lv: '#000000',\n  Ts: '#000000',\n  Og: '#000000'\n} as const\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport type { Element } from './element.types'\n\nconst elementsArray: Array<Element> = [\n  {\n    number: 1,\n    label: 'H',\n    period: 1,\n    group: 1,\n    title: 'Hydrogen',\n    state: 'gas',\n    origin: 'primordial',\n    type: 'diatomic',\n    mass: 1.00794\n  },\n  {\n    number: 2,\n    label: 'He',\n    period: 1,\n    group: 8,\n    title: 'Helium',\n    state: 'gas',\n    origin: 'primordial',\n    type: 'noble',\n    mass: 4.0026022\n  },\n  {\n    number: 3,\n    label: 'Li',\n    period: 2,\n    group: 1,\n    title: 'Lithium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'alkali',\n    mass: 6.94\n  },\n  {\n    number: 4,\n    label: 'Be',\n    period: 2,\n    group: 2,\n    title: 'Beryllium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'alkaline-earth',\n    mass: 9.01218315\n  },\n  {\n    number: 5,\n    label: 'B',\n    period: 2,\n    group: 3,\n    title: 'Boron',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'metalloid',\n    mass: 10.81\n  },\n  {\n    number: 6,\n    label: 'C',\n    period: 2,\n    group: 4,\n    title: 'Carbon',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'polyatomic',\n    mass: 12.011\n  },\n  {\n    number: 7,\n    label: 'N',\n    period: 2,\n    group: 5,\n    title: 'Nitrogen',\n    state: 'gas',\n    origin: 'primordial',\n    type: 'diatomic',\n    mass: 14.007\n  },\n  {\n    number: 8,\n    label: 'O',\n    period: 2,\n    group: 6,\n    leftH: true,\n    title: 'Oxygen',\n    state: 'gas',\n    origin: 'primordial',\n    type: 'diatomic',\n    mass: 15.999\n  },\n  {\n    number: 9,\n    label: 'F',\n    period: 2,\n    group: 7,\n    leftH: true,\n    title: 'Fluorine',\n    state: 'gas',\n    origin: 'primordial',\n    type: 'diatomic',\n    mass: 18.9984031636\n  },\n  {\n    number: 10,\n    label: 'Ne',\n    period: 2,\n    group: 8,\n    title: 'Neon',\n    state: 'gas',\n    origin: 'primordial',\n    type: 'noble',\n    mass: 20.17976\n  },\n  {\n    number: 11,\n    label: 'Na',\n    period: 3,\n    group: 1,\n    title: 'Sodium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'alkali',\n    mass: 22.989769282\n  },\n  {\n    number: 12,\n    label: 'Mg',\n    period: 3,\n    group: 2,\n    title: 'Magnesium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'alkaline-earth',\n    mass: 24.305\n  },\n  {\n    number: 13,\n    label: 'Al',\n    period: 3,\n    group: 3,\n    title: 'Aluminium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'post-transition',\n    mass: 26.98153857\n  },\n  {\n    number: 14,\n    label: 'Si',\n    period: 3,\n    group: 4,\n    title: 'Silicon',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'metalloid',\n    mass: 28.085\n  },\n  {\n    number: 15,\n    label: 'P',\n    period: 3,\n    group: 5,\n    title: 'Phosphorus',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'polyatomic',\n    mass: 30.9737619985\n  },\n  {\n    number: 16,\n    label: 'S',\n    period: 3,\n    group: 6,\n    leftH: true,\n    title: 'Sulfur',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'polyatomic',\n    mass: 32.06\n  },\n  {\n    number: 17,\n    label: 'Cl',\n    period: 3,\n    group: 7,\n    leftH: true,\n    title: 'Chlorine',\n    state: 'gas',\n    origin: 'primordial',\n    type: 'diatomic',\n    mass: 35.45\n  },\n  {\n    number: 18,\n    label: 'Ar',\n    period: 3,\n    group: 8,\n    title: 'Argon',\n    state: 'gas',\n    origin: 'primordial',\n    type: 'noble',\n    mass: 39.9481\n  },\n  {\n    number: 19,\n    label: 'K',\n    period: 4,\n    group: 1,\n    title: 'Potassium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'alkali',\n    mass: 39.09831\n  },\n  {\n    number: 20,\n    label: 'Ca',\n    period: 4,\n    group: 2,\n    title: 'Calcium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'alkaline-earth',\n    mass: 40.0784\n  },\n  {\n    number: 21,\n    label: 'Sc',\n    period: 4,\n    group: 3,\n    title: 'Scandium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 44.9559085\n  },\n  {\n    number: 22,\n    label: 'Ti',\n    period: 4,\n    group: 4,\n    title: 'Titanium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 47.8671\n  },\n  {\n    number: 23,\n    label: 'V',\n    period: 4,\n    group: 5,\n    title: 'Vanadium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 50.94151\n  },\n  {\n    number: 24,\n    label: 'Cr',\n    period: 4,\n    group: 6,\n    title: 'Chromium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 51.99616\n  },\n  {\n    number: 25,\n    label: 'Mn',\n    period: 4,\n    group: 7,\n    title: 'Manganese',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 54.9380443\n  },\n  {\n    number: 26,\n    label: 'Fe',\n    period: 4,\n    group: 8,\n    title: 'Iron',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 55.8452\n  },\n  {\n    number: 27,\n    label: 'Co',\n    period: 4,\n    group: 8,\n    title: 'Cobalt',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 58.9331944\n  },\n  {\n    number: 28,\n    label: 'Ni',\n    period: 4,\n    group: 8,\n    title: 'Nickel',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 58.69344\n  },\n  {\n    number: 29,\n    label: 'Cu',\n    period: 4,\n    group: 1,\n    title: 'Copper',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 63.5463\n  },\n  {\n    number: 30,\n    label: 'Zn',\n    period: 4,\n    group: 2,\n    title: 'Zinc',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 65.382\n  },\n  {\n    number: 31,\n    label: 'Ga',\n    period: 4,\n    group: 3,\n    title: 'Gallium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'post-transition',\n    mass: 69.7231\n  },\n  {\n    number: 32,\n    label: 'Ge',\n    period: 4,\n    group: 4,\n    title: 'Germanium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'metalloid',\n    mass: 72.6308\n  },\n  {\n    number: 33,\n    label: 'As',\n    period: 4,\n    group: 5,\n    title: 'Arsenic',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'metalloid',\n    mass: 74.9215956\n  },\n  {\n    number: 34,\n    label: 'Se',\n    period: 4,\n    group: 6,\n    leftH: true,\n    title: 'Selenium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'polyatomic',\n    mass: 78.9718\n  },\n  {\n    number: 35,\n    label: 'Br',\n    period: 4,\n    group: 7,\n    leftH: true,\n    title: 'Bromine',\n    state: 'liquid',\n    origin: 'primordial',\n    type: 'diatomic',\n    mass: 79.904\n  },\n  {\n    number: 36,\n    label: 'Kr',\n    period: 4,\n    group: 8,\n    title: 'Krypton',\n    state: 'gas',\n    origin: 'primordial',\n    type: 'noble',\n    mass: 83.7982\n  },\n  {\n    number: 37,\n    label: 'Rb',\n    period: 5,\n    group: 1,\n    title: 'Rubidium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'alkali',\n    mass: 85.46783\n  },\n  {\n    number: 38,\n    label: 'Sr',\n    period: 5,\n    group: 2,\n    title: 'Strontium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'alkaline-earth',\n    mass: 87.621\n  },\n  {\n    number: 39,\n    label: 'Y',\n    period: 5,\n    group: 3,\n    title: 'Yttrium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 88.905842\n  },\n  {\n    number: 40,\n    label: 'Zr',\n    period: 5,\n    group: 4,\n    title: 'Zirconium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 91.2242\n  },\n  {\n    number: 41,\n    label: 'Nb',\n    period: 5,\n    group: 5,\n    title: 'Niobium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 92.906372\n  },\n  {\n    number: 42,\n    label: 'Mo',\n    period: 5,\n    group: 6,\n    title: 'Molybdenum',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 95.951\n  },\n  {\n    number: 43,\n    label: 'Tc',\n    period: 5,\n    group: 7,\n    title: 'Technetium',\n    state: 'solid',\n    origin: 'decay',\n    type: 'transition',\n    mass: 98\n  },\n  {\n    number: 44,\n    label: 'Ru',\n    period: 5,\n    group: 8,\n    title: 'Ruthenium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 101.072\n  },\n  {\n    number: 45,\n    label: 'Rh',\n    period: 5,\n    group: 8,\n    title: 'Rhodium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 102.905502\n  },\n  {\n    number: 46,\n    label: 'Pd',\n    period: 5,\n    group: 8,\n    title: 'Palladium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 106.421\n  },\n  {\n    number: 47,\n    label: 'Ag',\n    period: 5,\n    group: 1,\n    title: 'Silver',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 107.86822\n  },\n  {\n    number: 48,\n    label: 'Cd',\n    period: 5,\n    group: 2,\n    title: 'Cadmium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 112.4144\n  },\n  {\n    number: 49,\n    label: 'In', // 49\n    period: 5,\n    group: 3,\n    title: 'Indium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'post-transition',\n    mass: 114.8181\n  },\n  {\n    number: 50,\n    label: 'Sn',\n    period: 5,\n    group: 4,\n    title: 'Tin',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'post-transition',\n    mass: 118.7107\n  },\n  {\n    number: 51,\n    label: 'Sb',\n    period: 5,\n    group: 5,\n    title: 'Antimony',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'metalloid',\n    mass: 121.7601\n  },\n  {\n    number: 52,\n    label: 'Te',\n    period: 5,\n    group: 6,\n    title: 'Tellurium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'metalloid',\n    mass: 127.603\n  },\n  {\n    number: 53,\n    label: 'I',\n    period: 5,\n    group: 7,\n    leftH: true,\n    title: 'Iodine',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'diatomic',\n    mass: 126.904473\n  },\n  {\n    number: 54,\n    label: 'Xe',\n    period: 5,\n    group: 8,\n    title: 'Xenon',\n    state: 'gas',\n    origin: 'primordial',\n    type: 'noble',\n    mass: 131.2936\n  },\n  {\n    number: 55,\n    label: 'Cs',\n    period: 6,\n    group: 1,\n    title: 'Caesium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'alkali',\n    mass: 132.905451966\n  },\n  {\n    number: 56,\n    label: 'Ba',\n    period: 6,\n    group: 2,\n    title: 'Barium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'alkaline-earth',\n    mass: 137.3277\n  },\n  {\n    number: 57,\n    label: 'La',\n    period: 6,\n    group: 3,\n    title: 'Lanthanum',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 138.905477\n  },\n  {\n    number: 58,\n    label: 'Ce',\n    period: 6,\n    group: 3,\n    title: 'Cerium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 140.1161\n  },\n  {\n    number: 59,\n    label: 'Pr',\n    period: 6,\n    group: 3,\n    title: 'Praseodymium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 140.907662\n  },\n  {\n    number: 60,\n    label: 'Nd',\n    period: 6,\n    group: 3,\n    title: 'Neodymium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 144.2423\n  },\n  {\n    number: 61,\n    label: 'Pm',\n    period: 6,\n    group: 3,\n    title: 'Promethium',\n    state: 'solid',\n    origin: 'decay',\n    type: 'lanthanide',\n    mass: 145\n  },\n  {\n    number: 62,\n    label: 'Sm',\n    period: 6,\n    group: 3,\n    title: 'Samarium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 150.362\n  },\n  {\n    number: 63,\n    label: 'Eu',\n    period: 6,\n    group: 3,\n    title: 'Europium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 151.9641\n  },\n  {\n    number: 64,\n    label: 'Gd',\n    period: 6,\n    group: 3,\n    title: 'Gadolinium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 157.253\n  },\n  {\n    number: 65,\n    label: 'Tb',\n    period: 6,\n    group: 3,\n    title: 'Terbium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 158.925352\n  },\n  {\n    number: 66,\n    label: 'Dy',\n    period: 6,\n    group: 3,\n    title: 'Dysprosium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 162.5001\n  },\n  {\n    number: 67,\n    label: 'Ho',\n    period: 6,\n    group: 3,\n    title: 'Holmium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 164.930332\n  },\n  {\n    number: 68,\n    label: 'Er',\n    period: 6,\n    group: 3,\n    title: 'Erbium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 167.2593\n  },\n  {\n    number: 69,\n    label: 'Tm',\n    period: 6,\n    group: 3,\n    title: 'Thulium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 168.934222\n  },\n  {\n    number: 70,\n    label: 'Yb',\n    period: 6,\n    group: 3,\n    title: 'Ytterbium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 173.0451\n  },\n  {\n    number: 71,\n    label: 'Lu',\n    period: 6,\n    group: 3,\n    title: 'Lutetium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'lanthanide',\n    mass: 174.96681\n  },\n  {\n    number: 72,\n    label: 'Hf',\n    period: 6,\n    group: 4,\n    title: 'Hafnium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 178.492\n  },\n  {\n    number: 73,\n    label: 'Ta',\n    period: 6,\n    group: 5,\n    title: 'Tantalum',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 180.947882\n  },\n  {\n    number: 74,\n    label: 'W',\n    period: 6,\n    group: 6,\n    title: 'Tungsten',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 183.841\n  },\n  {\n    number: 75,\n    label: 'Re',\n    period: 6,\n    group: 7,\n    title: 'Rhenium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 186.2071\n  },\n  {\n    number: 76,\n    label: 'Os',\n    period: 6,\n    group: 8,\n    title: 'Osmium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 190.233\n  },\n  {\n    number: 77,\n    label: 'Ir',\n    period: 6,\n    group: 8,\n    title: 'Iridium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 192.2173\n  },\n  {\n    number: 78,\n    label: 'Pt',\n    period: 6,\n    group: 8,\n    title: 'Platinum',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 195.0849\n  },\n  {\n    number: 79,\n    label: 'Au',\n    period: 6,\n    group: 1,\n    title: 'Gold',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 196.9665695\n  },\n  {\n    number: 80,\n    label: 'Hg',\n    period: 6,\n    group: 2,\n    title: 'Mercury',\n    state: 'liquid',\n    origin: 'primordial',\n    type: 'transition',\n    mass: 200.5923\n  },\n  {\n    number: 81,\n    label: 'Tl',\n    period: 6,\n    group: 3,\n    title: 'Thallium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'post-transition',\n    mass: 204.38\n  },\n  {\n    number: 82,\n    label: 'Pb',\n    period: 6,\n    group: 4,\n    title: 'Lead',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'post-transition',\n    mass: 207.21\n  },\n  {\n    number: 83,\n    label: 'Bi',\n    period: 6,\n    group: 5,\n    title: 'Bismuth',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'post-transition',\n    mass: 208.980401\n  },\n  {\n    number: 84,\n    label: 'Po',\n    period: 6,\n    group: 6,\n    title: 'Polonium',\n    state: 'solid',\n    origin: 'decay',\n    type: 'post-transition',\n    mass: 209\n  },\n  {\n    number: 85,\n    label: 'At',\n    period: 6,\n    group: 7,\n    title: 'Astatine',\n    state: 'solid',\n    origin: 'decay',\n    type: 'metalloid',\n    mass: 210\n  },\n  {\n    number: 86,\n    label: 'Rn',\n    period: 6,\n    group: 8,\n    title: 'Radon',\n    state: 'gas',\n    origin: 'decay',\n    type: 'noble',\n    mass: 222\n  },\n  {\n    number: 87,\n    label: 'Fr',\n    period: 7,\n    group: 1,\n    title: 'Francium',\n    state: 'solid',\n    origin: 'decay',\n    type: 'alkali',\n    mass: 223\n  },\n  {\n    number: 88,\n    label: 'Ra',\n    period: 7,\n    group: 2,\n    title: 'Radium',\n    state: 'solid',\n    origin: 'decay',\n    type: 'alkaline-earth',\n    mass: 226\n  },\n  {\n    number: 89,\n    label: 'Ac',\n    period: 7,\n    group: 3,\n    title: 'Actinium',\n    state: 'solid',\n    origin: 'decay',\n    type: 'actinide',\n    mass: 227\n  },\n  {\n    number: 90,\n    label: 'Th',\n    period: 7,\n    group: 3,\n    title: 'Thorium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'actinide',\n    mass: 232.03774\n  },\n  {\n    number: 91,\n    label: 'Pa',\n    period: 7,\n    group: 3,\n    title: 'Protactinium',\n    state: 'solid',\n    origin: 'decay',\n    type: 'actinide',\n    mass: 231.035882\n  },\n  {\n    number: 92,\n    label: 'U',\n    period: 7,\n    group: 3,\n    title: 'Uranium',\n    state: 'solid',\n    origin: 'primordial',\n    type: 'actinide',\n    mass: 238.028913\n  },\n  {\n    number: 93,\n    label: 'Np',\n    period: 7,\n    group: 3,\n    title: 'Neptunium',\n    state: 'solid',\n    origin: 'decay',\n    type: 'actinide',\n    mass: 237\n  },\n  {\n    number: 94,\n    label: 'Pu',\n    period: 7,\n    group: 3,\n    title: 'Plutonium',\n    state: 'solid',\n    origin: 'decay',\n    type: 'actinide',\n    mass: 244\n  },\n  {\n    number: 95,\n    label: 'Am',\n    period: 7,\n    group: 3,\n    title: 'Americium',\n    state: 'solid',\n    origin: 'synthetic',\n    type: 'actinide',\n    mass: 243\n  },\n  {\n    number: 96,\n    label: 'Cm',\n    period: 7,\n    group: 3,\n    title: 'Curium',\n    state: 'solid',\n    origin: 'synthetic',\n    type: 'actinide',\n    mass: 247\n  },\n  {\n    number: 97,\n    label: 'Bk',\n    period: 7,\n    group: 3,\n    title: 'Berkelium',\n    state: 'solid',\n    origin: 'synthetic',\n    type: 'actinide',\n    mass: 247\n  },\n  {\n    number: 98,\n    label: 'Cf',\n    period: 7,\n    group: 3,\n    title: 'Californium',\n    state: 'solid',\n    origin: 'synthetic',\n    type: 'actinide',\n    mass: 251\n  },\n  {\n    number: 99,\n    label: 'Es',\n    period: 7,\n    group: 3,\n    title: 'Einsteinium',\n    state: 'solid',\n    origin: 'synthetic',\n    type: 'actinide',\n    mass: 252\n  },\n  {\n    number: 100,\n    label: 'Fm',\n    period: 7,\n    group: 3,\n    title: 'Fermium',\n    origin: 'synthetic',\n    type: 'actinide',\n    mass: 257\n  },\n  {\n    number: 101,\n    label: 'Md',\n    period: 7,\n    group: 3,\n    title: 'Mendelevium',\n    origin: 'synthetic',\n    type: 'actinide',\n    mass: 258\n  },\n  {\n    number: 102,\n    label: 'No',\n    period: 7,\n    group: 3,\n    title: 'Nobelium',\n    origin: 'synthetic',\n    type: 'actinide',\n    mass: 259\n  },\n  {\n    number: 103,\n    label: 'Lr',\n    period: 7,\n    group: 3,\n    title: 'Lawrencium',\n    origin: 'synthetic',\n    type: 'actinide',\n    mass: 266\n  },\n  {\n    number: 104,\n    label: 'Rf',\n    period: 7,\n    group: 4,\n    title: 'Rutherfordium',\n    origin: 'synthetic',\n    type: 'transition',\n    mass: 267\n  },\n  {\n    number: 105,\n    label: 'Db',\n    period: 7,\n    group: 5,\n    title: 'Dubnium',\n    origin: 'synthetic',\n    type: 'transition',\n    mass: 268\n  },\n  {\n    number: 106,\n    label: 'Sg',\n    period: 7,\n    group: 6,\n    title: 'Seaborgium',\n    origin: 'synthetic',\n    type: 'transition',\n    mass: 269\n  },\n  {\n    number: 107,\n    label: 'Bh',\n    period: 7,\n    group: 7,\n    title: 'Bohrium',\n    origin: 'synthetic',\n    type: 'transition',\n    mass: 270\n  },\n  {\n    number: 108,\n    label: 'Hs',\n    period: 7,\n    group: 8,\n    title: 'Hassium',\n    origin: 'synthetic',\n    type: 'transition',\n    mass: 269\n  },\n  {\n    number: 109,\n    label: 'Mt',\n    period: 7,\n    group: 8,\n    title: 'Meitnerium',\n    origin: 'synthetic',\n    mass: 278\n  },\n  {\n    number: 110,\n    label: 'Ds',\n    period: 7,\n    group: 8,\n    title: 'Darmstadtium',\n    origin: 'synthetic',\n    mass: 281\n  },\n  {\n    number: 111,\n    label: 'Rg',\n    period: 7,\n    group: 1,\n    title: 'Roentgenium',\n    origin: 'synthetic',\n    mass: 282\n  },\n  {\n    number: 112,\n    label: 'Cn',\n    period: 7,\n    group: 2,\n    title: 'Copernicium',\n    origin: 'synthetic',\n    type: 'transition',\n    mass: 285\n  },\n  {\n    number: 113,\n    label: 'Nh',\n    period: 7,\n    group: 3,\n    title: 'Nihonium',\n    origin: 'synthetic',\n    mass: 286\n  },\n  {\n    number: 114,\n    label: 'Fl',\n    period: 7,\n    group: 4,\n    title: 'Flerovium',\n    origin: 'synthetic',\n    type: 'post-transition',\n    mass: 289\n  },\n  {\n    number: 115,\n    label: 'Mc',\n    period: 7,\n    group: 5,\n    title: 'Moscovium',\n    origin: 'synthetic',\n    mass: 289\n  },\n  {\n    number: 116,\n    label: 'Lv',\n    period: 7,\n    group: 6,\n    title: 'Livermorium',\n    origin: 'synthetic',\n    mass: 293\n  },\n  {\n    number: 117,\n    label: 'Ts',\n    period: 7,\n    group: 7,\n    title: 'Tennessine',\n    origin: 'synthetic',\n    mass: 294\n  },\n  {\n    number: 118,\n    label: 'Og',\n    period: 7,\n    group: 8,\n    title: 'Oganesson',\n    origin: 'synthetic',\n    mass: 294\n  }\n]\n\nconst elementsMap = elementsArray.reduce((acc, element) => {\n  acc.set(element.label, element)\n  acc.set(element.number, element)\n  return acc\n}, new Map<string | number, Element>())\n\nexport const Elements = {\n  get: (key: number | string): Element | undefined => elementsMap.get(key),\n  filter: (predicate: (element: Element) => boolean): Array<Element> => {\n    return elementsArray.filter(predicate)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nexport const Generics = {\n  atom: {\n    any: {\n      labels: ['A', 'AH']\n    },\n    'no-carbon': {\n      labels: ['Q', 'QH']\n    },\n    metal: {\n      labels: ['M', 'MH']\n    },\n    halogen: {\n      labels: ['X', 'XH']\n    }\n  },\n  group: {\n    labels: ['G', 'GH', 'G*', 'GH*'],\n    acyclic: {\n      labels: ['ACY', 'ACH'],\n      carbo: {\n        labels: ['ABC', 'ABH'],\n        alkynyl: {\n          labels: ['AYL', 'AYH']\n        },\n        alkyl: {\n          labels: ['ALK', 'ALH']\n        },\n        alkenyl: {\n          labels: ['AEL', 'AEH']\n        }\n      },\n      hetero: {\n        labels: ['AHC', 'AHH'],\n        alkoxy: {\n          labels: ['AOX', 'AOH']\n        }\n      }\n    },\n    cyclic: {\n      labels: ['CYC', 'CYH'],\n      'no-carbon': {\n        labels: ['CXX', 'CXH']\n      },\n      carbo: {\n        labels: ['CBC', 'CBH'],\n        aryl: {\n          labels: ['ARY', 'ARH']\n        },\n        cycloalkyl: {\n          labels: ['CAL', 'CAH']\n        },\n        cycloalkenyl: {\n          labels: ['CEL', 'CEH']\n        }\n      },\n      hetero: {\n        labels: ['CHC', 'CHH'],\n        aryl: {\n          labels: ['HAR', 'HAH']\n        }\n      }\n    }\n  },\n  special: {\n    labels: ['H+', 'D', 'T', 'R', 'Pol']\n  }\n} as const\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { ElementLabel, Elements } from 'domain/constants'\n\nexport interface AtomListParams {\n  readonly notList: boolean\n  readonly ids: Array<number>\n}\n\nexport class AtomList {\n  notList: boolean\n  ids: Array<number>\n\n  constructor(params: AtomListParams) {\n    this.notList = params.notList\n    this.ids = params.ids\n  }\n\n  labelList() {\n    const labels: Array<ElementLabel> = []\n    for (let id of this.ids) {\n      const currenElement = Elements.get(id)\n      currenElement && labels.push(currenElement!.label)\n    }\n\n    return labels\n  }\n\n  label() {\n    let label = '[' + this.labelList().join(',') + ']'\n    if (this.notList) {\n      label = '!' + label\n    }\n    return label\n  }\n\n  equals(atomList: AtomList) {\n    return (\n      this.notList === atomList.notList &&\n      (this.ids || []).sort().toString() ===\n        (atomList.ids || []).sort().toString()\n    )\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { AtomList, AtomListParams } from './AtomList'\n\nimport { Elements } from 'domain/constants'\nimport { Pile } from './Pile'\nimport { Vec2 } from './Vec2'\n\nfunction getValueOrDefault<T>(value: T | undefined, defaultValue: T): T {\n  return typeof value !== 'undefined' ? value : defaultValue\n}\n\nfunction getPseudo(label: string) {\n  return !Elements.get(label) &&\n    label !== 'L' &&\n    label !== 'L#' &&\n    label !== 'R#'\n    ? label\n    : ''\n}\n\nexport function radicalElectrons(radical: any) {\n  radical -= 0\n  if (radical === Atom.PATTERN.RADICAL.DOUPLET) return 1\n  else if (\n    radical === Atom.PATTERN.RADICAL.SINGLET ||\n    radical === Atom.PATTERN.RADICAL.TRIPLET\n  )\n    return 2\n  else {\n    return 0\n  }\n}\n\nexport enum StereoLabel {\n  Abs = 'abs',\n  And = '&',\n  Or = 'or'\n}\n\nexport interface AtomParams {\n  stereoParity?: number\n  stereoLabel?: string | null\n  exactChangeFlag?: number\n  rxnFragmentType?: number\n  invRet?: number\n  aam?: number\n  hCount?: number\n  unsaturatedAtom?: number\n  substitutionCount?: number\n  ringBondCount?: number\n  explicitValence?: number\n  attpnt?: any\n  rglabel?: string | null\n  charge?: number\n  radical?: number\n  isotope?: number\n  alias?: string | null\n  pseudo?: string\n  atomList?: AtomListParams | null\n  label: string\n  fragment?: number\n  pp?: Vec2\n  implicitH: number\n}\n\nexport class Atom {\n  static PATTERN = {\n    RADICAL: {\n      NONE: 0,\n      SINGLET: 1,\n      DOUPLET: 2,\n      TRIPLET: 3\n    },\n    STEREO_PARITY: {\n      NONE: 0,\n      ODD: 1,\n      EVEN: 2,\n      EITHER: 3\n    }\n  }\n\n  //TODO: rename\n  static attrlist = {\n    alias: null,\n    label: 'C',\n    isotope: 0,\n    radical: 0,\n    charge: 0,\n    explicitValence: -1,\n    ringBondCount: 0,\n    substitutionCount: 0,\n    unsaturatedAtom: 0,\n    hCount: 0,\n    atomList: null,\n    invRet: 0,\n    exactChangeFlag: 0,\n    rglabel: null,\n    attpnt: null,\n    aam: 0,\n    // enhanced stereo\n    stereoLabel: null,\n    stereoParity: 0\n  }\n\n  label: string\n  fragment: number\n  atomList: AtomList | null\n  attpnt: any\n  isotope: number\n  hCount: number\n  radical: number\n  charge: number\n  explicitValence: number\n  ringBondCount: number\n  unsaturatedAtom: number\n  substitutionCount: number\n  valence: number\n  implicitH: number\n  pp: Vec2\n  neighbors: Array<number>\n  sgs: Pile<any>\n  badConn: boolean\n  alias: string | null\n  rglabel: string | null\n  aam: number\n  invRet: number\n  exactChangeFlag: number\n  rxnFragmentType: number\n  stereoLabel?: string | null\n  stereoParity: number\n  hasImplicitH?: boolean\n  pseudo!: string\n\n  constructor(params: AtomParams) {\n    this.label = params.label\n    this.fragment = getValueOrDefault(params.fragment, -1)\n    this.alias = getValueOrDefault(params.alias, Atom.attrlist.alias)\n    this.isotope = getValueOrDefault(params.isotope, Atom.attrlist.isotope)\n    this.radical = getValueOrDefault(params.radical, Atom.attrlist.radical)\n    this.charge = getValueOrDefault(params.charge, Atom.attrlist.charge)\n    this.rglabel = getValueOrDefault(params.rglabel, Atom.attrlist.rglabel)\n    this.attpnt = getValueOrDefault(params.attpnt, Atom.attrlist.attpnt)\n    this.explicitValence = getValueOrDefault(\n      params.explicitValence,\n      Atom.attrlist.explicitValence\n    )\n\n    this.valence = 0\n    this.implicitH = params.implicitH || 0 // implicitH is not an attribute\n    this.pp = params.pp ? new Vec2(params.pp) : new Vec2()\n\n    // sgs should only be set when an atom is added to an s-group by an appropriate method,\n    //   or else a copied atom might think it belongs to a group, but the group be unaware of the atom\n    // TODO: make a consistency check on atom/s-group assignments\n    this.sgs = new Pile()\n\n    // query\n    this.ringBondCount = getValueOrDefault(\n      params.ringBondCount,\n      Atom.attrlist.ringBondCount\n    )\n    this.substitutionCount = getValueOrDefault(\n      params.substitutionCount,\n      Atom.attrlist.substitutionCount\n    )\n    this.unsaturatedAtom = getValueOrDefault(\n      params.unsaturatedAtom,\n      Atom.attrlist.unsaturatedAtom\n    )\n    this.hCount = getValueOrDefault(params.hCount, Atom.attrlist.hCount)\n\n    // reaction\n    this.aam = getValueOrDefault(params.aam, Atom.attrlist.aam)\n    this.invRet = getValueOrDefault(params.invRet, Atom.attrlist.invRet)\n    this.exactChangeFlag = getValueOrDefault(\n      params.exactChangeFlag,\n      Atom.attrlist.exactChangeFlag\n    )\n    this.rxnFragmentType = getValueOrDefault(params.rxnFragmentType, -1)\n\n    // stereo\n    this.stereoLabel = getValueOrDefault(\n      params.stereoLabel,\n      Atom.attrlist.stereoLabel\n    )\n    this.stereoParity = getValueOrDefault(\n      params.stereoParity,\n      Atom.attrlist.stereoParity\n    )\n\n    this.atomList = params.atomList ? new AtomList(params.atomList) : null\n    this.neighbors = [] // set of half-bonds having this atom as their origin\n    this.badConn = false\n\n    Object.defineProperty(this, 'pseudo', {\n      enumerable: true,\n      get: function () {\n        return getPseudo(this.label)\n      }\n    })\n  }\n\n  static getAttrHash(atom: Atom) {\n    const attrs = {}\n    for (let attr in Atom.attrlist) {\n      if (typeof atom[attr] !== 'undefined') attrs[attr] = atom[attr]\n    }\n    return attrs\n  }\n\n  static attrGetDefault(attr: string) {\n    if (attr in Atom.attrlist) return Atom.attrlist[attr]\n    return console.assert(false, 'Attribute unknown')\n  }\n\n  clone(fidMap: Map<number, number>): Atom {\n    const ret = new Atom(this)\n    if (fidMap && fidMap.has(this.fragment))\n      ret.fragment = fidMap.get(this.fragment)!\n    return ret\n  }\n\n  isQuery(): boolean {\n    return (\n      this.atomList !== null || this.label === 'A' || this.attpnt || this.hCount\n    )\n  }\n\n  pureHydrogen(): boolean {\n    return this.label === 'H' && this.isotope === 0\n  }\n\n  isPlainCarbon(): boolean {\n    return (\n      this.label === 'C' &&\n      this.isotope === 0 &&\n      this.radical === 0 &&\n      this.charge === 0 &&\n      this.explicitValence < 0 &&\n      this.ringBondCount === 0 &&\n      this.substitutionCount === 0 &&\n      this.unsaturatedAtom === 0 &&\n      this.hCount === 0 &&\n      !this.atomList\n    )\n  }\n\n  isPseudo(): boolean {\n    // TODO: handle reaxys generics separately\n    return !this.atomList && !this.rglabel && !Elements.get(this.label)\n  }\n\n  hasRxnProps(): boolean {\n    return !!(\n      this.invRet ||\n      this.exactChangeFlag ||\n      this.attpnt !== null ||\n      this.aam\n    )\n  }\n\n  calcValence(conn: number): boolean {\n    const label = this.label\n    const charge = this.charge\n    if (this.isQuery()) {\n      this.implicitH = 0\n      return true\n    }\n    const element = Elements.get(label)\n    if (!element) {\n      this.implicitH = 0\n      return true\n    }\n\n    var groupno = element.group\n    var rad = radicalElectrons(this.radical)\n    var valence = conn\n    var hyd = 0\n    var absCharge = Math.abs(charge)\n    if (groupno === 1) {\n      if (\n        label === 'H' ||\n        label === 'Li' ||\n        label === 'Na' ||\n        label === 'K' ||\n        label === 'Rb' ||\n        label === 'Cs' ||\n        label === 'Fr'\n      ) {\n        valence = 1\n        hyd = 1 - rad - conn - absCharge\n      }\n    } else if (groupno === 2) {\n      if (conn + rad + absCharge === 2 || conn + rad + absCharge === 0)\n        valence = 2\n      else hyd = -1\n    } else if (groupno === 3) {\n      if (label === 'B' || label === 'Al' || label === 'Ga' || label === 'In') {\n        if (charge === -1) {\n          valence = 4\n          hyd = 4 - rad - conn\n        } else {\n          valence = 3\n          hyd = 3 - rad - conn - absCharge\n        }\n      } else if (label === 'Tl') {\n        if (charge === -1) {\n          if (rad + conn <= 2) {\n            valence = 2\n            hyd = 2 - rad - conn\n          } else {\n            valence = 4\n            hyd = 4 - rad - conn\n          }\n        } else if (charge === -2) {\n          if (rad + conn <= 3) {\n            valence = 3\n            hyd = 3 - rad - conn\n          } else {\n            valence = 5\n            hyd = 5 - rad - conn\n          }\n        } else if (rad + conn + absCharge <= 1) {\n          valence = 1\n          hyd = 1 - rad - conn - absCharge\n        } else {\n          valence = 3\n          hyd = 3 - rad - conn - absCharge\n        }\n      }\n    } else if (groupno === 4) {\n      if (label === 'C' || label === 'Si' || label === 'Ge') {\n        valence = 4\n        hyd = 4 - rad - conn - absCharge\n      } else if (label === 'Sn' || label === 'Pb') {\n        if (conn + rad + absCharge <= 2) {\n          valence = 2\n          hyd = 2 - rad - conn - absCharge\n        } else {\n          valence = 4\n          hyd = 4 - rad - conn - absCharge\n        }\n      }\n    } else if (groupno === 5) {\n      if (label === 'N' || label === 'P') {\n        if (charge === 1) {\n          valence = 4\n          hyd = 4 - rad - conn\n        } else if (charge === 2) {\n          valence = 3\n          hyd = 3 - rad - conn\n        } else if (label === 'N' || rad + conn + absCharge <= 3) {\n          valence = 3\n          hyd = 3 - rad - conn - absCharge\n        } else {\n          // ELEM_P && rad + conn + absCharge > 3\n          valence = 5\n          hyd = 5 - rad - conn - absCharge\n        }\n      } else if (label === 'Bi' || label === 'Sb' || label === 'As') {\n        if (charge === 1) {\n          if (rad + conn <= 2 && label !== 'As') {\n            valence = 2\n            hyd = 2 - rad - conn\n          } else {\n            valence = 4\n            hyd = 4 - rad - conn\n          }\n        } else if (charge === 2) {\n          valence = 3\n          hyd = 3 - rad - conn\n        } else if (rad + conn <= 3) {\n          valence = 3\n          hyd = 3 - rad - conn - absCharge\n        } else {\n          valence = 5\n          hyd = 5 - rad - conn - absCharge\n        }\n      }\n    } else if (groupno === 6) {\n      if (label === 'O') {\n        if (charge >= 1) {\n          valence = 3\n          hyd = 3 - rad - conn\n        } else {\n          valence = 2\n          hyd = 2 - rad - conn - absCharge\n        }\n      } else if (label === 'S' || label === 'Se' || label === 'Po') {\n        if (charge === 1) {\n          if (conn <= 3) {\n            valence = 3\n            hyd = 3 - rad - conn\n          } else {\n            valence = 5\n            hyd = 5 - rad - conn\n          }\n        } else if (conn + rad + absCharge <= 2) {\n          valence = 2\n          hyd = 2 - rad - conn - absCharge\n        } else if (conn + rad + absCharge <= 4) {\n          // See examples in PubChem\n          // [S] : CID 16684216\n          // [Se]: CID 5242252\n          // [Po]: no example, just following ISIS/Draw logic here\n          valence = 4\n          hyd = 4 - rad - conn - absCharge\n        } else {\n          // See examples in PubChem\n          // [S] : CID 46937044\n          // [Se]: CID 59786\n          // [Po]: no example, just following ISIS/Draw logic here\n          valence = 6\n          hyd = 6 - rad - conn - absCharge\n        }\n      } else if (label === 'Te') {\n        if (charge === -1) {\n          if (conn <= 2) {\n            valence = 2\n            hyd = 2 - rad - conn - absCharge\n          }\n        } else if (charge === 0 || charge === 2) {\n          if (conn <= 2) {\n            valence = 2\n            hyd = 2 - rad - conn - absCharge\n          } else if (conn <= 4) {\n            valence = 4\n            hyd = 4 - rad - conn - absCharge\n          } else if (charge === 0 && conn <= 6) {\n            valence = 6\n            hyd = 6 - rad - conn - absCharge\n          } else {\n            hyd = -1\n          }\n        }\n      }\n    } else if (groupno === 7) {\n      if (label === 'F') {\n        valence = 1\n        hyd = 1 - rad - conn - absCharge\n      } else if (\n        label === 'Cl' ||\n        label === 'Br' ||\n        label === 'I' ||\n        label === 'At'\n      ) {\n        if (charge === 1) {\n          if (conn <= 2) {\n            valence = 2\n            hyd = 2 - rad - conn\n          } else if (conn === 3 || conn === 5 || conn >= 7) {\n            hyd = -1\n          }\n        } else if (charge === 0) {\n          if (conn <= 1) {\n            valence = 1\n            hyd = 1 - rad - conn\n            // While the halogens can have valence 3, they can not have\n            // hydrogens in that case.\n          } else if (conn === 2 || conn === 4 || conn === 6) {\n            if (rad === 1) {\n              valence = conn\n              hyd = 0\n            } else {\n              hyd = -1 // will throw an error in the end\n            }\n          } else if (conn > 7) {\n            hyd = -1 // will throw an error in the end\n          }\n        }\n      }\n    } else if (groupno === 8) {\n      if (conn + rad + absCharge === 0) valence = 1\n      else hyd = -1\n    }\n\n    this.valence = valence\n    this.implicitH = hyd\n    if (this.implicitH < 0) {\n      this.valence = conn\n      this.implicitH = 0\n      this.badConn = true\n      return false\n    }\n    return true\n  }\n\n  calcValenceMinusHyd(conn: number): number {\n    const charge = this.charge\n    const label = this.label\n    const element = Elements.get(this.label)\n    if (!element) {\n      console.assert('Element ' + label + ' unknown')\n      // query atom, skip\n      this.implicitH = 0\n      return 0\n    }\n\n    var groupno = element.group\n    var rad = radicalElectrons(this.radical)\n\n    if (groupno === 3) {\n      if (label === 'B' || label === 'Al' || label === 'Ga' || label === 'In') {\n        if (charge === -1) {\n          if (rad + conn <= 4) return rad + conn\n        }\n      }\n    } else if (groupno === 5) {\n      if (label === 'N' || label === 'P') {\n        if (charge === 1) return rad + conn\n        if (charge === 2) return rad + conn\n      } else if (label === 'Sb' || label === 'Bi' || label === 'As') {\n        if (charge === 1) return rad + conn\n        else if (charge === 2) return rad + conn\n      }\n    } else if (groupno === 6) {\n      if (label === 'O') {\n        if (charge >= 1) return rad + conn\n      } else if (label === 'S' || label === 'Se' || label === 'Po') {\n        if (charge === 1) return rad + conn\n      }\n    } else if (groupno === 7) {\n      if (label === 'Cl' || label === 'Br' || label === 'I' || label === 'At') {\n        if (charge === 1) return rad + conn\n      }\n    }\n\n    return rad + conn + Math.abs(charge)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nexport class Pile<TValue = any> extends Set<TValue> {\n  // TODO: it's used only in dfs.js in one place in some strange way.\n  // Should be removed after dfs.js refactoring\n  find(predicate: (TValue) => boolean) {\n    for (const item of this) {\n      if (predicate(item)) return item\n    }\n\n    return null\n  }\n\n  equals(setB: Pile): boolean {\n    return this.isSuperset(setB) && setB.isSuperset(this)\n  }\n\n  isSuperset(subset: Pile): boolean {\n    for (const item of subset) {\n      if (!this.has(item)) return false\n    }\n\n    return true\n  }\n\n  filter(expression: (arg: TValue) => boolean): Pile<TValue> {\n    return new Pile(Array.from(this).filter(expression))\n  }\n\n  union(setB: Pile): Pile<TValue> {\n    const union = new Pile(this)\n\n    for (const item of setB) union.add(item)\n\n    return union\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nexport interface Point {\n  x?: number\n  y?: number\n  z?: number\n}\nexport class Vec2 {\n  static ZERO = new Vec2(0, 0)\n  static UNIT = new Vec2(1, 1)\n\n  x: number\n  y: number\n  z: number\n\n  constructor(point: Point)\n  constructor(x?: number, y?: number, z?: number)\n  constructor(...args: Array<any>) {\n    if (args.length === 0) {\n      this.x = 0\n      this.y = 0\n      this.z = 0\n    } else if (arguments.length === 1) {\n      this.x = parseFloat(args[0].x || 0)\n      this.y = parseFloat(args[0].y || 0)\n      this.z = parseFloat(args[0].z || 0)\n    } else if (arguments.length === 2) {\n      this.x = parseFloat(args[0] || 0)\n      this.y = parseFloat(args[1] || 0)\n      this.z = 0\n    } else if (arguments.length === 3) {\n      this.x = parseFloat(args[0])\n      this.y = parseFloat(args[1])\n      this.z = parseFloat(args[2])\n    } else {\n      throw new Error('Vec2(): invalid arguments')\n    }\n  }\n\n  static dist(a: Vec2, b: Vec2): number {\n    return Vec2.diff(a, b).length()\n  }\n\n  static max(v1: Vec2, v2: Vec2): Vec2 {\n    return new Vec2(\n      Math.max(v1.x, v2.x),\n      Math.max(v1.y, v2.y),\n      Math.max(v1.z, v2.z)\n    )\n  }\n\n  static min(v1: Vec2, v2: Vec2): Vec2 {\n    return new Vec2(\n      Math.min(v1.x, v2.x),\n      Math.min(v1.y, v2.y),\n      Math.min(v1.z, v2.z)\n    )\n  }\n\n  static sum(v1: Vec2, v2: Vec2): Vec2 {\n    return new Vec2(v1.x + v2.x, v1.y + v2.y, v1.z + v2.z)\n  }\n\n  static dot(v1: Vec2, v2: Vec2): number {\n    return v1.x * v2.x + v1.y * v2.y\n  }\n\n  static cross(v1: Vec2, v2: Vec2): number {\n    return v1.x * v2.y - v1.y * v2.x\n  }\n\n  static angle(v1: Vec2, v2: Vec2): number {\n    return Math.atan2(Vec2.cross(v1, v2), Vec2.dot(v1, v2))\n  }\n\n  static diff(v1: Vec2, v2: Vec2): Vec2 {\n    return new Vec2(v1.x - v2.x, v1.y - v2.y, v1.z - v2.z)\n  }\n\n  // assume arguments v1, f1, v2, f2, v3, f3, etc.\n  // where v[i] are vectors and f[i] are corresponding coefficients\n  static lc(...args: Array<Vec2 | number>): Vec2 {\n    let v = new Vec2()\n    for (let i = 0; i < arguments.length / 2; ++i)\n      v = v.addScaled(args[2 * i] as Vec2, args[2 * i + 1] as number)\n    return v\n  }\n\n  static lc2(v1: Vec2, f1: number, v2: Vec2, f2: number): Vec2 {\n    return new Vec2(\n      v1.x * f1 + v2.x * f2,\n      v1.y * f1 + v2.y * f2,\n      v1.z * f1 + v2.z * f2\n    )\n  }\n\n  static centre(v1: Vec2, v2: Vec2) {\n    return Vec2.lc2(v1, 0.5, v2, 0.5)\n  }\n\n  length(): number {\n    return Math.sqrt(this.x * this.x + this.y * this.y)\n  }\n\n  equals(v: Vec2): boolean {\n    return this.x === v.x && this.y === v.y\n  }\n\n  add(v: Vec2): Vec2 {\n    return new Vec2(this.x + v.x, this.y + v.y, this.z + v.z)\n  }\n\n  add_(v: Vec2): void {\n    this.x += v.x\n    this.y += v.y\n    this.z += v.z\n  }\n\n  get_xy0(): Vec2 {\n    return new Vec2(this.x, this.y)\n  }\n\n  sub(v: Vec2): Vec2 {\n    return new Vec2(this.x - v.x, this.y - v.y, this.z - v.z)\n  }\n\n  scaled(s: number): Vec2 {\n    return new Vec2(this.x * s, this.y * s, this.z * s)\n  }\n\n  negated(): Vec2 {\n    return new Vec2(-this.x, -this.y, -this.z)\n  }\n\n  yComplement(y1: number): Vec2 {\n    y1 = y1 || 0\n    return new Vec2(this.x, y1 - this.y, this.z)\n  }\n\n  addScaled(v: Vec2, f: number): Vec2 {\n    return new Vec2(this.x + v.x * f, this.y + v.y * f, this.z + v.z * f)\n  }\n\n  normalized(): Vec2 {\n    return this.scaled(1 / this.length())\n  }\n\n  normalize(): boolean {\n    const l = this.length()\n\n    if (l < 0.000001) return false\n\n    this.x /= l\n    this.y /= l\n\n    return true\n  }\n\n  turnLeft(): Vec2 {\n    return new Vec2(-this.y, this.x, this.z)\n  }\n\n  coordStr(): string {\n    return this.x.toString() + ' , ' + this.y.toString()\n  }\n\n  toString(): string {\n    return '(' + this.x.toFixed(2) + ',' + this.y.toFixed(2) + ')'\n  }\n\n  max(v: Vec2): Vec2 {\n    console.assert(!!v)\n    return Vec2.max(this, v)\n  }\n\n  min(v: Vec2): Vec2 {\n    return Vec2.min(this, v)\n  }\n\n  ceil() {\n    return new Vec2(Math.ceil(this.x), Math.ceil(this.y), Math.ceil(this.z))\n  }\n\n  floor() {\n    return new Vec2(Math.floor(this.x), Math.floor(this.y), Math.floor(this.z))\n  }\n\n  rotate(angle: number) {\n    const sin = Math.sin(angle)\n    const cos = Math.cos(angle)\n\n    return this.rotateSC(sin, cos)\n  }\n\n  rotateSC(sin: number, cos: number): Vec2 {\n    console.assert(sin === 0 || !!sin)\n    console.assert(cos === 0 || !!cos)\n\n    return new Vec2(\n      this.x * cos - this.y * sin,\n      this.x * sin + this.y * cos,\n      this.z\n    )\n  }\n\n  oxAngle(): number {\n    return Math.atan2(this.y, this.x)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Bond } from './Bond'\nimport { StereoLabel } from './Atom'\nimport { Struct } from './Struct'\nimport { Vec2 } from './Vec2'\n\nexport enum StereoFlag {\n  Mixed = 'MIXED',\n  Abs = 'ABS',\n  And = 'AND',\n  Or = 'OR'\n}\n\nfunction calcStereoFlag(\n  struct: Struct,\n  stereoAids: Array<number>\n): StereoFlag | undefined {\n  if (!stereoAids || stereoAids.length === 0) return undefined\n  const filteredStereoAtoms = stereoAids\n    .map(aid => struct.atoms.get(aid))\n    .filter(atom => atom?.stereoLabel)\n  if (!filteredStereoAtoms.length) return undefined\n\n  const atom = filteredStereoAtoms[0]!\n  const stereoLabel = atom.stereoLabel! // {string | null} \"<abs|and|or>-<group>\"\n\n  const hasAnotherLabel = filteredStereoAtoms.some(\n    atom => atom?.stereoLabel !== stereoLabel\n  )\n\n  let stereoFlag: StereoFlag\n  if (hasAnotherLabel) {\n    stereoFlag = StereoFlag.Mixed\n  } else {\n    const label = stereoLabel.match(/\\D+/g)?.[0]\n    switch (label) {\n      case StereoLabel.Abs: {\n        stereoFlag = StereoFlag.Abs\n        break\n      }\n      case StereoLabel.And: {\n        stereoFlag = StereoFlag.And\n        break\n      }\n      case StereoLabel.Or: {\n        stereoFlag = StereoFlag.Or\n        break\n      }\n      default: {\n        throw new Error(`Unsupported stereo label: ${label}.`)\n      }\n    }\n  }\n  return stereoFlag\n}\n\nexport class Fragment {\n  #enhancedStereoFlag?: StereoFlag\n  stereoFlagPosition?: Vec2\n  stereoAtoms: Array<number> = []\n\n  get enhancedStereoFlag() {\n    return this.#enhancedStereoFlag\n  }\n\n  constructor(stereoFlagPosition?: Vec2) {\n    this.stereoFlagPosition = stereoFlagPosition\n  }\n\n  static getDefaultStereoFlagPosition(\n    struct: Struct,\n    fragmentId: number\n  ): Vec2 | undefined {\n    const fragment = struct.getFragment(fragmentId)\n    if (!fragment) return undefined\n    const bb = fragment.getCoordBoundingBox()\n    return new Vec2(bb.max.x, bb.min.y - 1)\n  }\n\n  clone(aidMap: Map<number, number>) {\n    const fr = new Fragment(this.stereoFlagPosition)\n    fr.stereoAtoms = this.stereoAtoms.map(aid => aidMap.get(aid)!)\n    fr.#enhancedStereoFlag = this.#enhancedStereoFlag\n    return fr\n  }\n\n  updateStereoFlag(struct: Struct) {\n    this.#enhancedStereoFlag = calcStereoFlag(struct, this.stereoAtoms)\n    return this.#enhancedStereoFlag\n  }\n\n  //TODO: split to 'add' and 'remove methods\n  updateStereoAtom(struct: Struct, aid: number, frId: number, isAdd: boolean) {\n    if (isAdd && !this.stereoAtoms.includes(aid)) this.stereoAtoms.push(aid)\n    if (\n      !isAdd &&\n      (struct.atoms.get(aid)?.fragment !== frId ||\n        !Array.from(struct.bonds.values())\n          .filter(bond => bond.stereo && bond.type !== Bond.PATTERN.TYPE.DOUBLE)\n          .some(bond => bond.begin === aid))\n    ) {\n      this.stereoAtoms = this.stereoAtoms.filter(item => item !== aid)\n    }\n\n    this.#enhancedStereoFlag = calcStereoFlag(struct, this.stereoAtoms)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Vec2 } from 'domain/entities'\n\nexport interface BondParams {\n  reactingCenterStatus?: number\n  topology?: number\n  stereo?: number\n  xxx?: string\n  type: number\n  end: number\n  begin: number\n}\n\nexport class Bond {\n  static PATTERN = {\n    TYPE: {\n      SINGLE: 1,\n      DOUBLE: 2,\n      TRIPLE: 3,\n      AROMATIC: 4,\n      SINGLE_OR_DOUBLE: 5,\n      SINGLE_OR_AROMATIC: 6,\n      DOUBLE_OR_AROMATIC: 7,\n      ANY: 8,\n      DATIVE: 9,\n      HYDROGEN: 10\n    },\n\n    STEREO: {\n      NONE: 0,\n      UP: 1,\n      EITHER: 4,\n      DOWN: 6,\n      CIS_TRANS: 3\n    },\n\n    TOPOLOGY: {\n      EITHER: 0,\n      RING: 1,\n      CHAIN: 2\n    },\n\n    REACTING_CENTER: {\n      NOT_CENTER: -1,\n      UNMARKED: 0,\n      CENTER: 1,\n      UNCHANGED: 2,\n      MADE_OR_BROKEN: 4,\n      ORDER_CHANGED: 8,\n      MADE_OR_BROKEN_AND_CHANGED: 12\n    }\n  }\n\n  static attrlist = {\n    type: Bond.PATTERN.TYPE.SINGLE,\n    stereo: Bond.PATTERN.STEREO.NONE,\n    topology: Bond.PATTERN.TOPOLOGY.EITHER,\n    reactingCenterStatus: Bond.PATTERN.REACTING_CENTER.UNMARKED\n  }\n\n  begin: number\n  end: number\n  readonly type: number\n  readonly xxx: string\n  readonly stereo: number\n  readonly topology: number\n  readonly reactingCenterStatus: number\n  len: number\n  sb: number\n  sa: number\n  hb1?: number\n  hb2?: number\n  angle: number\n  center: Vec2\n\n  constructor(params: BondParams) {\n    this.begin = params.begin\n    this.end = params.end\n    this.type = params.type\n    this.xxx = params.xxx || ''\n    this.stereo = Bond.PATTERN.STEREO.NONE\n    this.topology = Bond.PATTERN.TOPOLOGY.EITHER\n    this.reactingCenterStatus = 0\n    this.len = 0\n    this.sb = 0\n    this.sa = 0\n    this.angle = 0\n\n    if (params.stereo) this.stereo = params.stereo\n    if (params.topology) this.topology = params.topology\n    if (params.reactingCenterStatus)\n      this.reactingCenterStatus = params.reactingCenterStatus\n\n    this.center = new Vec2()\n  }\n\n  static getAttrHash(bond: Bond) {\n    let attrs = {}\n    for (let attr in Bond.attrlist) {\n      if (bond[attr]) {\n        attrs[attr] = bond[attr]\n      }\n    }\n    return attrs\n  }\n\n  static attrGetDefault(attr: string) {\n    if (attr in Bond.attrlist) {\n      return Bond.attrlist[attr]\n    }\n  }\n\n  hasRxnProps(): boolean {\n    return !!this.reactingCenterStatus\n  }\n\n  getCenter(struct: any): Vec2 {\n    const p1 = struct.atoms.get(this.begin).pp\n    const p2 = struct.atoms.get(this.end).pp\n    return Vec2.lc2(p1, 0.5, p2, 0.5)\n  }\n\n  getDir(struct: any): Vec2 {\n    const p1 = struct.atoms.get(this.begin)!.pp\n    const p2 = struct.atoms.get(this.end)!.pp\n    return p2.sub(p1).normalized()\n  }\n\n  clone(aidMap?: Map<number, number> | null): Bond {\n    const cp = new Bond(this)\n    if (aidMap) {\n      cp.begin = aidMap.get(cp.begin)!\n      cp.end = aidMap.get(cp.end)!\n    }\n    return cp\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Vec2 } from './Vec2'\n\nexport enum RxnArrowMode {\n  simple = 'simple',\n  equilibrium = 'equilibrium'\n}\n\nexport class RxnArrow {\n  pp: Vec2\n  mode: RxnArrowMode\n\n  constructor(pp: Vec2, mode: RxnArrowMode = RxnArrowMode.simple) {\n    this.pp = pp\n    this.mode = mode\n  }\n\n  clone() {\n    return new RxnArrow(this.pp, this.mode)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Vec2 } from './Vec2'\n\nexport class HalfBond {\n  begin: number\n  end: number\n  bid: number\n  dir: Vec2\n  norm: Vec2\n  ang: number\n  p: Vec2\n  loop: number\n  contra: number\n  next: number\n  leftSin: number\n  leftCos: number\n  leftNeighbor: number\n  rightSin: number\n  rightCos: number\n  rightNeighbor: number\n\n  constructor(begin: number, end: number, bid: number) {\n    console.assert(arguments.length === 3, 'Invalid parameter number!')\n\n    this.begin = begin\n    this.end = end\n    this.bid = bid\n\n    // rendering properties\n    this.dir = new Vec2() // direction\n    this.norm = new Vec2() // left normal\n    this.ang = 0 // angle to (1,0), used for sorting the bonds\n    this.p = new Vec2() // corrected origin position\n    this.loop = -1 // left loop id if the half-bond is in a loop, otherwise -1\n    this.contra = -1 // the half bond contrary to this one\n    this.next = -1 // the half-bond next ot this one in CCW order\n    this.leftSin = 0\n    this.leftCos = 0\n    this.leftNeighbor = 0\n    this.rightSin = 0\n    this.rightCos = 0\n    this.rightNeighbor = 0\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Bond } from './Bond'\nimport { Struct } from './Struct'\n\nexport class Loop {\n  hbs: number[]\n  dblBonds: number\n  aromatic: boolean\n  convex: boolean\n\n  constructor(hbs: Array<number>, struct: Struct, isConvex: boolean) {\n    this.hbs = hbs // set of half-bonds involved\n    this.dblBonds = 0 // number of double bonds in the loop\n    this.aromatic = true\n    this.convex = isConvex || false\n\n    hbs.forEach(hb => {\n      const bond: Bond = struct.bonds.get(struct.halfBonds.get(hb)!.bid)!\n      if (bond.type !== Bond.PATTERN.TYPE.AROMATIC) this.aromatic = false\n      if (bond.type === Bond.PATTERN.TYPE.DOUBLE) this.dblBonds++\n    })\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Pile } from './Pile'\nimport { Pool } from './Pool'\n\nexport interface RGroupParams {\n  ifthen?: number\n  resth?: boolean\n  range?: string\n}\nexport class RGroup {\n  frags: Pile<number>\n  resth: boolean\n  range: string\n  ifthen: number\n\n  constructor(params?: RGroupParams) {\n    this.frags = new Pile<number>()\n    this.resth = params?.resth || false\n    this.range = params?.range || ''\n    this.ifthen = params?.ifthen || 0\n  }\n\n  static findRGroupByFragment(rgroups: Pool<RGroup>, frid: number) {\n    return rgroups.find((_rgid, rgroup) => rgroup.frags.has(frid))\n  }\n\n  getAttrs(): RGroupParams {\n    return {\n      resth: this.resth,\n      range: this.range,\n      ifthen: this.ifthen\n    }\n  }\n\n  clone(fidMap?: Map<number, number> | null): RGroup {\n    const ret = new RGroup(this)\n    this.frags.forEach(fid => {\n      ret.frags.add(fidMap ? fidMap.get(fid)! : fid)\n    })\n    return ret\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Point, Vec2 } from './Vec2'\n\nexport interface RxnPlusParams {\n  pp: Point\n}\n\nexport class RxnPlus {\n  pp: Vec2\n\n  constructor(params?: RxnPlusParams) {\n    this.pp = params?.pp ? new Vec2(params.pp) : new Vec2()\n  }\n\n  clone() {\n    return new RxnPlus(this)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Vec2 } from './Vec2'\n\nexport class Box2Abs {\n  readonly p0: Vec2\n  readonly p1: Vec2\n\n  constructor(p: Vec2)\n  constructor(p0: Vec2, p1: Vec2)\n  constructor(x0: number, y0: number, x1: number, y1: number)\n  constructor(...args: Array<any>) {\n    if (args.length === 1 && 'min' in args[0] && 'max' in args[0]) {\n      this.p0 = args[0].min\n      this.p1 = args[0].max\n    }\n\n    if (args.length === 2) {\n      this.p0 = args[0]\n      this.p1 = args[1]\n    } else if (args.length === 4) {\n      this.p0 = new Vec2(args[0], args[1])\n      this.p1 = new Vec2(args[2], args[3])\n    } else if (args.length === 0) {\n      this.p0 = new Vec2()\n      this.p1 = new Vec2()\n    } else {\n      throw new Error(\n        'Box2Abs constructor only accepts 4 numbers or 2 vectors or no args!'\n      )\n    }\n  }\n\n  toString(): string {\n    return this.p0.toString() + ' ' + this.p1.toString()\n  }\n\n  clone(): Box2Abs {\n    return new Box2Abs(this.p0, this.p1)\n  }\n\n  extend(lp: Vec2, rb: Vec2): Box2Abs {\n    rb = rb || lp\n    return new Box2Abs(this.p0.sub(lp), this.p1.add(rb))\n  }\n\n  include(p: Vec2): Box2Abs {\n    console.assert(!!p)\n    return new Box2Abs(this.p0.min(p), this.p1.max(p))\n  }\n\n  contains(p: Vec2, ext: number = 0.0): boolean {\n    console.assert(!!p)\n    return (\n      p.x >= this.p0.x - ext &&\n      p.x <= this.p1.x + ext &&\n      p.y >= this.p0.y - ext &&\n      p.y <= this.p1.y + ext\n    )\n  }\n\n  translate(d: Vec2): Box2Abs {\n    return new Box2Abs(this.p0.add(d), this.p1.add(d))\n  }\n\n  transform(f: (p: Vec2, options: any) => Vec2, options: any): Box2Abs {\n    console.assert(!!f)\n    return new Box2Abs(f(this.p0, options), f(this.p1, options))\n  }\n\n  sz(): Vec2 {\n    return this.p1.sub(this.p0)\n  }\n\n  centre(): Vec2 {\n    return Vec2.centre(this.p0, this.p1)\n  }\n\n  pos() {\n    return this.p0\n  }\n\n  static fromRelBox(relBox: any): Box2Abs {\n    return new Box2Abs(\n      relBox.x,\n      relBox.y,\n      relBox.x + relBox.width,\n      relBox.y + relBox.height\n    )\n  }\n\n  static union(b1: Box2Abs, b2: Box2Abs): Box2Abs {\n    return new Box2Abs(Vec2.min(b1.p0, b2.p0), Vec2.max(b1.p1, b2.p1))\n  }\n\n  static segmentIntersection(a: Vec2, b: Vec2, c: Vec2, d: Vec2): boolean {\n    const dc = (a.x - c.x) * (b.y - c.y) - (a.y - c.y) * (b.x - c.x)\n    const dd = (a.x - d.x) * (b.y - d.y) - (a.y - d.y) * (b.x - d.x)\n    const da = (c.x - a.x) * (d.y - a.y) - (c.y - a.y) * (d.x - a.x)\n    const db = (c.x - b.x) * (d.y - b.y) - (c.y - b.y) * (d.x - b.x)\n\n    return dc * dd <= 0 && da * db <= 0\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Atom } from './Atom'\nimport { Bond } from './Bond'\nimport { Box2Abs } from './Box2Abs'\nimport { Pile } from './Pile'\nimport { Struct } from './Struct'\nimport { Vec2 } from './Vec2'\n\nexport class SGroupBracketParams {\n  readonly c: Vec2\n  readonly d: Vec2\n  readonly n: Vec2\n  readonly w: number\n  readonly h: number\n\n  constructor(c: Vec2, d: Vec2, w: number, h: number) {\n    this.c = c\n    this.d = d\n    this.n = d.rotateSC(1, 0)\n    this.w = w\n    this.h = h\n  }\n}\n\nexport class SGroup {\n  static TYPES = {\n    MUL: 1,\n    SRU: 2,\n    SUP: 3,\n    DAT: 4,\n    GEN: 5\n  }\n\n  type: string\n  id: number\n  label: number\n  bracketBox: any\n  bracketDir: Vec2\n  areas: any\n  highlight: boolean\n  highlighting: any\n  selected: boolean\n  selectionPlate: any\n  atoms: any\n  atomSet: any\n  parentAtomSet: any\n  patoms?: any\n  allAtoms: any\n  bonds: any\n  xBonds: any\n  neiAtoms: any\n  pp: Vec2 | null\n  data: any\n\n  constructor(type: string) {\n    this.type = type\n    this.id = -1\n    this.label = -1\n    this.bracketBox = null\n    this.bracketDir = new Vec2(1, 0)\n    this.areas = []\n\n    this.highlight = false\n    this.highlighting = null\n    this.selected = false\n    this.selectionPlate = null\n\n    this.atoms = []\n    this.patoms = []\n    this.bonds = []\n    this.xBonds = []\n    this.neiAtoms = []\n    this.pp = null\n    this.data = {\n      mul: 1, // multiplication count for MUL group\n      connectivity: 'ht', // head-to-head, head-to-tail or either-unknown\n      name: '',\n      subscript: 'n',\n\n      // data s-group fields\n      attached: false,\n      absolute: true,\n      showUnits: false,\n      nCharsToDisplay: -1,\n      tagChar: '',\n      daspPos: 1,\n      fieldType: 'F',\n      fieldName: '',\n      fieldValue: '',\n      units: '',\n      query: '',\n      queryOp: ''\n    }\n  }\n\n  // TODO: these methods should be overridden\n  //      and should only accept valid attributes for each S-group type.\n  //      The attributes should be accessed via these methods only and not directly through this.data.\n  // stub\n  getAttr(attr: string): any {\n    return this.data[attr]\n  }\n\n  // TODO: should be group-specific\n  getAttrs(): any {\n    var attrs = {}\n    Object.keys(this.data).forEach(attr => {\n      attrs[attr] = this.data[attr]\n    })\n    return attrs\n  }\n\n  // stub\n  setAttr(attr: string, value: any): any {\n    var oldValue = this.data[attr]\n    this.data[attr] = value\n    return oldValue\n  }\n\n  // stub\n  checkAttr(attr: string, value: any): boolean {\n    return this.data[attr] === value\n  }\n\n  updateOffset(offset: Vec2): void {\n    this.pp = Vec2.sum(this.bracketBox.p1, offset)\n  }\n\n  calculatePP(struct: Struct): void {\n    let topLeftPoint = this.bracketBox.p1.add(new Vec2(0.5, 0.5))\n    const sgroups = Array.from(struct.sgroups.values())\n    for (let i = 0; i < struct.sgroups.size; ++i) {\n      if (!descriptorIntersects(sgroups as [], topLeftPoint)) break\n\n      topLeftPoint = topLeftPoint.add(new Vec2(0, 0.5))\n    }\n\n    // TODO: the code below is a temporary solution that will be removed after the implementation of the internal format\n    // TODO: in schema.json required fields [\"context\", \"FieldValue\"] in sgroups type DAT must be returned\n    if (this.data.fieldName === 'INDIGO_CIP_DESC' && this.atoms.length === 1) {\n      const sAtom = this.atoms[0]\n      const sAtomPP = struct.atoms.get(sAtom)?.pp\n\n      if (sAtomPP) {\n        topLeftPoint = sAtomPP\n      }\n    }\n\n    this.pp = topLeftPoint\n  }\n\n  static getOffset(sgroup: SGroup): null | Vec2 {\n    if (!sgroup.pp) return null\n    return Vec2.diff(sgroup.pp, sgroup.bracketBox.p1)\n  }\n\n  static filterAtoms(atoms: any, map: any) {\n    var newAtoms: Array<any> = []\n    for (var i = 0; i < atoms.length; ++i) {\n      var aid = atoms[i]\n      if (typeof map[aid] !== 'number') newAtoms.push(aid)\n      else if (map[aid] >= 0) newAtoms.push(map[aid])\n      else newAtoms.push(-1)\n    }\n    return newAtoms\n  }\n\n  static removeNegative(atoms: any) {\n    var newAtoms: Array<any> = []\n    for (var j = 0; j < atoms.length; ++j) {\n      if (atoms[j] >= 0) newAtoms.push(atoms[j])\n    }\n    return newAtoms\n  }\n\n  static filter(_mol, sg, atomMap) {\n    sg.atoms = SGroup.removeNegative(SGroup.filterAtoms(sg.atoms, atomMap))\n  }\n\n  static clone(sgroup: SGroup, aidMap: Map<number, number>): SGroup {\n    const cp = new SGroup(sgroup.type)\n\n    Object.keys(sgroup.data).forEach(field => {\n      cp.data[field] = sgroup.data[field]\n    })\n\n    cp.atoms = sgroup.atoms.map(elem => aidMap.get(elem))\n    cp.pp = sgroup.pp\n    cp.bracketBox = sgroup.bracketBox\n    cp.patoms = null\n    cp.bonds = null\n    cp.allAtoms = sgroup.allAtoms\n    return cp\n  }\n\n  static addAtom(sgroup: SGroup, aid: number): void {\n    sgroup.atoms.push(aid)\n  }\n\n  static removeAtom(sgroup: SGroup, aid: number): void {\n    for (var i = 0; i < sgroup.atoms.length; ++i) {\n      if (sgroup.atoms[i] === aid) {\n        sgroup.atoms.splice(i, 1)\n        return\n      }\n    }\n  }\n\n  static getCrossBonds(\n    mol: any,\n    parentAtomSet: Pile<number>\n  ): { [key: number]: Array<Bond> } {\n    const crossBonds: { [key: number]: Array<Bond> } = {}\n    mol.bonds.forEach((bond, bid) => {\n      if (parentAtomSet.has(bond.begin) && !parentAtomSet.has(bond.end)) {\n        if (!crossBonds[bond.begin]) {\n          crossBonds[bond.begin] = []\n        }\n        crossBonds[bond.begin].push(bid)\n      } else if (\n        parentAtomSet.has(bond.end) &&\n        !parentAtomSet.has(bond.begin)\n      ) {\n        if (!crossBonds[bond.end]) {\n          crossBonds[bond.end] = []\n        }\n        crossBonds[bond.end].push(bid)\n      }\n    })\n    return crossBonds\n  }\n\n  static bracketPos(\n    sGroup,\n    mol,\n    crossBondsPerAtom: { [key: number]: Array<Bond> }\n  ): void {\n    var atoms = sGroup.atoms\n    const crossBonds = Object.values(crossBondsPerAtom).flat()\n    if (!crossBonds || crossBonds.length !== 2) {\n      sGroup.bracketDir = new Vec2(1, 0)\n    } else {\n      var p1 = mol.bonds.get(crossBonds[0]).getCenter(mol)\n      var p2 = mol.bonds.get(crossBonds[1]).getCenter(mol)\n      sGroup.bracketDir = Vec2.diff(p2, p1).normalized()\n    }\n    var d = sGroup.bracketDir\n\n    var braketBox: Box2Abs | null = null\n    var contentBoxes: Array<any> = []\n    atoms.forEach(aid => {\n      var atom = mol.atoms.get(aid)\n      var pos = new Vec2(atom.pp)\n      var ext = new Vec2(0.05 * 3, 0.05 * 3)\n      var bba = new Box2Abs(pos, pos).extend(ext, ext)\n      contentBoxes.push(bba)\n    })\n    contentBoxes.forEach(bba => {\n      var bbb: Box2Abs | null = null\n      ;[bba.p0.x, bba.p1.x].forEach(x => {\n        ;[bba.p0.y, bba.p1.y].forEach(y => {\n          var v = new Vec2(x, y)\n          var p = new Vec2(Vec2.dot(v, d), Vec2.dot(v, d.rotateSC(1, 0)))\n          bbb = !bbb ? new Box2Abs(p, p) : bbb!.include(p)\n        })\n      })\n      braketBox = !braketBox ? bbb : Box2Abs.union(braketBox, bbb!)\n    })\n    var vext = new Vec2(0.2, 0.4)\n    if (braketBox) braketBox = (braketBox as Box2Abs).extend(vext, vext)\n    sGroup.bracketBox = braketBox\n  }\n\n  static getBracketParameters(\n    mol,\n    crossBondsPerAtom: { [key: number]: Array<Bond> },\n    atomSet: Pile<number>,\n    bb,\n    d,\n    n\n  ): Array<any> {\n    var brackets: Array<any> = []\n    const crossBondsPerAtomValues = Object.values(crossBondsPerAtom)\n    const crossBonds = crossBondsPerAtomValues.flat()\n    if (crossBonds.length < 2) {\n      ;(function () {\n        d = d || new Vec2(1, 0)\n        n = n || d.rotateSC(1, 0)\n        var bracketWidth = Math.min(0.25, bb.sz().x * 0.3)\n        var cl = Vec2.lc2(d, bb.p0.x, n, 0.5 * (bb.p0.y + bb.p1.y))\n        var cr = Vec2.lc2(d, bb.p1.x, n, 0.5 * (bb.p0.y + bb.p1.y))\n        var bracketHeight = bb.sz().y\n\n        brackets.push(\n          new SGroupBracketParams(cl, d.negated(), bracketWidth, bracketHeight),\n          new SGroupBracketParams(cr, d, bracketWidth, bracketHeight)\n        )\n      })()\n    } else if (\n      crossBonds.length === 2 &&\n      crossBondsPerAtomValues.length === 2\n    ) {\n      ;(function () {\n        var b1 = mol.bonds.get(crossBonds[0])\n        var b2 = mol.bonds.get(crossBonds[1])\n        var cl0 = b1.getCenter(mol)\n        var cr0 = b2.getCenter(mol)\n        var dr = Vec2.diff(cr0, cl0).normalized()\n        var dl = dr.negated()\n\n        var bracketWidth = 0.25\n        var bracketHeight = 1.5\n        brackets.push(\n          new SGroupBracketParams(\n            cl0.addScaled(dl, 0),\n            dl,\n            bracketWidth,\n            bracketHeight\n          ),\n          new SGroupBracketParams(\n            cr0.addScaled(dr, 0),\n            dr,\n            bracketWidth,\n            bracketHeight\n          )\n        )\n      })()\n    } else {\n      ;(function () {\n        for (var i = 0; i < crossBonds.length; ++i) {\n          var b = mol.bonds.get(crossBonds[i])\n          var c = b.getCenter(mol)\n          var d = atomSet.has(b.begin) ? b.getDir(mol) : b.getDir(mol).negated()\n          brackets.push(new SGroupBracketParams(c, d, 0.2, 1.0))\n        }\n      })()\n    }\n    return brackets\n  }\n\n  static getObjBBox(atoms, mol): Box2Abs {\n    var a0 = mol.atoms.get(atoms[0]).pp\n    var bb = new Box2Abs(a0, a0)\n    for (var i = 1; i < atoms.length; ++i) {\n      var aid = atoms[i]\n      var atom = mol.atoms.get(aid)\n      var p = atom.pp\n      bb = bb.include(p)\n    }\n    return bb\n  }\n\n  static getAtoms(mol, sg): Array<any> {\n    if (!sg.allAtoms) return sg.atoms\n    var atoms: Array<any> = []\n    mol.atoms.forEach((_atom, aid) => {\n      atoms.push(aid)\n    })\n    return atoms\n  }\n\n  static getBonds(mol, sg): Array<any> {\n    var atoms = SGroup.getAtoms(mol, sg)\n    var bonds: Array<any> = []\n    mol.bonds.forEach((bond, bid) => {\n      if (atoms.indexOf(bond.begin) >= 0 && atoms.indexOf(bond.end) >= 0)\n        bonds.push(bid)\n    })\n    return bonds\n  }\n\n  static prepareMulForSaving(sgroup, mol): void {\n    sgroup.atoms.sort((a, b) => a - b)\n    sgroup.atomSet = new Pile(sgroup.atoms)\n    sgroup.parentAtomSet = new Pile(sgroup.atomSet)\n    var inBonds: Array<any> = []\n    var xBonds: Array<any> = []\n\n    mol.bonds.forEach((bond, bid) => {\n      if (\n        sgroup.parentAtomSet.has(bond.begin) &&\n        sgroup.parentAtomSet.has(bond.end)\n      )\n        inBonds.push(bid)\n      else if (\n        sgroup.parentAtomSet.has(bond.begin) ||\n        sgroup.parentAtomSet.has(bond.end)\n      )\n        xBonds.push(bid)\n    })\n\n    if (xBonds.length !== 0 && xBonds.length !== 2)\n      throw Error('Unsupported cross-bonds number')\n\n    var xAtom1 = -1\n    var xAtom2 = -1\n    var crossBond = null\n    if (xBonds.length === 2) {\n      var bond1 = mol.bonds.get(xBonds[0])\n      xAtom1 = sgroup.parentAtomSet.has(bond1.begin) ? bond1.begin : bond1.end\n\n      var bond2 = mol.bonds.get(xBonds[1])\n      xAtom2 = sgroup.parentAtomSet.has(bond2.begin) ? bond2.begin : bond2.end\n      crossBond = bond2\n    }\n\n    var tailAtom = xAtom2\n\n    var newAtoms: Array<any> = []\n    for (var j = 0; j < sgroup.data.mul - 1; j++) {\n      let amap = {}\n      sgroup.atoms.forEach(aid => {\n        var atom = mol.atoms.get(aid)\n        var aid2 = mol.atoms.add(new Atom(atom))\n        newAtoms.push(aid2)\n        sgroup.atomSet.add(aid2)\n        amap[aid] = aid2\n      })\n      inBonds.forEach(bid => {\n        var bond = mol.bonds.get(bid)\n        var newBond = new Bond(bond)\n        newBond.begin = amap[newBond.begin]\n        newBond.end = amap[newBond.end]\n        mol.bonds.add(newBond)\n      })\n      if (crossBond !== null) {\n        var newCrossBond = new Bond(crossBond)\n        newCrossBond.begin = tailAtom\n        newCrossBond.end = amap[xAtom1]\n        mol.bonds.add(newCrossBond)\n        tailAtom = amap[xAtom2]\n      }\n    }\n    if (tailAtom >= 0) {\n      var xBond2 = mol.bonds.get(xBonds[1])\n      if (xBond2.begin === xAtom2) xBond2.begin = tailAtom\n      else xBond2.end = tailAtom\n    }\n    sgroup.bonds = xBonds\n\n    newAtoms.forEach(aid => {\n      mol.sGroupForest\n        .getPathToRoot(sgroup.id)\n        .reverse()\n        .forEach(sgid => {\n          mol.atomAddToSGroup(sgid, aid)\n        })\n    })\n  }\n\n  static getMassCentre(mol, atoms): Vec2 {\n    var c = new Vec2() // mass centre\n    for (var i = 0; i < atoms.length; ++i)\n      c = c.addScaled(mol.atoms.get(atoms[i]).pp, 1.0 / atoms.length)\n    return c\n  }\n}\n\nfunction descriptorIntersects(sgroups: [], topLeftPoint: Vec2): boolean {\n  return sgroups.some((sg: SGroup) => {\n    if (!sg.pp) return false\n\n    const sgBottomRightPoint = sg.pp.add(new Vec2(0.5, 0.5))\n    const bottomRightPoint = topLeftPoint.add(new Vec2(0.5, 0.5))\n\n    return Box2Abs.segmentIntersection(\n      sg.pp,\n      sgBottomRightPoint,\n      topLeftPoint,\n      bottomRightPoint\n    )\n  })\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Vec2 } from './Vec2'\n\nexport enum SimpleObjectMode {\n  ellipse = 'ellipse',\n  rectangle = 'rectangle',\n  line = 'line'\n}\n\nexport interface SimpleObjectParams {\n  mode: SimpleObjectMode\n  pos?: Array<Vec2>\n}\n\nexport class SimpleObject {\n  pos: Array<Vec2>\n  mode: SimpleObjectMode\n\n  constructor(params: SimpleObjectParams) {\n    params = params || {}\n    this.pos = []\n\n    if (params.pos) {\n      for (let i = 0; i < params.pos.length; i++) {\n        const currentP = params.pos[i]\n        this.pos[i] = currentP ? new Vec2(params.pos[i]) : new Vec2()\n      }\n    }\n\n    this.mode = params.mode\n  }\n\n  clone(): SimpleObject {\n    return new SimpleObject(this)\n  }\n\n  center(): Vec2 {\n    switch (this.mode) {\n      case SimpleObjectMode.rectangle: {\n        return Vec2.centre(this.pos[0], this.pos[1])\n      }\n      default:\n        return this.pos[0]\n    }\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Pile } from './Pile'\nimport { SGroup } from './SGroup'\n\nexport class SGroupForest {\n  /** node id -> parent id */\n  parent: Map<number, number>\n  /** node id -> list of child ids */\n  children: Map<number, number[]>\n  atomSets: Map<number, any>\n\n  constructor() {\n    this.parent = new Map()\n    this.children = new Map()\n\n    this.children.set(-1, []) // extra root node\n    this.atomSets = new Map()\n  }\n\n  /** returns an array or s-group ids in the order of breadth-first search */\n  getSGroupsBFS(): number[] {\n    const order: number[] = []\n    let id = -1\n    let queue = Array.from(this.children.get(-1) as any)\n    while (queue.length > 0) {\n      id = queue.shift() as any\n      queue = queue.concat(this.children.get(id) as any)\n      order.push(id)\n    }\n    return order\n  }\n\n  getAtomSetRelations(newId: any, atoms: any) {\n    // find the lowest superset in the hierarchy\n    const isStrictSuperset = new Map()\n    const isSubset = new Map()\n\n    this.atomSets.delete(newId)\n\n    this.atomSets.forEach((atomSet, id) => {\n      isSubset.set(id, atomSet.isSuperset(atoms))\n      isStrictSuperset.set(\n        id,\n        atoms.isSuperset(atomSet) && !atomSet.equals(atoms)\n      )\n    })\n\n    const parents = Array.from(this.atomSets.keys()).filter(sgid => {\n      if (!isSubset.get(sgid)) {\n        return false\n      }\n      const childs = this.children.get(sgid)\n      return childs && childs.findIndex(childId => isSubset.get(childId)) < 0\n    })\n\n    const children = Array.from(this.atomSets.keys()).filter(\n      id =>\n        isStrictSuperset.get(id) && !isStrictSuperset.get(this.parent.get(id))\n    )\n\n    return {\n      children,\n      parent: parents.length === 0 ? -1 : parents[0]\n    }\n  }\n\n  getPathToRoot(sgid): number[] {\n    const path: number[] = []\n    for (let id = sgid; id >= 0; id = this.parent.get(id)) {\n      console.assert(path.indexOf(id) < 0, 'SGroupForest: loop detected')\n      path.push(id)\n    }\n    return path\n  }\n\n  insert({ id, atoms }, parent?: number, children?: number[]) {\n    console.assert(!this.parent.has(id), 'sgid already present in the forest')\n    console.assert(!this.children.has(id), 'sgid already present in the forest')\n\n    if (!parent || !children) {\n      // if these are not provided, deduce automatically\n      const guess = this.getAtomSetRelations(id, new Pile(atoms))\n      parent = guess.parent\n      children = guess.children\n    }\n\n    // TODO: make children Map<int, Pile> instead of Map<int, []>?\n    children.forEach(childId => {\n      this.resetParentLink(childId, id)\n    })\n    this.children.set(id, children)\n    this.parent.set(id, parent)\n    this.children.get(parent)?.push(id)\n    this.atomSets.set(id, new Pile(atoms))\n\n    return { parent, children }\n  }\n\n  private resetParentLink(childId, id) {\n    const parentId = this.parent.get(childId)\n    if (typeof parentId === 'undefined') {\n      return\n    }\n\n    const childs = this.children.get(parentId)\n    if (!childs) {\n      return\n    }\n\n    const childIndex = childs.indexOf(childId)\n    childs.splice(childIndex, 1)\n    this.parent.set(childId, id)\n  }\n\n  remove(id) {\n    console.assert(this.parent.has(id), 'sgid is not in the forest')\n    console.assert(this.children.has(id), 'sgid is not in the forest')\n\n    const parentId = this.parent.get(id) as any\n    const childs = this.children.get(parentId) as any\n    this.children.get(id)?.forEach(childId => {\n      this.parent.set(childId, parentId)\n      this.children.get(parentId)?.push(childId)\n    })\n\n    const i = childs.indexOf(id)\n    childs.splice(i, 1)\n\n    this.children.delete(id)\n    this.parent.delete(id)\n    this.atomSets.delete(id)\n  }\n}\n\nexport function checkOverlapping(struct, atoms) {\n  const sgroups = atoms.reduce((res, aid) => {\n    const atom = struct.atoms.get(aid)\n    return res.union(atom.sgs)\n  }, new Pile())\n\n  return Array.from(sgroups).some(sid => {\n    const sg = struct.sgroups.get(sid)\n    if (sg.type === 'DAT') return false\n    const sgAtoms = SGroup.getAtoms(struct, sg)\n\n    return sgAtoms.length < atoms.length\n      ? sgAtoms.findIndex(aid => atoms.indexOf(aid) === -1) >= 0\n      : atoms.findIndex(aid => sgAtoms.indexOf(aid) === -1) >= 0\n  })\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nexport class Pool<TValue = any> extends Map<number, TValue> {\n  private nextId: number = 0\n\n  add(item: TValue): number {\n    const id = this.nextId++\n    super.set(id, item)\n    return id\n  }\n\n  newId(): number {\n    return this.nextId++\n  }\n\n  keyOf(item: TValue): number | null {\n    for (const [key, value] of this.entries()) {\n      if (value === item) return key\n    }\n\n    return null\n  }\n\n  find(predicate: (key: number, value: TValue) => boolean): number | null {\n    for (const [key, value] of this.entries()) {\n      if (predicate(key, value)) return key\n    }\n\n    return null\n  }\n\n  filter(predicate: (key: number, value: TValue) => boolean): Pool<TValue> {\n    return new Pool<TValue>(\n      Array.from(this).filter(([key, value]) => predicate(key, value))\n    )\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Atom, radicalElectrons } from './Atom'\n\nimport { Bond } from './Bond'\nimport { Box2Abs } from './Box2Abs'\nimport { Elements } from 'domain/constants'\nimport { Fragment } from './Fragment'\nimport { HalfBond } from './HalfBond'\nimport { Loop } from './Loop'\nimport { Pile } from './Pile'\nimport { Pool } from './Pool'\nimport { RGroup } from './RGroup'\nimport { RxnArrow } from './RxnArrow'\nimport { RxnPlus } from './RxnPlus'\nimport { SGroup } from './SGroup'\nimport { SGroupForest } from './SGroupForest'\nimport { SimpleObject } from './SimpleObject'\nimport { Text } from './Text'\nimport { Vec2 } from './Vec2'\n\nexport type Neighbor = {\n  aid: number\n  bid: number\n}\n\nfunction arrayAddIfMissing(array, item) {\n  for (var i = 0; i < array.length; ++i) {\n    if (array[i] === item) return false\n  }\n  array.push(item)\n  return true\n}\n\nexport class Struct {\n  atoms: Pool<Atom>\n  bonds: Pool<Bond>\n  sgroups: Pool<SGroup>\n  halfBonds: Pool<HalfBond>\n  loops: Pool<Loop>\n  isReaction: boolean\n  rxnArrows: Pool<RxnArrow>\n  rxnPluses: Pool<RxnPlus>\n  frags: Pool<Fragment | null>\n  rgroups: Pool<RGroup>\n  name: string\n  sGroupForest: SGroupForest\n  simpleObjects: Pool<SimpleObject>\n  texts: Pool<Text>\n\n  constructor() {\n    this.atoms = new Pool<Atom>()\n    this.bonds = new Pool<Bond>()\n    this.sgroups = new Pool<SGroup>()\n    this.halfBonds = new Pool<HalfBond>()\n    this.loops = new Pool<Loop>()\n    this.isReaction = false\n    this.rxnArrows = new Pool<RxnArrow>()\n    this.rxnPluses = new Pool<RxnPlus>()\n    this.frags = new Pool<Fragment>()\n    this.rgroups = new Pool<RGroup>()\n    this.name = ''\n    this.sGroupForest = new SGroupForest()\n    this.simpleObjects = new Pool<SimpleObject>()\n    this.texts = new Pool<Text>()\n  }\n\n  hasRxnProps(): boolean {\n    return !!(\n      this.atoms.find((_aid, atom) => atom.hasRxnProps()) ||\n      this.bonds.find((_bid, bond) => bond.hasRxnProps())\n    )\n  }\n\n  hasRxnArrow(): boolean {\n    return this.rxnArrows.size === 1\n  }\n\n  hasRxnPluses(): boolean {\n    return this.rxnPluses.size > 0\n  }\n\n  isRxn(): boolean {\n    return this.hasRxnArrow() || this.hasRxnPluses()\n  }\n\n  isBlank(): boolean {\n    return (\n      this.atoms.size === 0 &&\n      this.rxnArrows.size === 0 &&\n      this.rxnPluses.size === 0 &&\n      this.simpleObjects.size === 0 &&\n      this.texts.size === 0\n    )\n  }\n\n  clone(\n    atomSet?: Pile<number> | null,\n    bondSet?: Pile<number> | null,\n    dropRxnSymbols?: boolean,\n    aidMap?: Map<number, number> | null,\n    simpleObjectsSet?: Pile<number> | null,\n    textsSet?: Pile<number> | null\n  ): Struct {\n    return this.mergeInto(\n      new Struct(),\n      atomSet,\n      bondSet,\n      dropRxnSymbols,\n      false,\n      aidMap,\n      simpleObjectsSet,\n      textsSet\n    )\n  }\n\n  getScaffold(): Struct {\n    const atomSet = new Pile<number>()\n    this.atoms.forEach((_atom, aid) => {\n      atomSet.add(aid)\n    })\n\n    this.rgroups.forEach(rg => {\n      rg.frags.forEach((_fnum, fid) => {\n        this.atoms.forEach((atom, aid) => {\n          if (atom.fragment === fid) atomSet.delete(aid)\n        })\n      })\n    })\n\n    return this.clone(atomSet)\n  }\n\n  getFragmentIds(fid: number): Pile<number> {\n    const atomSet = new Pile<number>()\n\n    this.atoms.forEach((atom, aid) => {\n      if (atom.fragment === fid) atomSet.add(aid)\n    })\n\n    return atomSet\n  }\n\n  getFragment(fid: number): Struct {\n    return this.clone(this.getFragmentIds(fid), null, true)\n  }\n\n  mergeInto(\n    cp: Struct,\n    atomSet?: Pile<number> | null,\n    bondSet?: Pile<number> | null,\n    dropRxnSymbols?: boolean,\n    keepAllRGroups?: boolean,\n    aidMap?: Map<number, number> | null,\n    simpleObjectsSet?: Pile<number> | null,\n    textsSet?: Pile<number> | null\n  ): Struct {\n    atomSet = atomSet || new Pile<number>(this.atoms.keys())\n    bondSet = bondSet || new Pile<number>(this.bonds.keys())\n    simpleObjectsSet =\n      simpleObjectsSet || new Pile<number>(this.simpleObjects.keys())\n    textsSet = textsSet || new Pile<number>(this.texts.keys())\n    aidMap = aidMap || new Map()\n\n    bondSet = bondSet.filter(bid => {\n      const bond = this.bonds.get(bid)!\n      return atomSet!.has(bond.begin) && atomSet!.has(bond.end)\n    })\n\n    const fidMask = new Pile()\n    this.atoms.forEach((atom, aid) => {\n      if (atomSet!.has(aid)) fidMask.add(atom.fragment)\n    })\n\n    const fidMap = new Map()\n    this.frags.forEach((_frag, fid) => {\n      if (fidMask.has(fid)) fidMap.set(fid, cp.frags.add(null))\n    })\n\n    const rgroupsIds: Array<number> = []\n    this.rgroups.forEach((rgroup, rgid) => {\n      let keepGroup = keepAllRGroups\n      if (!keepGroup) {\n        rgroup.frags.forEach((_fnum, fid) => {\n          rgroupsIds.push(fid)\n          if (fidMask.has(fid)) keepGroup = true\n        })\n\n        if (!keepGroup) return\n      }\n\n      const rg = cp.rgroups.get(rgid)\n      if (rg) {\n        rgroup.frags.forEach((_fnum, fid) => {\n          rgroupsIds.push(fid)\n          if (fidMask.has(fid)) rg.frags.add(fidMap.get(fid))\n        })\n      } else {\n        cp.rgroups.set(rgid, rgroup.clone(fidMap))\n      }\n    })\n\n    // atoms in not RGroup\n    this.atoms.forEach((atom, aid) => {\n      if (atomSet!.has(aid) && rgroupsIds.indexOf(atom.fragment) === -1)\n        aidMap!.set(aid, cp.atoms.add(atom.clone(fidMap)))\n    })\n    // atoms in RGroup\n    this.atoms.forEach((atom, aid) => {\n      if (atomSet!.has(aid) && rgroupsIds.indexOf(atom.fragment) !== -1)\n        aidMap!.set(aid, cp.atoms.add(atom.clone(fidMap)))\n    })\n\n    fidMap.forEach((newfid, oldfid) => {\n      const frags = JSON.parse(JSON.stringify(this.frags.get(oldfid)))\n\n      if (frags && Object.keys(frags).length !== 0) {\n        cp.frags.set(newfid, this.frags.get(oldfid)!.clone(aidMap!)) // clone Fragments\n      }\n    })\n\n    const bidMap = new Map()\n    this.bonds.forEach((bond, bid) => {\n      if (bondSet!.has(bid)) bidMap.set(bid, cp.bonds.add(bond.clone(aidMap!)))\n    })\n\n    this.sgroups.forEach(sg => {\n      if (sg.atoms.some(aid => !atomSet!.has(aid))) return\n\n      sg = SGroup.clone(sg, aidMap!)\n      const id = cp.sgroups.add(sg)\n      sg.id = id\n\n      sg.atoms.forEach(aid => {\n        cp.atoms.get(aid)!.sgs.add(id)\n      })\n\n      if (sg.type === 'DAT') cp.sGroupForest.insert(sg, -1, [])\n      else cp.sGroupForest.insert(sg)\n    })\n\n    simpleObjectsSet.forEach(soid => {\n      cp.simpleObjects.add(this.simpleObjects.get(soid)!.clone())\n    })\n\n    textsSet.forEach(id => {\n      cp.texts.add(this.texts.get(id)!.clone())\n    })\n\n    if (!dropRxnSymbols) {\n      cp.isReaction = this.isReaction\n      this.rxnArrows.forEach(item => {\n        cp.rxnArrows.add(item.clone())\n      })\n      this.rxnPluses.forEach(item => {\n        cp.rxnPluses.add(item.clone())\n      })\n    }\n\n    return cp\n  }\n\n  // NB: this updates the structure without modifying the corresponding ReStruct.\n  //  To be applied to standalone structures only.\n  prepareLoopStructure() {\n    this.initHalfBonds()\n    this.initNeighbors()\n    this.updateHalfBonds(Array.from(this.atoms.keys()))\n    this.sortNeighbors(Array.from(this.atoms.keys()))\n    this.findLoops()\n  }\n\n  atomAddToSGroup(sgid, aid) {\n    // TODO: [MK] make sure the addition does not break the hierarchy?\n    SGroup.addAtom(this.sgroups.get(sgid)!, aid)\n    this.atoms.get(aid)!.sgs.add(sgid)\n  }\n\n  calcConn(atom) {\n    let conn = 0\n    for (let i = 0; i < atom.neighbors.length; ++i) {\n      const hb = this.halfBonds.get(atom.neighbors[i])!\n      const bond = this.bonds.get(hb.bid)!\n      switch (bond.type) {\n        case Bond.PATTERN.TYPE.SINGLE:\n          conn += 1\n          break\n        case Bond.PATTERN.TYPE.DOUBLE:\n          conn += 2\n          break\n        case Bond.PATTERN.TYPE.TRIPLE:\n          conn += 3\n          break\n        case Bond.PATTERN.TYPE.DATIVE:\n          break\n        case Bond.PATTERN.TYPE.HYDROGEN:\n          break\n        case Bond.PATTERN.TYPE.AROMATIC:\n          if (atom.neighbors.length === 1) return [-1, true]\n          return [atom.neighbors.length, true]\n        default:\n          return [-1, false]\n      }\n    }\n    return [conn, false]\n  }\n\n  findBondId(begin, end) {\n    return this.bonds.find(\n      (_bid, bond) =>\n        (bond.begin === begin && bond.end === end) ||\n        (bond.begin === end && bond.end === begin)\n    )\n  }\n\n  initNeighbors() {\n    this.atoms.forEach(atom => {\n      atom.neighbors = []\n    })\n\n    this.bonds.forEach(bond => {\n      const a1 = this.atoms.get(bond.begin)!\n      const a2 = this.atoms.get(bond.end)!\n      a1.neighbors.push(bond.hb1!)\n      a2.neighbors.push(bond.hb2!)\n    })\n  }\n\n  bondInitHalfBonds(bid, bond?: Bond) {\n    bond = bond || this.bonds.get(bid)!\n    bond.hb1 = 2 * bid\n    bond.hb2 = 2 * bid + 1 // eslint-disable-line no-mixed-operators\n    this.halfBonds.set(bond.hb1, new HalfBond(bond.begin, bond.end, bid))\n    this.halfBonds.set(bond.hb2, new HalfBond(bond.end, bond.begin, bid))\n    const hb1 = this.halfBonds.get(bond.hb1)!\n    const hb2 = this.halfBonds.get(bond.hb2)!\n    hb1.contra = bond.hb2\n    hb2.contra = bond.hb1\n  }\n\n  halfBondUpdate(hbid: number) {\n    const hb = this.halfBonds.get(hbid)!\n    const p1 = this.atoms.get(hb.begin)!.pp\n    const p2 = this.atoms.get(hb.end)!.pp\n    const d = Vec2.diff(p2, p1).normalized()\n    hb.dir = Vec2.dist(p2, p1) > 1e-4 ? d : new Vec2(1, 0)\n    hb.norm = hb.dir.turnLeft()\n    hb.ang = hb.dir.oxAngle()\n    if (hb.loop < 0) hb.loop = -1\n  }\n\n  initHalfBonds() {\n    this.halfBonds.clear()\n    this.bonds.forEach((bond, bid) => {\n      this.bondInitHalfBonds(bid, bond)\n    })\n  }\n\n  setHbNext(hbid, next) {\n    this.halfBonds.get(this.halfBonds.get(hbid)!.contra)!.next = next\n  }\n\n  halfBondSetAngle(hbid, left) {\n    const hb = this.halfBonds.get(hbid)!\n    const hbl = this.halfBonds.get(left)!\n\n    hbl.rightCos = Vec2.dot(hbl.dir, hb.dir)\n    hb.leftCos = Vec2.dot(hbl.dir, hb.dir)\n\n    hbl.rightSin = Vec2.cross(hbl.dir, hb.dir)\n    hb.leftSin = Vec2.cross(hbl.dir, hb.dir)\n\n    hb.leftNeighbor = left\n    hbl.rightNeighbor = hbid\n  }\n\n  atomAddNeighbor(hbid) {\n    const hb = this.halfBonds.get(hbid)!\n    const atom = this.atoms.get(hb.begin)!\n\n    for (var i = 0; i < atom.neighbors.length; ++i) {\n      if (this.halfBonds.get(atom.neighbors[i])!.ang > hb.ang) break\n    }\n    atom.neighbors.splice(i, 0, hbid)\n    var ir = atom.neighbors[(i + 1) % atom.neighbors.length]\n    var il =\n      atom.neighbors[(i + atom.neighbors.length - 1) % atom.neighbors.length]\n    this.setHbNext(il, hbid)\n    this.setHbNext(hbid, ir)\n    this.halfBondSetAngle(hbid, il)\n    this.halfBondSetAngle(ir, hbid)\n  }\n\n  atomSortNeighbors(aid) {\n    const atom = this.atoms.get(aid)!\n    const halfBonds = this.halfBonds\n\n    atom.neighbors\n      .sort((nei, nei2) => halfBonds.get(nei)!.ang - halfBonds.get(nei2)!.ang)\n      .forEach((nei, i) => {\n        const nextNei = atom.neighbors[(i + 1) % atom.neighbors.length]\n        this.halfBonds.get(this.halfBonds.get(nei)!.contra)!.next = nextNei\n        this.halfBondSetAngle(nextNei, nei)\n      })\n  }\n\n  sortNeighbors(list) {\n    if (!list) {\n      this.atoms.forEach((_atom, aid) => {\n        this.atomSortNeighbors(aid)\n      })\n    } else {\n      list.forEach(aid => {\n        this.atomSortNeighbors(aid)\n      })\n    }\n  }\n\n  atomUpdateHalfBonds(aid) {\n    this.atoms.get(aid)!.neighbors.forEach(hbid => {\n      this.halfBondUpdate(hbid)\n      this.halfBondUpdate(this.halfBonds.get(hbid)!.contra)\n    })\n  }\n\n  updateHalfBonds(list) {\n    if (!list) {\n      this.atoms.forEach((_atom, aid) => {\n        this.atomUpdateHalfBonds(aid)\n      })\n    } else {\n      list.forEach(aid => {\n        this.atomUpdateHalfBonds(aid)\n      })\n    }\n  }\n\n  sGroupsRecalcCrossBonds() {\n    this.sgroups.forEach(sg => {\n      sg.xBonds = []\n      sg.neiAtoms = []\n    })\n\n    this.bonds.forEach((bond, bid) => {\n      const a1 = this.atoms.get(bond.begin)!\n      const a2 = this.atoms.get(bond.end)!\n\n      a1.sgs.forEach(sgid => {\n        if (!a2.sgs.has(sgid)) {\n          const sg = this.sgroups.get(sgid)!\n          sg.xBonds.push(bid)\n          arrayAddIfMissing(sg.neiAtoms, bond.end)\n        }\n      })\n\n      a2.sgs.forEach(sgid => {\n        if (!a1.sgs.has(sgid)) {\n          const sg = this.sgroups.get(sgid)!\n          sg.xBonds.push(bid)\n          arrayAddIfMissing(sg.neiAtoms, bond.begin)\n        }\n      })\n    })\n  }\n\n  sGroupDelete(sgid: number) {\n    this.sgroups.get(sgid)!.atoms.forEach(atom => {\n      this.atoms.get(atom)!.sgs.delete(sgid)\n    })\n\n    this.sGroupForest.remove(sgid)\n    this.sgroups.delete(sgid)\n  }\n\n  atomSetPos(id: number, pp: Vec2): void {\n    const item = this.atoms.get(id)!\n    item.pp = pp\n  }\n\n  rxnPlusSetPos(id: number, pp: Vec2): void {\n    const item = this.rxnPluses.get(id)!\n    item.pp = pp\n  }\n\n  rxnArrowSetPos(id: number, pp: Vec2): void {\n    const item = this.rxnArrows.get(id)\n    if (item) {\n      item.pp = pp\n    }\n  }\n\n  simpleObjectSetPos(id: number, pos: Array<Vec2>) {\n    const item = this.simpleObjects.get(id)!\n    item.pos = pos\n  }\n\n  textSetPosition(id: number, position: Vec2): void {\n    const item = this.texts.get(id)\n\n    if (item) {\n      item.position = position\n    }\n  }\n\n  getCoordBoundingBox(atomSet?: Pile<number>) {\n    let bb: any = null\n    function extend(pp) {\n      if (!bb) {\n        bb = {\n          min: pp,\n          max: pp\n        }\n      } else {\n        bb.min = Vec2.min(bb.min, pp)\n        bb.max = Vec2.max(bb.max, pp)\n      }\n    }\n\n    let global = !atomSet || atomSet.size === 0\n\n    this.atoms.forEach((atom, aid) => {\n      if (global || atomSet!.has(aid)) extend(atom.pp)\n    })\n    if (global) {\n      this.rxnPluses.forEach(item => {\n        extend(item.pp)\n      })\n      this.rxnArrows.forEach(item => {\n        extend(item.pp)\n      })\n    }\n    if (!bb && global) {\n      bb = {\n        min: new Vec2(0, 0),\n        max: new Vec2(1, 1)\n      }\n    }\n    return bb\n  }\n\n  getCoordBoundingBoxObj() {\n    var bb: any = null\n    function extend(pp) {\n      if (!bb) {\n        bb = {\n          min: new Vec2(pp),\n          max: new Vec2(pp)\n        }\n      } else {\n        bb.min = Vec2.min(bb.min, pp)\n        bb.max = Vec2.max(bb.max, pp)\n      }\n    }\n\n    this.atoms.forEach(atom => {\n      extend(atom.pp)\n    })\n    return bb\n  }\n\n  getBondLengthData() {\n    let totalLength = 0\n    let cnt = 0\n    this.bonds.forEach(bond => {\n      totalLength += Vec2.dist(\n        this.atoms.get(bond.begin)!.pp,\n        this.atoms.get(bond.end)!.pp\n      )\n      cnt++\n    })\n    return { cnt, totalLength }\n  }\n\n  getAvgBondLength(): number {\n    const bld = this.getBondLengthData()\n    return bld.cnt > 0 ? bld.totalLength / bld.cnt : -1\n  }\n\n  getAvgClosestAtomDistance(): number {\n    var totalDist = 0\n    var minDist\n    var dist = 0\n    var keys = Array.from(this.atoms.keys())\n    var k\n    var j\n    for (k = 0; k < keys.length; ++k) {\n      minDist = -1\n      for (j = 0; j < keys.length; ++j) {\n        if (j === k) continue // eslint-disable-line no-continue\n        dist = Vec2.dist(\n          this.atoms.get(keys[j])!.pp,\n          this.atoms.get(keys[k])!.pp\n        )\n        if (minDist < 0 || minDist > dist) minDist = dist\n      }\n      totalDist += minDist\n    }\n\n    return keys.length > 0 ? totalDist / keys.length : -1\n  }\n\n  checkBondExists(begin: number, end: number): boolean {\n    const key = this.bonds.find(\n      (_bid, bond) =>\n        (bond.begin === begin && bond.end === end) ||\n        (bond.end === begin && bond.begin === end)\n    )\n\n    return key !== undefined\n  }\n\n  findConnectedComponent(firstaid: number): Pile<number> {\n    const list = [firstaid]\n    const ids = new Pile<number>()\n    while (list.length > 0) {\n      const aid = list.pop()!\n      ids.add(aid)\n      const atom = this.atoms.get(aid)!\n      atom.neighbors.forEach(nei => {\n        const neiId = this.halfBonds.get(nei)!.end\n        if (!ids.has(neiId)) list.push(neiId)\n      })\n    }\n\n    return ids\n  }\n\n  findConnectedComponents(discardExistingFragments?: boolean) {\n    // NB: this is a hack\n    // TODO: need to maintain half-bond and neighbor structure permanently\n    if (!this.halfBonds.size) {\n      this.initHalfBonds()\n      this.initNeighbors()\n      this.updateHalfBonds(Array.from(this.atoms.keys()))\n      this.sortNeighbors(Array.from(this.atoms.keys()))\n    }\n\n    let addedAtoms = new Pile<number>()\n\n    const components: Array<any> = []\n    this.atoms.forEach((atom, aid) => {\n      if (\n        (discardExistingFragments || atom.fragment < 0) &&\n        !addedAtoms.has(aid)\n      ) {\n        const component = this.findConnectedComponent(aid)\n        components.push(component)\n        addedAtoms = addedAtoms.union(component)\n      }\n    })\n\n    return components\n  }\n\n  markFragment(idSet: Pile<number>) {\n    const frag = new Fragment()\n    const fid = this.frags.add(frag)\n\n    idSet.forEach(aid => {\n      const atom = this.atoms.get(aid)!\n      if (atom.stereoLabel) frag.updateStereoAtom(this, aid, fid, true)\n      atom.fragment = fid\n    })\n  }\n\n  markFragments() {\n    const components = this.findConnectedComponents()\n    components.forEach(comp => {\n      this.markFragment(comp)\n    })\n  }\n\n  scale(scale: number) {\n    if (scale === 1) return\n\n    this.atoms.forEach(atom => {\n      atom.pp = atom.pp.scaled(scale)\n    })\n\n    this.rxnPluses.forEach(item => {\n      item.pp = item.pp.scaled(scale)\n    })\n\n    this.rxnArrows.forEach(item => {\n      item.pp = item.pp.scaled(scale)\n    })\n\n    this.sgroups.forEach(item => {\n      item.pp = item.pp ? item.pp.scaled(scale) : null\n    })\n  }\n\n  rescale() {\n    let avg = this.getAvgBondLength()\n    if (avg < 0 && !this.isReaction)\n      // TODO [MK] this doesn't work well for reactions as the distances between\n      // the atoms in different components are generally larger than those between atoms of a single component\n      // (KETCHER-341)\n      avg = this.getAvgClosestAtomDistance()\n    if (avg < 1e-3) avg = 1\n\n    const scale = 1 / avg\n    this.scale(scale)\n  }\n\n  loopHasSelfIntersections(hbs: Array<number>) {\n    for (let i = 0; i < hbs.length; ++i) {\n      const hbi = this.halfBonds.get(hbs[i])!\n      const ai = this.atoms.get(hbi.begin)!.pp\n      const bi = this.atoms.get(hbi.end)!.pp\n      const set = new Pile([hbi.begin, hbi.end])\n\n      for (let j = i + 2; j < hbs.length; ++j) {\n        const hbj = this.halfBonds.get(hbs[j])!\n        if (set.has(hbj.begin) || set.has(hbj.end)) continue // skip edges sharing an atom\n\n        const aj = this.atoms.get(hbj.begin)!.pp\n        const bj = this.atoms.get(hbj.end)!.pp\n\n        if (Box2Abs.segmentIntersection(ai, bi, aj, bj)) return true\n      }\n    }\n\n    return false\n  }\n\n  // partition a cycle into simple cycles\n  // TODO: [MK] rewrite the detection algorithm to only find simple ones right away?\n  partitionLoop(loop: any) {\n    // eslint-disable-line max-statements\n    const subloops: Array<any> = []\n    let continueFlag = true\n    while (continueFlag) {\n      const atomToHalfBond = {} // map from every atom in the loop to the index of the first half-bond starting from that atom in the uniqHb array\n      continueFlag = false\n\n      for (let l = 0; l < loop.length; ++l) {\n        const hbid = loop[l]\n        const aid1 = this.halfBonds.get(hbid)!.begin\n        const aid2 = this.halfBonds.get(hbid)!.end\n        if (aid2 in atomToHalfBond) {\n          // subloop found\n          const s = atomToHalfBond[aid2] // where the subloop begins\n          const subloop = loop.slice(s, l + 1)\n          subloops.push(subloop)\n          if (l < loop.length)\n            // remove half-bonds corresponding to the subloop\n            loop.splice(s, l - s + 1)\n          continueFlag = true\n          break\n        }\n        atomToHalfBond[aid1] = l\n      }\n      if (!continueFlag) subloops.push(loop) // we're done, no more subloops found\n    }\n    return subloops\n  }\n\n  halfBondAngle(hbid1: number, hbid2: number): number {\n    const hba = this.halfBonds.get(hbid1)!\n    const hbb = this.halfBonds.get(hbid2)!\n    return Math.atan2(Vec2.cross(hba.dir, hbb.dir), Vec2.dot(hba.dir, hbb.dir))\n  }\n\n  loopIsConvex(loop: Array<any>): boolean {\n    return loop.every((item, k, loopArr) => {\n      const angle = this.halfBondAngle(item, loopArr[(k + 1) % loopArr.length])\n      return angle <= 0\n    })\n  }\n\n  // check whether a loop is on the inner or outer side of the polygon\n  //  by measuring the total angle between bonds\n  loopIsInner(loop: Array<any>): boolean {\n    let totalAngle = 2 * Math.PI\n    loop.forEach((hbida, k, loopArr) => {\n      const hbidb = loopArr[(k + 1) % loopArr.length]\n      const hbb = this.halfBonds.get(hbidb)!\n      const angle = this.halfBondAngle(hbida, hbidb)\n      totalAngle += hbb.contra === hbida ? Math.PI : angle // back and forth along the same edge\n    })\n    return Math.abs(totalAngle) < Math.PI\n  }\n\n  findLoops() {\n    const newLoops: Array<any> = []\n    const bondsToMark = new Pile<number>()\n\n    /*\n      Starting from each half-bond not known to be in a loop yet,\n      follow the 'next' links until the initial half-bond is reached or\n      the length of the sequence exceeds the number of half-bonds available.\n      In a planar graph, as long as every bond is a part of some \"loop\" -\n      either an outer or an inner one - every iteration either yields a loop\n      or doesn't start at all. Thus this has linear complexity in the number\n      of bonds for planar graphs.\n   */\n\n    let hbIdNext, c, loop\n    this.halfBonds.forEach((hb, hbId) => {\n      if (hb.loop !== -1) return\n\n      for (\n        hbIdNext = hbId, c = 0, loop = [];\n        c <= this.halfBonds.size;\n        hbIdNext = this.halfBonds.get(hbIdNext)!.next, ++c\n      ) {\n        if (!(c > 0 && hbIdNext === hbId)) {\n          loop.push(hbIdNext)\n          continue // eslint-disable-line no-continue\n        }\n\n        // loop found\n        const subloops = this.partitionLoop(loop)\n        subloops.forEach(loop => {\n          let loopId\n          if (this.loopIsInner(loop) && !this.loopHasSelfIntersections(loop)) {\n            /*\n                        loop is internal\n                        use lowest half-bond id in the loop as the loop id\n                        this ensures that the loop gets the same id if it is discarded and then recreated,\n                        which in turn is required to enable redrawing while dragging, as actions store item id's\n                     */\n            loopId = Math.min(...loop)\n            this.loops.set(\n              loopId,\n              new Loop(loop, this, this.loopIsConvex(loop))\n            )\n          } else {\n            loopId = -2\n          }\n\n          loop.forEach(hbid => {\n            this.halfBonds.get(hbid)!.loop = loopId\n            bondsToMark.add(this.halfBonds.get(hbid)!.bid)\n          })\n\n          if (loopId >= 0) newLoops.push(loopId)\n        })\n        break\n      }\n    })\n\n    return {\n      newLoops,\n      bondsToMark: Array.from(bondsToMark)\n    }\n  }\n\n  calcImplicitHydrogen(aid: number) {\n    const atom = this.atoms.get(aid)!\n    const [conn, isAromatic] = this.calcConn(atom)\n    let correctConn = conn\n    atom.badConn = false\n\n    if (isAromatic) {\n      if (atom.label === 'C' && atom.charge === 0) {\n        if (conn === 3) {\n          atom.implicitH = -radicalElectrons(atom.radical)\n          return\n        }\n        if (conn === 2) {\n          atom.implicitH = 1 - radicalElectrons(atom.radical)\n          return\n        }\n      } else if (\n        (atom.label === 'O' && atom.charge === 0) ||\n        (atom.label === 'N' && atom.charge === 0 && conn === 3) ||\n        (atom.label === 'N' && atom.charge === 1 && conn === 3) ||\n        (atom.label === 'S' && atom.charge === 0 && conn === 3)\n      ) {\n        atom.implicitH = 0\n        return\n      } else if (!atom.hasImplicitH) {\n        correctConn++\n      }\n    }\n\n    if (correctConn < 0 || atom.isQuery()) {\n      atom.implicitH = 0\n      return\n    }\n\n    if (atom.explicitValence >= 0) {\n      const elem = Elements.get(atom.label)\n      atom.implicitH = !!elem\n        ? atom.explicitValence - atom.calcValenceMinusHyd(correctConn)\n        : 0\n      if (atom.implicitH < 0) {\n        atom.implicitH = 0\n        atom.badConn = true\n      }\n    } else {\n      atom.calcValence(correctConn)\n    }\n  }\n\n  setImplicitHydrogen(list?: Array<number>) {\n    this.sgroups.forEach(item => {\n      if (item.data.fieldName === 'MRV_IMPLICIT_H')\n        this.atoms.get(item.atoms[0])!.hasImplicitH = true\n    })\n\n    if (!list) {\n      this.atoms.forEach((_atom, aid) => {\n        this.calcImplicitHydrogen(aid)\n      })\n    } else {\n      list.forEach(aid => {\n        if (this.atoms.get(aid)) {\n          this.calcImplicitHydrogen(aid)\n        }\n      })\n    }\n  }\n\n  atomGetNeighbors(aid: number): Array<Neighbor> | undefined {\n    return this.atoms.get(aid)?.neighbors.map(nei => {\n      const hb = this.halfBonds.get(nei)!\n      return {\n        aid: hb.end,\n        bid: hb.bid\n      }\n    })\n  }\n\n  getComponents() {\n    // eslint-disable-line max-statements\n    /* saver */\n    const connectedComponents = this.findConnectedComponents(true)\n    const barriers: Array<any> = []\n    let arrowPos: number | null = null\n\n    this.rxnArrows.forEach(item => {\n      // there's just one arrow\n      arrowPos = item.pp.x\n    })\n\n    this.rxnPluses.forEach(item => {\n      barriers.push(item.pp.x)\n    })\n\n    if (arrowPos !== null) barriers.push(arrowPos)\n\n    barriers.sort((a, b) => a - b)\n\n    const components: Array<any> = []\n\n    connectedComponents.forEach(component => {\n      const bb = this.getCoordBoundingBox(component)\n      const c = Vec2.lc2(bb.min, 0.5, bb.max, 0.5)\n      let j = 0\n\n      while (c.x > barriers[j]) ++j\n\n      components[j] = components[j] || new Pile()\n      components[j] = components[j].union(component)\n    })\n\n    const submolTexts: Array<string> = []\n    const reactants: Array<any> = []\n    const products: Array<any> = []\n\n    components.forEach(component => {\n      if (!component) {\n        submolTexts.push('')\n        return\n      }\n\n      const rxnFragmentType = this.defineRxnFragmentTypeForAtomset(\n        component,\n        arrowPos || 0\n      )\n\n      if (rxnFragmentType === 1) reactants.push(component)\n      else products.push(component)\n    })\n\n    return {\n      reactants,\n      products\n    }\n  }\n\n  defineRxnFragmentTypeForAtomset(atomset: Pile<number>, arrowpos: number) {\n    const bb = this.getCoordBoundingBox(atomset)\n    const c = Vec2.lc2(bb.min, 0.5, bb.max, 0.5)\n    return c.x < arrowpos ? 1 : 2\n  }\n\n  getBondFragment(bid: number) {\n    const aid = this.bonds.get(bid)?.begin\n    return aid && this.atoms.get(aid)?.fragment\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Vec2 } from './Vec2'\n\n//TODO: move to infrastructure\nexport enum TextCommand {\n  Bold = 'BOLD',\n  Italic = 'ITALIC',\n  Subscript = 'SUBSCRIPT',\n  Superscript = 'SUPERSCRIPT'\n}\n\nexport interface TextParams {\n  //TODO: add Interface for content type\n  content?: string\n  position?: Vec2\n}\n\nexport class Text {\n  content: string\n  position: Vec2\n\n  constructor(params: TextParams) {\n    params = params || {}\n    this.content = params.content || ''\n    this.position = params.position ? new Vec2(params.position) : new Vec2()\n  }\n\n  clone(): Text {\n    return new Text(this)\n  }\n}\n","export function ifDef<TValue = any>(\n  target: any,\n  key: string,\n  value: TValue,\n  defaultValue?: TValue\n) {\n  if (\n    value !== undefined &&\n    value !== null &&\n    value !== defaultValue &&\n    !(Array.isArray(value) && value.length === 0)\n  )\n    target[key] = value\n}\n","import { SGroup, Struct } from 'domain/entities'\n\nimport { ifDef } from 'utils'\n\nfunction fromRlabel(rg) {\n  const res: Array<any> = []\n  let rgi\n  let val\n  for (rgi = 0; rgi < 32; rgi++) {\n    if (rg & (1 << rgi)) {\n      val = rgi + 1\n      res.push(val) // push the string\n    }\n  }\n  return res\n}\n\nexport function moleculeToGraph(struct: Struct): any {\n  const body: any = {\n    atoms: Array.from(struct.atoms.values()).map(atom => {\n      if (atom.label === 'R#') return rglabelToGraph(atom)\n      if (atom.label === 'L#') return atomListToGraph(atom)\n      return atomToGraph(atom)\n    })\n  }\n\n  if (struct.bonds.size !== 0)\n    body.bonds = Array.from(struct.bonds.values()).map(bondToGraph)\n\n  if (struct.sgroups.size !== 0)\n    body.sgroups = Array.from(struct.sgroups.values()).map(sGroup =>\n      sgroupToGraph(struct, sGroup)\n    )\n\n  const fragment = struct.frags.get(0)\n  if (fragment) {\n    ifDef(body, 'stereoFlagPosition', fragment.stereoFlagPosition, null)\n  }\n  return {\n    type: 'molecule',\n    ...body\n  }\n}\n\nfunction atomToGraph(source) {\n  const result = {}\n  ifDef(result, 'label', source.label)\n  ifDef(result, 'alias', source.alias)\n  ifDef(result, 'location', [source.pp.x, source.pp.y, source.pp.z])\n  ifDef(result, 'charge', source.charge, 0)\n  ifDef(result, 'explicitValence', source.explicitValence, -1)\n  ifDef(result, 'isotope', source.isotope, 0)\n  ifDef(result, 'radical', source.radical, 0)\n  ifDef(result, 'attachmentPoints', source.attpnt, 0)\n  // stereo\n  ifDef(result, 'stereoLabel', source.stereoLabel, null)\n  ifDef(result, 'stereoParity', source.stereoCare, 0)\n  ifDef(result, 'weight', source.weight, 0)\n  // query\n  ifDef(result, 'ringBondCount', source.ringBondCount, 0)\n  ifDef(result, 'substitutionCount', source.substitutionCount, 0)\n  ifDef(result, 'unsaturatedAtom', !!source.unsaturatedAtom, false)\n  ifDef(result, 'hCount', source.hCount, 0)\n  // reaction\n  ifDef(result, 'mapping', parseInt(source.aam), 0)\n  ifDef(result, 'invRet', source.invRet, 0)\n  ifDef(result, 'exactChangeFlag', !!source.exactChangeFlag, false)\n  return result\n}\n\nfunction rglabelToGraph(source) {\n  const result = {\n    type: 'rg-label'\n  }\n  ifDef(result, 'location', [source.pp.x, source.pp.y, source.pp.z])\n  ifDef(result, 'attachmentPoints', source.attpnt, 0)\n\n  const refsToRGroups = fromRlabel(source.rglabel).map(\n    rgnumber => `rg-${rgnumber}`\n  )\n  ifDef(result, '$refs', refsToRGroups)\n\n  return result\n}\n\nfunction atomListToGraph(source) {\n  const result = {\n    type: 'atom-list'\n  }\n  ifDef(result, 'location', [source.pp.x, source.pp.y, source.pp.z])\n  ifDef(result, 'attachmentPoints', source.attpnt, 0)\n  ifDef(result, 'elements', source.atomList.labelList())\n  ifDef(result, 'notList', source.atomList.notList, false)\n  return result\n}\n\nfunction bondToGraph(source) {\n  const result = {}\n\n  ifDef(result, 'type', source.type)\n  ifDef(result, 'atoms', [source.begin, source.end])\n  ifDef(result, 'stereo', source.stereo, 0)\n  ifDef(result, 'topology', source.topology, 0)\n  ifDef(result, 'center', source.reactingCenterStatus, 0)\n\n  return result\n}\n\nfunction sgroupToGraph(struct, source) {\n  const result = {}\n\n  ifDef(result, 'type', source.type)\n  ifDef(result, 'atoms', source.atoms)\n\n  switch (source.type) {\n    case 'GEN':\n      break\n    case 'MUL': {\n      ifDef(result, 'mul', source.data.mul || 1)\n      break\n    }\n    case 'SRU': {\n      ifDef(result, 'subscript', source.data.subscript || 'n')\n      ifDef(\n        result,\n        'connectivity',\n        source.data.connectivity.toUpperCase() || 'ht'\n      )\n      break\n    }\n    case 'SUP': {\n      ifDef(result, 'name', source.data.name || '')\n      break\n    }\n    case 'DAT': {\n      const data = source.data\n      ifDef(result, 'placement', data.absolute, true)\n      ifDef(result, 'display', data.attached, false)\n      ifDef(result, 'context', data.context)\n      ifDef(result, 'fieldName', data.fieldName)\n      ifDef(result, 'fieldData', data.fieldValue)\n      ifDef(result, 'bonds', SGroup.getBonds(struct, source))\n      break\n    }\n    default:\n      break\n  }\n\n  return result\n}\n","import { Atom, Bond, SGroup, Struct } from 'domain/entities'\n\nimport { Elements } from 'domain/constants'\nimport { ifDef } from 'utils'\n\nexport function toRlabel(values) {\n  let res = 0\n  values.forEach(val => {\n    const rgi = val - 1\n    res |= 1 << rgi\n  })\n  return res\n}\n\nexport function moleculeToStruct(graphItem: any): Struct {\n  const struct = new Struct()\n  graphItem.atoms.forEach(atom => {\n    if (atom.type === 'rg-label') struct.atoms.add(rglabelToStruct(atom))\n    if (atom.type === 'atom-list') struct.atoms.add(atomListToStruct(atom))\n    if (!atom.type) struct.atoms.add(atomToStruct(atom))\n  })\n\n  if (graphItem.bonds)\n    graphItem.bonds.forEach(bond => struct.bonds.add(bondToStruct(bond)))\n\n  if (graphItem.sgroups)\n    graphItem.sgroups.forEach(sgroup =>\n      struct.sgroups.add(sgroupToStruct(sgroup))\n    )\n\n  struct.initHalfBonds()\n  struct.initNeighbors()\n  struct.markFragments()\n\n  return struct\n}\n\nexport function atomToStruct(source) {\n  const params: any = {}\n\n  ifDef(params, 'label', source.label)\n  ifDef(params, 'alias', source.alias)\n  ifDef(params, 'pp', {\n    x: source.location[0],\n    y: source.location[1],\n    z: source.location[2] || 0.0\n  })\n  ifDef(params, 'charge', source.charge)\n  ifDef(params, 'explicitValence', source.explicitValence)\n  ifDef(params, 'isotope', source.isotope)\n  ifDef(params, 'radical', source.radical)\n  ifDef(params, 'attpnt', source.attachmentPoints)\n  // stereo\n  ifDef(params, 'stereoLabel', source.stereoLabel)\n  ifDef(params, 'stereoParity', source.stereoParity)\n  ifDef(params, 'weight', source.weight)\n  // query\n  ifDef(params, 'ringBondCount', source.ringBondCount)\n  ifDef(params, 'substitutionCount', source.substitutionCount)\n  ifDef(params, 'unsaturatedAtom', source.unsaturatedAtom)\n  ifDef(params, 'hCount', source.hCount)\n  // reaction\n  ifDef(params, 'aam', source.mapping)\n  ifDef(params, 'invRet', source.invRet)\n  ifDef(params, 'exactChangeFlag', !!source.exactChangeFlag)\n  return new Atom(params)\n}\n\nexport function rglabelToStruct(source) {\n  const params: any = {}\n  params.label = 'R#'\n  ifDef(params, 'pp', {\n    x: source.location[0],\n    y: source.location[1],\n    z: source.location[2] || 0.0\n  })\n  ifDef(params, 'attpnt', source.attachmentPoints)\n  const rglabel = toRlabel(source.$refs.map(el => parseInt(el.slice(3))))\n  ifDef(params, 'rglabel', rglabel)\n  return new Atom(params)\n}\n\nexport function atomListToStruct(source) {\n  const params: any = {}\n  params.label = 'L#'\n  ifDef(params, 'pp', {\n    x: source.location[0],\n    y: source.location[1],\n    z: source.location[2] || 0.0\n  })\n  ifDef(params, 'attpnt', source.attachmentPoints)\n  const ids = source.elements\n    .map(el => Elements.get(el)?.number)\n    .filter(id => id)\n  ifDef(params, 'atomList', {\n    ids,\n    notList: source.notList\n  })\n  return new Atom(params)\n}\n\nexport function bondToStruct(source) {\n  const params: any = {}\n\n  ifDef(params, 'type', source.type)\n  ifDef(params, 'topology', source.topology)\n  ifDef(params, 'reactingCenterStatus', source.center)\n  ifDef(params, 'stereo', source.stereo)\n  // if (params.stereo)\n  // \tparams.stereo = params.stereo > 1 ? params.stereo * 2 : params.stereo;\n  // params.xxx = 0;\n  ifDef(params, 'begin', source.atoms[0])\n  ifDef(params, 'end', source.atoms[1])\n\n  return new Bond(params)\n}\n\nexport function sgroupToStruct(source) {\n  const sgroup = new SGroup(source.type)\n  ifDef(sgroup, 'atoms', source.atoms)\n  switch (source.type) {\n    case 'GEN':\n      break\n    case 'MUL': {\n      ifDef(sgroup.data, 'mul', source.mul)\n      break\n    }\n    case 'SRU': {\n      ifDef(sgroup.data, 'subscript', source.subscript)\n      ifDef(sgroup.data, 'connectivity', source.connectivity.toLowerCase())\n      break\n    }\n    case 'SUP': {\n      ifDef(sgroup.data, 'name', source.name)\n      break\n    }\n    case 'DAT': {\n      ifDef(sgroup.data, 'absolute', source.placement)\n      ifDef(sgroup.data, 'attached', source.display)\n      ifDef(sgroup.data, 'context', source.context)\n      ifDef(sgroup.data, 'fieldName', source.fieldName)\n      ifDef(sgroup.data, 'fieldValue', source.fieldData)\n      break\n    }\n    default:\n      break\n  }\n  return sgroup\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Pile, Struct, Vec2 } from 'domain/entities'\n\nexport function prepareStructForGraph(struct: Struct) {\n  const graphNodes: any = []\n\n  const rgFrags = new Set() // skip this when writing molecules\n  for (const [rgnumber, rgroup] of struct.rgroups.entries()) {\n    // RGroups writing\n    rgroup.frags.forEach(frid => rgFrags.add(frid))\n\n    const fragsAtoms = Array.from(rgroup.frags.values()).reduce(\n      (res, frid) => res.union(struct.getFragmentIds(frid)),\n      new Pile()\n    )\n\n    graphNodes.push({\n      type: 'rgroup',\n      fragment: struct.clone(fragsAtoms),\n      center: getFragmentCenter(struct, fragsAtoms),\n      data: { rgnumber, rgroup }\n    })\n  }\n\n  Array.from(struct.frags.keys())\n    .filter(fid => !rgFrags.has(fid))\n    .forEach(fid => {\n      const fragAtoms = struct.getFragmentIds(fid)\n      graphNodes.push({\n        type: 'molecule',\n        fragment: struct.clone(fragAtoms),\n        center: getFragmentCenter(struct, fragAtoms)\n      })\n    })\n\n  struct.rxnArrows.forEach(item => {\n    graphNodes.push({\n      type: 'arrow',\n      center: item.pp,\n      data: {},\n      mode: item.mode\n    })\n  })\n\n  struct.rxnPluses.forEach(item => {\n    graphNodes.push({\n      type: 'plus',\n      center: item.pp,\n      data: {}\n    })\n  })\n\n  struct.simpleObjects.forEach(item => {\n    graphNodes.push({\n      type: 'simpleObject',\n      center: item.pos[0],\n      data: {\n        mode: item.mode,\n        pos: item.pos\n      }\n    })\n  })\n\n  struct.texts.forEach(item => {\n    graphNodes.push({\n      type: 'text',\n      center: item.position,\n      data: {\n        content: item.content,\n        position: item.position\n      }\n    })\n  })\n\n  return graphNodes.sort((a, b) => a.center.x - b.center.x)\n}\n\nfunction getFragmentCenter(struct, atomSet) {\n  const bb = struct.getCoordBoundingBox(atomSet)\n  return Vec2.centre(bb.min, bb.max)\n}\n","import { Struct } from 'domain/entities'\nimport { ifDef } from 'utils'\nimport { moleculeToGraph } from './moleculeToGraph'\n\nexport function rgroupToGraph(struct: Struct, data) {\n  const body = {\n    rlogic: rgroupLogicToGraph(data.rgnumber, data.rgroup),\n    ...moleculeToGraph(struct)\n  }\n\n  return {\n    ...body,\n    type: 'rgroup'\n  }\n}\n\nfunction rgroupLogicToGraph(rgnumber, rglogic) {\n  const result = {}\n\n  ifDef(result, 'number', rgnumber)\n  ifDef(result, 'range', rglogic.range, '')\n  ifDef(result, 'resth', rglogic.resth, false)\n  ifDef(result, 'ifthen', rglogic.ifthen, 0)\n\n  return result\n}\n","import { RGroup, Struct } from 'domain/entities'\n\nimport { ifDef } from 'utils'\nimport { moleculeToStruct } from './moleculeToStruct'\n\nexport function rgroupToStruct(graphItem): Struct {\n  const struct = moleculeToStruct(graphItem)\n  const rgroup = rgroupLogicToStruct(graphItem.rlogic)\n  struct.frags.forEach((_value: any, key) => {\n    rgroup.frags.add(key)\n  })\n  if (graphItem.rlogic) struct.rgroups.set(graphItem.rlogic.number, rgroup)\n  return struct\n}\n\nexport function rgroupLogicToStruct(rglogic) {\n  const params = {}\n  ifDef(params, 'range', rglogic.range)\n  ifDef(params, 'resth', rglogic.resth)\n  ifDef(params, 'ifthen', rglogic.ifthen)\n\n  return new RGroup(params)\n}\n","import { RxnArrow, RxnPlus, Struct, Vec2 } from 'domain/entities'\n\nexport function rxnToStruct(graphItem: any, struct: Struct): Struct {\n  if (graphItem.type === 'arrow') {\n    struct.rxnArrows.add(\n      new RxnArrow(\n        new Vec2(\n          graphItem.location[0],\n          graphItem.location[1],\n          graphItem.location[2]\n        ),\n        graphItem.mode\n      )\n    )\n  } else {\n    struct.rxnPluses.add(\n      new RxnPlus({\n        pp: {\n          x: graphItem.location[0],\n          y: graphItem.location[1],\n          z: graphItem.location[2]\n        }\n      })\n    )\n  }\n  return struct\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { SimpleObject, SimpleObjectMode, Struct, Vec2 } from 'domain/entities'\n\nexport function simpleObjectToStruct(graphItem: any, struct: Struct): Struct {\n  const object =\n    graphItem.data.mode === 'circle'\n      ? circleToEllipse(graphItem)\n      : graphItem.data\n  struct.simpleObjects.add(new SimpleObject(object))\n  return struct\n}\n\n/**\n * @deprecated TODO to remove after release 2.3\n * As circle has been migrated to ellipses here is function for converting old files data with circles to ellipse type\n * @param graphItem\n */\nfunction circleToEllipse(graphItem) {\n  const radius = Vec2.dist(graphItem.data.pos[1], graphItem.data.pos[0])\n  const pos0 = graphItem.data.pos[0]\n  return {\n    mode: SimpleObjectMode.ellipse,\n    pos: [\n      {\n        x: pos0.x - Math.abs(radius),\n        y: pos0.y - Math.abs(radius),\n        z: pos0.z - Math.abs(radius)\n      },\n      {\n        x: pos0.x + Math.abs(radius),\n        y: pos0.y + Math.abs(radius),\n        z: pos0.z + Math.abs(radius)\n      }\n    ]\n  }\n}\n","import { Struct, Vec2 } from 'domain/entities'\nimport { arrowToGraph, plusToGraph } from './toGraph/rxnToGraph'\n\nimport { Serializer } from '../serializers.types'\nimport { headerToGraph } from './toGraph/headerToGraph'\nimport { moleculeToGraph } from './toGraph/moleculeToGraph'\nimport { moleculeToStruct } from './fromGraph/moleculeToStruct'\nimport { prepareStructForGraph } from './toGraph/prepare'\nimport { rgroupToGraph } from './toGraph/rgroupToGraph'\nimport { rgroupToStruct } from './fromGraph/rgroupToStruct'\nimport { rxnToStruct } from './fromGraph/rxnToStruct'\nimport { simpleObjectToGraph } from './toGraph/simpleObjectToGraph'\nimport { simpleObjectToStruct } from './fromGraph/simpleObjectToStruct'\nimport { textToGraph } from './toGraph/textToGraph'\nimport { textToStruct } from './fromGraph/textToStruct'\nimport { validate } from './validate'\n\nfunction parseNode(node: any, struct: any) {\n  const type = node.type\n  switch (type) {\n    case 'arrow':\n      rxnToStruct(node, struct)\n      break\n    case 'plus':\n      rxnToStruct(node, struct)\n      break\n    case 'simpleObject':\n      simpleObjectToStruct(node, struct)\n      break\n    case 'molecule':\n      const currentStruct = moleculeToStruct(node)\n      if (node.stereoFlagPosition) {\n        const fragment = currentStruct.frags.get(0)!\n        fragment.stereoFlagPosition = new Vec2(node.stereoFlagPosition)\n      }\n\n      currentStruct.mergeInto(struct)\n      break\n    case 'rgroup':\n      rgroupToStruct(node).mergeInto(struct)\n      break\n    case 'text':\n      textToStruct(node, struct)\n      break\n    default:\n      break\n  }\n}\nexport class KetSerializer implements Serializer<Struct> {\n  deserialize(content: string): Struct {\n    const resultingStruct = new Struct()\n    const graph = JSON.parse(content)\n    if (!validate(graph)) {\n      throw new Error('Cannot deserialize input JSON.')\n    }\n    resultingStruct.name = graph.header ? graph.header.moleculeName : null\n\n    const nodes = graph.root.nodes\n    Object.keys(nodes).forEach(i => {\n      if (nodes[i].type) parseNode(nodes[i], resultingStruct)\n      else if (nodes[i].$ref) parseNode(graph[nodes[i].$ref], resultingStruct)\n    })\n\n    return resultingStruct\n  }\n\n  serialize(struct: Struct): string {\n    const result: any = {\n      root: {\n        nodes: []\n      }\n    }\n\n    const header = headerToGraph(struct)\n    if (header) result.header = header\n\n    const graphNodes = prepareStructForGraph(struct)\n\n    let moleculeId = 0\n    graphNodes.forEach(item => {\n      switch (item.type) {\n        case 'molecule': {\n          result.root.nodes.push({ $ref: `mol${moleculeId}` })\n          result[`mol${moleculeId++}`] = moleculeToGraph(item.fragment)\n          break\n        }\n        case 'rgroup': {\n          result.root.nodes.push({ $ref: `rg${item.data!.rgnumber}` })\n          result[`rg${item.data!.rgnumber}`] = rgroupToGraph(\n            item.fragment,\n            item.data\n          )\n          break\n        }\n        case 'plus': {\n          result.root.nodes.push(plusToGraph(item))\n          break\n        }\n        case 'arrow': {\n          result.root.nodes.push(arrowToGraph(item))\n          break\n        }\n        case 'simpleObject': {\n          result.root.nodes.push(simpleObjectToGraph(item))\n          break\n        }\n        case 'text': {\n          result.root.nodes.push(textToGraph(item))\n          break\n        }\n        default:\n          break\n      }\n    })\n\n    return JSON.stringify(result, null, 4)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Struct, Text } from 'domain/entities'\n\nexport function textToStruct(graphItem: any, struct: Struct) {\n  const object = graphItem.data\n  struct.texts.add(new Text(object))\n\n  return struct\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Validator } from 'jsonschema'\nimport schema from './schema.json'\n\nexport function validate(graph: any): boolean {\n  const validator = new Validator()\n  const result = validator.validate(graph, schema)\n  return result.valid\n}\n","import { Struct } from 'domain/entities'\nimport { ifDef } from 'utils'\n\nexport function headerToGraph(struct: Struct): any {\n  const header = {}\n\n  ifDef(header, 'moleculeName', struct.name, '')\n  ifDef(header, 'creatorProgram', null, '')\n  ifDef(header, 'comment', null, '')\n\n  return Object.keys(header).length !== 0 ? header : null\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nexport function arrowToGraph(arrowNode) {\n  const coord = arrowNode.center\n  return {\n    type: 'arrow',\n    location: [coord.x, coord.y, coord.z],\n    prop: arrowNode.data,\n    mode: arrowNode.mode\n  }\n}\n\nexport function plusToGraph(plusNode) {\n  const coord = plusNode.center\n  return {\n    type: 'plus',\n    location: [coord.x, coord.y, coord.z],\n    prop: plusNode.data\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nexport function simpleObjectToGraph(simpleObjectNode) {\n  return {\n    type: 'simpleObject',\n    data: simpleObjectNode.data\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nexport function textToGraph(textNode) {\n  return {\n    type: 'text',\n    data: textNode.data\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Bond, RxnArrow, RxnPlus, Struct, Vec2 } from 'domain/entities'\n\nfunction paddedNum(number, width, precision) {\n  number = parseFloat(number)\n\n  var numStr = number.toFixed(precision || 0).replace(',', '.') // Really need to replace?\n  if (numStr.length > width) throw new Error('number does not fit')\n\n  return numStr.padStart(width)\n}\n\nfunction parseDecimalInt(str) {\n  /* reader */\n  var val = parseInt(str, 10)\n\n  return isNaN(val) ? 0 : val // eslint-disable-line\n}\n\nfunction partitionLine(\n  /* string*/ str,\n  /* array of int*/ parts,\n  /* bool*/ withspace\n) {\n  /* reader */\n  var res = []\n  for (var i = 0, shift = 0; i < parts.length; ++i) {\n    res.push(str.slice(shift, shift + parts[i]))\n    if (withspace) shift++\n    shift += parts[i]\n  }\n  return res\n}\n\nfunction partitionLineFixed(\n  /* string*/ str,\n  /* int*/ itemLength,\n  /* bool*/ withspace\n) {\n  /* reader */\n  var res = []\n  for (var shift = 0; shift < str.length; shift += itemLength) {\n    res.push(str.slice(shift, shift + itemLength))\n    if (withspace) shift++\n  }\n  return res\n}\n\nvar fmtInfo = {\n  bondTypeMap: {\n    1: Bond.PATTERN.TYPE.SINGLE,\n    2: Bond.PATTERN.TYPE.DOUBLE,\n    3: Bond.PATTERN.TYPE.TRIPLE,\n    4: Bond.PATTERN.TYPE.AROMATIC,\n    5: Bond.PATTERN.TYPE.SINGLE_OR_DOUBLE,\n    6: Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC,\n    7: Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC,\n    8: Bond.PATTERN.TYPE.ANY,\n    9: Bond.PATTERN.TYPE.DATIVE,\n    10: Bond.PATTERN.TYPE.HYDROGEN\n  },\n  bondStereoMap: {\n    0: Bond.PATTERN.STEREO.NONE,\n    1: Bond.PATTERN.STEREO.UP,\n    4: Bond.PATTERN.STEREO.EITHER,\n    6: Bond.PATTERN.STEREO.DOWN,\n    3: Bond.PATTERN.STEREO.CIS_TRANS\n  },\n  v30bondStereoMap: {\n    0: Bond.PATTERN.STEREO.NONE,\n    1: Bond.PATTERN.STEREO.UP,\n    2: Bond.PATTERN.STEREO.EITHER,\n    3: Bond.PATTERN.STEREO.DOWN\n  },\n  bondTopologyMap: {\n    0: Bond.PATTERN.TOPOLOGY.EITHER,\n    1: Bond.PATTERN.TOPOLOGY.RING,\n    2: Bond.PATTERN.TOPOLOGY.CHAIN\n  },\n  countsLinePartition: [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 6],\n  atomLinePartition: [10, 10, 10, 1, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],\n  bondLinePartition: [3, 3, 3, 3, 3, 3, 3],\n  atomListHeaderPartition: [3, 1, 1, 4, 1, 1],\n  atomListHeaderLength: 11, // = atomListHeaderPartition.reduce(function(a,b) { return a + b; }, 0)\n  atomListHeaderItemLength: 4,\n  chargeMap: [0, +3, +2, +1, 0, -1, -2, -3],\n  valenceMap: [undefined, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 0],\n  implicitHydrogenMap: [undefined, 0, 1, 2, 3, 4],\n  v30atomPropMap: {\n    CHG: 'charge',\n    RAD: 'radical',\n    MASS: 'isotope',\n    VAL: 'explicitValence',\n    HCOUNT: 'hCount',\n    INVRET: 'invRet',\n    SUBST: 'substitutionCount',\n    UNSAT: 'unsaturatedAtom',\n    RBCNT: 'ringBondCount'\n  },\n  rxnItemsPartition: [3, 3, 3]\n}\n\nvar FRAGMENT = {\n  NONE: 0,\n  REACTANT: 1,\n  PRODUCT: 2,\n  AGENT: 3\n}\n\nvar SHOULD_RESCALE_MOLECULES = true\n\nfunction rxnMerge(\n  mols,\n  nReactants,\n  nProducts,\n  nAgents,\n  shouldReactionRelayout\n) /* Struct */ {\n  // eslint-disable-line max-statements\n  /* reader */\n  var ret = new Struct()\n  var bbReact = [],\n    bbAgent = [],\n    bbProd = []\n  var molReact = [],\n    molAgent = [],\n    molProd = []\n  var j\n  var bondLengthData = { cnt: 0, totalLength: 0 }\n  for (j = 0; j < mols.length; ++j) {\n    var mol = mols[j]\n    var bondLengthDataMol = mol.getBondLengthData()\n    bondLengthData.cnt += bondLengthDataMol.cnt\n    bondLengthData.totalLength += bondLengthDataMol.totalLength\n  }\n  if (SHOULD_RESCALE_MOLECULES) {\n    var avgBondLength =\n      1 /\n      (bondLengthData.cnt == 0\n        ? 1\n        : bondLengthData.totalLength / bondLengthData.cnt)\n    for (j = 0; j < mols.length; ++j) {\n      mol = mols[j]\n      mol.scale(avgBondLength)\n    }\n  }\n\n  for (j = 0; j < mols.length; ++j) {\n    mol = mols[j]\n    var bb = mol.getCoordBoundingBoxObj()\n    if (!bb) continue // eslint-disable-line no-continue\n\n    var fragmentType =\n      j < nReactants\n        ? FRAGMENT.REACTANT // eslint-disable-line no-nested-ternary\n        : j < nReactants + nProducts\n        ? FRAGMENT.PRODUCT\n        : FRAGMENT.AGENT\n    if (fragmentType == FRAGMENT.REACTANT) {\n      bbReact.push(bb)\n      molReact.push(mol)\n    } else if (fragmentType == FRAGMENT.AGENT) {\n      bbAgent.push(bb)\n      molAgent.push(mol)\n    } else if (fragmentType == FRAGMENT.PRODUCT) {\n      bbProd.push(bb)\n      molProd.push(mol)\n    }\n\n    mol.atoms.forEach(atom => {\n      atom.rxnFragmentType = fragmentType\n    })\n  }\n\n  function shiftMol(ret, mol, bb, xorig, over) {\n    // eslint-disable-line max-params\n    var d = new Vec2(\n      xorig - bb.min.x,\n      over ? 1 - bb.min.y : -(bb.min.y + bb.max.y) / 2\n    )\n    mol.atoms.forEach(atom => {\n      atom.pp.add_(d) // eslint-disable-line no-underscore-dangle\n    })\n\n    mol.sgroups.forEach(item => {\n      if (item.pp) item.pp.add_(d) // eslint-disable-line no-underscore-dangle\n    })\n    bb.min.add_(d) // eslint-disable-line no-underscore-dangle\n    bb.max.add_(d) // eslint-disable-line no-underscore-dangle\n    mol.mergeInto(ret)\n    return bb.max.x - bb.min.x\n  }\n\n  if (shouldReactionRelayout) {\n    // reaction fragment layout\n    var xorig = 0\n    for (j = 0; j < molReact.length; ++j)\n      xorig += shiftMol(ret, molReact[j], bbReact[j], xorig, false) + 2.0\n    xorig += 2.0\n    for (j = 0; j < molAgent.length; ++j)\n      xorig += shiftMol(ret, molAgent[j], bbAgent[j], xorig, true) + 2.0\n    xorig += 2.0\n\n    for (j = 0; j < molProd.length; ++j)\n      xorig += shiftMol(ret, molProd[j], bbProd[j], xorig, false) + 2.0\n  } else {\n    for (j = 0; j < molReact.length; ++j) molReact[j].mergeInto(ret)\n    for (j = 0; j < molAgent.length; ++j) molAgent[j].mergeInto(ret)\n    for (j = 0; j < molProd.length; ++j) molProd[j].mergeInto(ret)\n  }\n\n  var bb1\n  var bb2\n  var x\n  var y\n  var bbReactAll = null\n  var bbProdAll = null\n  for (j = 0; j < bbReact.length - 1; ++j) {\n    bb1 = bbReact[j]\n    bb2 = bbReact[j + 1]\n\n    x = (bb1.max.x + bb2.min.x) / 2\n    y = (bb1.max.y + bb1.min.y + bb2.max.y + bb2.min.y) / 4\n\n    ret.rxnPluses.add(new RxnPlus({ pp: new Vec2(x, y) }))\n  }\n  for (j = 0; j < bbReact.length; ++j) {\n    if (j == 0) {\n      bbReactAll = {}\n      bbReactAll.max = new Vec2(bbReact[j].max)\n      bbReactAll.min = new Vec2(bbReact[j].min)\n    } else {\n      bbReactAll.max = Vec2.max(bbReactAll.max, bbReact[j].max)\n      bbReactAll.min = Vec2.min(bbReactAll.min, bbReact[j].min)\n    }\n  }\n  for (j = 0; j < bbProd.length - 1; ++j) {\n    bb1 = bbProd[j]\n    bb2 = bbProd[j + 1]\n\n    x = (bb1.max.x + bb2.min.x) / 2\n    y = (bb1.max.y + bb1.min.y + bb2.max.y + bb2.min.y) / 4\n\n    ret.rxnPluses.add(new RxnPlus({ pp: new Vec2(x, y) }))\n  }\n  for (j = 0; j < bbProd.length; ++j) {\n    if (j == 0) {\n      bbProdAll = {}\n      bbProdAll.max = new Vec2(bbProd[j].max)\n      bbProdAll.min = new Vec2(bbProd[j].min)\n    } else {\n      bbProdAll.max = Vec2.max(bbProdAll.max, bbProd[j].max)\n      bbProdAll.min = Vec2.min(bbProdAll.min, bbProd[j].min)\n    }\n  }\n  bb1 = bbReactAll\n  bb2 = bbProdAll\n  if (!bb1 && !bb2) {\n    ret.rxnArrows.add(new RxnArrow(new Vec2(0, 0)))\n  } else {\n    var v1 = bb1 ? new Vec2(bb1.max.x, (bb1.max.y + bb1.min.y) / 2) : null\n    var v2 = bb2 ? new Vec2(bb2.min.x, (bb2.max.y + bb2.min.y) / 2) : null\n    var defaultOffset = 3\n    if (!v1) v1 = new Vec2(v2.x - defaultOffset, v2.y)\n    if (!v2) v2 = new Vec2(v1.x + defaultOffset, v1.y)\n    ret.rxnArrows.add(new RxnArrow(Vec2.lc2(v1, 0.5, v2, 0.5)))\n  }\n  ret.isReaction = true\n  return ret\n}\n\nexport default {\n  fmtInfo,\n  paddedNum,\n  parseDecimalInt,\n  partitionLine,\n  partitionLineFixed,\n  rxnMerge\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Pool, SGroup, Vec2 } from 'domain/entities'\n\nimport utils from './utils'\n\n/**\n * @param str { string }\n * @param valueString { boolean }\n * @returns { Pool }\n */\nfunction readKeyValuePairs(str, valueString) {\n  const ret = new Pool()\n  const partition = utils.partitionLineFixed(str, 3, true)\n  const count = utils.parseDecimalInt(partition[0])\n\n  for (let i = 0; i < count; ++i) {\n    const key = utils.parseDecimalInt(partition[2 * i + 1]) - 1\n    const value = valueString\n      ? partition[2 * i + 2].trim()\n      : utils.parseDecimalInt(partition[2 * i + 2])\n\n    ret.set(key, value)\n  }\n\n  return ret\n}\n\n/**\n * @param str { string }\n * @param valueString { boolean }\n * @returns { Array }\n */\nfunction readKeyMultiValuePairs(str, valueString) {\n  /* reader */\n  var ret = []\n  var partition = utils.partitionLineFixed(str, 3, true)\n  var count = utils.parseDecimalInt(partition[0])\n  for (var i = 0; i < count; ++i) {\n    ret.push([\n      /* eslint-disable no-mixed-operators*/\n      utils.parseDecimalInt(partition[2 * i + 1]) - 1,\n      valueString\n        ? partition[2 * i + 2].trim()\n        : utils.parseDecimalInt(partition[2 * i + 2])\n      /* eslint-enable no-mixed-operators*/\n    ])\n  }\n  return ret\n}\n\nfunction postLoadMul(sgroup, mol, atomMap) {\n  // eslint-disable-line max-statements\n  sgroup.data.mul = sgroup.data.subscript - 0\n  var atomReductionMap = {}\n\n  sgroup.atoms = SGroup.filterAtoms(sgroup.atoms, atomMap)\n  sgroup.patoms = SGroup.filterAtoms(sgroup.patoms, atomMap)\n\n  // mark repetitions for removal\n  for (var k = 1; k < sgroup.data.mul; ++k) {\n    for (var m = 0; m < sgroup.patoms.length; ++m) {\n      var raid = sgroup.atoms[k * sgroup.patoms.length + m] // eslint-disable-line no-mixed-operators\n      if (raid < 0) continue // eslint-disable-line no-continue\n      if (sgroup.patoms[m] < 0) throw new Error('parent atom missing')\n      atomReductionMap[raid] = sgroup.patoms[m] // \"merge\" atom in parent\n    }\n  }\n  sgroup.patoms = SGroup.removeNegative(sgroup.patoms)\n\n  var patomsMap = identityMap(sgroup.patoms)\n\n  var bondsToRemove = []\n  mol.bonds.forEach((bond, bid) => {\n    var beginIn = bond.begin in atomReductionMap\n    var endIn = bond.end in atomReductionMap\n    // if both adjacent atoms of a bond are to be merged, remove it\n    /* eslint-disable no-mixed-operators*/\n    if (\n      (beginIn && endIn) ||\n      (beginIn && bond.end in patomsMap) ||\n      (endIn && bond.begin in patomsMap)\n    )\n      bondsToRemove.push(bid)\n    /* eslint-enable no-mixed-operators*/\n    // if just one atom is merged, modify the bond accordingly\n    else if (beginIn) bond.begin = atomReductionMap[bond.begin]\n    else if (endIn) bond.end = atomReductionMap[bond.end]\n  }, sgroup)\n\n  // apply removal lists\n  for (var b = 0; b < bondsToRemove.length; ++b)\n    mol.bonds.delete(bondsToRemove[b])\n  for (var a in atomReductionMap) {\n    mol.atoms.delete(+a)\n    atomMap[a] = -1\n  }\n  sgroup.atoms = sgroup.patoms\n  sgroup.patoms = null\n}\n\nfunction postLoadSru(sgroup) {\n  sgroup.data.connectivity = (sgroup.data.connectivity || 'EU')\n    .trim()\n    .toLowerCase()\n}\n\nfunction postLoadSup(sgroup) {\n  sgroup.data.name = (sgroup.data.subscript || '').trim()\n  sgroup.data.subscript = ''\n}\n\nfunction postLoadGen(sgroup, mol, atomMap) {\n  // eslint-disable-line no-unused-vars\n}\n\nfunction postLoadDat(sgroup, mol) {\n  if (!sgroup.data.absolute)\n    sgroup.pp = sgroup.pp.add(SGroup.getMassCentre(mol, sgroup.atoms))\n}\n\nfunction loadSGroup(mol, sg, atomMap) {\n  var postLoadMap = {\n    MUL: postLoadMul,\n    SRU: postLoadSru,\n    SUP: postLoadSup,\n    DAT: postLoadDat,\n    GEN: postLoadGen\n  }\n\n  // add the group to the molecule\n  sg.id = mol.sgroups.add(sg)\n\n  // apply type-specific post-processing\n  postLoadMap[sg.type](sg, mol, atomMap)\n  // mark atoms in the group as belonging to it\n  for (let s = 0; s < sg.atoms.length; ++s) {\n    if (mol.atoms.has(sg.atoms[s])) mol.atoms.get(sg.atoms[s]).sgs.add(sg.id)\n  }\n\n  if (sg.type === 'DAT') mol.sGroupForest.insert(sg, -1, [])\n  else mol.sGroupForest.insert(sg)\n\n  return sg.id\n}\n\nfunction initSGroup(sGroups, propData) {\n  /* reader */\n  const kv = readKeyValuePairs(propData, true)\n  for (const [key, type] of kv) {\n    if (!(type in SGroup.TYPES)) throw new Error('Unsupported S-group type')\n\n    const sg = new SGroup(type)\n    sg.number = key\n    sGroups[key] = sg\n  }\n}\n\nfunction applySGroupProp(sGroups, propName, propData, numeric, core) {\n  // eslint-disable-line max-params\n  const kv = readKeyValuePairs(propData, !numeric)\n  // \"core\" properties are stored directly in an sgroup, not in sgroup.data\n  for (const key of kv.keys())\n    (core ? sGroups[key] : sGroups[key].data)[propName] = kv.get(key)\n}\n\nfunction applySGroupArrayProp(sGroups, propName, propData, shift) {\n  /* reader */\n  const sid = utils.parseDecimalInt(propData.slice(1, 4)) - 1\n  const num = utils.parseDecimalInt(propData.slice(4, 8))\n  let part = toIntArray(utils.partitionLineFixed(propData.slice(8), 3, true))\n\n  if (part.length !== num) throw new Error('File format invalid')\n  if (shift) part = part.map(v => v + shift)\n\n  sGroups[sid][propName] = sGroups[sid][propName].concat(part)\n}\n\nfunction applyDataSGroupName(sg, name) {\n  /* reader */\n  sg.data.fieldName = name\n}\n\nfunction applyDataSGroupQuery(sg, query) {\n  /* reader */\n  sg.data.query = query\n}\n\nfunction applyDataSGroupQueryOp(sg, queryOp) {\n  /* reader */\n  sg.data.queryOp = queryOp\n}\n\nfunction applyDataSGroupDesc(sGroups, propData) {\n  /* reader */\n  var split = utils.partitionLine(propData, [4, 31, 2, 20, 2, 3], false)\n  var id = utils.parseDecimalInt(split[0]) - 1\n  var fieldName = split[1].trim()\n  var fieldType = split[2].trim()\n  var units = split[3].trim()\n  var query = split[4].trim()\n  var queryOp = split[5].trim()\n  var sGroup = sGroups[id]\n  sGroup.data.fieldType = fieldType\n  sGroup.data.fieldName = fieldName\n  sGroup.data.units = units\n  sGroup.data.query = query\n  sGroup.data.queryOp = queryOp\n}\n\nfunction applyDataSGroupInfo(sg, propData) {\n  // eslint-disable-line max-statements\n  /* reader */\n  var split = utils.partitionLine(\n    propData,\n    [\n      10 /* x.x*/,\n      10 /* y.y*/,\n      4 /* eee*/,\n      1 /* f*/,\n      1 /* g*/,\n      1 /* h*/,\n      3 /* i */,\n      3 /* jjj*/,\n      3 /* kkk*/,\n      3 /* ll*/,\n      2 /* m*/,\n      3 /* n*/,\n      2 /* oo*/\n    ],\n    false\n  )\n\n  var x = parseFloat(split[0])\n  var y = parseFloat(split[1])\n  var attached = split[3].trim() == 'A'\n  var absolute = split[4].trim() == 'A'\n  var showUnits = split[5].trim() == 'U'\n  var nCharsToDisplay = split[7].trim()\n  nCharsToDisplay =\n    nCharsToDisplay == 'ALL' ? -1 : utils.parseDecimalInt(nCharsToDisplay)\n  var tagChar = split[10].trim()\n  var daspPos = utils.parseDecimalInt(split[11].trim())\n\n  sg.pp = new Vec2(x, -y)\n  sg.data.attached = attached\n  sg.data.absolute = absolute\n  sg.data.showUnits = showUnits\n  sg.data.nCharsToDisplay = nCharsToDisplay\n  sg.data.tagChar = tagChar\n  sg.data.daspPos = daspPos\n}\n\nfunction applyDataSGroupInfoLine(sGroups, propData) {\n  /* reader */\n  var id = utils.parseDecimalInt(propData.substr(0, 4)) - 1\n  var sg = sGroups[id]\n  applyDataSGroupInfo(sg, propData.substr(5))\n}\n\nfunction applyDataSGroupData(sg, data, finalize) {\n  /* reader */\n  sg.data.fieldValue = (sg.data.fieldValue || '') + data\n  if (finalize) {\n    sg.data.fieldValue = trimRight(sg.data.fieldValue)\n    if (sg.data.fieldValue.startsWith('\"') && sg.data.fieldValue.endsWith('\"'))\n      sg.data.fieldValue = sg.data.fieldValue.substr(\n        1,\n        sg.data.fieldValue.length - 2\n      )\n  }\n}\n\nfunction applyDataSGroupDataLine(sGroups, propData, finalize) {\n  /* reader */\n  var id = utils.parseDecimalInt(propData.substr(0, 5)) - 1\n  var data = propData.substr(5)\n  var sg = sGroups[id]\n  applyDataSGroupData(sg, data, finalize)\n}\n\n// Utilities functions\nfunction toIntArray(strArray) {\n  /* reader */\n  var ret = []\n  for (var j = 0; j < strArray.length; ++j)\n    ret[j] = utils.parseDecimalInt(strArray[j])\n  return ret\n}\n\nfunction trimRight(str) {\n  return str.replace(/\\s+$/, '')\n}\n\nfunction identityMap(array) {\n  var map = {}\n  for (var i = 0; i < array.length; ++i) map[array[i]] = array[i]\n  return map\n}\n\nexport default {\n  readKeyValuePairs,\n  readKeyMultiValuePairs,\n  loadSGroup,\n  initSGroup,\n  applySGroupProp,\n  applySGroupArrayProp,\n  applyDataSGroupName,\n  applyDataSGroupQuery,\n  applyDataSGroupQueryOp,\n  applyDataSGroupDesc,\n  applyDataSGroupInfo,\n  applyDataSGroupData,\n  applyDataSGroupInfoLine,\n  applyDataSGroupDataLine\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\n/* eslint-disable guard-for-in */ // todo\n\nimport {\n  Atom,\n  AtomList,\n  Bond,\n  Pool,\n  RGroup,\n  SGroup,\n  StereoLabel,\n  Struct,\n  Vec2\n} from 'domain/entities'\n\nimport { Elements } from 'domain/constants'\nimport sGroup from './parseSGroup'\nimport utils from './utils'\n\nconst loadRGroupFragments = true // TODO: set to load the fragments\n\nfunction parseAtomLine(atomLine) {\n  /* reader */\n  var atomSplit = utils.partitionLine(atomLine, utils.fmtInfo.atomLinePartition)\n  var params = {\n    // generic\n    pp: new Vec2(\n      parseFloat(atomSplit[0]),\n      -parseFloat(atomSplit[1]),\n      parseFloat(atomSplit[2])\n    ),\n    label: atomSplit[4].trim(),\n    explicitValence:\n      utils.fmtInfo.valenceMap[utils.parseDecimalInt(atomSplit[10])],\n\n    // obsolete\n    massDifference: utils.parseDecimalInt(atomSplit[5]),\n    charge: utils.fmtInfo.chargeMap[utils.parseDecimalInt(atomSplit[6])],\n\n    // query\n    hCount: utils.parseDecimalInt(utils.parseDecimalInt(atomSplit[8])),\n    stereoCare: utils.parseDecimalInt(atomSplit[9]) != 0,\n\n    // reaction\n    aam: utils.parseDecimalInt(atomSplit[14]),\n    invRet: utils.parseDecimalInt(atomSplit[15]),\n\n    // reaction query\n    exactChangeFlag: utils.parseDecimalInt(atomSplit[16]) != 0\n  }\n  return new Atom(params)\n}\n\nfunction parseBondLine(bondLine) {\n  /* reader */\n  var bondSplit = utils.partitionLine(bondLine, utils.fmtInfo.bondLinePartition)\n  var params = {\n    begin: utils.parseDecimalInt(bondSplit[0]) - 1,\n    end: utils.parseDecimalInt(bondSplit[1]) - 1,\n    type: utils.fmtInfo.bondTypeMap[utils.parseDecimalInt(bondSplit[2])],\n    stereo: utils.fmtInfo.bondStereoMap[utils.parseDecimalInt(bondSplit[3])],\n    xxx: bondSplit[4],\n    topology:\n      utils.fmtInfo.bondTopologyMap[utils.parseDecimalInt(bondSplit[5])],\n    reactingCenterStatus: utils.parseDecimalInt(bondSplit[6])\n  }\n\n  return new Bond(params)\n}\n\nfunction parseAtomListLine(/* string */ atomListLine) {\n  /* reader */\n  var split = utils.partitionLine(\n    atomListLine,\n    utils.fmtInfo.atomListHeaderPartition\n  )\n\n  var number = utils.parseDecimalInt(split[0]) - 1\n  var notList = split[2].trim() == 'T'\n  var count = utils.parseDecimalInt(split[4].trim())\n\n  var ids = atomListLine.slice(utils.fmtInfo.atomListHeaderLength)\n  var list = []\n  var itemLength = utils.fmtInfo.atomListHeaderItemLength\n  for (var i = 0; i < count; ++i)\n    list[i] = utils.parseDecimalInt(\n      ids.slice(i * itemLength, (i + 1) * itemLength - 1)\n    )\n\n  return {\n    aid: number,\n    atomList: new AtomList({\n      notList,\n      ids: list\n    })\n  }\n}\n\n/**\n * @param ctab\n * @param ctabLines\n * @param shift\n * @param end\n * @param sGroups\n * @param rLogic\n * @returns { Pool }\n */\nfunction parsePropertyLines(ctab, ctabLines, shift, end, sGroups, rLogic) {\n  // eslint-disable-line max-statements, max-params\n  /* reader */\n  const props = new Pool()\n\n  while (shift < end) {\n    var line = ctabLines[shift]\n    if (line.charAt(0) == 'A') {\n      var propValue = ctabLines[++shift]\n      var isPseudo = /'.+'/.test(propValue)\n      if (isPseudo && !props.get('pseudo')) props.set('pseudo', new Pool())\n      if (!isPseudo && !props.get('alias')) props.set('alias', new Pool())\n      if (isPseudo) propValue = propValue.replace(/'/g, '')\n      props\n        .get(isPseudo ? 'pseudo' : 'alias')\n        .set(utils.parseDecimalInt(line.slice(3, 6)) - 1, propValue)\n    } else if (line.charAt(0) == 'M') {\n      var type = line.slice(3, 6)\n      var propertyData = line.slice(6)\n      if (type == 'END') {\n        break\n      } else if (type == 'CHG') {\n        if (!props.get('charge'))\n          props.set('charge', sGroup.readKeyValuePairs(propertyData))\n      } else if (type == 'RAD') {\n        if (!props.get('radical'))\n          props.set('radical', sGroup.readKeyValuePairs(propertyData))\n      } else if (type == 'ISO') {\n        if (!props.get('isotope'))\n          props.set('isotope', sGroup.readKeyValuePairs(propertyData))\n      } else if (type == 'RBC') {\n        if (!props.get('ringBondCount'))\n          props.set('ringBondCount', sGroup.readKeyValuePairs(propertyData))\n      } else if (type == 'SUB') {\n        if (!props.get('substitutionCount'))\n          props.set('substitutionCount', sGroup.readKeyValuePairs(propertyData))\n      } else if (type == 'UNS') {\n        if (!props.get('unsaturatedAtom'))\n          props.set('unsaturatedAtom', sGroup.readKeyValuePairs(propertyData))\n        // else if (type == \"LIN\") // link atom\n      } else if (type == 'RGP') {\n        // rgroup atom\n        if (!props.get('rglabel')) props.set('rglabel', new Pool())\n        var rglabels = props.get('rglabel')\n        var a2rs = sGroup.readKeyMultiValuePairs(propertyData)\n        for (var a2ri = 0; a2ri < a2rs.length; a2ri++) {\n          var a2r = a2rs[a2ri]\n          rglabels.set(\n            a2r[0],\n            (rglabels.get(a2r[0]) || 0) | (1 << (a2r[1] - 1))\n          )\n        }\n      } else if (type == 'LOG') {\n        // rgroup atom\n        propertyData = propertyData.slice(4)\n        var rgid = utils.parseDecimalInt(propertyData.slice(0, 3).trim())\n        var iii = utils.parseDecimalInt(propertyData.slice(4, 7).trim())\n        var hhh = utils.parseDecimalInt(propertyData.slice(8, 11).trim())\n        var ooo = propertyData.slice(12).trim()\n        var logic = {}\n        if (iii > 0) logic.ifthen = iii\n        logic.resth = hhh == 1\n        logic.range = ooo\n        rLogic[rgid] = logic\n      } else if (type == 'APO') {\n        if (!props.get('attpnt'))\n          props.set('attpnt', sGroup.readKeyValuePairs(propertyData))\n      } else if (type == 'ALS') {\n        // atom list\n        const pool = parsePropertyLineAtomList(\n          utils.partitionLine(propertyData, [1, 3, 3, 1, 1, 1]),\n          utils.partitionLineFixed(propertyData.slice(10), 4, false)\n        )\n\n        if (!props.get('atomList')) props.set('atomList', new Pool())\n        if (!props.get('label')) props.set('label', new Pool())\n\n        pool.forEach((atomList, aid) => {\n          props.get('label').set(aid, 'L#')\n          props.get('atomList').set(aid, atomList)\n        })\n      } else if (type == 'STY') {\n        // introduce s-group\n        sGroup.initSGroup(sGroups, propertyData)\n      } else if (type == 'SST') {\n        sGroup.applySGroupProp(sGroups, 'subtype', propertyData)\n      } else if (type == 'SLB') {\n        sGroup.applySGroupProp(sGroups, 'label', propertyData, true)\n      } else if (type == 'SPL') {\n        sGroup.applySGroupProp(sGroups, 'parent', propertyData, true, true)\n      } else if (type == 'SCN') {\n        sGroup.applySGroupProp(sGroups, 'connectivity', propertyData)\n      } else if (type == 'SAL') {\n        sGroup.applySGroupArrayProp(sGroups, 'atoms', propertyData, -1)\n      } else if (type == 'SBL') {\n        sGroup.applySGroupArrayProp(sGroups, 'bonds', propertyData, -1)\n      } else if (type == 'SPA') {\n        sGroup.applySGroupArrayProp(sGroups, 'patoms', propertyData, -1)\n      } else if (type == 'SMT') {\n        var sid = utils.parseDecimalInt(propertyData.slice(0, 4)) - 1\n        sGroups[sid].data.subscript = propertyData.slice(4).trim()\n      } else if (type == 'SDT') {\n        sGroup.applyDataSGroupDesc(sGroups, propertyData)\n      } else if (type == 'SDD') {\n        sGroup.applyDataSGroupInfoLine(sGroups, propertyData)\n      } else if (type == 'SCD') {\n        sGroup.applyDataSGroupDataLine(sGroups, propertyData, false)\n      } else if (type == 'SED') {\n        sGroup.applyDataSGroupDataLine(sGroups, propertyData, true)\n      }\n    }\n    ++shift\n  }\n  return props\n}\n\n/**\n * @param atoms { Pool }\n * @param values { Pool }\n * @param propId { string }\n */\nfunction applyAtomProp(atoms, values, propId) {\n  /* reader */\n  values.forEach((propVal, aid) => {\n    atoms.get(aid)[propId] = propVal\n  })\n}\n\nfunction parseCTabV2000(ctabLines, countsSplit) {\n  // eslint-disable-line max-statements\n  /* reader */\n  const ctab = new Struct()\n  let i\n  const atomCount = utils.parseDecimalInt(countsSplit[0])\n  const bondCount = utils.parseDecimalInt(countsSplit[1])\n  const atomListCount = utils.parseDecimalInt(countsSplit[2])\n  const isAbs = utils.parseDecimalInt(countsSplit[4]) === 1\n  const isAnd = utils.parseDecimalInt(countsSplit[4]) === 0\n  const stextLinesCount = utils.parseDecimalInt(countsSplit[5])\n  const propertyLinesCount = utils.parseDecimalInt(countsSplit[10])\n\n  let shift = 0\n  const atomLines = ctabLines.slice(shift, shift + atomCount)\n  shift += atomCount\n  const bondLines = ctabLines.slice(shift, shift + bondCount)\n  shift += bondCount\n  const atomListLines = ctabLines.slice(shift, shift + atomListCount)\n  shift += atomListCount + stextLinesCount\n\n  const atoms = atomLines.map(parseAtomLine)\n  atoms.forEach(atom => ctab.atoms.add(atom))\n\n  const bonds = bondLines.map(parseBondLine)\n  bonds.forEach(bond => {\n    if (bond.stereo && isAbs)\n      ctab.atoms.get(bond.begin).stereoLabel = StereoLabel.Abs\n    if (bond.stereo && isAnd)\n      ctab.atoms.get(bond.begin).stereoLabel = `${StereoLabel.And}1`\n    ctab.bonds.add(bond)\n  })\n\n  const atomLists = atomListLines.map(parseAtomListLine)\n  atomLists.forEach(pair => {\n    ctab.atoms.get(pair.aid).atomList = pair.atomList\n    ctab.atoms.get(pair.aid).label = 'L#'\n  })\n\n  const sGroups = {}\n  const rLogic = {}\n  const props = parsePropertyLines(\n    ctab,\n    ctabLines,\n    shift,\n    Math.min(ctabLines.length, shift + propertyLinesCount),\n    sGroups,\n    rLogic\n  )\n  props.forEach((values, propId) => {\n    applyAtomProp(ctab.atoms, values, propId)\n  })\n\n  const atomMap = {}\n  let sid\n  for (sid in sGroups) {\n    const sg = sGroups[sid]\n    if (sg.type === 'DAT' && sg.atoms.length === 0) {\n      const parent = sGroups[sid].parent\n      if (parent >= 0) {\n        const psg = sGroups[parent - 1]\n        if (psg.type === 'GEN') sg.atoms = [].slice.call(psg.atoms)\n      }\n    }\n  }\n  for (sid in sGroups) sGroup.loadSGroup(ctab, sGroups[sid], atomMap)\n  const emptyGroups = []\n  for (sid in sGroups) {\n    // TODO: why do we need that?\n    SGroup.filter(ctab, sGroups[sid], atomMap)\n    if (sGroups[sid].atoms.length === 0 && !sGroups[sid].allAtoms)\n      emptyGroups.push(+sid)\n  }\n  for (i = 0; i < emptyGroups.length; ++i) {\n    ctab.sGroupForest.remove(emptyGroups[i])\n    ctab.sgroups.delete(emptyGroups[i])\n  }\n  for (const id in rLogic) {\n    const rgid = parseInt(id, 10)\n    ctab.rgroups.set(rgid, new RGroup(rLogic[rgid]))\n  }\n\n  return ctab\n}\n\nfunction parseRg2000(/* string[] */ ctabLines) /* Struct */ {\n  // eslint-disable-line max-statements\n  ctabLines = ctabLines.slice(7)\n  if (ctabLines[0].trim() !== '$CTAB') throw new Error('RGFile format invalid')\n  var i = 1\n  while (ctabLines[i].charAt(0) !== '$') i++\n  if (ctabLines[i].trim() !== '$END CTAB')\n    throw new Error('RGFile format invalid')\n  var coreLines = ctabLines.slice(1, i)\n  ctabLines = ctabLines.slice(i + 1)\n  var fragmentLines = {}\n  while (true) {\n    // eslint-disable-line no-constant-condition\n    if (ctabLines.length === 0) throw new Error('Unexpected end of file')\n    var line = ctabLines[0].trim()\n    if (line === '$END MOL') {\n      ctabLines = ctabLines.slice(1)\n      break\n    }\n    if (line !== '$RGP') throw new Error('RGFile format invalid')\n\n    const rgid = parseInt(ctabLines[1].trim(), 10)\n    fragmentLines[rgid] = []\n    ctabLines = ctabLines.slice(2)\n    while (true) {\n      // eslint-disable-line no-constant-condition\n      if (ctabLines.length === 0) throw new Error('Unexpected end of file')\n      line = ctabLines[0].trim()\n      if (line === '$END RGP') {\n        ctabLines = ctabLines.slice(1)\n        break\n      }\n      if (line !== '$CTAB') throw new Error('RGFile format invalid')\n      i = 1\n      while (ctabLines[i].charAt(0) !== '$') i++\n      if (ctabLines[i].trim() !== '$END CTAB')\n        throw new Error('RGFile format invalid')\n      fragmentLines[rgid].push(ctabLines.slice(1, i))\n      ctabLines = ctabLines.slice(i + 1)\n    }\n  }\n\n  var core = parseCTab(coreLines)\n  var frag = {}\n  if (loadRGroupFragments) {\n    for (var strId in fragmentLines) {\n      const id = parseInt(strId, 10)\n      frag[id] = []\n      for (var j = 0; j < fragmentLines[id].length; ++j)\n        frag[id].push(parseCTab(fragmentLines[id][j]))\n    }\n  }\n  return rgMerge(core, frag)\n}\n\nfunction parseRxn2000(\n  /* string[] */ ctabLines,\n  shouldReactionRelayout\n) /* Struct */ {\n  // eslint-disable-line max-statements\n  /* reader */\n  ctabLines = ctabLines.slice(4)\n  var countsSplit = utils.partitionLine(\n    ctabLines[0],\n    utils.fmtInfo.rxnItemsPartition\n  )\n  var nReactants = countsSplit[0] - 0,\n    nProducts = countsSplit[1] - 0,\n    nAgents = countsSplit[2] - 0\n  ctabLines = ctabLines.slice(1) // consume counts line\n\n  var mols = []\n  while (ctabLines.length > 0 && ctabLines[0].substr(0, 4) == '$MOL') {\n    ctabLines = ctabLines.slice(1)\n    var n = 0\n    while (n < ctabLines.length && ctabLines[n].substr(0, 4) != '$MOL') n++\n\n    var lines = ctabLines.slice(0, n)\n    var struct\n    if (lines[0].search('\\\\$MDL') == 0) {\n      struct = parseRg2000(lines)\n    } else {\n      struct = parseCTab(lines.slice(3))\n      struct.name = lines[0].trim()\n    }\n    mols.push(struct)\n    ctabLines = ctabLines.slice(n)\n  }\n\n  return utils.rxnMerge(\n    mols,\n    nReactants,\n    nProducts,\n    nAgents,\n    shouldReactionRelayout\n  )\n}\n\nfunction parseCTab(/* string */ ctabLines) /* Struct */ {\n  /* reader */\n  var countsSplit = utils.partitionLine(\n    ctabLines[0],\n    utils.fmtInfo.countsLinePartition\n  )\n  ctabLines = ctabLines.slice(1)\n  return parseCTabV2000(ctabLines, countsSplit)\n}\n\nfunction rgMerge(scaffold, rgroups) /* Struct */ {\n  /* reader */\n  const ret = new Struct()\n\n  scaffold.mergeInto(ret, null, null, false, true)\n\n  Object.keys(rgroups).forEach(id => {\n    const rgid = parseInt(id, 10)\n\n    for (let j = 0; j < rgroups[rgid].length; ++j) {\n      const ctab = rgroups[rgid][j]\n      ctab.rgroups.set(rgid, new RGroup())\n      const frag = {}\n      const frid = ctab.frags.add(frag)\n      ctab.rgroups.get(rgid).frags.add(frid)\n      ctab.atoms.forEach(atom => {\n        atom.fragment = frid\n      })\n      ctab.mergeInto(ret)\n    }\n  })\n\n  return ret\n}\n\nfunction labelsListToIds(labels) {\n  /* reader */\n  var ids = []\n  for (var i = 0; i < labels.length; ++i) {\n    const element = Elements.get(labels[i].trim())\n    if (element) {\n      ids.push(element.number)\n    }\n  }\n\n  return ids\n}\n\n/**\n * @param hdr\n * @param lst\n * @returns { Pool }\n */\nfunction parsePropertyLineAtomList(hdr, lst) {\n  /* reader */\n  var aid = utils.parseDecimalInt(hdr[1]) - 1\n  var count = utils.parseDecimalInt(hdr[2])\n  var notList = hdr[4].trim() == 'T'\n  var ids = labelsListToIds(lst.slice(0, count))\n  var ret = new Pool()\n  ret.set(\n    aid,\n    new AtomList({\n      notList,\n      ids\n    })\n  )\n  return ret\n}\n\nexport default {\n  parseCTabV2000,\n  parseRg2000,\n  parseRxn2000\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport {\n  Atom,\n  AtomList,\n  Bond,\n  RGroup,\n  SGroup,\n  Struct,\n  Vec2\n} from 'domain/entities'\n\nimport { Elements } from 'domain/constants'\nimport sGroup from './parseSGroup'\nimport utils from './utils'\n\nfunction parseAtomLineV3000(line) {\n  // eslint-disable-line max-statements\n  /* reader */\n  var split, subsplit, key, value, i\n  split = spaceparsplit(line)\n  var params = {\n    pp: new Vec2(\n      parseFloat(split[2]),\n      -parseFloat(split[3]),\n      parseFloat(split[4])\n    ),\n    aam: split[5].trim()\n  }\n  var label = split[1].trim()\n  if (label.charAt(0) == '\"' && label.charAt(label.length - 1) == '\"')\n    label = label.substr(1, label.length - 2) // strip qutation marks\n  if (label.charAt(label.length - 1) == ']') {\n    // assume atom list\n    label = label.substr(0, label.length - 1) // remove ']'\n    var atomListParams = {}\n    atomListParams.notList = false\n    if (label.substr(0, 5) == 'NOT [') {\n      atomListParams.notList = true\n      label = label.substr(5) // remove 'NOT ['\n    } else if (label.charAt(0) != '[') {\n      throw new Error(\"Error: atom list expected, found '\" + label + \"'\")\n    } else {\n      label = label.substr(1) // remove '['\n    }\n    atomListParams.ids = labelsListToIds(label.split(','))\n    params['atomList'] = new AtomList(atomListParams)\n    params['label'] = 'L#'\n  } else {\n    params['label'] = label\n  }\n  split.splice(0, 6)\n  for (i = 0; i < split.length; ++i) {\n    subsplit = splitonce(split[i], '=')\n    key = subsplit[0]\n    value = subsplit[1]\n    if (key in utils.fmtInfo.v30atomPropMap) {\n      var ival = utils.parseDecimalInt(value)\n      if (key == 'VAL') {\n        if (ival == 0) continue // eslint-disable-line no-continue\n        if (ival == -1) ival = 0\n      }\n      params[utils.fmtInfo.v30atomPropMap[key]] = ival\n    } else if (key == 'RGROUPS') {\n      value = value.trim().substr(1, value.length - 2)\n      var rgrsplit = value.split(' ').slice(1)\n      params.rglabel = 0\n      for (var j = 0; j < rgrsplit.length; ++j)\n        params.rglabel |= 1 << (rgrsplit[j] - 1)\n    } else if (key == 'ATTCHPT') {\n      params.attpnt = value.trim() - 0\n    }\n  }\n\n  return new Atom(params)\n}\n\nfunction parseBondLineV3000(line) {\n  /* reader */\n  var split, subsplit, key, value, i\n  split = spaceparsplit(line)\n  var params = {\n    begin: utils.parseDecimalInt(split[2]) - 1,\n    end: utils.parseDecimalInt(split[3]) - 1,\n    type: utils.fmtInfo.bondTypeMap[utils.parseDecimalInt(split[1])]\n  }\n  split.splice(0, 4)\n  for (i = 0; i < split.length; ++i) {\n    subsplit = splitonce(split[i], '=')\n    key = subsplit[0]\n    value = subsplit[1]\n    if (key == 'CFG') {\n      params.stereo =\n        utils.fmtInfo.v30bondStereoMap[utils.parseDecimalInt(value)]\n      if (\n        params.type == Bond.PATTERN.TYPE.DOUBLE &&\n        params.stereo == Bond.PATTERN.STEREO.EITHER\n      )\n        params.stereo = Bond.PATTERN.STEREO.CIS_TRANS\n    } else if (key == 'TOPO') {\n      params.topology =\n        utils.fmtInfo.bondTopologyMap[utils.parseDecimalInt(value)]\n    } else if (key == 'RXCTR') {\n      params.reactingCenterStatus = utils.parseDecimalInt(value)\n    } else if (key == 'STBOX') {\n      params.stereoCare = utils.parseDecimalInt(value)\n    }\n  }\n  return new Bond(params)\n}\n\nfunction v3000parseCollection(ctab, ctabLines, shift) {\n  /* reader */\n  shift++\n  while (ctabLines[shift].trim() != 'M  V30 END COLLECTION') shift++\n  shift++\n  return shift\n}\n\nfunction v3000parseSGroup(ctab, ctabLines, sgroups, atomMap, shift) {\n  // eslint-disable-line max-params, max-statements\n  /* reader */\n  var line = ''\n  shift++\n  while (shift < ctabLines.length) {\n    line = stripV30(ctabLines[shift++]).trim()\n    if (line.trim() == 'END SGROUP') return shift\n    while (line.charAt(line.length - 1) == '-')\n      line = (\n        line.substr(0, line.length - 1) + stripV30(ctabLines[shift++])\n      ).trim()\n    var split = splitSGroupDef(line)\n    var type = split[1]\n    var sg = new SGroup(type)\n    sg.number = split[0] - 0\n    sg.type = type\n    sg.label = split[2] - 0\n    sgroups[sg.number] = sg\n    var props = {}\n    for (var i = 3; i < split.length; ++i) {\n      var subsplit = splitonce(split[i], '=')\n      if (subsplit.length != 2)\n        throw new Error(\n          \"A record of form AAA=BBB or AAA=(...) expected, got '\" +\n            split[i] +\n            \"'\"\n        )\n      var name = subsplit[0]\n      if (!(name in props)) props[name] = []\n      props[name].push(subsplit[1])\n    }\n    sg.atoms = parseBracedNumberList(props['ATOMS'][0], -1)\n    if (props['PATOMS'])\n      sg.patoms = parseBracedNumberList(props['PATOMS'][0], -1)\n    sg.bonds = props['BONDS']\n      ? parseBracedNumberList(props['BONDS'][0], -1)\n      : []\n    var brkxyzStrs = props['BRKXYZ']\n    sg.brkxyz = []\n    if (brkxyzStrs) {\n      for (var j = 0; j < brkxyzStrs.length; ++j)\n        sg.brkxyz.push(parseBracedNumberList(brkxyzStrs[j]))\n    }\n    if (props['MULT']) sg.data.subscript = props['MULT'][0] - 0\n    if (props['LABEL']) sg.data.subscript = props['LABEL'][0].trim()\n    if (props['CONNECT'])\n      sg.data.connectivity = props['CONNECT'][0].toLowerCase()\n    if (props['FIELDDISP'])\n      sGroup.applyDataSGroupInfo(sg, stripQuotes(props['FIELDDISP'][0]))\n    if (props['FIELDDATA'])\n      sGroup.applyDataSGroupData(sg, props['FIELDDATA'][0], true)\n    if (props['FIELDNAME'])\n      sGroup.applyDataSGroupName(sg, props['FIELDNAME'][0])\n    if (props['QUERYTYPE'])\n      sGroup.applyDataSGroupQuery(sg, props['QUERYTYPE'][0])\n    if (props['QUERYOP']) sGroup.applyDataSGroupQueryOp(sg, props['QUERYOP'][0])\n    sGroup.loadSGroup(ctab, sg, atomMap)\n  }\n  throw new Error('S-group declaration incomplete.')\n}\n\nfunction parseCTabV3000(ctabLines, norgroups) {\n  // eslint-disable-line max-statements\n  /* reader */\n  var ctab = new Struct()\n\n  var shift = 0\n  if (ctabLines[shift++].trim() != 'M  V30 BEGIN CTAB')\n    throw Error('CTAB V3000 invalid')\n  if (ctabLines[shift].slice(0, 13) != 'M  V30 COUNTS')\n    throw Error('CTAB V3000 invalid')\n  var vals = ctabLines[shift].slice(14).split(' ')\n  const isAbs = utils.parseDecimalInt(vals[4]) === 1\n  shift++\n\n  if (ctabLines[shift].trim() == 'M  V30 BEGIN ATOM') {\n    shift++\n    var line\n    while (shift < ctabLines.length) {\n      line = stripV30(ctabLines[shift++]).trim()\n      if (line == 'END ATOM') break\n      while (line.charAt(line.length - 1) == '-')\n        line = (\n          line.substring(0, line.length - 1) + stripV30(ctabLines[shift++])\n        ).trim()\n      ctab.atoms.add(parseAtomLineV3000(line))\n    }\n\n    if (ctabLines[shift].trim() == 'M  V30 BEGIN BOND') {\n      shift++\n      while (shift < ctabLines.length) {\n        line = stripV30(ctabLines[shift++]).trim()\n        if (line == 'END BOND') break\n        while (line.charAt(line.length - 1) == '-')\n          line = (\n            line.substring(0, line.length - 1) + stripV30(ctabLines[shift++])\n          ).trim()\n        const bond = parseBondLineV3000(line)\n        if (bond.stereo && isAbs) ctab.atoms.get(bond.begin).stereoLabel = 'abs'\n        ctab.bonds.add(bond)\n      }\n    }\n\n    // TODO: let sections follow in arbitrary order\n    var sgroups = {}\n    var atomMap = {}\n\n    while (ctabLines[shift].trim() != 'M  V30 END CTAB') {\n      if (ctabLines[shift].trim() == 'M  V30 BEGIN COLLECTION')\n        // TODO: read collection information\n        shift = v3000parseCollection(ctab, ctabLines, shift)\n      else if (ctabLines[shift].trim() == 'M  V30 BEGIN SGROUP')\n        shift = v3000parseSGroup(ctab, ctabLines, sgroups, atomMap, shift)\n      else throw Error('CTAB V3000 invalid')\n    }\n  }\n  if (ctabLines[shift++].trim() != 'M  V30 END CTAB')\n    throw Error('CTAB V3000 invalid')\n\n  if (!norgroups) readRGroups3000(ctab, ctabLines.slice(shift))\n\n  return ctab\n}\n\nfunction readRGroups3000(ctab, /* string */ ctabLines) /* Struct */ {\n  // eslint-disable-line max-statements\n  /* reader */\n  var rfrags = {}\n  var rLogic = {}\n  var shift = 0\n  while (\n    shift < ctabLines.length &&\n    ctabLines[shift].search('M  V30 BEGIN RGROUP') == 0\n  ) {\n    var id = ctabLines[shift++].split(' ').pop()\n    rfrags[id] = []\n    rLogic[id] = {}\n    while (true) {\n      // eslint-disable-line no-constant-condition\n      var line = ctabLines[shift].trim()\n      if (line.search('M  V30 RLOGIC') == 0) {\n        line = line.slice(13)\n        var rlsplit = line.trim().split(/\\s+/g)\n        var iii = utils.parseDecimalInt(rlsplit[0])\n        var hhh = utils.parseDecimalInt(rlsplit[1])\n        var ooo = rlsplit.slice(2).join(' ')\n        var logic = {}\n        if (iii > 0) logic.ifthen = iii\n        logic.resth = hhh == 1\n        logic.range = ooo\n        rLogic[id] = logic\n        shift++\n        continue // eslint-disable-line no-continue\n      }\n      if (line != 'M  V30 BEGIN CTAB') throw Error('CTAB V3000 invalid')\n      for (var i = 0; i < ctabLines.length; ++i) {\n        if (ctabLines[shift + i].trim() == 'M  V30 END CTAB') break\n      }\n      var lines = ctabLines.slice(shift, shift + i + 1)\n      var rfrag = parseCTabV3000(lines, true)\n      rfrags[id].push(rfrag)\n      shift = shift + i + 1\n      if (ctabLines[shift].trim() == 'M  V30 END RGROUP') {\n        shift++\n        break\n      }\n    }\n  }\n\n  Object.keys(rfrags).forEach(rgid => {\n    rfrags[rgid].forEach(rg => {\n      rg.rgroups.set(rgid, new RGroup(rLogic[rgid]))\n      const frid = rg.frags.add({})\n      rg.rgroups.get(rgid).frags.add(frid)\n      rg.atoms.forEach(atom => {\n        atom.fragment = frid\n      })\n      rg.mergeInto(ctab)\n    })\n  })\n}\n\nfunction parseRxn3000(\n  /* string[] */ ctabLines,\n  shouldReactionRelayout\n) /* Struct */ {\n  // eslint-disable-line max-statements\n  /* reader */\n  ctabLines = ctabLines.slice(4)\n  var countsSplit = ctabLines[0].split(/\\s+/g).slice(3)\n  var nReactants = countsSplit[0] - 0,\n    nProducts = countsSplit[1] - 0,\n    nAgents = countsSplit.length > 2 ? countsSplit[2] - 0 : 0\n\n  function findCtabEnd(i) {\n    for (var j = i; j < ctabLines.length; ++j) {\n      if (ctabLines[j].trim() == 'M  V30 END CTAB') return j\n    }\n\n    return console.error('CTab format invalid')\n  }\n\n  function findRGroupEnd(i) {\n    for (var j = i; j < ctabLines.length; ++j) {\n      if (ctabLines[j].trim() == 'M  V30 END RGROUP') return j\n    }\n    return console.error('CTab format invalid')\n  }\n\n  var molLinesReactants = []\n  var molLinesProducts = []\n  var current = null\n  var rGroups = []\n  for (var i = 0; i < ctabLines.length; ++i) {\n    var line = ctabLines[i].trim()\n    var j\n\n    if (line.startsWith('M  V30 COUNTS')) {\n      // do nothing\n    } else if (line == 'M  END') {\n      break // stop reading\n    } else if (line == 'M  V30 BEGIN PRODUCT') {\n      console.assert(current == null, 'CTab format invalid')\n      current = molLinesProducts\n    } else if (line == 'M  V30 END PRODUCT') {\n      console.assert(current === molLinesProducts, 'CTab format invalid')\n      current = null\n    } else if (line == 'M  V30 BEGIN REACTANT') {\n      console.assert(current == null, 'CTab format invalid')\n      current = molLinesReactants\n    } else if (line == 'M  V30 END REACTANT') {\n      console.assert(current === molLinesReactants, 'CTab format invalid')\n      current = null\n    } else if (line.startsWith('M  V30 BEGIN RGROUP')) {\n      console.assert(current == null, 'CTab format invalid')\n      j = findRGroupEnd(i)\n      rGroups.push(ctabLines.slice(i, j + 1))\n      i = j\n    } else if (line == 'M  V30 BEGIN CTAB') {\n      j = findCtabEnd(i)\n      current.push(ctabLines.slice(i, j + 1))\n      i = j\n    } else {\n      throw new Error('line unrecognized: ' + line)\n    }\n  }\n  var mols = []\n  var molLines = molLinesReactants.concat(molLinesProducts)\n  for (j = 0; j < molLines.length; ++j) {\n    var mol = parseCTabV3000(molLines[j], countsSplit)\n    mols.push(mol)\n  }\n  var ctab = utils.rxnMerge(\n    mols,\n    nReactants,\n    nProducts,\n    nAgents,\n    shouldReactionRelayout\n  )\n\n  readRGroups3000(\n    ctab,\n    (function (array) {\n      var res = []\n      for (var k = 0; k < array.length; ++k) res = res.concat(array[k])\n      return res\n    })(rGroups)\n  )\n\n  return ctab\n}\n\n// split a line by spaces outside parentheses\nfunction spaceparsplit(line) {\n  // eslint-disable-line max-statements\n  /* reader */\n  var split = []\n  var pc = 0\n  var c\n  var i\n  var i0 = -1\n  var quoted = false\n\n  for (i = 0; i < line.length; ++i) {\n    c = line[i]\n    if (c == '(') pc++\n    else if (c == ')') pc--\n    if (c == '\"') quoted = !quoted\n    if (!quoted && line[i] == ' ' && pc == 0) {\n      if (i > i0 + 1) split.push(line.slice(i0 + 1, i))\n      i0 = i\n    }\n  }\n  if (i > i0 + 1) split.push(line.slice(i0 + 1, i))\n  return split\n}\n\n// utils\nfunction stripQuotes(str) {\n  if (str[0] === '\"' && str[str.length - 1] === '\"')\n    return str.substr(1, str.length - 2)\n  return str\n}\n\nfunction splitonce(line, delim) {\n  /* reader */\n  var p = line.indexOf(delim)\n  return [line.slice(0, p), line.slice(p + 1)]\n}\n\nfunction splitSGroupDef(line) {\n  // eslint-disable-line max-statements\n  /* reader */\n  var split = []\n  var braceBalance = 0\n  var quoted = false\n  for (var i = 0; i < line.length; ++i) {\n    var c = line.charAt(i)\n    if (c == '\"') {\n      quoted = !quoted\n    } else if (!quoted) {\n      if (c == '(') {\n        braceBalance++\n      } else if (c == ')') {\n        braceBalance--\n      } else if (c == ' ' && braceBalance == 0) {\n        split.push(line.slice(0, i))\n        line = line.slice(i + 1).trim()\n        i = 0\n      }\n    }\n  }\n  if (braceBalance != 0)\n    throw new Error('Brace balance broken. S-group properies invalid!')\n  if (line.length > 0) split.push(line.trim())\n  return split\n}\n\nfunction parseBracedNumberList(line, shift) {\n  /* reader */\n  if (!line) return null\n  var list = []\n  line = line.trim()\n  line = line.substr(1, line.length - 2)\n  var split = line.split(' ')\n  shift = shift || 0\n\n  for (var i = 1; i < split.length; ++i) {\n    var value = parseInt(split[i])\n    if (!isNaN(value))\n      // eslint-disable-line\n      list.push(value + shift)\n  }\n\n  return list\n}\n\nfunction stripV30(line) {\n  /* reader */\n  if (line.slice(0, 7) != 'M  V30 ') throw new Error('Prefix invalid')\n  return line.slice(7)\n}\n\nfunction labelsListToIds(labels) {\n  /* reader */\n  var ids = []\n  for (var i = 0; i < labels.length; ++i) {\n    const element = Elements.get(labels[i].trim())\n    if (element) {\n      ids.push(element.number)\n    }\n  }\n\n  return ids\n}\n\nexport default {\n  parseCTabV3000,\n  readRGroups3000,\n  parseRxn3000\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Pile, SGroup } from 'domain/entities'\n\nimport utils from './utils'\nimport v2000 from './v2000'\nimport v3000 from './v3000'\n\nconst loadRGroupFragments = true // TODO: set to load the fragments\n\n/* Parse Mol */\nfunction parseMol(/* string */ ctabLines) /* Struct */ {\n  /* reader */\n  if (ctabLines[0].search('\\\\$MDL') === 0) {\n    const struct = v2000.parseRg2000(ctabLines)\n    struct.name = ctabLines[3].trim()\n    return struct\n  }\n  const struct = parseCTab(ctabLines.slice(3))\n  struct.name = ctabLines[0].trim()\n  return struct\n}\n\nfunction parseCTab(/* string */ ctabLines) /* Struct */ {\n  /* reader */\n  const countsSplit = partitionLine(\n    ctabLines[0],\n    utils.fmtInfo.countsLinePartition\n  )\n  const version = countsSplit[11].trim()\n  ctabLines = ctabLines.slice(1)\n  if (version === 'V2000') return v2000.parseCTabV2000(ctabLines, countsSplit)\n  else if (version === 'V3000')\n    return v3000.parseCTabV3000(ctabLines, !loadRGroupFragments)\n  else throw new Error('Molfile version unknown: ' + version) // eslint-disable-line no-else-return\n}\n\n/* Parse Rxn */\nfunction parseRxn(\n  /* string[] */ ctabLines,\n  shouldReactionRelayout\n) /* Struct */ {\n  /* reader */\n  const split = ctabLines[0].trim().split(' ')\n  if (split.length > 1 && split[1] === 'V3000')\n    return v3000.parseRxn3000(ctabLines, shouldReactionRelayout)\n\n  const struct = v2000.parseRxn2000(ctabLines, shouldReactionRelayout)\n  struct.name = ctabLines[1].trim()\n  return struct\n}\n\n/* Prepare For Saving */\nconst prepareForSaving = {\n  MUL: SGroup.prepareMulForSaving,\n  SRU: prepareSruForSaving,\n  SUP: prepareSupForSaving,\n  DAT: prepareDatForSaving,\n  GEN: prepareGenForSaving\n}\n\nfunction prepareSruForSaving(sgroup, mol) {\n  const xBonds = []\n  mol.bonds.forEach((bond, bid) => {\n    const a1 = mol.atoms.get(bond.begin)\n    const a2 = mol.atoms.get(bond.end)\n    /* eslint-disable no-mixed-operators*/\n    if (\n      (a1.sgs.has(sgroup.id) && !a2.sgs.has(sgroup.id)) ||\n      (a2.sgs.has(sgroup.id) && !a1.sgs.has(sgroup.id))\n    )\n      /* eslint-enable no-mixed-operators*/\n      xBonds.push(bid)\n  }, sgroup)\n  if (xBonds.length !== 0 && xBonds.length !== 2) {\n    throw {\n      // eslint-disable-line no-throw-literal\n      id: sgroup.id,\n      'error-type': 'cross-bond-number',\n      message: 'Unsupported cross-bonds number'\n    }\n  }\n  sgroup.bonds = xBonds\n}\n\nfunction prepareSupForSaving(sgroup, mol) {\n  // This code is also used for GroupSru and should be moved into a separate common method\n  // It seems that such code should be used for any sgroup by this this should be checked\n  const xBonds = []\n  mol.bonds.forEach((bond, bid) => {\n    const a1 = mol.atoms.get(bond.begin)\n    const a2 = mol.atoms.get(bond.end)\n    /* eslint-disable no-mixed-operators*/\n    if (\n      (a1.sgs.has(sgroup.id) && !a2.sgs.has(sgroup.id)) ||\n      (a2.sgs.has(sgroup.id) && !a1.sgs.has(sgroup.id))\n    )\n      /* eslint-enable no-mixed-operators*/\n      xBonds.push(bid)\n  }, sgroup)\n  sgroup.bonds = xBonds\n}\n\nfunction prepareGenForSaving(sgroup, mol) {\n  // eslint-disable-line no-unused-vars\n}\n\nfunction prepareDatForSaving(sgroup, mol) {\n  sgroup.atoms = SGroup.getAtoms(mol, sgroup)\n}\n\n/* Save To Molfile */\nconst saveToMolfile = {\n  MUL: saveMulToMolfile,\n  SRU: saveSruToMolfile,\n  SUP: saveSupToMolfile,\n  DAT: saveDatToMolfile,\n  GEN: saveGenToMolfile\n}\n\nfunction saveMulToMolfile(sgroup, mol, sgMap, atomMap, bondMap) {\n  // eslint-disable-line max-params\n  const idstr = (sgMap[sgroup.id] + '').padStart(3)\n\n  let lines = []\n  lines = lines.concat(\n    makeAtomBondLines(\n      'SAL',\n      idstr,\n      Array.from(sgroup.atomSet.values()),\n      atomMap\n    )\n  ) // TODO: check atomSet\n  lines = lines.concat(\n    makeAtomBondLines(\n      'SPA',\n      idstr,\n      Array.from(sgroup.parentAtomSet.values()),\n      atomMap\n    )\n  )\n  lines = lines.concat(makeAtomBondLines('SBL', idstr, sgroup.bonds, bondMap))\n  const smtLine = 'M  SMT ' + idstr + ' ' + sgroup.data.mul\n  lines.push(smtLine)\n  lines = lines.concat(bracketsToMolfile(mol, sgroup, idstr))\n  return lines.join('\\n')\n}\n\nfunction saveSruToMolfile(sgroup, mol, sgMap, atomMap, bondMap) {\n  // eslint-disable-line max-params\n  const idstr = (sgMap[sgroup.id] + '').padStart(3)\n\n  let lines = []\n  lines = lines.concat(makeAtomBondLines('SAL', idstr, sgroup.atoms, atomMap))\n  lines = lines.concat(makeAtomBondLines('SBL', idstr, sgroup.bonds, bondMap))\n  lines = lines.concat(bracketsToMolfile(mol, sgroup, idstr))\n  return lines.join('\\n')\n}\n\nfunction saveSupToMolfile(sgroup, mol, sgMap, atomMap, bondMap) {\n  // eslint-disable-line max-params\n  const idstr = (sgMap[sgroup.id] + '').padStart(3)\n\n  let lines = []\n  lines = lines.concat(makeAtomBondLines('SAL', idstr, sgroup.atoms, atomMap))\n  lines = lines.concat(makeAtomBondLines('SBL', idstr, sgroup.bonds, bondMap))\n  if (sgroup.data.name && sgroup.data.name !== '')\n    lines.push('M  SMT ' + idstr + ' ' + sgroup.data.name)\n  return lines.join('\\n')\n}\n\nfunction saveDatToMolfile(sgroup, mol, sgMap, atomMap) {\n  const idstr = (sgMap[sgroup.id] + '').padStart(3)\n\n  const data = sgroup.data\n  let pp = sgroup.pp\n  if (!data.absolute) pp = pp.sub(SGroup.getMassCentre(mol, sgroup.atoms))\n  let lines = []\n  lines = lines.concat(makeAtomBondLines('SAL', idstr, sgroup.atoms, atomMap))\n  let sdtLine =\n    'M  SDT ' +\n    idstr +\n    ' ' +\n    (data.fieldName || '').padEnd(30) +\n    (data.fieldType || '').padStart(2) +\n    (data.units || '').padEnd(20) +\n    (data.query || '').padStart(2)\n\n  if (data.queryOp)\n    // see gitlab #184\n    sdtLine += data.queryOp.padEnd(80 - 65)\n\n  lines.push(sdtLine)\n  const sddLine =\n    'M  SDD ' +\n    idstr +\n    ' ' +\n    utils.paddedNum(pp.x, 10, 4) +\n    utils.paddedNum(-pp.y, 10, 4) +\n    '    ' + // ' eee'\n    (data.attached ? 'A' : 'D') + // f\n    (data.absolute ? 'A' : 'R') + // g\n    (data.showUnits ? 'U' : ' ') + // h\n    '   ' + //  i\n    (data.nCharnCharsToDisplay >= 0\n      ? utils.paddedNum(data.nCharnCharsToDisplay, 3)\n      : 'ALL') + // jjj\n    '  1   ' + // 'kkk ll '\n    (data.tagChar || ' ') + // m\n    '  ' +\n    utils.paddedNum(data.daspPos, 1) + // n\n    '  ' // oo\n  lines.push(sddLine)\n  const val = normalizeNewlines(data.fieldValue).replace(/\\n*$/, '')\n  const charsPerLine = 69\n  val.split('\\n').forEach(chars => {\n    while (chars.length > charsPerLine) {\n      lines.push('M  SCD ' + idstr + ' ' + chars.slice(0, charsPerLine))\n      chars = chars.slice(charsPerLine)\n    }\n    lines.push('M  SED ' + idstr + ' ' + chars)\n  })\n  return lines.join('\\n')\n}\n\nfunction saveGenToMolfile(sgroup, mol, sgMap, atomMap, bondMap) {\n  // eslint-disable-line max-params\n  const idstr = (sgMap[sgroup.id] + '').padStart(3)\n\n  let lines = []\n  lines = lines.concat(makeAtomBondLines('SAL', idstr, sgroup.atoms, atomMap))\n  lines = lines.concat(makeAtomBondLines('SBL', idstr, sgroup.bonds, bondMap))\n  lines = lines.concat(bracketsToMolfile(mol, sgroup, idstr))\n  return lines.join('\\n')\n}\n\nfunction makeAtomBondLines(prefix, idstr, ids, map) {\n  if (!ids) return []\n  const lines = []\n  for (let i = 0; i < Math.floor((ids.length + 14) / 15); ++i) {\n    const rem = Math.min(ids.length - 15 * i, 15) // eslint-disable-line no-mixed-operators\n    let salLine = 'M  ' + prefix + ' ' + idstr + ' ' + utils.paddedNum(rem, 2)\n    for (let j = 0; j < rem; ++j)\n      salLine += ' ' + utils.paddedNum(map[ids[i * 15 + j]], 3) // eslint-disable-line no-mixed-operators\n    lines.push(salLine)\n  }\n  return lines\n}\n\nfunction bracketsToMolfile(mol, sg, idstr) {\n  // eslint-disable-line max-statements\n  const atomSet = new Pile(sg.atoms)\n  const crossBonds = SGroup.getCrossBonds(mol, atomSet)\n  SGroup.bracketPos(sg, mol, crossBonds)\n  const bb = sg.bracketBox\n  const d = sg.bracketDir\n  const n = d.rotateSC(1, 0)\n  const brackets = SGroup.getBracketParameters(\n    mol,\n    crossBonds,\n    atomSet,\n    bb,\n    d,\n    n\n  )\n  const lines = []\n  for (let i = 0; i < brackets.length; ++i) {\n    const bracket = brackets[i]\n    const a0 = bracket.c.addScaled(bracket.n, -0.5 * bracket.h).yComplement()\n    const a1 = bracket.c.addScaled(bracket.n, 0.5 * bracket.h).yComplement()\n    let line = 'M  SDI ' + idstr + utils.paddedNum(4, 3)\n    const coord = [a0.x, a0.y, a1.x, a1.y]\n    for (let j = 0; j < coord.length; ++j)\n      line += utils.paddedNum(coord[j], 10, 4)\n    lines.push(line)\n  }\n  return lines\n}\n\n// According Unicode Consortium sould be\n// nlRe = /\\r\\n|[\\n\\v\\f\\r\\x85\\u2028\\u2029]/g;\n// http://www.unicode.org/reports/tr18/#Line_Boundaries\nconst nlRe = /\\r\\n|[\\n\\r]/g\nfunction normalizeNewlines(str) {\n  return str.replace(nlRe, '\\n')\n}\n\nfunction partitionLine(\n  /* string*/ str,\n  /* array of int*/ parts,\n  /* bool*/ withspace\n) {\n  /* reader */\n  const res = []\n  for (let i = 0, shift = 0; i < parts.length; ++i) {\n    res.push(str.slice(shift, shift + parts[i]))\n    if (withspace) shift++\n    shift += parts[i]\n  }\n  return res\n}\n\nexport default {\n  parseCTab,\n  parseMol,\n  parseRxn,\n  prepareForSaving,\n  saveToMolfile\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { StereoFlag, Struct } from 'domain/entities'\n\nimport { Elements } from 'domain/constants'\nimport common from './common'\nimport utils from './utils'\n\nconst END_V2000 = '2D 1   1.00000     0.00000     0'\n\ntype Mapping = {\n  [key in number]: number\n}\ntype NumberTuple = [number, number]\n\nexport class Molfile {\n  molecule: Struct\n  molfile: string | null\n  reaction: boolean\n  mapping: Mapping\n  bondMapping: Mapping\n\n  constructor() {\n    // @ts-ignore\n    this.molecule = null\n    this.molfile = null\n\n    this.reaction = false\n    this.mapping = {}\n    this.bondMapping = {}\n  }\n\n  parseCTFile(molfileLines: string[], shouldReactionRelayout?: boolean) {\n    let ret\n    if (molfileLines[0].search('\\\\$RXN') === 0) {\n      ret = common.parseRxn(molfileLines, shouldReactionRelayout)\n    } else {\n      ret = common.parseMol(molfileLines)\n    }\n    ret.initHalfBonds()\n    ret.initNeighbors()\n\n    return ret\n  }\n\n  prepareSGroups(skipErrors: boolean, preserveIndigoDesc?: boolean) {\n    let mol = this.molecule\n    let toRemove: any[] = []\n    let errors = 0\n\n    this.molecule.sGroupForest\n      .getSGroupsBFS()\n      .reverse()\n      .forEach(id => {\n        let sgroup = mol.sgroups.get(id)!\n        let errorIgnore = false\n\n        try {\n          common.prepareForSaving[sgroup.type](sgroup, mol)\n        } catch (ex) {\n          if (!skipErrors || typeof ex.id != 'number') {\n            throw new Error(`Error: ${ex.message}`)\n          }\n          errorIgnore = true\n        }\n        /* eslint-disable no-mixed-operators*/\n        if (\n          errorIgnore ||\n          (!preserveIndigoDesc &&\n            /^INDIGO_.+_DESC$/i.test(sgroup.data.fieldName))\n        ) {\n          /* eslint-enable no-mixed-operators*/\n          // @ts-ignore\n          errors += errorIgnore\n          toRemove.push(sgroup.id)\n        }\n      }, this)\n\n    if (errors) {\n      throw new Error(\n        'Warning: ' +\n          errors +\n          ' invalid S-groups were detected. They will be omitted.'\n      )\n    }\n\n    for (let i = 0; i < toRemove.length; ++i) {\n      mol.sGroupDelete(toRemove[i])\n    }\n  }\n\n  getCTab(molecule: Struct, rgroups?: Map<any, any>) {\n    /* saver */\n    this.molecule = molecule.clone()\n    this.prepareSGroups(false, false)\n    this.molfile = ''\n    this.writeCTab2000(rgroups)\n    return this.molfile\n  }\n\n  saveMolecule(\n    molecule: Struct,\n    skipSGroupErrors: boolean,\n    norgroups?: boolean,\n    preserveIndigoDesc?: boolean\n  ) {\n    // eslint-disable-line max-statements\n    /* saver */\n    this.reaction = molecule.hasRxnArrow()\n    this.molfile = '' + molecule.name\n    if (this.reaction) {\n      if (molecule.rgroups.size > 0) {\n        throw new Error(\n          'Reactions with r-groups are not supported at the moment'\n        )\n      }\n      let components = molecule.getComponents()\n\n      let reactants = components.reactants\n      let products = components.products\n      let all = reactants.concat(products)\n      this.molfile =\n        '$RXN\\n' +\n        molecule.name +\n        '\\n\\n\\n' +\n        utils.paddedNum(reactants.length, 3) +\n        utils.paddedNum(products.length, 3) +\n        utils.paddedNum(0, 3) +\n        '\\n'\n      for (let i = 0; i < all.length; ++i) {\n        const saver = new Molfile()\n        const submol = molecule.clone(all[i], null, true)\n        const molfile = saver.saveMolecule(submol, false, true)\n        this.molfile += '$MOL\\n' + molfile\n      }\n      return this.molfile\n    }\n\n    if (molecule.rgroups.size > 0) {\n      if (norgroups) {\n        molecule = molecule.getScaffold()\n      } else {\n        let scaffold = new Molfile().getCTab(\n          molecule.getScaffold(),\n          molecule.rgroups\n        )\n        this.molfile =\n          '$MDL  REV  1\\n$MOL\\n$HDR\\n' + molecule.name + '\\n\\n\\n$END HDR\\n'\n        this.molfile += '$CTAB\\n' + scaffold + '$END CTAB\\n'\n\n        molecule.rgroups.forEach((rg, rgid) => {\n          this.molfile += '$RGP\\n'\n          this.writePaddedNumber(rgid, 3)\n          this.molfile += '\\n'\n          rg.frags.forEach(fid => {\n            const group = new Molfile().getCTab(molecule.getFragment(fid))\n            this.molfile += '$CTAB\\n' + group + '$END CTAB\\n'\n          })\n          this.molfile += '$END RGP\\n'\n        })\n        this.molfile += '$END MOL\\n'\n\n        return this.molfile\n      }\n    }\n\n    this.molecule = molecule.clone()\n\n    this.prepareSGroups(skipSGroupErrors, preserveIndigoDesc)\n\n    this.writeHeader()\n    this.writeCTab2000()\n\n    return this.molfile\n  }\n\n  writeHeader() {\n    /* saver */\n\n    let date = new Date()\n\n    this.writeCR() // TODO: write structure name\n    this.writeWhiteSpace(2)\n    this.write('Ketcher')\n    this.writeWhiteSpace()\n    this.writeCR(\n      (date.getMonth() + 1 + '').padStart(2) +\n        (date.getDate() + '').padStart(2) +\n        ((date.getFullYear() % 100) + '').padStart(2) +\n        (date.getHours() + '').padStart(2) +\n        (date.getMinutes() + '').padStart(2) +\n        END_V2000\n    )\n    this.writeCR()\n  }\n\n  write(str: string) {\n    /* saver */\n    this.molfile += str\n  }\n\n  writeCR(str?: string) {\n    /* saver */\n    if (arguments.length === 0) {\n      str = ''\n    }\n\n    this.molfile += str + '\\n'\n  }\n\n  writeWhiteSpace(length: number = 0) {\n    /* saver */\n    if (arguments.length === 0) {\n      length = 1\n    }\n\n    this.write(' '.repeat(Math.max(length, 0)))\n  }\n\n  writePadded(str: string, width: number) {\n    /* saver */\n    this.write(str)\n    this.writeWhiteSpace(width - str.length)\n  }\n\n  writePaddedNumber(number: number, width: number) {\n    /* saver */\n    let str = (number - 0).toString()\n\n    this.writeWhiteSpace(width - str.length)\n    this.write(str)\n  }\n\n  writePaddedFloat(number: string | number, width: number, precision: number) {\n    /* saver */\n    this.write(utils.paddedNum(number, width, precision))\n  }\n\n  writeCTab2000Header() {\n    /* saver */\n    this.writePaddedNumber(this.molecule.atoms.size, 3)\n    this.writePaddedNumber(this.molecule.bonds.size, 3)\n\n    this.writePaddedNumber(0, 3)\n    this.writePaddedNumber(0, 3)\n    const isAbsFlag = Array.from(this.molecule.frags.values()).some(fr =>\n      fr ? fr.enhancedStereoFlag === StereoFlag.Abs : false\n    )\n    this.writePaddedNumber(isAbsFlag ? 1 : 0, 3)\n    this.writePaddedNumber(0, 3)\n    this.writeWhiteSpace(12)\n    this.writePaddedNumber(999, 3)\n    this.writeCR(' V2000')\n  }\n\n  writeCTab2000(rgroups?: Map<any, any>) {\n    // eslint-disable-line max-statements\n    /* saver */\n    this.writeCTab2000Header()\n\n    this.mapping = {}\n    let i = 1\n\n    const atomsIds: number[] = []\n    const atomsProps: {\n      id: number\n      value: string\n    }[] = []\n    this.molecule.atoms.forEach((atom, id) => {\n      let label = atom.label\n      if (atom.atomList != null) {\n        label = 'L'\n        atomsIds.push(id)\n      } else if (atom['pseudo']) {\n        if (atom['pseudo'].length > 3) {\n          label = 'A'\n          atomsProps.push({ id, value: `'${atom['pseudo']}'` })\n        }\n      } else if (atom['alias']) {\n        atomsProps.push({ id, value: atom['alias'] })\n      } else if (\n        !Elements.get(atom.label) &&\n        ['A', 'Q', 'X', '*', 'R#'].indexOf(atom.label) === -1\n      ) {\n        // search in generics?\n        label = 'C'\n        atomsProps.push({ id, value: atom.label })\n      }\n\n      this.writeAtom(atom, label)\n\n      this.mapping[id] = i++\n    }, this)\n\n    this.bondMapping = {}\n    i = 1\n    this.molecule.bonds.forEach((bond, id) => {\n      this.bondMapping[id] = i++\n      this.writeBond(bond)\n    }, this)\n\n    while (atomsProps.length > 0) {\n      this.writeAtomProps(atomsProps[0])\n      atomsProps.splice(0, 1)\n    }\n\n    const chargeList: NumberTuple[] = []\n    const isotopeList: NumberTuple[] = []\n    const radicalList: NumberTuple[] = []\n    const rglabelList: NumberTuple[] = []\n    const rglogicList: string[] = []\n    const aplabelList: NumberTuple[] = []\n    const rbcountList: NumberTuple[] = []\n    const unsaturatedList: NumberTuple[] = []\n    const substcountList: NumberTuple[] = []\n\n    this.molecule.atoms.forEach((atom, id) => {\n      if (atom.charge !== 0) {\n        chargeList.push([id, atom.charge])\n      }\n      if (atom.isotope !== 0) {\n        isotopeList.push([id, atom.isotope])\n      }\n      if (atom.radical !== 0) {\n        radicalList.push([id, atom.radical])\n      }\n      if (atom.rglabel != null && atom.label === 'R#') {\n        // TODO need to force rglabel=null when label is not 'R#'\n        for (let rgi = 0; rgi < 32; rgi++) {\n          if ((atom.rglabel as any) & (1 << rgi)) {\n            rglabelList.push([id, rgi + 1])\n          }\n        }\n      }\n      if (atom.attpnt != null) {\n        aplabelList.push([id, atom.attpnt])\n      }\n      if (atom.ringBondCount !== 0) {\n        rbcountList.push([id, atom.ringBondCount])\n      }\n      if (atom.substitutionCount !== 0) {\n        substcountList.push([id, atom.substitutionCount])\n      }\n      if (atom.unsaturatedAtom !== 0) {\n        unsaturatedList.push([id, atom.unsaturatedAtom])\n      }\n    })\n\n    if (rgroups) {\n      rgroups.forEach((rg, rgid) => {\n        if (rg.resth || rg.ifthen > 0 || rg.range.length > 0) {\n          let line =\n            '  1 ' +\n            utils.paddedNum(rgid, 3) +\n            ' ' +\n            utils.paddedNum(rg.ifthen, 3) +\n            ' ' +\n            utils.paddedNum(rg.resth ? 1 : 0, 3) +\n            '   ' +\n            rg.range\n          rglogicList.push(line)\n        }\n      })\n    }\n\n    this.writeAtomPropList('M  CHG', chargeList)\n    this.writeAtomPropList('M  ISO', isotopeList)\n    this.writeAtomPropList('M  RAD', radicalList)\n    this.writeAtomPropList('M  RGP', rglabelList)\n    for (let j = 0; j < rglogicList.length; ++j) {\n      this.write('M  LOG' + rglogicList[j] + '\\n')\n    }\n\n    this.writeAtomPropList('M  APO', aplabelList)\n    this.writeAtomPropList('M  RBC', rbcountList)\n    this.writeAtomPropList('M  SUB', substcountList)\n    this.writeAtomPropList('M  UNS', unsaturatedList)\n\n    if (atomsIds.length > 0) {\n      for (let j = 0; j < atomsIds.length; ++j) {\n        let atomId = atomsIds[j]\n        let atomList = this.molecule.atoms.get(atomId)!.atomList!\n        this.write('M  ALS')\n        this.writePaddedNumber(atomId + 1, 4)\n        this.writePaddedNumber(atomList.ids.length, 3)\n        this.writeWhiteSpace()\n        this.write(atomList.notList ? 'T' : 'F')\n\n        let labelList = atomList.labelList()\n        for (let k = 0; k < labelList.length; ++k) {\n          this.writeWhiteSpace()\n          this.writePadded(labelList[k], 3)\n        }\n        this.writeCR()\n      }\n    }\n\n    const sgmap = {}\n    let cnt = 1\n    const sgmapback = {}\n    const sgorder = this.molecule.sGroupForest.getSGroupsBFS()\n    sgorder.forEach(id => {\n      sgmapback[cnt] = id\n      sgmap[id] = cnt++\n    })\n    for (let q = 1; q < cnt; ++q) {\n      // each group on its own\n      const id = sgmapback[q]\n      const sgroup = this.molecule.sgroups.get(id)!\n      this.write('M  STY')\n      this.writePaddedNumber(1, 3)\n      this.writeWhiteSpace(1)\n      this.writePaddedNumber(q, 3)\n      this.writeWhiteSpace(1)\n      this.writePadded(sgroup.type, 3)\n      this.writeCR()\n\n      // TODO: write subtype, M SST\n\n      this.write('M  SLB')\n      this.writePaddedNumber(1, 3)\n      this.writeWhiteSpace(1)\n      this.writePaddedNumber(q, 3)\n      this.writeWhiteSpace(1)\n      this.writePaddedNumber(q, 3)\n      this.writeCR()\n\n      const parentId = this.molecule.sGroupForest.parent.get(id)!\n      if (parentId >= 0) {\n        this.write('M  SPL')\n        this.writePaddedNumber(1, 3)\n        this.writeWhiteSpace(1)\n        this.writePaddedNumber(q, 3)\n        this.writeWhiteSpace(1)\n        this.writePaddedNumber(sgmap[parentId], 3)\n        this.writeCR()\n      }\n\n      // connectivity\n      if (sgroup.type === 'SRU' && sgroup.data.connectivity) {\n        const connectivity = ` ${q.toString().padStart(3)} ${(\n          sgroup.data.connectivity || ''\n        ).padEnd(3)}`\n\n        this.write('M  SCN')\n        this.writePaddedNumber(1, 3)\n        this.write(connectivity.toUpperCase())\n        this.writeCR()\n      }\n\n      if (sgroup.type === 'SRU') {\n        this.write('M  SMT ')\n        this.writePaddedNumber(q, 3)\n        this.writeWhiteSpace()\n        this.write(sgroup.data.subscript || 'n')\n        this.writeCR()\n      }\n\n      this.writeCR(\n        common.saveToMolfile[sgroup.type](\n          sgroup,\n          this.molecule,\n          sgmap,\n          this.mapping,\n          this.bondMapping\n        )\n      )\n    }\n\n    // TODO: write M  APO\n    // TODO: write M  AAL\n    // TODO: write M  RGP\n    // TODO: write M  LOG\n\n    this.writeCR('M  END')\n  }\n\n  private writeAtom(atom, atomLabel: string) {\n    this.writePaddedFloat(atom.pp.x, 10, 4)\n    this.writePaddedFloat(-atom.pp.y, 10, 4)\n    this.writePaddedFloat(atom.pp.z, 10, 4)\n    this.writeWhiteSpace()\n    this.writePadded(atomLabel, 3)\n    this.writePaddedNumber(0, 2)\n    this.writePaddedNumber(0, 3)\n    this.writePaddedNumber(0, 3)\n\n    if (typeof atom.hCount === 'undefined') {\n      atom.hCount = 0\n    }\n    this.writePaddedNumber(atom.hCount, 3)\n\n    if (typeof atom.stereoCare === 'undefined') {\n      atom.stereoCare = 0\n    }\n    this.writePaddedNumber(atom.stereoCare, 3)\n\n    let number: number\n    if (atom.explicitValence < 0) {\n      number = 0\n    } else if (atom.explicitValence === 0) {\n      number = 15\n    } else {\n      number = atom.explicitValence\n    }\n    this.writePaddedNumber(number, 3)\n\n    this.writePaddedNumber(0, 3)\n    this.writePaddedNumber(0, 3)\n    this.writePaddedNumber(0, 3)\n\n    if (typeof atom.aam === 'undefined') {\n      atom.aam = 0\n    }\n    this.writePaddedNumber(atom.aam, 3)\n\n    if (typeof atom.invRet === 'undefined') {\n      atom.invRet = 0\n    }\n    this.writePaddedNumber(atom.invRet, 3)\n\n    if (typeof atom.exactChangeFlag === 'undefined') {\n      atom.exactChangeFlag = 0\n    }\n    this.writePaddedNumber(atom.exactChangeFlag, 3)\n\n    this.writeCR()\n  }\n\n  private writeBond(bond) {\n    this.writePaddedNumber(this.mapping[bond.begin], 3)\n    this.writePaddedNumber(this.mapping[bond.end], 3)\n    this.writePaddedNumber(bond.type, 3)\n\n    if (typeof bond.stereo === 'undefined') {\n      bond.stereo = 0\n    }\n    this.writePaddedNumber(bond.stereo, 3)\n\n    this.writePadded(bond.xxx, 3)\n\n    if (typeof bond.topology === 'undefined') {\n      bond.topology = 0\n    }\n    this.writePaddedNumber(bond.topology, 3)\n\n    if (typeof bond.reactingCenterStatus === 'undefined') {\n      bond.reactingCenterStatus = 0\n    }\n    this.writePaddedNumber(bond.reactingCenterStatus, 3)\n\n    this.writeCR()\n  }\n\n  private writeAtomProps(props) {\n    this.write('A  ')\n    this.writePaddedNumber(props.id + 1, 3)\n    this.writeCR()\n    this.writeCR(props.value)\n  }\n\n  private writeAtomPropList(propId: string, values: NumberTuple[]) {\n    while (values.length > 0) {\n      const part: NumberTuple[] = []\n\n      while (values.length > 0 && part.length < 8) {\n        part.push(values[0])\n        values.splice(0, 1)\n      }\n\n      this.write(propId)\n      this.writePaddedNumber(part.length, 3)\n\n      part.forEach(value => {\n        this.writeWhiteSpace()\n        this.writePaddedNumber(this.mapping[value[0]], 3)\n        this.writeWhiteSpace()\n        this.writePaddedNumber(value[1], 3)\n      })\n\n      this.writeCR()\n    }\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { MolSerializerOptions } from './mol.types'\nimport { Molfile } from './Molfile'\nimport { Serializer } from '../serializers.types'\nimport { Struct } from 'domain/entities'\n\nexport class MolSerializer implements Serializer<Struct> {\n  static DefaultOptions: MolSerializerOptions = {\n    badHeaderRecover: false,\n    ignoreErrors: false,\n    noRgroups: false,\n    preserveIndigoDesc: false,\n    reactionRelayout: false\n  }\n\n  readonly options: MolSerializerOptions\n\n  constructor(options?: Partial<MolSerializerOptions>) {\n    this.options = { ...MolSerializer.DefaultOptions, ...options }\n  }\n\n  deserialize(content: string): Struct {\n    const molfile = new Molfile()\n    const lines = content?.split(/\\r\\n|[\\n\\r]/g)\n    try {\n      return molfile.parseCTFile(lines, this.options.reactionRelayout)\n    } catch (ex) {\n      if (this.options.badHeaderRecover) {\n        try {\n          // check whether there's an extra empty line on top\n          // this often happens when molfile text is pasted into the dialog window\n          return molfile.parseCTFile(\n            lines.slice(1),\n            this.options.reactionRelayout\n          )\n        } catch (ex1) {\n          //\n        }\n        try {\n          // check for a missing first line\n          // this sometimes happens when pasting\n          return molfile.parseCTFile(\n            [''].concat(lines),\n            this.options.reactionRelayout\n          )\n        } catch (ex2) {\n          //\n        }\n      }\n      throw ex\n    }\n  }\n\n  serialize(struct: Struct): string {\n    return new Molfile().saveMolecule(\n      struct,\n      this.options.ignoreErrors,\n      this.options.noRgroups,\n      this.options.preserveIndigoDesc\n    )\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Bond, Pool, Vec2 } from 'domain/entities'\n\nfunction CisTrans(mol, neighborsFunc, context) {\n  this.molecule = mol\n  this.bonds = new Pool()\n  this.getNeighbors = neighborsFunc\n  this.context = context\n}\n\nCisTrans.PARITY = {\n  NONE: 0,\n  CIS: 1,\n  TRANS: 2\n}\n\nCisTrans.prototype.each = function (func) {\n  this.bonds.forEach(func)\n}\n\nCisTrans.prototype.getParity = function (idx) {\n  return this.bonds.get(idx).parity\n}\n\nCisTrans.prototype.getSubstituents = function (idx) {\n  return this.bonds.get(idx).substituents\n}\n\nCisTrans.prototype.sameside = function (beg, end, neiBeg, neiEnd) {\n  var diff = Vec2.diff(beg, end)\n  var norm = new Vec2(-diff.y, diff.x)\n\n  if (!norm.normalize()) return 0\n\n  var normBeg = Vec2.diff(neiBeg, beg)\n  var normEnd = Vec2.diff(neiEnd, end)\n\n  if (!normBeg.normalize()) return 0\n  if (!normEnd.normalize()) return 0\n\n  var prodBeg = Vec2.dot(normBeg, norm)\n  var prodEnd = Vec2.dot(normEnd, norm)\n\n  if (Math.abs(prodBeg) < 0.001 || Math.abs(prodEnd) < 0.001) return 0\n\n  return prodBeg * prodEnd > 0 ? 1 : -1\n}\n\nCisTrans.prototype.samesides = function (iBeg, iEnd, iNeiBeg, iNeiEnd) {\n  return this.sameside(\n    this.molecule.atoms.get(iBeg).pp,\n    this.molecule.atoms.get(iEnd).pp,\n    this.molecule.atoms.get(iNeiBeg).pp,\n    this.molecule.atoms.get(iNeiEnd).pp\n  )\n}\n\nCisTrans.prototype.sortSubstituents = function (substituents) {\n  // eslint-disable-line max-statements\n  var h0 = this.molecule.atoms.get(substituents[0]).pureHydrogen()\n  var h1 =\n    substituents[1] < 0 ||\n    this.molecule.atoms.get(substituents[1]).pureHydrogen()\n  var h2 = this.molecule.atoms.get(substituents[2]).pureHydrogen()\n  var h3 =\n    substituents[3] < 0 ||\n    this.molecule.atoms.get(substituents[3]).pureHydrogen()\n\n  if (h0 && h1) return false\n  if (h2 && h3) return false\n\n  if (h1) {\n    substituents[1] = -1\n  } else if (h0) {\n    substituents[0] = substituents[1]\n    substituents[1] = -1\n  } else if (substituents[0] > substituents[1]) {\n    swap(substituents, 0, 1)\n  }\n\n  if (h3) {\n    substituents[3] = -1\n  } else if (h2) {\n    substituents[2] = substituents[3]\n    substituents[3] = -1\n  } else if (substituents[2] > substituents[3]) {\n    swap(substituents, 2, 3)\n  }\n\n  return true\n}\n\nCisTrans.prototype.isGeomStereoBond = function (bondIdx, substituents) {\n  // eslint-disable-line max-statements\n  // it must be [C,N,Si]=[C,N,Si] bond\n  var bond = this.molecule.bonds.get(bondIdx)\n\n  if (bond.type != Bond.PATTERN.TYPE.DOUBLE) return false\n\n  var label1 = this.molecule.atoms.get(bond.begin).label\n  var label2 = this.molecule.atoms.get(bond.end).label\n\n  if (label1 != 'C' && label1 != 'N' && label1 != 'Si' && label1 != 'Ge')\n    return false\n  if (label2 != 'C' && label2 != 'N' && label2 != 'Si' && label2 != 'Ge')\n    return false\n\n  // the atoms should have 1 or 2 single bonds\n  // (apart from the double bond under consideration)\n  var neiBegin = this.getNeighbors.call(this.context, bond.begin)\n  var neiЕnd = this.getNeighbors.call(this.context, bond.end)\n\n  if (\n    neiBegin.length < 2 ||\n    neiBegin.length > 3 ||\n    neiЕnd.length < 2 ||\n    neiЕnd.length > 3\n  )\n    return false\n\n  substituents[0] = -1\n  substituents[1] = -1\n  substituents[2] = -1\n  substituents[3] = -1\n\n  var i\n  var nei\n\n  for (i = 0; i < neiBegin.length; i++) {\n    nei = neiBegin[i]\n\n    if (nei.bid == bondIdx) continue // eslint-disable-line no-continue\n\n    if (this.molecule.bonds.get(nei.bid).type != Bond.PATTERN.TYPE.SINGLE)\n      return false\n\n    if (substituents[0] == -1) substituents[0] = nei.aid\n    // (substituents[1] == -1)\n    else substituents[1] = nei.aid\n  }\n\n  for (i = 0; i < neiЕnd.length; i++) {\n    nei = neiЕnd[i]\n\n    if (nei.bid == bondIdx) continue // eslint-disable-line no-continue\n\n    if (this.molecule.bonds.get(nei.bid).type != Bond.PATTERN.TYPE.SINGLE)\n      return false\n\n    if (substituents[2] == -1) substituents[2] = nei.aid\n    // (substituents[3] == -1)\n    else substituents[3] = nei.aid\n  }\n\n  if (\n    substituents[1] != -1 &&\n    this.samesides(bond.begin, bond.end, substituents[0], substituents[1]) != -1\n  )\n    return false\n  if (\n    substituents[3] != -1 &&\n    this.samesides(bond.begin, bond.end, substituents[2], substituents[3]) != -1\n  )\n    return false\n\n  return true\n}\n\nCisTrans.prototype.build = function (excludeBonds) {\n  this.molecule.bonds.forEach((bond, bid) => {\n    const ct = {\n      parity: 0,\n      substituents: []\n    }\n    this.bonds.set(bid, ct)\n\n    if (Array.isArray(excludeBonds) && excludeBonds[bid]) return\n\n    if (!this.isGeomStereoBond(bid, ct.substituents)) return\n\n    if (!this.sortSubstituents(ct.substituents)) return\n\n    const sign = this.samesides(\n      bond.begin,\n      bond.end,\n      ct.substituents[0],\n      ct.substituents[2]\n    )\n\n    if (sign === 1) ct.parity = CisTrans.PARITY.CIS\n    else if (sign === -1) ct.parity = CisTrans.PARITY.TRANS\n  })\n}\n\nfunction swap(arr, i1, i2) {\n  var tmp = arr[i1]\n  arr[i1] = arr[i2]\n  arr[i2] = tmp\n}\n\nexport default CisTrans\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nfunction Dfs(mol, atomData, components, nReactants) {\n  this.molecule = mol\n  this.atom_data = atomData\n  this.components = components\n  this.nComponentsInReactants = -1\n  this.nReactants = nReactants\n\n  this.vertices = new Array(this.molecule.atoms.size) // Minimum size\n  this.molecule.atoms.forEach((atom, aid) => {\n    this.vertices[aid] = new Dfs.VertexDesc()\n  }, this)\n\n  this.edges = new Array(this.molecule.bonds.size) // Minimum size\n  this.molecule.bonds.forEach((bond, bid) => {\n    this.edges[bid] = new Dfs.EdgeDesc()\n  }, this)\n\n  this.v_seq = []\n}\n\nDfs.VertexDesc = function () {\n  this.dfs_state = 0 // 0 -- not on stack\n  // 1 -- on stack\n  // 2 -- removed from stack\n  this.parent_vertex = 0 // parent vertex in DFS tree\n  this.parent_edge = 0 // edge to parent vertex\n  this.branches = 0 // how many DFS branches go out from this vertex}\n}\n\nDfs.EdgeDesc = function () {\n  this.opening_cycles = 0 // how many cycles are\n  // (i) starting with this edge\n  // and (ii) ending in this edge's first vertex\n  this.closing_cycle = 0 // 1 if this edge closes a cycle\n}\n\nDfs.SeqElem = function (vIdx, parVertex, parEdge) {\n  this.idx = vIdx // index of vertex in _graph\n  this.parent_vertex = parVertex // parent vertex in DFS tree\n  this.parent_edge = parEdge // edge to parent vertex\n}\n\nDfs.prototype.walk = function () {\n  // eslint-disable-line max-statements\n  var vStack = []\n  var i, j\n  var cid = 0\n  var component = 0\n\n  while (true) {\n    // eslint-disable-line no-constant-condition\n    if (vStack.length < 1) {\n      var selected = -1\n\n      while (cid < this.components.length && selected == -1) {\n        selected = this.components[cid].find(aid => {\n          if (this.vertices[aid].dfs_state === 0) {\n            selected = aid\n            return true\n          }\n          return false\n        })\n        if (selected === null) {\n          selected = -1\n          cid++\n        }\n        if (cid == this.nReactants) this.nComponentsInReactants = component\n      }\n      if (selected < -1) {\n        this.molecule.atoms.find(aid => {\n          if (this.vertices[aid].dfs_state === 0) {\n            selected = aid\n            return true\n          }\n          return false\n        })\n      }\n      if (selected == -1) break\n      this.vertices[selected].parent_vertex = -1\n      this.vertices[selected].parent_edge = -1\n      vStack.push(selected)\n      component++\n    }\n\n    var vIdx = vStack.pop()\n    var parentVertex = this.vertices[vIdx].parent_vertex\n\n    var seqElem = new Dfs.SeqElem(\n      vIdx,\n      parentVertex,\n      this.vertices[vIdx].parent_edge\n    )\n    this.v_seq.push(seqElem)\n\n    this.vertices[vIdx].dfs_state = 2\n\n    var atomD = this.atom_data[vIdx]\n\n    for (i = 0; i < atomD.neighbours.length; i++) {\n      var neiIdx = atomD.neighbours[i].aid\n      var edgeIdx = atomD.neighbours[i].bid\n\n      if (neiIdx == parentVertex) continue // eslint-disable-line no-continue\n\n      if (this.vertices[neiIdx].dfs_state == 2) {\n        this.edges[edgeIdx].closing_cycle = 1\n\n        j = vIdx\n\n        while (j != -1 && this.vertices[j].parent_vertex != neiIdx)\n          j = this.vertices[j].parent_vertex\n\n        if (j == -1) throw new Error('cycle unwind error')\n\n        this.edges[this.vertices[j].parent_edge].opening_cycles++\n        this.vertices[vIdx].branches++\n\n        seqElem = new Dfs.SeqElem(neiIdx, vIdx, edgeIdx)\n        this.v_seq.push(seqElem)\n      } else {\n        if (this.vertices[neiIdx].dfs_state == 1) {\n          j = vStack.indexOf(neiIdx)\n\n          if (j == -1)\n            // eslint-disable-line max-depth\n            throw new Error('internal: removing vertex from stack')\n\n          vStack.splice(j, 1)\n\n          var parent = this.vertices[neiIdx].parent_vertex\n\n          if (parent >= 0)\n            // eslint-disable-line max-depth\n            this.vertices[parent].branches--\n        }\n\n        this.vertices[vIdx].branches++\n        this.vertices[neiIdx].parent_vertex = vIdx\n        this.vertices[neiIdx].parent_edge = edgeIdx\n        this.vertices[neiIdx].dfs_state = 1\n        vStack.push(neiIdx)\n      }\n    }\n  }\n}\n\nDfs.prototype.edgeClosingCycle = function (eIdx) {\n  return this.edges[eIdx].closing_cycle !== 0\n}\n\nDfs.prototype.numBranches = function (vIdx) {\n  return this.vertices[vIdx].branches\n}\n\nDfs.prototype.numOpeningCycles = function (eIdx) {\n  return this.edges[eIdx].opening_cycles\n}\n\nDfs.prototype.toString = function () {\n  var str = ''\n  this.v_seq.forEach(seqElem => {\n    str += seqElem.idx + ' -> '\n  })\n  str += '*'\n  return str\n}\n\nexport default Dfs\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Bond, Pile, Pool, Vec2 } from 'domain/entities'\n\nfunction Stereocenters(mol, neighborsFunc, context) {\n  this.molecule = mol\n  this.atoms = new Pool()\n  this.getNeighbors = neighborsFunc\n  this.context = context\n}\n\nStereocenters.prototype.each = function (func, context) {\n  this.atoms.forEach(func, context)\n}\n\nStereocenters.prototype.buildFromBonds = function (\n  /* const int *atom_types, const int *atom_groups, const int *bond_orientations, */ ignoreErrors\n) {\n  var atoms = this.molecule.atoms\n  var bonds = this.molecule.bonds\n\n  /*\n\t\tthis is a set of atoms that are likely to belong to allene structures and\n\t\ttherefore should not be considered as potential stereocenters in the code below,\n\t\tas allenes cannot be encoded in the SMILES notation\n\t*/\n\n  var alleneMask = new Pile()\n  atoms.forEach((atom, aid) => {\n    var neiList = this.getNeighbors.call(this.context, aid)\n    if (neiList.length !== 2) return false\n    var nei1 = neiList[0]\n    var nei2 = neiList[1]\n    // check atom labels\n    if (\n      [aid, nei1.aid, nei2.aid].findIndex(\n        aid => ['C', 'Si'].indexOf(atoms.get(aid).label) < 0,\n        this\n      ) >= 0\n    )\n      return false\n\n    // check adjacent bond types\n    if (\n      [nei1.bid, nei2.bid].findIndex(\n        bid => bonds.get(bid).type !== Bond.PATTERN.TYPE.DOUBLE,\n        this\n      ) >= 0\n    )\n      return false\n\n    // get the other neighbors of the two adjacent atoms except for the central atom\n    var nei1nei = this.getNeighbors\n      .call(this.context, nei1.aid)\n      .filter(nei => nei.aid != aid)\n    var nei2nei = this.getNeighbors\n      .call(this.context, nei2.aid)\n      .filter(nei => nei.aid != aid)\n    if (\n      nei1nei.length < 1 ||\n      nei1nei.length > 2 ||\n      nei2nei.length < 1 ||\n      nei2nei.length > 2\n    )\n      return false\n\n    if (\n      nei1nei\n        .concat(nei2nei)\n        .findIndex(\n          nei => bonds.get(nei.bid).type != Bond.PATTERN.TYPE.SINGLE,\n          this\n        ) >= 0\n    )\n      return false\n\n    if (\n      nei1nei\n        .concat(nei2nei)\n        .findIndex(\n          nei => bonds.get(nei.bid).stereo == Bond.PATTERN.STEREO.EITHER,\n          this\n        ) >= 0\n    )\n      return false\n    alleneMask.add(nei1.aid).add(nei2.aid)\n    return true\n  })\n\n  if (alleneMask.size > 0)\n    //TODO: add error handler call\n    //legacy message: This structure may contain allenes, which cannot be represented in the SMILES notation. Relevant stereo-information will be discarded.\n\n    atoms.forEach((atom, aid) => {\n      if (alleneMask.has(aid)) return\n      /*\n      if (atom_types[atom_idx] == 0)\n         continue;\n         */\n      var neiList = this.getNeighbors.call(this.context, aid)\n      var stereocenter = false\n\n      neiList.find(function (nei) {\n        var bond = this.molecule.bonds.get(nei.bid)\n\n        if (bond.type === Bond.PATTERN.TYPE.SINGLE && bond.begin == aid) {\n          if (\n            bond.stereo === Bond.PATTERN.STEREO.UP ||\n            bond.stereo == Bond.PATTERN.STEREO.DOWN\n          ) {\n            stereocenter = true\n            return true\n          }\n        }\n        return false\n      }, this)\n\n      if (!stereocenter) return\n\n      if (ignoreErrors)\n        this.buildOneCenter(\n          aid /* , atom_groups[atom_idx], atom_types[atom_idx], bond_orientations*/\n        )\n      else\n        this.buildOneCenter(\n          aid /* , atom_groups[atom_idx], atom_types[atom_idx], bond_orientations*/\n        )\n    })\n}\n\nStereocenters.allowed_stereocenters = [\n  { elem: 'C', charge: 0, degree: 3, n_double_bonds: 0, implicit_degree: 4 },\n  { elem: 'C', charge: 0, degree: 4, n_double_bonds: 0, implicit_degree: 4 },\n  { elem: 'Si', charge: 0, degree: 3, n_double_bonds: 0, implicit_degree: 4 },\n  { elem: 'Si', charge: 0, degree: 4, n_double_bonds: 0, implicit_degree: 4 },\n  { elem: 'N', charge: 1, degree: 3, n_double_bonds: 0, implicit_degree: 4 },\n  { elem: 'N', charge: 1, degree: 4, n_double_bonds: 0, implicit_degree: 4 },\n  { elem: 'N', charge: 0, degree: 3, n_double_bonds: 0, implicit_degree: 3 },\n  { elem: 'S', charge: 0, degree: 4, n_double_bonds: 2, implicit_degree: 4 },\n  { elem: 'S', charge: 1, degree: 3, n_double_bonds: 0, implicit_degree: 3 },\n  { elem: 'S', charge: 0, degree: 3, n_double_bonds: 1, implicit_degree: 3 },\n  { elem: 'P', charge: 0, degree: 3, n_double_bonds: 0, implicit_degree: 3 },\n  { elem: 'P', charge: 1, degree: 4, n_double_bonds: 0, implicit_degree: 4 },\n  { elem: 'P', charge: 0, degree: 4, n_double_bonds: 1, implicit_degree: 4 }\n]\n\nStereocenters.prototype.buildOneCenter = function (\n  atomIdx /* , int group, int type, const int *bond_orientations*/\n) {\n  // eslint-disable-line max-statements\n  var atom = this.molecule.atoms.get(atomIdx)\n\n  var neiList = this.getNeighbors.call(this.context, atomIdx)\n  var degree = neiList.length\n  var implicitDegree = -1\n\n  var stereocenter = {\n    group: 0, // = group;\n    type: 0, // = type;\n    pyramid: []\n  }\n\n  var edgeIds = []\n\n  var lastAtomDir = 0\n  var nDoubleBonds = 0\n\n  stereocenter.pyramid[0] = -1\n  stereocenter.pyramid[1] = -1\n  stereocenter.pyramid[2] = -1\n  stereocenter.pyramid[3] = -1\n\n  var nPureHydrogens = 0\n\n  if (degree > 4)\n    throw new Error('stereocenter with %d bonds are not supported' + degree)\n\n  neiList.forEach((nei, neiIdx) => {\n    var neiAtom = this.molecule.atoms.get(nei.aid)\n    var bond = this.molecule.bonds.get(nei.bid)\n    edgeIds[neiIdx] = {\n      edge_idx: nei.bid,\n      nei_idx: nei.aid,\n      rank: nei.aid,\n      vec: Vec2.diff(neiAtom.pp, atom.pp).yComplement()\n    }\n\n    if (neiAtom.pureHydrogen()) {\n      nPureHydrogens++\n      edgeIds[neiIdx].rank = 10000\n    } else if (neiAtom.label === 'H') {\n      edgeIds[neiIdx].rank = 5000\n    }\n\n    if (!edgeIds[neiIdx].vec.normalize()) throw new Error('zero bond length')\n\n    if (bond.type === Bond.PATTERN.TYPE.TRIPLE)\n      throw new Error('non-single bonds not allowed near stereocenter')\n    else if (bond.type === Bond.PATTERN.TYPE.AROMATIC)\n      throw new Error('aromatic bonds not allowed near stereocenter')\n    else if (bond.type === Bond.PATTERN.TYPE.DOUBLE) nDoubleBonds++\n  })\n\n  Stereocenters.allowed_stereocenters.find(as => {\n    if (\n      as.elem === atom.label &&\n      as.charge === atom.charge &&\n      as.degree === degree &&\n      as.n_double_bonds === nDoubleBonds\n    ) {\n      implicitDegree = as.implicit_degree\n      return true\n    }\n    return false\n  })\n\n  if (implicitDegree === -1)\n    throw new Error(\n      'unknown stereocenter configuration: ' +\n        atom.label +\n        ', charge ' +\n        atom.charge +\n        ', ' +\n        degree +\n        ' bonds (' +\n        nDoubleBonds +\n        ' double)'\n    )\n\n  if (degree === 4 && nPureHydrogens > 1)\n    throw new Error(nPureHydrogens + ' hydrogens near stereocenter')\n\n  if (degree === 3 && implicitDegree === 4 && nPureHydrogens > 0)\n    throw new Error(\n      'have hydrogen(s) besides implicit hydrogen near stereocenter'\n    )\n\n  if (degree === 4) {\n    // sort by neighbor atom index (ascending)\n    if (edgeIds[0].rank > edgeIds[1].rank) swap(edgeIds, 0, 1)\n    if (edgeIds[1].rank > edgeIds[2].rank) swap(edgeIds, 1, 2)\n    if (edgeIds[2].rank > edgeIds[3].rank) swap(edgeIds, 2, 3)\n    if (edgeIds[1].rank > edgeIds[2].rank) swap(edgeIds, 1, 2)\n    if (edgeIds[0].rank > edgeIds[1].rank) swap(edgeIds, 0, 1)\n    if (edgeIds[1].rank > edgeIds[2].rank) swap(edgeIds, 1, 2)\n\n    var main1 = -1\n    var main2 = -1\n    var side1 = -1\n    var side2 = -1\n    var mainDir = 0\n\n    for (var neiIdx = 0; neiIdx < 4; neiIdx++) {\n      var stereo = this.getBondStereo(atomIdx, edgeIds[neiIdx].edge_idx)\n\n      if (\n        stereo === Bond.PATTERN.STEREO.UP ||\n        stereo == Bond.PATTERN.STEREO.DOWN\n      ) {\n        main1 = neiIdx\n        mainDir = stereo\n        break\n      }\n    }\n\n    if (main1 === -1)\n      throw new Error('none of 4 bonds going from stereocenter is stereobond')\n\n    var xyz1, xyz2\n\n    // find main2 as opposite to main1\n    if (main2 === -1) {\n      xyz1 = Stereocenters.xyzzy(\n        edgeIds[main1].vec,\n        edgeIds[(main1 + 1) % 4].vec,\n        edgeIds[(main1 + 2) % 4].vec\n      )\n      xyz2 = Stereocenters.xyzzy(\n        edgeIds[main1].vec,\n        edgeIds[(main1 + 1) % 4].vec,\n        edgeIds[(main1 + 3) % 4].vec\n      )\n\n      if (xyz1 + xyz2 == 3 || xyz1 + xyz2 == 12) {\n        main2 = (main1 + 1) % 4\n        side1 = (main1 + 2) % 4\n        side2 = (main1 + 3) % 4\n      }\n    }\n    if (main2 == -1) {\n      xyz1 = Stereocenters.xyzzy(\n        edgeIds[main1].vec,\n        edgeIds[(main1 + 2) % 4].vec,\n        edgeIds[(main1 + 1) % 4].vec\n      )\n      xyz2 = Stereocenters.xyzzy(\n        edgeIds[main1].vec,\n        edgeIds[(main1 + 2) % 4].vec,\n        edgeIds[(main1 + 3) % 4].vec\n      )\n\n      if (xyz1 + xyz2 == 3 || xyz1 + xyz2 == 12) {\n        main2 = (main1 + 2) % 4\n        side1 = (main1 + 1) % 4\n        side2 = (main1 + 3) % 4\n      }\n    }\n    if (main2 == -1) {\n      xyz1 = Stereocenters.xyzzy(\n        edgeIds[main1].vec,\n        edgeIds[(main1 + 3) % 4].vec,\n        edgeIds[(main1 + 1) % 4].vec\n      )\n      xyz2 = Stereocenters.xyzzy(\n        edgeIds[main1].vec,\n        edgeIds[(main1 + 3) % 4].vec,\n        edgeIds[(main1 + 2) % 4].vec\n      )\n\n      if (xyz1 + xyz2 == 3 || xyz1 + xyz2 == 12) {\n        main2 = (main1 + 3) % 4\n        side1 = (main1 + 2) % 4\n        side2 = (main1 + 1) % 4\n      }\n    }\n\n    if (main2 == -1)\n      throw new Error('internal error: can not find opposite bond')\n\n    if (\n      mainDir == Bond.PATTERN.STEREO.UP &&\n      this.getBondStereo(atomIdx, edgeIds[main2].edge_idx) ==\n        Bond.PATTERN.STEREO.DOWN\n    )\n      throw new Error('stereo types of the opposite bonds mismatch')\n    if (\n      mainDir == Bond.PATTERN.STEREO.DOWN &&\n      this.getBondStereo(atomIdx, edgeIds[main2].edge_idx) ==\n        Bond.PATTERN.STEREO.UP\n    )\n      throw new Error('stereo types of the opposite bonds mismatch')\n\n    if (mainDir == this.getBondStereo(atomIdx, edgeIds[side1].edge_idx))\n      throw new Error('stereo types of non-opposite bonds match')\n    if (mainDir == this.getBondStereo(atomIdx, edgeIds[side2].edge_idx))\n      throw new Error('stereo types of non-opposite bonds match')\n\n    if (main1 == 3 || main2 == 3) lastAtomDir = mainDir\n    else\n      lastAtomDir =\n        mainDir == Bond.PATTERN.STEREO.UP\n          ? Bond.PATTERN.STEREO.DOWN\n          : Bond.PATTERN.STEREO.UP\n\n    sign = Stereocenters.sign(edgeIds[0].vec, edgeIds[1].vec, edgeIds[2].vec)\n\n    if (\n      (lastAtomDir == Bond.PATTERN.STEREO.UP && sign > 0) ||\n      (lastAtomDir == Bond.PATTERN.STEREO.DOWN && sign < 0)\n    ) {\n      stereocenter.pyramid[0] = edgeIds[0].nei_idx\n      stereocenter.pyramid[1] = edgeIds[1].nei_idx\n      stereocenter.pyramid[2] = edgeIds[2].nei_idx\n    } else {\n      stereocenter.pyramid[0] = edgeIds[0].nei_idx\n      stereocenter.pyramid[1] = edgeIds[2].nei_idx\n      stereocenter.pyramid[2] = edgeIds[1].nei_idx\n    }\n\n    stereocenter.pyramid[3] = edgeIds[3].nei_idx\n  } else if (degree === 3) {\n    // sort by neighbor atom index (ascending)\n    if (edgeIds[0].rank > edgeIds[1].rank) swap(edgeIds, 0, 1)\n    if (edgeIds[1].rank > edgeIds[2].rank) swap(edgeIds, 1, 2)\n    if (edgeIds[0].rank > edgeIds[1].rank) swap(edgeIds, 0, 1)\n\n    var stereo0 = this.getBondStereo(atomIdx, edgeIds[0].edge_idx)\n    var stereo1 = this.getBondStereo(atomIdx, edgeIds[1].edge_idx)\n    var stereo2 = this.getBondStereo(atomIdx, edgeIds[2].edge_idx)\n\n    var nUp = 0\n    var nDown = 0\n\n    nUp += stereo0 === Bond.PATTERN.STEREO.UP ? 1 : 0\n    nUp += stereo1 === Bond.PATTERN.STEREO.UP ? 1 : 0\n    nUp += stereo2 === Bond.PATTERN.STEREO.UP ? 1 : 0\n\n    nDown += stereo0 === Bond.PATTERN.STEREO.DOWN ? 1 : 0\n    nDown += stereo1 === Bond.PATTERN.STEREO.DOWN ? 1 : 0\n    nDown += stereo2 === Bond.PATTERN.STEREO.DOWN ? 1 : 0\n\n    if (implicitDegree == 4) {\n      // have implicit hydrogen\n      if (nUp == 3) throw new Error('all 3 bonds up near stereoatom')\n      if (nDown == 3) throw new Error('all 3 bonds down near stereoatom')\n\n      if (nUp == 0 && nDown == 0)\n        throw new Error('no up/down bonds near stereoatom -- indefinite case')\n      if (nUp == 1 && nDown == 1)\n        throw new Error('one bond up, one bond down -- indefinite case')\n\n      mainDir = 0\n\n      if (nUp == 2) {\n        lastAtomDir = Bond.PATTERN.STEREO.DOWN\n      } else if (nDown == 2) {\n        lastAtomDir = Bond.PATTERN.STEREO.UP\n      } else {\n        main1 = -1\n        side1 = -1\n        side2 = -1\n\n        for (neiIdx = 0; neiIdx < 3; neiIdx++) {\n          dir = this.getBondStereo(atomIdx, edgeIds[neiIdx].edge_idx)\n\n          if (\n            dir == Bond.PATTERN.STEREO.UP ||\n            dir == Bond.PATTERN.STEREO.DOWN\n          ) {\n            // eslint-disable-line max-depth\n            main1 = neiIdx\n            mainDir = dir\n            side1 = (neiIdx + 1) % 3\n            side2 = (neiIdx + 2) % 3\n            break\n          }\n        }\n\n        if (main1 == -1)\n          throw new Error('internal error: can not find up or down bond')\n\n        var xyz = Stereocenters.xyzzy(\n          edgeIds[side1].vec,\n          edgeIds[side2].vec,\n          edgeIds[main1].vec\n        )\n\n        if (xyz == 3 || xyz == 4)\n          throw new Error('degenerate case for 3 bonds near stereoatom')\n\n        if (xyz == 1) lastAtomDir = mainDir\n        else\n          lastAtomDir =\n            mainDir == Bond.PATTERN.STEREO.UP\n              ? Bond.PATTERN.STEREO.DOWN\n              : Bond.PATTERN.STEREO.UP\n      }\n\n      var sign = Stereocenters.sign(\n        edgeIds[0].vec,\n        edgeIds[1].vec,\n        edgeIds[2].vec\n      )\n\n      if (\n        (lastAtomDir == Bond.PATTERN.STEREO.UP && sign > 0) ||\n        (lastAtomDir == Bond.PATTERN.STEREO.DOWN && sign < 0)\n      ) {\n        stereocenter.pyramid[0] = edgeIds[0].nei_idx\n        stereocenter.pyramid[1] = edgeIds[1].nei_idx\n        stereocenter.pyramid[2] = edgeIds[2].nei_idx\n      } else {\n        stereocenter.pyramid[0] = edgeIds[0].nei_idx\n        stereocenter.pyramid[1] = edgeIds[2].nei_idx\n        stereocenter.pyramid[2] = edgeIds[1].nei_idx\n      }\n\n      stereocenter.pyramid[3] = -1\n    } else {\n      // 3-connected P, N or S; no implicit hydrogens\n      var dir\n\n      if (nDown > 0 && nUp > 0)\n        throw new Error('one bond up, one bond down -- indefinite case')\n      else if (nDown == 0 && nUp == 0)\n        throw new Error('no up-down bonds attached to stereocenter')\n      else if (nUp > 0) dir = 1\n      else dir = -1\n\n      if (\n        Stereocenters.xyzzy(edgeIds[0].vec, edgeIds[1].vec, edgeIds[2].vec) ===\n          1 ||\n        Stereocenters.xyzzy(edgeIds[0].vec, edgeIds[2].vec, edgeIds[1].vec) ===\n          1 ||\n        Stereocenters.xyzzy(edgeIds[2].vec, edgeIds[1].vec, edgeIds[0].vec) ===\n          1\n      )\n        // all bonds belong to the same half-plane\n        dir = -dir\n\n      sign = Stereocenters.sign(edgeIds[0].vec, edgeIds[1].vec, edgeIds[2].vec)\n\n      if (sign == dir) {\n        stereocenter.pyramid[0] = edgeIds[0].nei_idx\n        stereocenter.pyramid[1] = edgeIds[2].nei_idx\n        stereocenter.pyramid[2] = edgeIds[1].nei_idx\n      } else {\n        stereocenter.pyramid[0] = edgeIds[0].nei_idx\n        stereocenter.pyramid[1] = edgeIds[1].nei_idx\n        stereocenter.pyramid[2] = edgeIds[2].nei_idx\n      }\n      stereocenter.pyramid[3] = -1\n    }\n  }\n  this.atoms.set(atomIdx, stereocenter)\n}\n\nStereocenters.prototype.getBondStereo = function (centerIdx, edgeIdx) {\n  var bond = this.molecule.bonds.get(edgeIdx)\n\n  if (centerIdx != bond.begin)\n    // TODO: check this\n    return 0\n\n  return bond.stereo\n}\n\n// 1 -- in the smaller angle, 2 -- in the bigger angle,\n// 4 -- in the 'positive' straight angle, 8 -- in the 'negative' straight angle\nStereocenters.xyzzy = function (v1, v2, u) {\n  var eps = 0.001\n\n  var sine1 = Vec2.cross(v1, v2)\n  var cosine1 = Vec2.dot(v1, v2)\n\n  var sine2 = Vec2.cross(v1, u)\n  var cosine2 = Vec2.dot(v1, u)\n\n  if (Math.abs(sine1) < eps) {\n    if (Math.abs(sine2) < eps)\n      throw new Error('degenerate case -- bonds overlap')\n\n    return sine2 > 0 ? 4 : 8\n  }\n\n  if (sine1 * sine2 < -eps * eps) return 2\n\n  if (cosine2 < cosine1) return 2\n\n  return 1\n}\n\nStereocenters.sign = function (v1, v2, v3) {\n  var res = (v1.x - v3.x) * (v2.y - v3.y) - (v1.y - v3.y) * (v2.x - v3.x) // eslint-disable-line no-mixed-operators\n  var eps = 0.001\n\n  if (res > eps) return 1\n  if (res < -eps) return -1\n\n  throw new Error('degenerate triangle')\n}\n\nStereocenters.isPyramidMappingRigid = function (mapping) {\n  var arr = mapping.slice()\n  var rigid = true\n\n  if (arr[0] > arr[1]) {\n    swap(arr, 0, 1)\n    rigid = !rigid\n  }\n  if (arr[1] > arr[2]) {\n    swap(arr, 1, 2)\n    rigid = !rigid\n  }\n  if (arr[2] > arr[3]) {\n    swap(arr, 2, 3)\n    rigid = !rigid\n  }\n  if (arr[1] > arr[2]) {\n    swap(arr, 1, 2)\n    rigid = !rigid\n  }\n  if (arr[0] > arr[1]) {\n    swap(arr, 0, 1)\n    rigid = !rigid\n  }\n  if (arr[1] > arr[2]) {\n    swap(arr, 1, 2)\n    rigid = !rigid\n  }\n\n  return rigid\n}\n\nfunction swap(arr, i1, i2) {\n  var tmp = arr[i1]\n  arr[i1] = arr[i2]\n  arr[i2] = tmp\n}\n\nexport default Stereocenters\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Atom, Bond, Pile, SGroup } from 'domain/entities'\n\nimport CisTrans from './cis_trans'\nimport Dfs from './dfs'\nimport Stereocenters from './stereocenters'\n\nexport function Smiles() {\n  this.smiles = ''\n  this.writtenAtoms = []\n  this.writtenComponents = 0\n\n  this.ignoreErrors = false\n}\n\nSmiles._Atom = function (hСount) {\n  // eslint-disable-line no-underscore-dangle\n  this.neighbours = [] // Array of integer pairs {a, b}\n  this.aromatic = false // has aromatic bond\n  this.lowercase = false // aromatic and has to be written lowercase\n  this.chirality = 0 // 0 means no chirality, 1 means CCW pyramid, 2 means CW pyramid\n  this.branch_cnt = 0 // runs from 0 to (branches - 1)\n  this.paren_written = false\n  this.h_count = hСount\n  this.parent = -1\n}\n\n// NB: only loops of length up to 6 are included here\nSmiles.prototype.isBondInRing = function (bid) {\n  console.assert(this.inLoop, 'Init this.inLoop prior to calling this method')\n  return this.inLoop[bid]\n}\n\nSmiles.prototype.saveMolecule = function (struct, ignoreErrors) {\n  // eslint-disable-line max-statements\n  var i, j, k\n\n  if (!ignoreErrors) this.ignoreErrors = ignoreErrors\n\n  // [RB]: KETCHER-498 (Incorrect smile-string for multiple Sgroup)\n  // TODO the fix is temporary, still need to implement error handling/reporting\n  // BEGIN\n  struct = struct.clone(\n    undefined,\n    undefined,\n    !struct.hasRxnArrow(), // make it drop multiple reactions\n    undefined,\n    undefined,\n    undefined\n  )\n  struct.initHalfBonds()\n  struct.initNeighbors()\n  struct.sortNeighbors()\n  struct.setImplicitHydrogen()\n  struct.sgroups.forEach(sg => {\n    if (sg.type === 'MUL') {\n      try {\n        SGroup.prepareMulForSaving(sg, struct)\n      } catch (ex) {\n        throw Error('Bad s-group (' + ex.message + ')')\n      }\n    }\n    // 'SMILES data format doesn\\'t support s-groups'\n  })\n  // END\n\n  this.atoms = new Array(struct.atoms.size)\n\n  struct.atoms.forEach((atom, aid) => {\n    this.atoms[aid] = new Smiles._Atom(atom.implicitH) // eslint-disable-line no-underscore-dangle\n  })\n\n  // From the SMILES specification:\n  // Please note that only atoms on the following list\n  // can be considered aromatic: C, N, O, P, S, As, Se, and * (wildcard).\n  var allowedLowercase = ['B', 'C', 'N', 'O', 'P', 'S', 'Se', 'As']\n\n  // Detect atoms that have aromatic bonds and count neighbours\n  struct.bonds.forEach((bond, bid) => {\n    if (bond.type === Bond.PATTERN.TYPE.AROMATIC) {\n      this.atoms[bond.begin].aromatic = true\n      if (allowedLowercase.indexOf(struct.atoms.get(bond.begin).label) !== -1)\n        this.atoms[bond.begin].lowercase = true\n      this.atoms[bond.end].aromatic = true\n      if (allowedLowercase.indexOf(struct.atoms.get(bond.end).label) !== -1)\n        this.atoms[bond.end].lowercase = true\n    }\n    this.atoms[bond.begin].neighbours.push({ aid: bond.end, bid })\n    this.atoms[bond.end].neighbours.push({ aid: bond.begin, bid })\n  })\n\n  this.inLoop = (function () {\n    struct.prepareLoopStructure()\n    let bondsInLoops = new Pile()\n    struct.loops.forEach(loop => {\n      if (loop.hbs.length <= 6) {\n        const hbids = loop.hbs.map(hbid => struct.halfBonds.get(hbid).bid)\n        bondsInLoops = bondsInLoops.union(new Pile(hbids))\n      }\n    })\n    const inLoop = {}\n    bondsInLoops.forEach(bid => {\n      inLoop[bid] = 1\n    })\n    return inLoop\n  })()\n\n  this.touchedCistransbonds = 0\n  this.markCisTrans(struct)\n\n  var components = struct.getComponents()\n  var componentsAll = components.reactants.concat(components.products)\n\n  var walk = new Dfs(\n    struct,\n    this.atoms,\n    componentsAll,\n    components.reactants.length\n  )\n\n  walk.walk()\n  this.atoms.forEach(atom => {\n    atom.neighbours = []\n  })\n\n  // fill up neighbor lists for the stereocenters calculation\n  for (i = 0; i < walk.v_seq.length; i++) {\n    var seqEl = walk.v_seq[i]\n    var vIdx = seqEl.idx\n    var eIdx = seqEl.parent_edge\n    var vPrevIdx = seqEl.parent_vertex\n\n    if (eIdx >= 0) {\n      var atom = this.atoms[vIdx]\n\n      var openingCycles = walk.numOpeningCycles(eIdx)\n\n      for (j = 0; j < openingCycles; j++)\n        this.atoms[vPrevIdx].neighbours.push({ aid: -1, bid: -1 })\n\n      if (walk.edgeClosingCycle(eIdx)) {\n        for (k = 0; k < atom.neighbours.length; k++) {\n          if (atom.neighbours[k].aid === -1) {\n            // eslint-disable-line max-depth\n            atom.neighbours[k].aid = vPrevIdx\n            atom.neighbours[k].bid = eIdx\n            break\n          }\n        }\n        if (k === atom.neighbours.length)\n          throw new Error('internal: can not put closing bond to its place')\n      } else {\n        atom.neighbours.push({ aid: vPrevIdx, bid: eIdx })\n        atom.parent = vPrevIdx\n      }\n      this.atoms[vPrevIdx].neighbours.push({ aid: vIdx, bid: eIdx })\n    }\n  }\n\n  try {\n    // detect chiral configurations\n    var stereocenters = new Stereocenters(\n      struct,\n      function (idx) {\n        return this.atoms[idx].neighbours\n      },\n      this\n    )\n    stereocenters.buildFromBonds(this.ignoreErrors)\n\n    stereocenters.each((sc, atomIdx) => {\n      // eslint-disable-line max-statements\n      // if (sc.type < MoleculeStereocenters::ATOM_AND)\n      //    continue;\n\n      var implicitHIdx = -1\n\n      if (sc.pyramid[3] == -1) implicitHIdx = 3\n      /*\n\t\t\telse for (j = 0; j < 4; j++)\n\t\t\t\tif (ignored_vertices[pyramid[j]])\n\t\t\t\t{\n\t\t\t\t\timplicit_h_idx = j;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t*/\n\n      var pyramidMapping = []\n      var counter = 0\n\n      var atom = this.atoms[atomIdx]\n\n      if (atom.parent != -1) {\n        for (k = 0; k < 4; k++) {\n          if (sc.pyramid[k] == atom.parent) {\n            pyramidMapping[counter++] = k\n            break\n          }\n        }\n      }\n\n      if (implicitHIdx != -1) pyramidMapping[counter++] = implicitHIdx\n\n      for (j = 0; j != atom.neighbours.length; j++) {\n        if (atom.neighbours[j].aid == atom.parent) continue // eslint-disable-line no-continue\n\n        for (k = 0; k < 4; k++) {\n          if (atom.neighbours[j].aid == sc.pyramid[k]) {\n            if (counter >= 4) throw new Error('internal: pyramid overflow')\n            pyramidMapping[counter++] = k\n            break\n          }\n        }\n      }\n\n      if (counter == 4) {\n        // move the 'from' atom to the end\n        counter = pyramidMapping[0]\n        pyramidMapping[0] = pyramidMapping[1]\n        pyramidMapping[1] = pyramidMapping[2]\n        pyramidMapping[2] = pyramidMapping[3]\n        pyramidMapping[3] = counter\n      } else if (counter != 3) {\n        throw new Error('cannot calculate chirality')\n      }\n\n      if (Stereocenters.isPyramidMappingRigid(pyramidMapping))\n        this.atoms[atomIdx].chirality = 1\n      else this.atoms[atomIdx].chirality = 2\n    })\n  } catch (ex) {\n    //TODO: add error handler call\n  }\n\n  // write the SMILES itself\n\n  // cycle_numbers[i] == -1 means that the number is available\n  // cycle_numbers[i] == n means that the number is used by vertex n\n  var cycleNumbers = []\n\n  cycleNumbers.push(0) // never used\n\n  var firstComponent = true\n\n  for (i = 0; i < walk.v_seq.length; i++) {\n    seqEl = walk.v_seq[i]\n    vIdx = seqEl.idx\n    eIdx = seqEl.parent_edge\n    vPrevIdx = seqEl.parent_vertex\n    var writeAtom = true\n\n    if (vPrevIdx >= 0) {\n      if (walk.numBranches(vPrevIdx) > 1) {\n        if (\n          this.atoms[vPrevIdx].branch_cnt > 0 &&\n          this.atoms[vPrevIdx].paren_written\n        )\n          this.smiles += ')'\n      }\n\n      openingCycles = walk.numOpeningCycles(eIdx)\n\n      for (j = 0; j < openingCycles; j++) {\n        for (k = 1; k < cycleNumbers.length; k++) {\n          if (cycleNumbers[k] == -1)\n            // eslint-disable-line max-depth\n            break\n        }\n        if (k == cycleNumbers.length) cycleNumbers.push(vPrevIdx)\n        else cycleNumbers[k] = vPrevIdx\n\n        this.writeCycleNumber(k)\n      }\n\n      if (vPrevIdx >= 0) {\n        var branches = walk.numBranches(vPrevIdx)\n\n        if (branches > 1 && this.atoms[vPrevIdx].branch_cnt < branches - 1) {\n          if (walk.edgeClosingCycle(eIdx)) {\n            // eslint-disable-line max-depth\n            this.atoms[vPrevIdx].paren_written = false\n          } else {\n            this.smiles += '('\n            this.atoms[vPrevIdx].paren_written = true\n          }\n        }\n\n        this.atoms[vPrevIdx].branch_cnt++\n\n        if (this.atoms[vPrevIdx].branch_cnt > branches)\n          throw new Error('unexpected branch')\n      }\n\n      var bond = struct.bonds.get(eIdx)\n\n      var dir = 0\n\n      if (bond.type == Bond.PATTERN.TYPE.SINGLE)\n        dir = this.calcBondDirection(struct, eIdx, vPrevIdx)\n\n      if ((dir == 1 && vIdx == bond.end) || (dir == 2 && vIdx == bond.begin))\n        this.smiles += '/'\n      else if (\n        (dir == 2 && vIdx == bond.end) ||\n        (dir == 1 && vIdx == bond.begin)\n      )\n        this.smiles += '\\\\'\n      else if (bond.type == Bond.PATTERN.TYPE.ANY) {\n        this.smiles += '~'\n      } else if (bond.type == Bond.PATTERN.TYPE.DOUBLE) {\n        this.smiles += '='\n      } else if (bond.type == Bond.PATTERN.TYPE.TRIPLE) {\n        this.smiles += '#'\n      } else if (bond.type == Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC) {\n        this.smiles += '-,:'\n      } else if (bond.type == Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC) {\n        this.smiles += '=,:'\n      } else if (bond.type == Bond.PATTERN.TYPE.SINGLE_OR_DOUBLE) {\n        this.smiles += '-,='\n      } else if (\n        bond.type == Bond.PATTERN.TYPE.AROMATIC &&\n        (!this.atoms[bond.begin].lowercase ||\n          !this.atoms[bond.end].lowercase ||\n          !this.isBondInRing(eIdx))\n      )\n        this.smiles += ':'\n      // TODO: Check if this : is needed\n      else if (\n        bond.type == Bond.PATTERN.TYPE.SINGLE &&\n        this.atoms[bond.begin].aromatic &&\n        this.atoms[bond.end].aromatic\n      )\n        this.smiles += '-'\n\n      if (walk.edgeClosingCycle(eIdx)) {\n        for (j = 1; j < cycleNumbers.length; j++) {\n          if (cycleNumbers[j] == vIdx) break\n        }\n\n        if (j == cycleNumbers.length) throw new Error('cycle number not found')\n\n        this.writeCycleNumber(j)\n\n        cycleNumbers[j] = -1\n        writeAtom = false\n      }\n    } else {\n      if (!firstComponent) {\n        this.smiles +=\n          this.writtenComponents === walk.nComponentsInReactants &&\n          walk.nReactants !== 0\n            ? '>>'\n            : '.' // when walk.nReactants === 0 - not reaction\n      }\n      firstComponent = false\n      this.writtenComponents++\n    }\n    if (writeAtom) {\n      this.writeAtom(\n        struct,\n        vIdx,\n        this.atoms[vIdx].aromatic,\n        this.atoms[vIdx].lowercase,\n        this.atoms[vIdx].chirality\n      )\n      this.writtenAtoms.push(seqEl.idx)\n    }\n  }\n\n  this.comma = false\n\n  // this._writeStereogroups(mol, atoms);\n  this.writeRadicals(struct)\n  // this._writePseudoAtoms(mol);\n  // this._writeHighlighting();\n\n  if (this.comma) this.smiles += '|'\n\n  return this.smiles\n}\n\nSmiles.prototype.writeCycleNumber = function (n) {\n  if (n > 0 && n < 10) this.smiles += n\n  else if (n >= 10 && n < 100) this.smiles += '%' + n\n  else if (n >= 100 && n < 1000) this.smiles += '%%' + n\n  else throw new Error('bad cycle number: ' + n)\n}\n\nSmiles.prototype.writeAtom = function (\n  mol,\n  idx,\n  aromatic,\n  lowercase,\n  chirality\n) {\n  // eslint-disable-line max-params, max-statements\n  var atom = mol.atoms.get(idx)\n  var needBrackets = false\n  var hydro = -1\n  var aam = 0\n\n  /*\n\tif (mol.haveQueryAtoms())\n\t{\n\t  query_atom = &mol.getQueryAtom(idx);\n\n\t  if (query_atom->type == QUERY_ATOM_RGROUP)\n\t  {\n\t\t if (mol.getRGroups()->isRGroupAtom(idx))\n\t\t {\n\t\t\tconst Array<int> &rg = mol.getRGroups()->getSiteRGroups(idx);\n\n\t\t\tif (rg.length != 1)\n\t\t\t   throw Error(\"rgroup count %d\", rg.length);\n\n\t\t\t_output.printf(\"[&%d]\", rg[0] + 1);\n\t\t }\n\t\t else\n\t\t\t_output.printf(\"[&%d]\", 1);\n\n\t\t return;\n\t  }\n\t}\n\t*/\n\n  if (atom.label == 'A') {\n    this.smiles += '*'\n    return\n  }\n\n  if (atom.label == 'R' || atom.label == 'R#') {\n    this.smiles += '[*]'\n    return\n  }\n\n  // KETCHER-598 (Ketcher does not save AAM into reaction SMILES)\n  // BEGIN\n  //    if (this.atom_atom_mapping)\n  //        aam = atom_atom_mapping[idx];\n  aam = atom.aam\n  // END\n\n  if (\n    atom.label != 'C' &&\n    atom.label != 'P' &&\n    atom.label != 'N' &&\n    atom.label != 'S' &&\n    atom.label != 'O' &&\n    atom.label != 'Cl' &&\n    atom.label != 'F' &&\n    atom.label != 'Br' &&\n    atom.label != 'B' &&\n    atom.label != 'I'\n  )\n    needBrackets = true\n\n  if (\n    atom.explicitValence >= 0 ||\n    atom.radical != 0 ||\n    chirality > 0 ||\n    (aromatic && atom.label != 'C' && atom.label != 'O') ||\n    (aromatic &&\n      atom.label == 'C' &&\n      this.atoms[idx].neighbours.length < 3 &&\n      this.atoms[idx].h_count == 0)\n  )\n    hydro = this.atoms[idx].h_count\n\n  var label = atom.label\n  if (atom.atomList && !atom.atomList.notList) {\n    label = atom.atomList.label()\n    needBrackets = false // atom list label already has brackets\n  } else if (atom.isPseudo() || (atom.atomList && atom.atomList.notList)) {\n    label = '*'\n    needBrackets = true\n  } else if (\n    chirality ||\n    atom.charge != 0 ||\n    atom.isotope > 0 ||\n    hydro >= 0 ||\n    aam > 0\n  ) {\n    needBrackets = true\n  }\n\n  if (needBrackets) {\n    if (hydro == -1) hydro = this.atoms[idx].h_count\n    this.smiles += '['\n  }\n\n  if (atom.isotope > 0) this.smiles += atom.isotope\n\n  if (lowercase) this.smiles += label.toLowerCase()\n  else this.smiles += label\n\n  if (chirality > 0) {\n    if (chirality == 1) this.smiles += '@'\n    // chirality == 2\n    else this.smiles += '@@'\n\n    if (atom.implicitH > 1)\n      throw new Error(atom.implicitH + ' implicit H near stereocenter')\n  }\n\n  if (atom.label != 'H') {\n    if (hydro > 1 || (hydro == 0 && !needBrackets)) this.smiles += 'H' + hydro\n    else if (hydro == 1) this.smiles += 'H'\n  }\n\n  if (atom.charge > 1) this.smiles += '+' + atom.charge\n  else if (atom.charge < -1) this.smiles += atom.charge\n  else if (atom.charge == 1) this.smiles += '+'\n  else if (atom.charge == -1) this.smiles += '-'\n\n  if (aam > 0) this.smiles += ':' + aam\n\n  if (needBrackets) this.smiles += ']'\n\n  /*\n\tif (mol.getRGroupFragment() != 0)\n\t{\n\t  for (i = 0; i < 2; i++)\n\t  {\n\t\t int j;\n\n\t\t for (j = 0; mol.getRGroupFragment()->getAttachmentPoint(i, j) != -1; j++)\n\t\t\tif (idx == mol.getRGroupFragment()->getAttachmentPoint(i, j))\n\t\t\t{\n\t\t\t   _output.printf(\"([*])\");\n\t\t\t   break;\n\t\t\t}\n\n\t\t if (mol.getRGroupFragment()->getAttachmentPoint(i, j) != -1)\n\t\t\tbreak;\n\t  }\n\t}\n\t*/\n}\n\nSmiles.prototype.markCisTrans = function (mol) {\n  this.cis_trans = new CisTrans(\n    mol,\n    function (idx) {\n      return this.atoms[idx].neighbours\n    },\n    this\n  )\n  this.cis_trans.build()\n  this.dbonds = new Array(mol.bonds.size)\n\n  mol.bonds.forEach((bond, bid) => {\n    this.dbonds[bid] = {\n      ctbond_beg: -1,\n      ctbond_end: -1,\n      saved: 0\n    }\n  })\n\n  this.cis_trans.each((ct, bid) => {\n    var bond = mol.bonds.get(bid)\n\n    if (ct.parity !== 0 && !this.isBondInRing(bid)) {\n      var neiBeg = this.atoms[bond.begin].neighbours\n      var neiEnd = this.atoms[bond.end].neighbours\n      var aromFailBeg = true\n      var aromFailEnd = true\n\n      neiBeg.forEach(nei => {\n        if (\n          nei.bid !== bid &&\n          mol.bonds.get(nei.bid).type === Bond.PATTERN.TYPE.SINGLE\n        )\n          aromFailBeg = false\n      })\n\n      neiEnd.forEach(nei => {\n        if (\n          nei.bid !== bid &&\n          mol.bonds.get(nei.bid).type === Bond.PATTERN.TYPE.SINGLE\n        )\n          aromFailEnd = false\n      })\n\n      if (aromFailBeg || aromFailEnd) return\n\n      neiBeg.forEach(nei => {\n        if (nei.bid === bid) return\n        if (mol.bonds.get(nei.bid).begin === bond.begin)\n          this.dbonds[nei.bid].ctbond_beg = bid\n        else this.dbonds[nei.bid].ctbond_end = bid\n      })\n\n      neiEnd.forEach(nei => {\n        if (nei.bid === bid) return\n        if (mol.bonds.get(nei.bid).begin === bond.end)\n          this.dbonds[nei.bid].ctbond_beg = bid\n        else this.dbonds[nei.bid].ctbond_end = bid\n      })\n    }\n  })\n}\n\nSmiles.prototype.updateSideBonds = function (mol, bondIdx) {\n  // eslint-disable-line max-statements\n  var bond = mol.bonds.get(bondIdx)\n  var subst = this.cis_trans.getSubstituents(bondIdx)\n  var parity = this.cis_trans.getParity(bondIdx)\n\n  var sidebonds = [-1, -1, -1, -1]\n\n  sidebonds[0] = mol.findBondId(subst[0], bond.begin)\n  if (subst[1] != -1) sidebonds[1] = mol.findBondId(subst[1], bond.begin)\n\n  sidebonds[2] = mol.findBondId(subst[2], bond.end)\n  if (subst[3] != -1) sidebonds[3] = mol.findBondId(subst[3], bond.end)\n\n  var n1 = 0\n  var n2 = 0\n  var n3 = 0\n  var n4 = 0\n\n  if (this.dbonds[sidebonds[0]].saved != 0) {\n    if (\n      (this.dbonds[sidebonds[0]].saved == 1 &&\n        mol.bonds.get(sidebonds[0]).begin == bond.begin) ||\n      (this.dbonds[sidebonds[0]].saved == 2 &&\n        mol.bonds.get(sidebonds[0]).end == bond.begin)\n    )\n      n1++\n    else n2++\n  }\n  if (sidebonds[1] != -1 && this.dbonds[sidebonds[1]].saved != 0) {\n    if (\n      (this.dbonds[sidebonds[1]].saved == 2 &&\n        mol.bonds.get(sidebonds[1]).begin == bond.begin) ||\n      (this.dbonds[sidebonds[1]].saved == 1 &&\n        mol.bonds.get(sidebonds[1]).end == bond.begin)\n    )\n      n1++\n    else n2++\n  }\n  if (this.dbonds[sidebonds[2]].saved != 0) {\n    if (\n      (this.dbonds[sidebonds[2]].saved == 1 &&\n        mol.bonds.get(sidebonds[2]).begin == bond.end) ||\n      (this.dbonds[sidebonds[2]].saved == 2 &&\n        mol.bonds.get(sidebonds[2]).end == bond.end)\n    )\n      n3++\n    else n4++\n  }\n  if (sidebonds[3] != -1 && this.dbonds[sidebonds[3]].saved != 0) {\n    if (\n      (this.dbonds[sidebonds[3]].saved == 2 &&\n        mol.bonds.get(sidebonds[3]).begin == bond.end) ||\n      (this.dbonds[sidebonds[3]].saved == 1 &&\n        mol.bonds.get(sidebonds[3]).end == bond.end)\n    )\n      n3++\n    else n4++\n  }\n\n  if (parity == CisTrans.PARITY.CIS) {\n    n1 += n3\n    n2 += n4\n  } else {\n    n1 += n4\n    n2 += n3\n  }\n\n  if (n1 > 0 && n2 > 0) throw new Error('incompatible cis-trans configuration')\n\n  if (n1 == 0 && n2 == 0) return false\n\n  if (n1 > 0) {\n    this.dbonds[sidebonds[0]].saved =\n      mol.bonds.get(sidebonds[0]).begin == bond.begin ? 1 : 2\n    if (sidebonds[1] != -1) {\n      this.dbonds[sidebonds[1]].saved =\n        mol.bonds.get(sidebonds[1]).begin == bond.begin ? 2 : 1\n    }\n\n    this.dbonds[sidebonds[2]].saved =\n      (mol.bonds.get(sidebonds[2]).begin == bond.end) ==\n      (parity == CisTrans.PARITY.CIS)\n        ? 1\n        : 2\n    if (sidebonds[3] != -1) {\n      this.dbonds[sidebonds[3]].saved =\n        (mol.bonds.get(sidebonds[3]).begin == bond.end) ==\n        (parity == CisTrans.PARITY.CIS)\n          ? 2\n          : 1\n    }\n  }\n  if (n2 > 0) {\n    this.dbonds[sidebonds[0]].saved =\n      mol.bonds.get(sidebonds[0]).begin == bond.begin ? 2 : 1\n    if (sidebonds[1] != -1) {\n      this.dbonds[sidebonds[1]].saved =\n        mol.bonds.get(sidebonds[1]).begin == bond.begin ? 1 : 2\n    }\n\n    this.dbonds[sidebonds[2]].saved =\n      (mol.bonds.get(sidebonds[2]).begin == bond.end) ==\n      (parity == CisTrans.PARITY.CIS)\n        ? 2\n        : 1\n    if (sidebonds[3] != -1) {\n      this.dbonds[sidebonds[3]].saved =\n        (mol.bonds.get(sidebonds[3]).begin == bond.end) ==\n        (parity == CisTrans.PARITY.CIS)\n          ? 1\n          : 2\n    }\n  }\n\n  return true\n}\n\nSmiles.prototype.calcBondDirection = function (mol, idx, vprev) {\n  var ntouched\n\n  if (this.dbonds[idx].ctbond_beg == -1 && this.dbonds[idx].ctbond_end == -1)\n    return 0\n\n  if (mol.bonds.get(idx).type != Bond.PATTERN.TYPE.SINGLE)\n    throw new Error('internal: directed bond type ' + mol.bonds.get(idx).type)\n\n  while (true) {\n    // eslint-disable-line no-constant-condition\n    ntouched = 0\n    this.cis_trans.each((ct, bid) => {\n      if (ct.parity !== 0 && !this.isBondInRing(bid)) {\n        if (this.updateSideBonds(mol, bid)) ntouched++\n      }\n    })\n    if (ntouched === this.touchedCistransbonds) break\n    this.touchedCistransbonds = ntouched\n  }\n\n  if (this.dbonds[idx].saved === 0) {\n    if (vprev === mol.bonds.get(idx).begin) this.dbonds[idx].saved = 1\n    else this.dbonds[idx].saved = 2\n  }\n\n  return this.dbonds[idx].saved\n}\n\nSmiles.prototype.writeRadicals = function (mol) {\n  // eslint-disable-line max-statements\n  var marked = new Array(this.writtenAtoms.length)\n  var i, j\n\n  for (i = 0; i < this.writtenAtoms.length; i++) {\n    if (marked[i]) continue // eslint-disable-line no-continue\n\n    var radical = mol.atoms.get(this.writtenAtoms[i]).radical\n\n    if (radical == 0) continue // eslint-disable-line no-continue\n\n    if (this.comma) {\n      this.smiles += ','\n    } else {\n      this.smiles += ' |'\n      this.comma = true\n    }\n\n    if (radical == Atom.PATTERN.RADICAL.SINGLET) this.smiles += '^3:'\n    else if (radical == Atom.PATTERN.RADICAL.DOUPLET) this.smiles += '^1:'\n    // RADICAL_TRIPLET\n    else this.smiles += '^4:'\n\n    this.smiles += i\n\n    for (j = i + 1; j < this.writtenAtoms.length; j++) {\n      if (mol.atoms.get(this.writtenAtoms[j]).radical == radical) {\n        marked[j] = true\n        this.smiles += ',' + j\n      }\n    }\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Serializer } from '../serializers.types'\nimport { SmiSerializerOptions } from './smi.types'\nimport { Smiles } from './Smiles'\nimport { Struct } from 'domain/entities'\n\nexport class SmiSerializer implements Serializer<Struct> {\n  static DefaultOptions: SmiSerializerOptions = {\n    ignoreErrors: false\n  }\n\n  private readonly options: SmiSerializerOptions\n\n  constructor(options?: Partial<SmiSerializerOptions>) {\n    this.options = { ...SmiSerializer.DefaultOptions, ...options }\n  }\n\n  deserialize(_content: string): Struct {\n    throw new Error('Not implemented yet.')\n  }\n\n  serialize(struct: Struct): string {\n    return new Smiles().saveMolecule(struct, this.options.ignoreErrors)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { SdfItem, StructAssociatedData } from './sdf.types'\n\nimport { MolSerializer } from '../mol/MolSerializer'\nimport { Serializer } from '../serializers.types'\n\nconst DelimeterRegex = /^[^]+?\\$\\$\\$\\$$/gm\nexport class SdfSerializer implements Serializer<Array<SdfItem>> {\n  deserialize(content: string): Array<SdfItem> {\n    let m: any\n    const result: Array<SdfItem> = []\n    const molSerializer = new MolSerializer()\n    while ((m = DelimeterRegex.exec(content)) !== null) {\n      const chunk = m[0].replace(/\\r/g, '').trim() // TODO: normalize newline?\n      var end = chunk.indexOf('M  END')\n      if (end !== -1) {\n        const propChunks: any = chunk\n          .substr(end + 7)\n          .trim()\n          .split(/^$\\n?/m)\n\n        const struct = molSerializer.deserialize(chunk.substring(0, end + 6))\n        const props = propChunks.reduce(\n          (acc: StructAssociatedData, pc: string) => {\n            var m = pc.match(/^> [ \\d]*<(\\S+)>/)\n            if (m) {\n              const field = m[1]\n              const value = pc.split('\\n')[1].trim()\n              acc[field] = Number.isFinite(value) ? +value : value.toString() // eslint-disable-line\n            }\n            return acc\n          },\n          {} as StructAssociatedData\n        )\n\n        result.push({ struct, props })\n      }\n    }\n    return result\n  }\n\n  serialize(sdfItems: Array<SdfItem>): string {\n    const molSerializer = new MolSerializer()\n    return sdfItems.reduce((res, item) => {\n      res += molSerializer.serialize(item.struct)\n\n      Object.keys(item.props).forEach(prop => {\n        res += '> <' + prop + '>\\n'\n        res += item.props[prop] + '\\n\\n'\n      })\n\n      return res + '$$$$'\n    }, '')\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nexport enum ChemicalMimeType {\n  Mol = 'chemical/x-mdl-molfile',\n  Rxn = 'chemical/x-mdl-rxnfile',\n  DaylightSmiles = 'chemical/x-daylight-smiles',\n  ExtendedSmiles = 'chemical/x-chemaxon-cxsmiles',\n  DaylightSmarts = 'chemical/x-daylight-smarts',\n  InChI = 'chemical/x-inchi',\n  InChIAuxInfo = 'chemical/x-inchi-aux',\n  CML = 'chemical/x-cml',\n  KET = 'application/json'\n}\n\nexport interface WithStruct {\n  struct: string\n}\n\nexport interface WithFormat {\n  format: ChemicalMimeType\n}\n\nexport interface WithSelection {\n  selected?: Array<number>\n}\n\nexport interface CheckData extends WithStruct {\n  types: Array<string>\n}\n\nexport interface CheckResult {\n  [key: string]: string\n}\n\nexport interface ConvertData extends WithStruct {\n  output_format: ChemicalMimeType\n}\n\nexport interface ConvertResult extends WithStruct, WithFormat {}\n\nexport interface LayoutData extends WithStruct {}\n\nexport interface LayoutResult extends WithStruct, WithFormat {}\n\nexport interface CleanData extends WithStruct, WithSelection {}\n\nexport interface CleanResult extends WithStruct, WithFormat {}\n\nexport interface AromatizeData extends WithStruct {}\n\nexport interface AromatizeResult extends WithStruct, WithFormat {}\n\nexport interface DearomatizeData extends WithStruct {}\n\nexport interface DearomatizeResult extends WithStruct, WithFormat {}\n\nexport interface CalculateCipData extends WithStruct {}\n\nexport interface CalculateCipResult extends WithStruct, WithFormat {}\n\nexport interface CalculateData extends WithStruct, WithSelection {\n  properties: Array<string>\n}\n\nexport interface CalculateResult {\n  [key: string]: string | number | boolean\n}\n\nexport interface AutomapData extends WithStruct {\n  mode: string\n}\n\nexport interface AutomapResult extends WithStruct, WithFormat {}\n\nexport interface InfoResult {\n  indigoVersion: string\n  imagoVersions: Array<string>\n  isAvailable: boolean\n}\n\nexport interface RecognizeResult extends WithStruct {}\n\nexport interface StructServiceOptions {\n  [key: string]: string | number | boolean\n}\n\nexport type OutputFormatType = 'png' | 'svg'\nexport interface GenerateImageOptions extends StructServiceOptions {\n  outputFormat: OutputFormatType\n}\n\nexport interface StructService {\n  info: () => Promise<InfoResult>\n  convert: (\n    data: ConvertData,\n    options?: StructServiceOptions\n  ) => Promise<ConvertResult>\n  layout: (\n    data: LayoutData,\n    options?: StructServiceOptions\n  ) => Promise<LayoutResult>\n  clean: (\n    data: CleanData,\n    options?: StructServiceOptions\n  ) => Promise<CleanResult>\n  aromatize: (\n    data: AromatizeData,\n    options?: StructServiceOptions\n  ) => Promise<AromatizeResult>\n  dearomatize: (\n    data: DearomatizeData,\n    options?: StructServiceOptions\n  ) => Promise<DearomatizeResult>\n  calculateCip: (\n    data: CalculateCipData,\n    options?: StructServiceOptions\n  ) => Promise<CalculateCipResult>\n  automap: (\n    data: AutomapData,\n    options?: StructServiceOptions\n  ) => Promise<AutomapResult>\n  check: (\n    data: CheckData,\n    options?: StructServiceOptions\n  ) => Promise<CheckResult>\n  calculate: (\n    data: CalculateData,\n    options?: StructServiceOptions\n  ) => Promise<CalculateResult>\n  recognize: (blob: Blob, version: string) => Promise<RecognizeResult>\n  generateImageAsBase64: (\n    data: string,\n    options?: GenerateImageOptions\n  ) => Promise<string>\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Vec2 } from 'domain/entities'\n\nexport interface ScaleOptions {\n  scale: number\n}\n\nfunction scaled2obj(v: Vec2, options: ScaleOptions): Vec2 {\n  return v.scaled(1 / options.scale)\n}\n\nfunction obj2scaled(v: Vec2, options: ScaleOptions): Vec2 {\n  return v.scaled(options.scale)\n}\n\nexport const Scale = {\n  scaled2obj,\n  obj2scaled\n}\n","import { Bond } from '../../entities/Bond'\nimport { Struct, Neighbor } from '../../entities/Struct'\n\nfunction isCorrectStereoCenter(\n  bond: Bond,\n  beginNeighs: Array<Neighbor> | undefined,\n  endNeighs: Array<Neighbor> | undefined,\n  struct: Struct\n) {\n  const beginAtom = struct.atoms.get(bond.begin)\n\n  let EndAtomNeigh: number | undefined = NaN\n\n  if (endNeighs?.length === 2) {\n    EndAtomNeigh =\n      endNeighs[0].aid === bond.begin ? endNeighs[1].aid : endNeighs[0].aid\n  }\n\n  if (bond.stereo > 0) {\n    if (\n      endNeighs?.length === 1 &&\n      beginNeighs?.length === 2 &&\n      Number(beginAtom?.implicitH) % 2 === 0\n    ) {\n      return false\n    }\n\n    if (\n      endNeighs?.length === 2 &&\n      beginNeighs?.length === 2 &&\n      Number(beginAtom?.implicitH) % 2 === 0 &&\n      struct.atomGetNeighbors(EndAtomNeigh)?.length === 1\n    ) {\n      return false\n    }\n\n    if (beginNeighs?.length === 1) {\n      return false\n    }\n\n    return true\n  } else {\n    return false\n  }\n}\n\nexport const StereoValidator = {\n  isCorrectStereoCenter\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport {\n  AromatizeData,\n  AromatizeResult,\n  AutomapData,\n  AutomapResult,\n  CalculateCipData,\n  CalculateCipResult,\n  CalculateData,\n  CalculateResult,\n  CheckData,\n  CheckResult,\n  CleanData,\n  CleanResult,\n  ConvertData,\n  ConvertResult,\n  DearomatizeData,\n  DearomatizeResult,\n  GenerateImageOptions,\n  InfoResult,\n  LayoutData,\n  LayoutResult,\n  OutputFormatType,\n  RecognizeResult,\n  StructService,\n  StructServiceOptions\n} from 'domain/services'\n\nfunction pollDeferred(process, complete, timeGap, startTimeGap) {\n  return new Promise((resolve, reject) => {\n    function iterate() {\n      process().then(\n        val => {\n          try {\n            if (complete(val)) resolve(val)\n            else setTimeout(iterate, timeGap)\n          } catch (e) {\n            reject(e)\n          }\n        },\n        err => reject(err)\n      )\n    }\n    setTimeout(iterate, startTimeGap || 0)\n  })\n}\n\nfunction parametrizeUrl(url, params) {\n  return url.replace(/:(\\w+)/g, (_, val) => params[val])\n}\n\nfunction request(\n  method: string,\n  url: string,\n  data?: any,\n  headers?: any,\n  responseHandler?: (promise: Promise<any>) => Promise<any>\n) {\n  let requestUrl = url\n  if (data && method === 'GET') requestUrl = parametrizeUrl(url, data)\n  let response: any = fetch(requestUrl, {\n    method,\n    headers: Object.assign(\n      {\n        Accept: 'application/json'\n      },\n      headers\n    ),\n    body: method !== 'GET' ? data : undefined,\n    credentials: 'same-origin'\n  })\n\n  if (responseHandler) {\n    response = responseHandler(response)\n  } else {\n    response = response.then(response =>\n      response\n        .json()\n        .then(res => (response.ok ? res : Promise.reject(res.error)))\n    )\n  }\n\n  return response.catch(err => {\n    throw Error(err)\n  })\n}\n\nfunction indigoCall(\n  method: string,\n  url: string,\n  baseUrl: string,\n  defaultOptions: any\n) {\n  return function (\n    data,\n    options,\n    responseHandler?: (promise: Promise<any>) => Promise<any>\n  ) {\n    const body = Object.assign({}, data)\n    body.options = Object.assign(body.options || {}, defaultOptions, options)\n    return request(\n      method,\n      baseUrl + url,\n      JSON.stringify(body),\n      {\n        'Content-Type': 'application/json'\n      },\n      responseHandler\n    )\n  }\n}\n\nexport class RemoteStructService implements StructService {\n  private readonly apiPath: string\n  private readonly defaultOptions: StructServiceOptions\n\n  constructor(apiPath: string, defaultOptions: StructServiceOptions) {\n    this.apiPath = apiPath\n    this.defaultOptions = defaultOptions\n  }\n\n  async info(): Promise<InfoResult> {\n    let indigoVersion: string\n    let imagoVersions: Array<string>\n    let isAvailable: boolean = false\n\n    try {\n      const response = await request('GET', this.apiPath + 'info')\n      indigoVersion = response['indigo_version']\n      imagoVersions = response['imago_versions']\n      isAvailable = true\n    } catch (e) {\n      indigoVersion = ''\n      imagoVersions = []\n      isAvailable = false\n    }\n\n    return {\n      indigoVersion,\n      imagoVersions,\n      isAvailable\n    }\n  }\n\n  convert(\n    data: ConvertData,\n    options?: StructServiceOptions\n  ): Promise<ConvertResult> {\n    return indigoCall(\n      'POST',\n      'indigo/convert',\n      this.apiPath,\n      this.defaultOptions\n    )(data, options)\n  }\n\n  layout(\n    data: LayoutData,\n    options?: StructServiceOptions\n  ): Promise<LayoutResult> {\n    return indigoCall(\n      'POST',\n      'indigo/layout',\n      this.apiPath,\n      this.defaultOptions\n    )(data, options)\n  }\n\n  clean(data: CleanData, options?: StructServiceOptions): Promise<CleanResult> {\n    return indigoCall(\n      'POST',\n      'indigo/clean',\n      this.apiPath,\n      this.defaultOptions\n    )(data, options)\n  }\n\n  aromatize(\n    data: AromatizeData,\n    options?: StructServiceOptions\n  ): Promise<AromatizeResult> {\n    return indigoCall(\n      'POST',\n      'indigo/aromatize',\n      this.apiPath,\n      this.defaultOptions\n    )(data, options)\n  }\n\n  dearomatize(\n    data: DearomatizeData,\n    options?: StructServiceOptions\n  ): Promise<DearomatizeResult> {\n    return indigoCall(\n      'POST',\n      'indigo/dearomatize',\n      this.apiPath,\n      this.defaultOptions\n    )(data, options)\n  }\n\n  calculateCip(\n    data: CalculateCipData,\n    options?: StructServiceOptions\n  ): Promise<CalculateCipResult> {\n    return indigoCall(\n      'POST',\n      'indigo/calculate_cip',\n      this.apiPath,\n      this.defaultOptions\n    )(data, options)\n  }\n\n  automap(\n    data: AutomapData,\n    options?: StructServiceOptions\n  ): Promise<AutomapResult> {\n    return indigoCall(\n      'POST',\n      'indigo/automap',\n      this.apiPath,\n      this.defaultOptions\n    )(data, options)\n  }\n\n  check(data: CheckData, options?: StructServiceOptions): Promise<CheckResult> {\n    return indigoCall(\n      'POST',\n      'indigo/check',\n      this.apiPath,\n      this.defaultOptions\n    )(data, options)\n  }\n\n  calculate(\n    data: CalculateData,\n    options?: StructServiceOptions\n  ): Promise<CalculateResult> {\n    return indigoCall(\n      'POST',\n      'indigo/calculate',\n      this.apiPath,\n      this.defaultOptions\n    )(data, options)\n  }\n\n  recognize(blob: Blob, version: string): Promise<RecognizeResult> {\n    const parVersion = version ? `?version=${version}` : ''\n    const req = request(\n      'POST',\n      this.apiPath + `imago/uploads${parVersion}`,\n      blob,\n      {\n        'Content-Type': blob.type || 'application/octet-stream'\n      }\n    )\n    const status = request.bind(null, 'GET', this.apiPath + 'imago/uploads/:id')\n    return req\n      .then(data =>\n        pollDeferred(\n          status.bind(null, { id: data.upload_id }),\n          (response: any) => {\n            if (response.state === 'FAILURE') throw response\n            return response.state === 'SUCCESS'\n          },\n          500,\n          300\n        )\n      )\n      .then((response: any) => ({ struct: response.metadata.mol_str }))\n  }\n\n  generateImageAsBase64(\n    data: string,\n    options?: GenerateImageOptions\n  ): Promise<string> {\n    const outputFormat: OutputFormatType = options?.outputFormat || 'png'\n    return indigoCall(\n      'POST',\n      'indigo/render',\n      this.apiPath,\n      this.defaultOptions\n    )({ struct: data }, { 'render-output-format': outputFormat }, response =>\n      response\n        .then(resp => resp.text())\n        //TODO: Indigo does not encode svg to base64. This code should be deleted after fix\n        .then(text => {\n          if (outputFormat === 'svg') {\n            return btoa(text)\n          } else {\n            return text\n          }\n        })\n    )\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport {\n  ServiceMode,\n  StructService,\n  StructServiceOptions,\n  StructServiceProvider\n} from 'domain/services'\n\nimport { RemoteStructService } from './RemoteStructService'\n\nexport class RemoteStructServiceProvider implements StructServiceProvider {\n  private readonly apiPath: string\n  mode: ServiceMode = 'remote'\n\n  constructor(apiPath: string) {\n    let currentApiPath = apiPath\n    const params = new URLSearchParams(document.location.search)\n    if (params.has('api_path')) {\n      currentApiPath = params.get('api_path')!\n    }\n    this.apiPath =\n      !currentApiPath || /\\/$/.test(currentApiPath)\n        ? currentApiPath\n        : currentApiPath + '/'\n  }\n\n  createStructService(options: StructServiceOptions): StructService {\n    return new RemoteStructService(this.apiPath, options)\n  }\n}\n","import { ChemicalMimeType } from 'domain/services'\n\nexport class SupportedFormatProperties {\n  name: string\n  mime: ChemicalMimeType\n  extensions: string[]\n  supportsCoords?: boolean\n  options?: any\n\n  constructor(\n    name: string,\n    mime: ChemicalMimeType,\n    extensions: string[],\n    supportsCoords?: boolean,\n    options?: any\n  ) {\n    this.name = name\n    this.mime = mime\n    this.extensions = extensions\n    this.supportsCoords = supportsCoords || false\n    this.options = options || {}\n  }\n}\n","import { ChemicalMimeType } from 'domain/services'\nimport { SupportedFormat } from './structFormatter.types'\nimport { SupportedFormatProperties } from './SupportedFormatProperties'\n\ntype FormatPropertiesMap = {\n  [key in SupportedFormat]: SupportedFormatProperties\n}\n\nconst formatProperties: FormatPropertiesMap = {\n  mol: new SupportedFormatProperties(\n    'MDL Molfile V2000',\n    ChemicalMimeType.Mol,\n    ['.mol'],\n    true\n  ),\n  molV3000: new SupportedFormatProperties(\n    'MDL Molfile V3000',\n    ChemicalMimeType.Mol,\n    ['.mol'],\n    true,\n    { 'molfile-saving-mode': '3000' }\n  ),\n  rxn: new SupportedFormatProperties(\n    'MDL Rxnfile V2000',\n    ChemicalMimeType.Rxn,\n    ['.rxn'],\n    true\n  ),\n  rxnV3000: new SupportedFormatProperties(\n    'MDL Rxnfile V3000',\n    ChemicalMimeType.Rxn,\n    ['.rxn'],\n    true,\n    { 'molfile-saving-mode': '3000' }\n  ),\n  smiles: new SupportedFormatProperties(\n    'Daylight SMILES',\n    ChemicalMimeType.DaylightSmiles,\n    ['.smi', '.smiles']\n  ),\n  smilesExt: new SupportedFormatProperties(\n    'Extended SMILES',\n    ChemicalMimeType.ExtendedSmiles,\n    ['.cxsmi', '.cxsmiles']\n  ),\n  smarts: new SupportedFormatProperties(\n    'Daylight SMARTS',\n    ChemicalMimeType.DaylightSmarts,\n    ['.smarts']\n  ),\n  inChI: new SupportedFormatProperties('InChI', ChemicalMimeType.InChI, [\n    '.inchi'\n  ]),\n  inChIAuxInfo: new SupportedFormatProperties(\n    'InChI AuxInfo',\n    ChemicalMimeType.InChIAuxInfo,\n    ['.inchi']\n  ),\n  cml: new SupportedFormatProperties(\n    'CML',\n    ChemicalMimeType.CML,\n    ['.cml', '.mrv'],\n    true\n  ),\n  graph: new SupportedFormatProperties('Graph Format', ChemicalMimeType.KET, [\n    '.ket'\n  ])\n}\n\nfunction getPropertiesByFormat(format: SupportedFormat) {\n  return formatProperties[format]\n}\n\nexport { formatProperties, getPropertiesByFormat }\n","import { KetSerializer } from 'domain/serializers'\nimport { Struct } from 'domain/entities'\nimport { StructFormatter } from './structFormatter.types'\n\nexport class GraphFormatter implements StructFormatter {\n  constructor(private readonly serializer: KetSerializer) {}\n\n  async getStructureFromStructAsync(struct: Struct): Promise<string> {\n    const graph = this.serializer.serialize(struct)\n    return graph\n  }\n\n  async getStructureFromStringAsync(content: string): Promise<Struct> {\n    return this.serializer.deserialize(content)\n  }\n}\n","import { MolSerializer } from 'domain/serializers'\nimport { Struct } from 'domain/entities'\nimport { StructFormatter } from './structFormatter.types'\n\nexport class MolfileV2000Formatter implements StructFormatter {\n  constructor(private readonly molfileManager: MolSerializer) {}\n\n  async getStructureFromStructAsync(struct: Struct): Promise<string> {\n    const stringifiedMolfile = this.molfileManager.serialize(struct)\n    return stringifiedMolfile\n  }\n\n  async getStructureFromStringAsync(\n    stringifiedStruct: string\n  ): Promise<Struct> {\n    const struct = this.molfileManager.deserialize(stringifiedStruct)\n    return struct\n  }\n}\n","import { MolSerializer } from 'domain/serializers'\nimport { Struct } from 'domain/entities'\nimport { StructFormatter } from './structFormatter.types'\n\nexport class RxnFormatter implements StructFormatter {\n  constructor(private readonly molfileManager: MolSerializer) {}\n\n  async getStructureFromStructAsync(struct: Struct): Promise<string> {\n    const stringifiedMolfile = this.molfileManager.serialize(struct)\n    return stringifiedMolfile\n  }\n\n  async getStructureFromStringAsync(\n    stringifiedStruct: string\n  ): Promise<Struct> {\n    const struct = this.molfileManager.deserialize(stringifiedStruct)\n    return struct\n  }\n}\n","import {\n  ConvertData,\n  ConvertResult,\n  LayoutData,\n  LayoutResult,\n  StructService,\n  StructServiceOptions\n} from 'domain/services'\nimport { StructFormatter, SupportedFormat } from './structFormatter.types'\n\nimport { MolSerializer } from 'domain/serializers'\nimport { Struct } from 'domain/entities'\nimport { getPropertiesByFormat } from './formatProperties'\n\nexport class ServerFormatter implements StructFormatter {\n  constructor(\n    private readonly structService: StructService,\n    private readonly molfileManager: MolSerializer,\n    private readonly format: SupportedFormat,\n    private readonly options?: StructServiceOptions\n  ) {}\n\n  async getStructureFromStructAsync(struct: Struct): Promise<string> {\n    const infoResult = await this.structService.info()\n    if (!infoResult.isAvailable) {\n      throw new Error('Server is not available')\n    }\n\n    const formatProperties = getPropertiesByFormat(this.format)\n\n    try {\n      const stringifiedStruct = this.molfileManager.serialize(struct)\n      const convertResult = await this.structService.convert(\n        {\n          struct: stringifiedStruct,\n          output_format: formatProperties.mime\n        },\n        { ...this.options, ...formatProperties.options }\n      )\n\n      return convertResult.struct\n    } catch (error) {\n      let message\n      if (error.message === 'Server is not compatible') {\n        message = `${formatProperties.name} is not supported.`\n      } else {\n        message = `Convert error!\\n${error.message || error}`\n      }\n\n      throw new Error(message)\n    }\n  }\n\n  async getStructureFromStringAsync(\n    stringifiedStruct: string\n  ): Promise<Struct> {\n    const infoResult = await this.structService.info()\n    if (!infoResult.isAvailable) {\n      throw new Error('Server is not available')\n    }\n\n    type ConvertPromise = (\n      data: ConvertData,\n      options?: StructServiceOptions\n    ) => Promise<ConvertResult>\n\n    type LayoutPromise = (\n      data: LayoutData,\n      options?: StructServiceOptions\n    ) => Promise<LayoutResult>\n\n    let promise: LayoutPromise | ConvertPromise\n\n    let data: ConvertData | LayoutData = {\n      struct: undefined as any,\n      output_format: getPropertiesByFormat('mol').mime\n    }\n\n    const withCoords = getPropertiesByFormat(this.format).supportsCoords\n    if (withCoords) {\n      promise = this.structService.convert\n      data.struct = stringifiedStruct\n    } else {\n      promise = this.structService.layout\n      data.struct = stringifiedStruct.trim()\n    }\n\n    try {\n      const result = await promise(data, this.options)\n      const parsedStruct = this.molfileManager.deserialize(result.struct)\n      if (!withCoords) {\n        parsedStruct.rescale()\n      }\n      return parsedStruct\n    } catch (error) {\n      if (error.message !== 'Server is not compatible') {\n        throw Error(`Convert error!\\n${error.message || error}`)\n      }\n\n      const formatError =\n        this.format === 'smiles'\n          ? `${getPropertiesByFormat('smilesExt').name} and opening of ${\n              getPropertiesByFormat('smiles').name\n            }`\n          : getPropertiesByFormat(this.format).name\n\n      throw Error(`${formatError} is not supported in standalone mode.`)\n    }\n  }\n}\n","import { MolSerializer, SmiSerializer } from 'domain/serializers'\nimport { StructFormatter, SupportedFormat } from './structFormatter.types'\nimport { StructService, StructServiceOptions } from 'domain/services'\n\nimport { ServerFormatter } from './ServerFormatter'\nimport { Struct } from 'domain/entities'\n\nexport class SmilesFormatter implements StructFormatter {\n  constructor(\n    private readonly smiSerializer: SmiSerializer,\n\n    // only for ServerFormatter\n\n    private readonly structService: StructService,\n    private readonly molfileManager: MolSerializer,\n    private readonly format: SupportedFormat,\n    private readonly options?: StructServiceOptions\n  ) {}\n\n  async getStructureFromStructAsync(struct: Struct): Promise<string> {\n    const stringifiedMolfile = this.smiSerializer.serialize(struct)\n    return stringifiedMolfile\n  }\n\n  getStructureFromStringAsync(stringifiedStruct: string): Promise<Struct> {\n    const serverFormatter = new ServerFormatter(\n      this.structService,\n      this.molfileManager,\n      this.format,\n      this.options\n    )\n\n    return serverFormatter.getStructureFromStringAsync(stringifiedStruct)\n  }\n}\n","import {\n  FormatterFactoryOptions,\n  StructFormatter,\n  SupportedFormat\n} from './structFormatter.types'\nimport {\n  KetSerializer,\n  MolSerializer,\n  MolSerializerOptions,\n  SmiSerializer\n} from 'domain/serializers'\nimport { StructService, StructServiceOptions } from 'domain/services'\n\nimport { GraphFormatter } from './GraphFormatter'\nimport { MolfileV2000Formatter } from './MolfileV2000Formatter'\nimport { RxnFormatter } from './RxnFormatter'\nimport { ServerFormatter } from './ServerFormatter'\nimport { SmilesFormatter } from './SmilesFormatter'\n\nexport class FormatterFactory {\n  constructor(private readonly structService: StructService) {}\n\n  private separateOptions(\n    options?: FormatterFactoryOptions\n  ): [Partial<MolSerializerOptions>, StructServiceOptions | {}] {\n    if (!options) {\n      return [{}, {}]\n    }\n\n    const {\n      reactionRelayout,\n      badHeaderRecover,\n      ...structServiceOptions\n    } = options\n\n    let molfileParseOptions: Partial<MolSerializerOptions> = {}\n\n    if (typeof reactionRelayout === 'boolean') {\n      molfileParseOptions.reactionRelayout = reactionRelayout\n    }\n    if (typeof badHeaderRecover === 'boolean') {\n      molfileParseOptions.badHeaderRecover = badHeaderRecover\n    }\n\n    return [molfileParseOptions, structServiceOptions]\n  }\n\n  create(\n    format: SupportedFormat,\n    options?: FormatterFactoryOptions\n  ): StructFormatter {\n    const [molSerializerOptions, structServiceOptions] = this.separateOptions(\n      options\n    )\n\n    let formatter: StructFormatter\n    switch (format) {\n      case 'graph':\n        formatter = new GraphFormatter(new KetSerializer())\n        break\n\n      case 'mol':\n        formatter = new MolfileV2000Formatter(\n          new MolSerializer(molSerializerOptions)\n        )\n        break\n\n      case 'rxn':\n        formatter = new RxnFormatter(new MolSerializer(molSerializerOptions))\n        break\n\n      case 'smiles':\n        formatter = new SmilesFormatter(\n          new SmiSerializer(),\n\n          // only for ServerFormatter, because 'getStructureFromStringAsync' is delegated to it\n\n          this.structService,\n          new MolSerializer(molSerializerOptions),\n          format,\n          structServiceOptions\n        )\n        break\n\n      case 'cml':\n      case 'inChIAuxInfo':\n      case 'inChI':\n      case 'molV3000':\n      case 'rxnV3000':\n      case 'smilesExt':\n      case 'smarts':\n      default:\n        formatter = new ServerFormatter(\n          this.structService,\n          new MolSerializer(molSerializerOptions),\n          format,\n          structServiceOptions\n        )\n    }\n\n    return formatter\n  }\n}\n","import { SupportedFormat } from './structFormatter.types'\n\nexport function identifyStructFormat(\n  stringifiedStruct: string\n): SupportedFormat {\n  // Mimic Indigo/molecule_auto_loader.cpp as much as possible\n  const sanitizedString = stringifiedStruct.trim()\n\n  try {\n    if (JSON.parse(sanitizedString)) {\n      return 'graph'\n    }\n  } catch (er) {} // eslint-disable-line\n\n  if (sanitizedString.indexOf('$RXN') !== -1) {\n    return 'rxn'\n  }\n\n  const match = sanitizedString.match(/^(M {2}END|\\$END MOL)$/m)\n\n  if (match) {\n    const end = (match.index || 0) + match[0].length\n    if (\n      end === sanitizedString.length ||\n      sanitizedString.slice(end, end + 20).search(/^\\$(MOL|END CTAB)$/m) !== -1\n    ) {\n      return 'mol'\n    }\n  }\n  if (\n    sanitizedString[0] === '<' &&\n    sanitizedString.indexOf('<molecule') !== -1\n  ) {\n    return 'cml'\n  }\n\n  if (sanitizedString.slice(0, 5) === 'InChI') {\n    return 'inChI'\n  }\n\n  if (sanitizedString.indexOf('\\n') === -1) {\n    // TODO: smiles regexp\n    return 'smiles'\n  }\n\n  // Molfile by default as Indigo does\n  return 'mol'\n}\n","import 'miew/dist/Miew.min.css'\nimport 'ketcher-react/dist/index.css'\n\n// @ts-ignore\nimport { Editor } from 'ketcher-react'\n// @ts-ignore\nimport Miew from 'miew'\nimport React from 'react'\n// @ts-ignore\nimport { RemoteStructServiceProvider } from 'ketcher-core'\n;(global as any).Miew = Miew\n\nlet structServiceProvider: any = new RemoteStructServiceProvider(\n  process.env.API_PATH || process.env.REACT_APP_API_PATH!\n)\nif (process.env.MODE === 'standalone') {\n  const { StandaloneStructServiceProvider } = require('ketcher-standalone')\n  structServiceProvider = new StandaloneStructServiceProvider()\n}\n\nconst App = () => {\n  return (\n    <Editor\n      staticResourcesUrl={process.env.PUBLIC_URL}\n      structServiceProvider={structServiceProvider}\n    />\n  )\n}\n\nexport default App\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nexport enum LayerMap {\n  background = 'background',\n  selectionPlate = 'selectionPlate',\n  highlighting = 'highlighting',\n  warnings = 'warnings',\n  data = 'data',\n  indices = 'indices'\n}\n\nexport enum StereoColoringType {\n  LabelsOnly = 'LabelsOnly',\n  BondsOnly = 'BondsOnly',\n  LabelsAndBonds = 'LabelsAndBonds',\n  Off = 'Off'\n}\n\nexport enum StereLabelStyleType {\n  IUPAC = 'Iupac',\n  Classic = 'Classic',\n  On = 'On',\n  Off = 'Off'\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\n// Single entry point to Raphaël library\n\nimport Raphael from 'raphael'\nimport { Vec2 } from 'ketcher-core'\n\n// TODO: refactor ugly prototype extensions to plain old functions\nRaphael.el.translateAbs = function (x, y) {\n  this.delta = this.delta || new Vec2()\n  this.delta.x += x - 0\n  this.delta.y += y - 0\n  this.transform('t' + this.delta.x.toString() + ',' + this.delta.y.toString())\n}\n\nRaphael.st.translateAbs = function (x, y) {\n  this.forEach(el => {\n    el.translateAbs(x, y)\n  })\n}\n\nexport default Raphael\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\n// Visel is a shorthand for VISual ELement\n// It corresponds to a visualization (i.e. set of paths) of an atom or a bond.\nimport { Box2Abs, Vec2 } from 'ketcher-core'\n\nclass Visel {\n  constructor(type) {\n    this.type = type\n    this.paths = []\n    this.boxes = []\n    this.boundingBox = null\n    this.exts = []\n  }\n  add(path, bb, ext) {\n    this.paths.push(path)\n    if (bb) {\n      this.boxes.push(bb)\n      this.boundingBox =\n        this.boundingBox == null ? bb : Box2Abs.union(this.boundingBox, bb)\n    }\n    if (ext) this.exts.push(ext)\n  }\n  clear() {\n    this.paths = []\n    this.boxes = []\n    this.exts = []\n    this.boundingBox = null\n  }\n  translate(x, y) {\n    if (arguments.length > 2)\n      // TODO: replace to debug time assert\n      throw new Error('One vector or two scalar arguments expected')\n    if (y === undefined) {\n      this.translate(x.x, x.y)\n    } else {\n      var delta = new Vec2(x, y)\n      for (var i = 0; i < this.paths.length; ++i)\n        this.paths[i].translateAbs(x, y)\n      for (var j = 0; j < this.boxes.length; ++j)\n        this.boxes[j] = this.boxes[j].translate(delta)\n      if (this.boundingBox !== null)\n        this.boundingBox = this.boundingBox.translate(delta)\n    }\n  }\n}\n\nexport default Visel\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Box2Abs, Scale } from 'ketcher-core'\n\nimport ReStruct from './index'\nimport Render from '..'\nimport Visel from './visel'\n\nclass ReObject {\n  public visel: Visel\n  public highlight: boolean = false\n  public highlighting: any = null\n  public selected: boolean = false\n  public selectionPlate: any = null\n\n  constructor(viselType: string) {\n    this.visel = new Visel(viselType)\n  }\n\n  getVBoxObj(render: Render): Box2Abs | null {\n    var vbox = this.visel.boundingBox\n    if (vbox === null) return null\n    if (render.options.offset)\n      vbox = vbox.translate(render.options.offset.negated())\n    return vbox.transform(Scale.scaled2obj, render.options)\n  }\n\n  setHighlight(highLight: boolean, render: Render): void {\n    // TODO render should be field\n    if (highLight) {\n      let noredraw = 'highlighting' in this && this.highlighting !== null // && !this.highlighting.removed;\n      if (noredraw) {\n        if (this.highlighting.type === 'set') {\n          if (!this.highlighting[0]) return\n          noredraw = !this.highlighting[0].removed\n        } else {\n          noredraw = !this.highlighting.removed\n        }\n      }\n      if (noredraw) {\n        this.highlighting.show()\n      } else {\n        render.paper.setStart()\n        this.drawHighlight(render)\n        this.highlighting = render.paper.setFinish()\n      }\n    } else if (this.highlighting) {\n      this.highlighting.hide()\n    }\n\n    this.highlight = highLight\n  }\n\n  // @ts-ignore\n  drawHighlight(render: Render): any {\n    console.assert(null, 'ReObject.drawHighlight is not overridden') // eslint-disable-line no-console\n  }\n\n  // @ts-ignore\n  makeSelectionPlate(restruct: ReStruct, paper: any, styles: any): any {\n    console.assert(null, 'ReObject.makeSelectionPlate is not overridden') // eslint-disable-line no-console\n  }\n}\n\nexport default ReObject\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Vec2 } from 'ketcher-core'\n\nfunction tfx(v) {\n  return parseFloat(v).toFixed(8)\n}\n\nfunction relBox(box) {\n  return {\n    x: box.x,\n    y: box.y,\n    width: box.width,\n    height: box.height\n  }\n}\n\n/**\n * Finds intersection of a ray and a box and\n * Returns the shift magnitude to avoid it\n * @param p { Vec2 }\n * @param d { Vec2 }\n * @param bb { Box2Abs }\n */\nfunction shiftRayBox(p, d, bb) {\n  console.assert(!!p)\n  console.assert(!!d)\n  console.assert(!!bb)\n\n  // four corner points of the box\n  const b = [\n    bb.p0,\n    new Vec2(bb.p1.x, bb.p0.y),\n    bb.p1,\n    new Vec2(bb.p0.x, bb.p1.y)\n  ]\n\n  const r = b.map(v => v.sub(p)) // b relative to p\n\n  d = d.normalized()\n\n  const rc = r.map(v => Vec2.cross(v, d)) // cross prods\n  const rd = r.map(v => Vec2.dot(v, d)) // dot prods\n\n  // find foremost points on the right and on the left of the ray\n  let pid = -1\n  let nid = -1\n\n  for (let i = 0; i < 4; ++i) {\n    if (rc[i] > 0) {\n      if (pid < 0 || rd[pid] < rd[i]) pid = i\n    } else if (nid < 0 || rd[nid] < rd[i]) {\n      nid = i\n    }\n  }\n\n  if (nid < 0 || pid < 0)\n    // no intersection, no shift\n    return 0\n\n  // check the order\n  const id0 = rd[pid] > rd[nid] ? nid : pid\n  const id1 = rd[pid] > rd[nid] ? pid : nid\n\n  // simple proportion to calculate the shift\n  /* eslint-disable no-mixed-operators*/\n  return (\n    rd[id0] +\n    (Math.abs(rc[id0]) * (rd[id1] - rd[id0])) /\n      (Math.abs(rc[id0]) + Math.abs(rc[id1]))\n  )\n  /* eslint-enable no-mixed-operators*/\n}\n\nexport default {\n  tfx,\n  relBox,\n  shiftRayBox\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport Raphael from '../raphael-ext'\nimport { Vec2 } from 'ketcher-core'\nimport util from './util'\n\nconst tfx = util.tfx\n\nfunction rectangle(paper, pos, options) {\n  return paper.rect(\n    tfx(Math.min(pos[0].x, pos[1].x)),\n    tfx(Math.min(pos[0].y, pos[1].y)),\n    tfx(Math.abs(pos[1].x - pos[0].x)),\n    tfx(Math.abs(pos[1].y - pos[0].y))\n  )\n}\n\nfunction ellipse(paper, pos, options) {\n  const rad = Vec2.diff(pos[1], pos[0])\n  const rx = rad.x / 2\n  const ry = rad.y / 2\n  return paper.ellipse(pos[0].x + rx, pos[0].y + ry, Math.abs(rx), Math.abs(ry))\n}\n\nfunction polyline(paper, pos, options) {\n  let path = ['M', pos[0].x, pos[0].y]\n  for (let i = 1; i < pos.length; i++) path.push('L', pos[i].x, pos[i].y)\n  return paper.path(path)\n}\n\nfunction line(paper, pos, options) {\n  let path = ['M', pos[0].x, pos[0].y]\n  path.push('L', pos[1].x, pos[1].y)\n  return paper.path(path)\n}\n\nfunction arrow(paper, a, b, options) {\n  var width = 5,\n    length = 7\n  return paper\n    .path(\n      'M{0},{1}L{2},{3}L{4},{5}M{2},{3}L{4},{6}',\n      tfx(a.x),\n      tfx(a.y),\n      tfx(b.x),\n      tfx(b.y),\n      tfx(b.x - length),\n      tfx(b.y - width),\n      tfx(b.y + width)\n    )\n    .attr(options.lineattr)\n}\n\nfunction equilibriumArrow(paper, a, b, options) {\n  var arrowLength = 9,\n    lineOffset = 3.5,\n    arrowOffset = 7\n  var path = []\n  path.push(\n    `M${tfx(a.x)},${tfx(a.y - lineOffset)}` +\n      `L${tfx(b.x)},${tfx(b.y - lineOffset)}` +\n      `L${tfx(b.x - arrowLength)},${tfx(b.y - arrowOffset)}` +\n      `L${tfx(b.x - arrowLength)},${tfx(a.y - lineOffset)}Z`\n  )\n  path.push(\n    `M${tfx(a.x)},${tfx(a.y + lineOffset)}` +\n      `L${tfx(b.x)},${tfx(b.y + lineOffset)}` +\n      `M${tfx(a.x)},${tfx(a.y + lineOffset)}` +\n      `L${tfx(a.x + arrowLength)},${tfx(a.y + arrowOffset)}` +\n      `L${tfx(a.x + arrowLength)},${a.y + lineOffset}Z`\n  )\n  return paper.path(path).attr({ ...options.lineattr, fill: '#000' })\n}\n\nfunction plus(paper, c, options) {\n  var s = options.scale / 5\n  return paper\n    .path(\n      'M{0},{4}L{0},{5}M{2},{1}L{3},{1}',\n      tfx(c.x),\n      tfx(c.y),\n      tfx(c.x - s),\n      tfx(c.x + s),\n      tfx(c.y - s),\n      tfx(c.y + s)\n    )\n    .attr(options.lineattr)\n}\n\nfunction bondSingle(paper, hb1, hb2, options, color = '#000') {\n  var a = hb1.p,\n    b = hb2.p\n  return paper.path(makeStroke(a, b)).attr(options.lineattr).attr({\n    fill: color,\n    stroke: color\n  })\n}\n\nfunction bondSingleUp(paper, a, b2, b3, options, color = '#000') {\n  // eslint-disable-line max-params\n  return paper\n    .path(\n      'M{0},{1}L{2},{3}L{4},{5}Z',\n      tfx(a.x),\n      tfx(a.y),\n      tfx(b2.x),\n      tfx(b2.y),\n      tfx(b3.x),\n      tfx(b3.y)\n    )\n    .attr(options.lineattr)\n    .attr({\n      fill: color,\n      stroke: color\n    })\n}\n\nfunction bondSingleStereoBold(paper, a1, a2, a3, a4, options, color = '#000') {\n  // eslint-disable-line max-params\n  const bond = paper\n    .path(\n      'M{0},{1}L{2},{3}L{4},{5}L{6},{7}Z',\n      tfx(a1.x),\n      tfx(a1.y),\n      tfx(a2.x),\n      tfx(a2.y),\n      tfx(a3.x),\n      tfx(a3.y),\n      tfx(a4.x),\n      tfx(a4.y)\n    )\n    .attr(options.lineattr)\n  bond.attr({\n    stroke: color,\n    fill: color\n  })\n  return bond\n}\n\nfunction bondDoubleStereoBold(\n  paper,\n  sgBondPath,\n  b1,\n  b2,\n  options,\n  color = '#000'\n) {\n  // eslint-disable-line max-params\n  return paper.set([\n    sgBondPath,\n    paper\n      .path('M{0},{1}L{2},{3}', tfx(b1.x), tfx(b1.y), tfx(b2.x), tfx(b2.y))\n      .attr(options.lineattr)\n      .attr({\n        stroke: color,\n        fill: color\n      })\n  ])\n}\n\nfunction bondSingleDown(paper, hb1, d, nlines, step, options, color = '#000') {\n  // eslint-disable-line max-params\n  var a = hb1.p,\n    n = hb1.norm\n  var bsp = 0.7 * options.stereoBond\n\n  var path = '',\n    p,\n    q,\n    r\n  for (var i = 0; i < nlines; ++i) {\n    r = a.addScaled(d, step * i)\n    p = r.addScaled(n, (bsp * (i + 0.5)) / (nlines - 0.5))\n    q = r.addScaled(n, (-bsp * (i + 0.5)) / (nlines - 0.5))\n    path += makeStroke(p, q)\n  }\n  return paper.path(path).attr(options.lineattr).attr({\n    fill: color,\n    stroke: color\n  })\n}\n\nfunction bondSingleEither(\n  paper,\n  hb1,\n  d,\n  nlines,\n  step,\n  options,\n  color = '#000'\n) {\n  // eslint-disable-line max-params\n  var a = hb1.p,\n    n = hb1.norm\n  var bsp = 0.7 * options.stereoBond\n\n  var path = 'M' + tfx(a.x) + ',' + tfx(a.y),\n    r = a\n  for (var i = 0; i < nlines; ++i) {\n    r = a\n      .addScaled(d, step * (i + 0.5))\n      .addScaled(n, ((i & 1 ? -1 : +1) * bsp * (i + 0.5)) / (nlines - 0.5))\n    path += 'L' + tfx(r.x) + ',' + tfx(r.y)\n  }\n  return paper.path(path).attr(options.lineattr).attr({\n    fill: color,\n    stroke: color\n  })\n}\n\nfunction bondDouble(paper, a1, a2, b1, b2, cisTrans, options) {\n  // eslint-disable-line max-params\n  return paper\n    .path(\n      cisTrans\n        ? 'M{0},{1}L{6},{7}M{4},{5}L{2},{3}'\n        : 'M{0},{1}L{2},{3}M{4},{5}L{6},{7}',\n      tfx(a1.x),\n      tfx(a1.y),\n      tfx(b1.x),\n      tfx(b1.y),\n      tfx(a2.x),\n      tfx(a2.y),\n      tfx(b2.x),\n      tfx(b2.y)\n    )\n    .attr(options.lineattr)\n}\n\nfunction bondSingleOrDouble(paper, hb1, hb2, nSect, options) {\n  // eslint-disable-line max-statements, max-params\n  var a = hb1.p,\n    b = hb2.p,\n    n = hb1.norm\n  var bsp = options.bondSpace / 2\n\n  var path = '',\n    pi,\n    pp = a\n  for (var i = 1; i <= nSect; ++i) {\n    pi = Vec2.lc2(a, (nSect - i) / nSect, b, i / nSect)\n    if (i & 1) {\n      path += makeStroke(pp, pi)\n    } else {\n      path += makeStroke(pp.addScaled(n, bsp), pi.addScaled(n, bsp))\n      path += makeStroke(pp.addScaled(n, -bsp), pi.addScaled(n, -bsp))\n    }\n    pp = pi\n  }\n  return paper.path(path).attr(options.lineattr)\n}\n\nfunction bondTriple(paper, hb1, hb2, options, color = '#000') {\n  var a = hb1.p,\n    b = hb2.p,\n    n = hb1.norm\n  var a2 = a.addScaled(n, options.bondSpace)\n  var b2 = b.addScaled(n, options.bondSpace)\n  var a3 = a.addScaled(n, -options.bondSpace)\n  var b3 = b.addScaled(n, -options.bondSpace)\n  return paper\n    .path(makeStroke(a, b) + makeStroke(a2, b2) + makeStroke(a3, b3))\n    .attr(options.lineattr)\n    .attr({\n      fill: color,\n      stroke: color\n    })\n}\n\nfunction bondAromatic(paper, paths, bondShift, options) {\n  var l1 = paper.path(paths[0]).attr(options.lineattr)\n  var l2 = paper.path(paths[1]).attr(options.lineattr)\n  if (bondShift !== undefined && bondShift !== null)\n    (bondShift > 0 ? l1 : l2).attr({ 'stroke-dasharray': '- ' })\n\n  return paper.set([l1, l2])\n}\n\nfunction bondAny(paper, hb1, hb2, options) {\n  var a = hb1.p,\n    b = hb2.p\n  return paper\n    .path(makeStroke(a, b))\n    .attr(options.lineattr)\n    .attr({ 'stroke-dasharray': '- ' })\n}\n\nfunction bondHydrogen(paper, hb1, hb2, options) {\n  var a = hb1.p,\n    b = hb2.p\n  return paper.path(makeStroke(a, b)).attr(options.lineattr).attr({\n    'stroke-dasharray': '.',\n    'stroke-linecap': 'square'\n  })\n}\n\nfunction bondDative(paper, hb1, hb2, options) {\n  var a = hb1.p,\n    b = hb2.p\n  return paper\n    .path(makeStroke(a, b))\n    .attr(options.lineattr)\n    .attr({ 'arrow-end': 'block-midium-long' })\n}\n\nfunction reactingCenter(paper, p, options) {\n  var pathdesc = ''\n  for (var i = 0; i < p.length / 2; ++i)\n    pathdesc += makeStroke(p[2 * i], p[2 * i + 1])\n  return paper.path(pathdesc).attr(options.lineattr)\n}\n\nfunction topologyMark(paper, p, mark, options) {\n  var path = paper.text(p.x, p.y, mark).attr({\n    font: options.font,\n    'font-size': options.fontszsub,\n    fill: '#000'\n  })\n  var rbb = util.relBox(path.getBBox())\n  recenterText(path, rbb)\n  return path\n}\n\nfunction radicalCap(paper, p, options) {\n  var s = options.lineWidth * 0.9\n  var dw = s,\n    dh = 2 * s\n  return paper\n    .path(\n      'M{0},{1}L{2},{3}L{4},{5}',\n      tfx(p.x - dw),\n      tfx(p.y + dh),\n      tfx(p.x),\n      tfx(p.y),\n      tfx(p.x + dw),\n      tfx(p.y + dh)\n    )\n    .attr({\n      stroke: '#000',\n      'stroke-width': options.lineWidth * 0.7,\n      'stroke-linecap': 'square',\n      'stroke-linejoin': 'miter'\n    })\n}\n\nfunction radicalBullet(paper, p, options) {\n  return paper.circle(tfx(p.x), tfx(p.y), options.lineWidth).attr({\n    stroke: null,\n    fill: '#000'\n  })\n}\n\nfunction bracket(paper, d, n, c, bracketWidth, bracketHeight, options) {\n  // eslint-disable-line max-params\n  bracketWidth = bracketWidth || 0.25\n  bracketHeight = bracketHeight || 1.0\n  var a0 = c.addScaled(n, -0.5 * bracketHeight)\n  var a1 = c.addScaled(n, 0.5 * bracketHeight)\n  var b0 = a0.addScaled(d, -bracketWidth)\n  var b1 = a1.addScaled(d, -bracketWidth)\n\n  return paper\n    .path(\n      'M{0},{1}L{2},{3}L{4},{5}L{6},{7}',\n      tfx(b0.x),\n      tfx(b0.y),\n      tfx(a0.x),\n      tfx(a0.y),\n      tfx(a1.x),\n      tfx(a1.y),\n      tfx(b1.x),\n      tfx(b1.y)\n    )\n    .attr(options.sgroupBracketStyle)\n}\n\nfunction selectionRectangle(paper, p0, p1, options) {\n  return paper\n    .rect(\n      tfx(Math.min(p0.x, p1.x)),\n      tfx(Math.min(p0.y, p1.y)),\n      tfx(Math.abs(p1.x - p0.x)),\n      tfx(Math.abs(p1.y - p0.y))\n    )\n    .attr(options.lassoStyle)\n}\n\nfunction selectionPolygon(paper, r, options) {\n  var v = r[r.length - 1]\n  var pstr = 'M' + tfx(v.x) + ',' + tfx(v.y)\n  for (var i = 0; i < r.length; ++i)\n    pstr += 'L' + tfx(r[i].x) + ',' + tfx(r[i].y)\n  return paper.path(pstr).attr(options.lassoStyle)\n}\n\nfunction selectionLine(paper, p0, p1, options) {\n  return paper.path(makeStroke(p0, p1)).attr(options.lassoStyle)\n}\n\nfunction makeStroke(a, b) {\n  return 'M' + tfx(a.x) + ',' + tfx(a.y) + 'L' + tfx(b.x) + ',' + tfx(b.y) + '\t'\n}\n\nfunction dashedPath(p0, p1, dash) {\n  var t0 = 0\n  var t1 = Vec2.dist(p0, p1)\n  var d = Vec2.diff(p1, p0).normalized()\n  var black = true\n  var path = ''\n  var i = 0\n\n  while (t0 < t1) {\n    var len = dash[i % dash.length]\n    var t2 = t0 + Math.min(len, t1 - t0)\n    if (black)\n      path +=\n        'M ' +\n        p0.addScaled(d, t0).coordStr() +\n        ' L ' +\n        p0.addScaled(d, t2).coordStr()\n    t0 += len\n    black = !black\n    i++\n  }\n  return path\n}\n\nfunction aromaticBondPaths(a2, a3, b2, b3, mask, dash) {\n  // eslint-disable-line max-params\n  var l1 = dash && mask & 1 ? dashedPath(a2, b2, dash) : makeStroke(a2, b2)\n  var l2 = dash && mask & 2 ? dashedPath(a3, b3, dash) : makeStroke(a3, b3)\n\n  return [l1, l2]\n}\n\nfunction recenterText(path, rbb) {\n  // TODO: find a better way\n  if (Raphael.vml) {\n    // dirty hack\n    console.assert(null, \"Souldn't go here!\")\n    var gap = rbb.height * 0.16\n    path.translateAbs(0, gap)\n    rbb.y += gap\n  }\n}\n\nexport default {\n  recenterText,\n  arrow,\n  equilibriumArrow,\n  plus,\n  aromaticBondPaths,\n  bondSingle,\n  bondSingleUp,\n  bondSingleStereoBold,\n  bondDoubleStereoBold,\n  bondSingleDown,\n  bondSingleEither,\n  bondDouble,\n  bondSingleOrDouble,\n  bondTriple,\n  bondAromatic,\n  bondAny,\n  bondHydrogen,\n  bondDative,\n  reactingCenter,\n  topologyMark,\n  radicalCap,\n  radicalBullet,\n  bracket,\n  selectionRectangle,\n  selectionPolygon,\n  selectionLine,\n  ellipse,\n  rectangle,\n  polyline,\n  line\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  Atom,\n  Bond,\n  Box2Abs,\n  ElementColor,\n  Elements,\n  Scale,\n  StereoFlag,\n  StereoLabel,\n  Struct,\n  Vec2\n} from 'ketcher-core'\nimport {\n  LayerMap,\n  StereLabelStyleType,\n  StereoColoringType\n} from './GeneralEnumTypes'\n\nimport ReObject from './ReObject'\nimport ReStruct from './ReStruct'\nimport Render from '..'\nimport draw from '../draw'\nimport util from '../util'\n\ninterface ElemAttr {\n  text: string\n  path: any\n  rbb: { x: number; y: number; width: number; height: number }\n}\n\nconst StereoLabelMinOpacity = 0.3\n\nenum ShowHydrogenLabels {\n  Off = 'off',\n  Hetero = 'Hetero',\n  Terminal = 'Terminal',\n  TerminalAndHetero = 'Terminal and Hetero',\n  On = 'on'\n}\n\nclass ReAtom extends ReObject {\n  a: Atom\n  showLabel: boolean\n  hydrogenOnTheLeft: boolean\n  color: string\n  component: number\n  label?: ElemAttr\n\n  constructor(atom: Atom) {\n    super('atom')\n    this.a = atom // TODO rename a to item\n    this.showLabel = false\n\n    this.hydrogenOnTheLeft = false\n\n    this.color = '#000000'\n    this.component = -1\n  }\n  static isSelectable(): true {\n    return true\n  }\n  getVBoxObj(render: Render): Box2Abs | null {\n    if (this.visel.boundingBox)\n      return ReObject.prototype.getVBoxObj.call(this, render)\n    return new Box2Abs(this.a.pp, this.a.pp)\n  }\n  drawHighlight(render: Render) {\n    const ret = this.makeHighlightPlate(render)\n    render.ctab.addReObjectPath(LayerMap.highlighting, this.visel, ret)\n    return ret\n  }\n  makeHighlightPlate(render: Render) {\n    const paper = render.paper\n    const options = render.options\n    const ps = Scale.obj2scaled(this.a.pp, options)\n    return paper\n      .circle(ps.x, ps.y, options.atomSelectionPlateRadius)\n      .attr(options.highlightStyle)\n  }\n  makeSelectionPlate(restruct: ReStruct, paper: any, styles: any) {\n    const ps = Scale.obj2scaled(this.a.pp, restruct.render.options)\n    return paper\n      .circle(ps.x, ps.y, styles.atomSelectionPlateRadius)\n      .attr(styles.selectionStyle)\n  }\n  show(restruct: ReStruct, aid: number, options: any): void {\n    // eslint-disable-line max-statements\n    const render = restruct.render\n    const ps = Scale.obj2scaled(this.a.pp, render.options)\n\n    this.hydrogenOnTheLeft = setHydrogenPos(restruct.molecule, this)\n    this.showLabel = isLabelVisible(restruct, render.options, this)\n    this.color = 'black' // reset colour\n\n    let delta\n    let rightMargin\n    let leftMargin\n    let implh\n    let isHydrogen\n    let label\n    let index: any = null\n\n    if (this.showLabel) {\n      label = buildLabel(this, render.paper, ps, options)\n      delta = 0.5 * options.lineWidth\n      rightMargin = label.rbb.width / 2\n      leftMargin = -label.rbb.width / 2\n      implh = Math.floor(this.a.implicitH)\n      isHydrogen = label.text === 'H'\n      restruct.addReObjectPath(LayerMap.data, this.visel, label.path, ps, true)\n      if (options.showAtomIds) {\n        index = {}\n        index.text = aid.toString()\n        index.path = render.paper.text(ps.x, ps.y, index.text).attr({\n          font: options.font,\n          'font-size': options.fontszsub,\n          fill: '#070'\n        })\n        index.rbb = util.relBox(index.path.getBBox())\n        draw.recenterText(index.path, index.rbb)\n        restruct.addReObjectPath(LayerMap.indices, this.visel, index.path, ps)\n      }\n      this.setHighlight(this.highlight, render)\n    }\n\n    if (this.showLabel && !this.a.alias && !this.a.pseudo) {\n      let hydroIndex: any = null\n      if (isHydrogen && implh > 0) {\n        hydroIndex = showHydroIndex(this, render, implh, rightMargin)\n        rightMargin += hydroIndex.rbb.width + delta\n        restruct.addReObjectPath(\n          LayerMap.data,\n          this.visel,\n          hydroIndex.path,\n          ps,\n          true\n        )\n      }\n\n      if (this.a.radical != 0) {\n        const radical = showRadical(this, render)\n        restruct.addReObjectPath(\n          LayerMap.data,\n          this.visel,\n          radical.path,\n          ps,\n          true\n        )\n      }\n      if (this.a.isotope != 0) {\n        const isotope = showIsotope(this, render, leftMargin)\n        leftMargin -= isotope.rbb.width + delta\n        restruct.addReObjectPath(\n          LayerMap.data,\n          this.visel,\n          isotope.path,\n          ps,\n          true\n        )\n      }\n      if (\n        !isHydrogen &&\n        implh > 0 &&\n        displayHydrogen(options.showHydrogenLabels, this)\n      ) {\n        const data = showHydrogen(this, render, implh, {\n          hydrogen: {},\n          hydroIndex,\n          rightMargin,\n          leftMargin\n        })\n        const hydrogen = data.hydrogen\n        hydroIndex = data.hydroIndex\n        rightMargin = data.rightMargin\n        leftMargin = data.leftMargin\n        restruct.addReObjectPath(\n          LayerMap.data,\n          this.visel,\n          hydrogen.path,\n          ps,\n          true\n        )\n        if (hydroIndex != null)\n          restruct.addReObjectPath(\n            LayerMap.data,\n            this.visel,\n            hydroIndex.path,\n            ps,\n            true\n          )\n      }\n\n      if (this.a.charge != 0 && options.showCharge) {\n        const charge = showCharge(this, render, rightMargin)\n        rightMargin += charge.rbb.width + delta\n        restruct.addReObjectPath(\n          LayerMap.data,\n          this.visel,\n          charge.path,\n          ps,\n          true\n        )\n      }\n      if (this.a.explicitValence >= 0 && options.showValence) {\n        const valence = showExplicitValence(this, render, rightMargin)\n        rightMargin += valence.rbb.width + delta\n        restruct.addReObjectPath(\n          LayerMap.data,\n          this.visel,\n          valence.path,\n          ps,\n          true\n        )\n      }\n\n      if (this.a.badConn && options.showValenceWarnings) {\n        const warning = showWarning(this, render, leftMargin, rightMargin)\n        restruct.addReObjectPath(\n          LayerMap.warnings,\n          this.visel,\n          warning.path,\n          ps,\n          true\n        )\n      }\n      if (index) {\n        /* eslint-disable no-mixed-operators */\n        pathAndRBoxTranslate(\n          index.path,\n          index.rbb,\n          -0.5 * label.rbb.width - 0.5 * index.rbb.width - delta,\n          0.3 * label.rbb.height\n        )\n        /* eslint-enable no-mixed-operators */\n      }\n    }\n\n    if (this.a.attpnt) {\n      const lsb = bisectLargestSector(this, restruct.molecule)\n      showAttpnt(this, render, lsb, restruct.addReObjectPath.bind(restruct))\n    }\n\n    const stereoLabel = this.a.stereoLabel // Enhanced Stereo\n    const aamText = getAamText(this)\n    const queryAttrsText =\n      !this.a.alias && !this.a.pseudo ? getQueryAttrsText(this) : ''\n\n    // we render them together to avoid possible collisions\n\n    const fragmentId = Number(restruct.atoms.get(aid)?.a.fragment)\n    //TODO: fragment should not be null\n    const fragment = restruct.molecule.frags.get(fragmentId)\n\n    const text =\n      (shouldDisplayStereoLabel(\n        stereoLabel,\n        options.stereoLabelStyle,\n        fragment?.enhancedStereoFlag\n      )\n        ? `${stereoLabel}\\n`\n        : '') +\n      (queryAttrsText.length > 0 ? `${queryAttrsText}\\n` : '') +\n      (aamText.length > 0 ? `.${aamText}.` : '')\n    if (text.length > 0) {\n      const elem = Elements.get(this.a.label)\n      const aamPath = render.paper.text(ps.x, ps.y, text).attr({\n        font: options.font,\n        'font-size': options.fontszsub,\n        fill: options.atomColoring && elem ? ElementColor[this.a.label] : '#000'\n      })\n      if (stereoLabel) {\n        //use dom element to change color of stereo label which is the first element\n        //of just created text\n        //text -> tspan\n        const color = getStereoAtomColor(render.options, stereoLabel)\n        aamPath.node.childNodes[0].setAttribute('fill', color)\n        const opacity = getStereoAtomOpacity(stereoLabel)\n        aamPath.node.childNodes[0].setAttribute('opacity', opacity)\n      }\n      const aamBox = util.relBox(aamPath.getBBox())\n      draw.recenterText(aamPath, aamBox)\n      const visel = this.visel\n      let t = 3\n      let dir = bisectLargestSector(this, restruct.molecule)\n      // estimate the shift to clear the atom label\n      for (let i = 0; i < visel.exts.length; ++i)\n        t = Math.max(t, util.shiftRayBox(ps, dir, visel.exts[i].translate(ps)))\n      // estimate the shift backwards to account for the size of the aam/query text box itself\n      t += util.shiftRayBox(ps, dir.negated(), Box2Abs.fromRelBox(aamBox))\n      dir = dir.scaled(8 + t)\n      pathAndRBoxTranslate(aamPath, aamBox, dir.x, dir.y)\n      restruct.addReObjectPath(LayerMap.data, this.visel, aamPath, ps, true)\n    }\n  }\n}\n\nfunction getStereoAtomColor(options, stereoLabel) {\n  if (\n    !stereoLabel ||\n    options.colorStereogenicCenters === StereoColoringType.Off ||\n    options.colorStereogenicCenters === StereoColoringType.BondsOnly\n  ) {\n    return '#000'\n  }\n\n  return getColorFromStereoLabel(options, stereoLabel)\n}\n\nexport function getColorFromStereoLabel(options, stereoLabel) {\n  const stereoLabelType = stereoLabel.match(/\\D+/g)[0]\n\n  switch (stereoLabelType) {\n    case StereoLabel.And:\n      return options.colorOfAndCenters\n    case StereoLabel.Or:\n      return options.colorOfOrCenters\n    case StereoLabel.Abs:\n      return options.colorOfAbsoluteCenters\n    default:\n      return '#000'\n  }\n}\n\nfunction getStereoAtomOpacity(stereoLabel) {\n  const stereoLabelType = stereoLabel.match(/\\D+/g)[0]\n  const stereoLabelNumber = +stereoLabel.replace(stereoLabelType, '')\n  if (stereoLabelType === StereoLabel.Abs) {\n    return 1\n  }\n  return Math.max(1 - (stereoLabelNumber - 1) / 10, StereoLabelMinOpacity)\n}\n\nfunction shouldDisplayStereoLabel(\n  stereoLabel,\n  labelStyle,\n  flag: StereoFlag | undefined\n): Boolean {\n  if (!stereoLabel) {\n    return false\n  }\n  const stereoLabelType = stereoLabel.match(/\\D+/g)[0]\n  switch (labelStyle) {\n    // Off\n    case StereLabelStyleType.Off:\n      return false\n    // On\n    case StereLabelStyleType.On:\n      return true\n    // Classic\n    case StereLabelStyleType.Classic:\n      return flag === StereoFlag.Mixed || stereoLabelType === StereoLabel.Or\n        ? true\n        : false\n    // IUPAC\n    case StereLabelStyleType.IUPAC:\n      return flag === StereoFlag.Mixed && stereoLabelType !== StereoLabel.Abs\n        ? true\n        : false\n    default:\n      return true\n  }\n}\n\nfunction isLabelVisible(restruct, options, atom) {\n  const visibleTerminal =\n    options.showHydrogenLabels !== ShowHydrogenLabels.Off &&\n    options.showHydrogenLabels !== ShowHydrogenLabels.Hetero\n\n  const neighborsLength =\n    atom.a.neighbors.length === 0 ||\n    (atom.a.neighbors.length < 2 && visibleTerminal)\n\n  const shouldBeVisible =\n    neighborsLength ||\n    options.carbonExplicitly ||\n    atom.a.alias ||\n    atom.a.isotope !== 0 ||\n    atom.a.radical !== 0 ||\n    atom.a.charge !== 0 ||\n    atom.a.explicitValence >= 0 ||\n    atom.a.atomList !== null ||\n    atom.a.rglabel !== null ||\n    (atom.a.badConn && options.showValenceWarnings) ||\n    atom.a.label.toLowerCase() !== 'c'\n\n  if (shouldBeVisible) return true\n\n  if (atom.a.neighbors.length === 2) {\n    const nei1 = atom.a.neighbors[0]\n    const nei2 = atom.a.neighbors[1]\n    const hb1 = restruct.molecule.halfBonds.get(nei1)\n    const hb2 = restruct.molecule.halfBonds.get(nei2)\n    const bond1 = restruct.bonds.get(hb1.bid)\n    const bond2 = restruct.bonds.get(hb2.bid)\n\n    const sameNotStereo =\n      bond1.b.type === bond2.b.type &&\n      bond1.b.stereo === Bond.PATTERN.STEREO.NONE &&\n      bond2.b.stereo === Bond.PATTERN.STEREO.NONE\n\n    if (sameNotStereo && Math.abs(Vec2.cross(hb1.dir, hb2.dir)) < 0.2)\n      return true\n  }\n\n  return false\n}\n\nfunction displayHydrogen(hydrogenLabels, atom) {\n  return (\n    hydrogenLabels === ShowHydrogenLabels.On ||\n    (hydrogenLabels === ShowHydrogenLabels.Terminal &&\n      atom.a.neighbors.length < 2) ||\n    (hydrogenLabels === ShowHydrogenLabels.Hetero &&\n      atom.label.text.toLowerCase() !== 'c') ||\n    (hydrogenLabels === ShowHydrogenLabels.TerminalAndHetero &&\n      (atom.a.neighbors.length < 2 || atom.label.text.toLowerCase() !== 'c'))\n  )\n}\n\nfunction setHydrogenPos(struct, atom) {\n  // check where should the hydrogen be put on the left of the label\n  if (atom.a.neighbors.length === 0) {\n    const element = Elements.get(atom.a.label)\n    return !element || Boolean(element.leftH)\n  }\n\n  let yl = 1\n  let yr = 1\n  let nl = 0\n  let nr = 0\n\n  atom.a.neighbors.forEach(nei => {\n    const d = struct.halfBonds.get(nei).dir\n\n    if (d.x <= 0) {\n      yl = Math.min(yl, Math.abs(d.y))\n      nl++\n    } else {\n      yr = Math.min(yr, Math.abs(d.y))\n      nr++\n    }\n  })\n\n  return yl < 0.51 || yr < 0.51 ? yr < yl : nr > nl\n}\n\nfunction buildLabel(\n  atom: ReAtom,\n  paper: any,\n  ps: Vec2,\n  options: any\n): ElemAttr {\n  // eslint-disable-line max-statements\n  let label: any = {}\n  label.text = getLabelText(atom.a)\n\n  if (label.text === '') label = 'R#' // for structures that missed 'M  RGP' tag in molfile\n\n  if (label.text === atom.a.label) {\n    const element = Elements.get(label.text)\n    if (options.atomColoring && element)\n      atom.color = ElementColor[label.text] || '#000'\n  }\n\n  label.path = paper.text(ps.x, ps.y, label.text).attr({\n    font: options.font,\n    'font-size': options.fontsz,\n    fill: atom.color,\n    'font-style': atom.a.pseudo ? 'italic' : ''\n  })\n\n  label.rbb = util.relBox(label.path.getBBox())\n  draw.recenterText(label.path, label.rbb)\n\n  if (atom.a.atomList !== null)\n    pathAndRBoxTranslate(\n      label.path,\n      label.rbb,\n      ((atom.hydrogenOnTheLeft ? -1 : 1) *\n        (label.rbb.width - label.rbb.height)) /\n        2,\n      0\n    )\n\n  atom.label = label\n  return label\n}\n\nfunction getLabelText(atom) {\n  if (atom.atomList !== null) return atom.atomList.label()\n\n  if (atom.pseudo) return atom.pseudo\n\n  if (atom.alias) return atom.alias\n\n  if (atom.label === 'R#' && atom.rglabel !== null) {\n    let text = ''\n\n    for (let rgi = 0; rgi < 32; rgi++) {\n      if (atom.rglabel & (1 << rgi))\n        // eslint-disable-line max-depth\n        text += 'R' + (rgi + 1).toString()\n    }\n\n    return text\n  }\n\n  return atom.label\n}\n\nfunction showHydroIndex(atom, render, implh, rightMargin): ElemAttr {\n  const ps = Scale.obj2scaled(atom.a.pp, render.options)\n  const options = render.options\n  const delta = 0.5 * options.lineWidth\n  const hydroIndex: any = {}\n  hydroIndex.text = (implh + 1).toString()\n  hydroIndex.path = render.paper.text(ps.x, ps.y, hydroIndex.text).attr({\n    font: options.font,\n    'font-size': options.fontszsub,\n    fill: atom.color\n  })\n  hydroIndex.rbb = util.relBox(hydroIndex.path.getBBox())\n  draw.recenterText(hydroIndex.path, hydroIndex.rbb)\n  /* eslint-disable no-mixed-operators*/\n  pathAndRBoxTranslate(\n    hydroIndex.path,\n    hydroIndex.rbb,\n    rightMargin + 0.5 * hydroIndex.rbb.width + delta,\n    0.2 * atom.label.rbb.height\n  )\n  /* eslint-enable no-mixed-operators*/\n  return hydroIndex\n}\n\nfunction showRadical(atom: ReAtom, render: Render): Omit<ElemAttr, 'text'> {\n  const ps: Vec2 = Scale.obj2scaled(atom.a.pp, render.options)\n  const options = render.options\n  const paper: any = render.paper\n  const radical: any = {}\n  let hshift\n  switch (atom.a.radical) {\n    case 1:\n      radical.path = paper.set()\n      hshift = 1.6 * options.lineWidth\n      radical.path.push(\n        draw.radicalBullet(paper, ps.add(new Vec2(-hshift, 0)), options),\n        draw.radicalBullet(paper, ps.add(new Vec2(hshift, 0)), options)\n      )\n      radical.path.attr('fill', atom.color)\n      break\n    case 2:\n      radical.path = paper.set()\n      radical.path.push(draw.radicalBullet(paper, ps, options))\n      radical.path.attr('fill', atom.color)\n      break\n    case 3:\n      radical.path = paper.set()\n      hshift = 1.6 * options.lineWidth\n      radical.path.push(\n        draw.radicalCap(paper, ps.add(new Vec2(-hshift, 0)), options),\n        draw.radicalCap(paper, ps.add(new Vec2(hshift, 0)), options)\n      )\n      radical.path.attr('stroke', atom.color)\n      break\n    default:\n      break\n  }\n  radical.rbb = util.relBox(radical.path.getBBox())\n  let vshift = -0.5 * (atom.label!.rbb.height + radical.rbb.height)\n  if (atom.a.radical === 3) vshift -= options.lineWidth / 2\n  pathAndRBoxTranslate(radical.path, radical.rbb, 0, vshift)\n  return radical\n}\n\nfunction showIsotope(\n  atom: ReAtom,\n  render: Render,\n  leftMargin: number\n): ElemAttr {\n  const ps = Scale.obj2scaled(atom.a.pp, render.options)\n  const options = render.options\n  const delta = 0.5 * options.lineWidth\n  const isotope: any = {}\n  isotope.text = atom.a.isotope.toString()\n  isotope.path = render.paper.text(ps.x, ps.y, isotope.text).attr({\n    font: options.font,\n    'font-size': options.fontszsub,\n    fill: atom.color\n  })\n  isotope.rbb = util.relBox(isotope.path.getBBox())\n  draw.recenterText(isotope.path, isotope.rbb)\n  /* eslint-disable no-mixed-operators*/\n  pathAndRBoxTranslate(\n    isotope.path,\n    isotope.rbb,\n    leftMargin - 0.5 * isotope.rbb.width - delta,\n    -0.3 * atom.label!.rbb.height\n  )\n  /* eslint-enable no-mixed-operators*/\n  return isotope\n}\n\nfunction showCharge(\n  atom: ReAtom,\n  render: Render,\n  rightMargin: number\n): ElemAttr {\n  const ps = Scale.obj2scaled(atom.a.pp, render.options)\n  const options = render.options\n  const delta = 0.5 * options.lineWidth\n  const charge: any = {}\n  charge.text = ''\n  const absCharge = Math.abs(atom.a.charge)\n  if (absCharge !== 1) charge.text = absCharge.toString()\n  if (atom.a.charge < 0) charge.text += '\\u2013'\n  else charge.text += '+'\n\n  charge.path = render.paper.text(ps.x, ps.y, charge.text).attr({\n    font: options.font,\n    'font-size': options.fontszsub,\n    fill: atom.color\n  })\n  charge.rbb = util.relBox(charge.path.getBBox())\n  draw.recenterText(charge.path, charge.rbb)\n  /* eslint-disable no-mixed-operators*/\n  pathAndRBoxTranslate(\n    charge.path,\n    charge.rbb,\n    rightMargin + 0.5 * charge.rbb.width + delta,\n    -0.3 * atom.label!.rbb.height\n  )\n  /* eslint-enable no-mixed-operators*/\n  return charge\n}\n\nfunction showExplicitValence(\n  atom: ReAtom,\n  render: Render,\n  rightMargin: number\n): ElemAttr {\n  const mapValence = {\n    0: '0',\n    1: 'I',\n    2: 'II',\n    3: 'III',\n    4: 'IV',\n    5: 'V',\n    6: 'VI',\n    7: 'VII',\n    8: 'VIII',\n    9: 'IX',\n    10: 'X',\n    11: 'XI',\n    12: 'XII',\n    13: 'XIII',\n    14: 'XIV'\n  }\n  const ps = Scale.obj2scaled(atom.a.pp, render.options)\n  const options = render.options\n  const delta = 0.5 * options.lineWidth\n  const valence: any = {}\n  valence.text = mapValence[atom.a.explicitValence]\n  if (!valence.text)\n    throw new Error('invalid valence ' + atom.a.explicitValence.toString())\n  valence.text = '(' + valence.text + ')'\n  valence.path = render.paper.text(ps.x, ps.y, valence.text).attr({\n    font: options.font,\n    'font-size': options.fontszsub,\n    fill: atom.color\n  })\n  valence.rbb = util.relBox(valence.path.getBBox())\n  draw.recenterText(valence.path, valence.rbb)\n  /* eslint-disable no-mixed-operators*/\n  pathAndRBoxTranslate(\n    valence.path,\n    valence.rbb,\n    rightMargin + 0.5 * valence.rbb.width + delta,\n    -0.3 * atom.label!.rbb.height\n  )\n  /* eslint-enable no-mixed-operators*/\n  return valence\n}\n\nfunction showHydrogen(\n  atom: ReAtom,\n  render: Render,\n  implh: number,\n  data: {\n    hydrogen: any\n    hydroIndex: number\n    rightMargin: number\n    leftMargin: number\n  }\n): {\n  hydrogen: ElemAttr\n  hydroIndex: ElemAttr\n  rightMargin: number\n  leftMargin: number\n} {\n  // eslint-disable-line max-statements\n  let hydroIndex: any = data.hydroIndex\n  const hydrogenLeft = atom.hydrogenOnTheLeft\n  const ps = Scale.obj2scaled(atom.a.pp, render.options)\n  const options = render.options\n  const delta = 0.5 * options.lineWidth\n  const hydrogen = data.hydrogen\n  hydrogen.text = 'H'\n  hydrogen.path = render.paper.text(ps.x, ps.y, hydrogen.text).attr({\n    font: options.font,\n    'font-size': options.fontsz,\n    fill: atom.color\n  })\n  hydrogen.rbb = util.relBox(hydrogen.path.getBBox())\n  draw.recenterText(hydrogen.path, hydrogen.rbb)\n  if (!hydrogenLeft) {\n    pathAndRBoxTranslate(\n      hydrogen.path,\n      hydrogen.rbb,\n      data.rightMargin + 0.5 * hydrogen.rbb.width + delta,\n      0\n    )\n    data.rightMargin += hydrogen.rbb.width + delta\n  }\n  if (implh > 1) {\n    hydroIndex = {}\n    hydroIndex.text = implh.toString()\n    hydroIndex.path = render.paper.text(ps.x, ps.y, hydroIndex.text).attr({\n      font: options.font,\n      'font-size': options.fontszsub,\n      fill: atom.color\n    })\n    hydroIndex.rbb = util.relBox(hydroIndex.path.getBBox())\n    draw.recenterText(hydroIndex.path, hydroIndex.rbb)\n    if (!hydrogenLeft) {\n      pathAndRBoxTranslate(\n        hydroIndex.path,\n        hydroIndex.rbb,\n        data.rightMargin + 0.5 * hydroIndex.rbb.width + delta,\n        0.2 * atom.label!.rbb.height\n      )\n      data.rightMargin += hydroIndex.rbb.width + delta\n    }\n  }\n  if (hydrogenLeft) {\n    if (hydroIndex != null) {\n      pathAndRBoxTranslate(\n        hydroIndex.path,\n        hydroIndex.rbb,\n        data.leftMargin - 0.5 * hydroIndex.rbb.width - delta,\n        0.2 * atom.label!.rbb.height\n      )\n      data.leftMargin -= hydroIndex.rbb.width + delta\n    }\n    pathAndRBoxTranslate(\n      hydrogen.path,\n      hydrogen.rbb,\n      data.leftMargin - 0.5 * hydrogen.rbb.width - delta,\n      0\n    )\n    data.leftMargin -= hydrogen.rbb.width + delta\n  }\n  return Object.assign(data, { hydrogen, hydroIndex })\n}\n\nfunction showWarning(\n  atom,\n  render,\n  leftMargin,\n  rightMargin\n): { rbb: DOMRect; path: any } {\n  const ps = Scale.obj2scaled(atom.a.pp, render.options)\n  const delta = 0.5 * render.options.lineWidth\n  const tfx = util.tfx\n  const warning: any = {}\n  const y = ps.y + atom.label.rbb.height / 2 + delta\n  warning.path = render.paper\n    .path(\n      'M{0},{1}L{2},{3}',\n      tfx(ps.x + leftMargin),\n      tfx(y),\n      tfx(ps.x + rightMargin),\n      tfx(y)\n    )\n    .attr(render.options.lineattr)\n    .attr({ stroke: '#F00' })\n  warning.rbb = util.relBox(warning.path.getBBox())\n  return warning\n}\n\nfunction showAttpnt(atom, render, lsb, addReObjectPath) {\n  // eslint-disable-line max-statements\n  const asterisk = '∗'\n  const ps = Scale.obj2scaled(atom.a.pp, render.options)\n  const options = render.options\n  const tfx = util.tfx\n  let i, j\n  for (i = 0; i < 4; ++i) {\n    let attpntText = ''\n    if (atom.a.attpnt & (1 << i)) {\n      if (attpntText.length > 0) attpntText += ' '\n      attpntText += asterisk\n      for (j = 0; j < (i == 0 ? 0 : i + 1); ++j) attpntText += \"'\"\n      let pos0 = new Vec2(ps)\n      let pos1 = ps.addScaled(lsb, 0.7 * options.scale)\n\n      const attpntPath1 = render.paper.text(pos1.x, pos1.y, attpntText).attr({\n        font: options.font,\n        'font-size': options.fontsz,\n        fill: atom.color\n      })\n      const attpntRbb = util.relBox(attpntPath1.getBBox())\n      draw.recenterText(attpntPath1, attpntRbb)\n\n      const lsbn = lsb.negated()\n      /* eslint-disable no-mixed-operators*/\n      pos1 = pos1.addScaled(\n        lsbn,\n        util.shiftRayBox(pos1, lsbn, Box2Abs.fromRelBox(attpntRbb)) +\n          options.lineWidth / 2\n      )\n      /* eslint-enable no-mixed-operators*/\n      pos0 = shiftBondEnd(atom, pos0, lsb, options.lineWidth)\n      const n = lsb.rotateSC(1, 0)\n      const arrowLeft = pos1\n        .addScaled(n, 0.05 * options.scale)\n        .addScaled(lsbn, 0.09 * options.scale)\n      const arrowRight = pos1\n        .addScaled(n, -0.05 * options.scale)\n        .addScaled(lsbn, 0.09 * options.scale)\n      const attpntPath = render.paper.set()\n      attpntPath.push(\n        attpntPath1,\n        render.paper\n          .path(\n            'M{0},{1}L{2},{3}M{4},{5}L{2},{3}L{6},{7}',\n            tfx(pos0.x),\n            tfx(pos0.y),\n            tfx(pos1.x),\n            tfx(pos1.y),\n            tfx(arrowLeft.x),\n            tfx(arrowLeft.y),\n            tfx(arrowRight.x),\n            tfx(arrowRight.y)\n          )\n          .attr(render.options.lineattr)\n          .attr({ 'stroke-width': options.lineWidth / 2 })\n      )\n      addReObjectPath(LayerMap.indices, atom.visel, attpntPath, ps)\n      lsb = lsb.rotate(Math.PI / 6)\n    }\n  }\n}\n\n// function getStereoLabelText(atom, aid, render) {\n// \tconst struct = render.ctab.molecule;\n// \tconst frag = struct.frags.get(atom.a.fragment);\n// \tconst stereo = frag.getStereoAtomMark(aid);\n// \tif (!stereo.type) return null;\n//\n// \treturn stereo.type + (stereo.number || '');\n// }\n\nfunction getAamText(atom) {\n  let aamText = ''\n  if (atom.a.aam > 0) aamText += atom.a.aam\n  if (atom.a.invRet > 0) {\n    if (aamText.length > 0) aamText += ','\n    if (atom.a.invRet == 1) aamText += 'Inv'\n    else if (atom.a.invRet == 2) aamText += 'Ret'\n    else throw new Error('Invalid value for the invert/retain flag')\n  }\n  if (atom.a.exactChangeFlag > 0) {\n    if (aamText.length > 0) aamText += ','\n    if (atom.a.exactChangeFlag == 1) aamText += 'ext'\n    else throw new Error('Invalid value for the exact change flag')\n  }\n  return aamText\n}\n\nfunction getQueryAttrsText(atom) {\n  let queryAttrsText = ''\n  if (atom.a.ringBondCount != 0) {\n    if (atom.a.ringBondCount > 0)\n      queryAttrsText += 'rb' + atom.a.ringBondCount.toString()\n    else if (atom.a.ringBondCount == -1) queryAttrsText += 'rb0'\n    else if (atom.a.ringBondCount == -2) queryAttrsText += 'rb*'\n    else throw new Error('Ring bond count invalid')\n  }\n  if (atom.a.substitutionCount != 0) {\n    if (queryAttrsText.length > 0) queryAttrsText += ','\n    if (atom.a.substitutionCount > 0)\n      queryAttrsText += 's' + atom.a.substitutionCount.toString()\n    else if (atom.a.substitutionCount == -1) queryAttrsText += 's0'\n    else if (atom.a.substitutionCount == -2) queryAttrsText += 's*'\n    else throw new Error('Substitution count invalid')\n  }\n  if (atom.a.unsaturatedAtom > 0) {\n    if (queryAttrsText.length > 0) queryAttrsText += ','\n    if (atom.a.unsaturatedAtom == 1) queryAttrsText += 'u'\n    else throw new Error('Unsaturated atom invalid value')\n  }\n  if (atom.a.hCount > 0) {\n    if (queryAttrsText.length > 0) queryAttrsText += ','\n    queryAttrsText += 'H' + (atom.a.hCount - 1).toString()\n  }\n  return queryAttrsText\n}\n\nfunction pathAndRBoxTranslate(path, rbb, x, y) {\n  path.translateAbs(x, y)\n  rbb.x += x\n  rbb.y += y\n}\n\nfunction bisectLargestSector(atom: ReAtom, struct: Struct) {\n  let angles: Array<number> = []\n  atom.a.neighbors.forEach(hbid => {\n    const hb = struct.halfBonds.get(hbid)\n    hb && angles.push(hb.ang)\n  })\n  angles = angles.sort((a, b) => a - b)\n  const da: Array<number> = []\n  for (let i = 0; i < angles.length - 1; ++i) {\n    da.push(angles[(i + 1) % angles.length] - angles[i])\n  }\n  da.push(angles[0] - angles[angles.length - 1] + 2 * Math.PI)\n  let daMax = 0\n  let ang = -Math.PI / 2\n  for (let i = 0; i < angles.length; ++i) {\n    if (da[i] > daMax) {\n      daMax = da[i]\n      ang = angles[i] + da[i] / 2\n    }\n  }\n  return new Vec2(Math.cos(ang), Math.sin(ang))\n}\n\nfunction shiftBondEnd(atom, pos0, dir, margin) {\n  let t = 0\n  const visel = atom.visel\n  for (let k = 0; k < visel.exts.length; ++k) {\n    const box = visel.exts[k].translate(pos0)\n    t = Math.max(t, util.shiftRayBox(pos0, dir, box))\n  }\n  if (t > 0) pos0 = pos0.addScaled(dir, t + margin)\n  return pos0\n}\n\nexport default ReAtom\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Atom, Bond, HalfBond, Scale, Struct, Vec2 } from 'ketcher-core'\nimport { LayerMap, StereoColoringType } from './GeneralEnumTypes'\nimport ReAtom, { getColorFromStereoLabel } from './reatom'\n\nimport ReObject from './ReObject'\nimport ReStruct from './ReStruct'\nimport Render from '..'\nimport draw from '../draw'\nimport util from '../util'\n\nclass ReBond extends ReObject {\n  b: Bond\n  doubleBondShift: number\n  path: any\n  neihbid1: number = -1\n  neihbid2: number = -1\n  boldStereo?: boolean\n  rbb?: { x: number; y: number; width: number; height: number }\n\n  constructor(bond: Bond) {\n    super('bond')\n    this.b = bond // TODO rename b to item\n    this.doubleBondShift = 0\n  }\n  static isSelectable() {\n    return true\n  }\n  drawHighlight(render: Render) {\n    const ret = this.makeHighlightPlate(render)\n    render.ctab.addReObjectPath(LayerMap.highlighting, this.visel, ret)\n    return ret\n  }\n  makeHighlightPlate(render: Render) {\n    const options = render.options\n    bondRecalc(this, render.ctab, options)\n    const c = Scale.obj2scaled(this.b.center, options)\n    return render.paper\n      .circle(c.x, c.y, 0.8 * options.atomSelectionPlateRadius)\n      .attr(options.highlightStyle)\n  }\n  makeSelectionPlate(restruct: ReStruct, paper: any, options: any) {\n    bondRecalc(this, restruct, options)\n    const c = Scale.obj2scaled(this.b.center, options)\n    return paper\n      .circle(c.x, c.y, 0.8 * options.atomSelectionPlateRadius)\n      .attr(options.selectionStyle)\n  }\n\n  show(restruct: ReStruct, bid: number, options: any): void {\n    // eslint-disable-line max-statements\n    const render = restruct.render\n    const struct = restruct.molecule\n    const paper = render.paper\n    const hb1 =\n        this.b.hb1 !== undefined ? struct.halfBonds.get(this.b.hb1) : null,\n      hb2 = this.b.hb2 !== undefined ? struct.halfBonds.get(this.b.hb2) : null\n\n    checkStereoBold(bid, this, restruct)\n    bondRecalc(this, restruct, options)\n    setDoubleBondShift(this, struct)\n    if (!hb1 || !hb2) return\n    this.path = getBondPath(restruct, this, hb1, hb2)\n    this.rbb = util.relBox(this.path.getBBox())\n    restruct.addReObjectPath(LayerMap.data, this.visel, this.path, null, true)\n    const reactingCenter: any = {}\n    reactingCenter.path = getReactingCenterPath(render, this, hb1, hb2)\n    if (reactingCenter.path) {\n      reactingCenter.rbb = util.relBox(reactingCenter.path.getBBox())\n      restruct.addReObjectPath(\n        LayerMap.data,\n        this.visel,\n        reactingCenter.path,\n        null,\n        true\n      )\n    }\n    const topology: any = {}\n    topology.path = getTopologyMark(render, this, hb1, hb2)\n    if (topology.path) {\n      topology.rbb = util.relBox(topology.path.getBBox())\n      restruct.addReObjectPath(\n        LayerMap.data,\n        this.visel,\n        topology.path,\n        null,\n        true\n      )\n    }\n    this.setHighlight(this.highlight, render)\n\n    let ipath = null\n    const bondIdxOff = options.subFontSize * 0.6\n    if (options.showBondIds) {\n      ipath = getIdsPath(bid, paper, hb1, hb2, bondIdxOff, 0.5, 0.5, hb1.norm)\n      restruct.addReObjectPath(LayerMap.indices, this.visel, ipath)\n    }\n    if (options.showHalfBondIds) {\n      ipath = getIdsPath(\n        this.b.hb1!,\n        paper,\n        hb1,\n        hb2,\n        bondIdxOff,\n        0.8,\n        0.2,\n        hb1.norm\n      )\n      restruct.addReObjectPath(LayerMap.indices, this.visel, ipath)\n      ipath = getIdsPath(\n        this.b.hb2!,\n        paper,\n        hb1,\n        hb2,\n        bondIdxOff,\n        0.2,\n        0.8,\n        hb2.norm\n      )\n      restruct.addReObjectPath(LayerMap.indices, this.visel, ipath)\n    }\n    if (options.showLoopIds && !options.showBondIds) {\n      ipath = getIdsPath(\n        hb1.loop,\n        paper,\n        hb1,\n        hb2,\n        bondIdxOff,\n        0.5,\n        0.5,\n        hb2.norm\n      )\n      restruct.addReObjectPath(LayerMap.indices, this.visel, ipath)\n      ipath = getIdsPath(\n        hb2.loop,\n        paper,\n        hb1,\n        hb2,\n        bondIdxOff,\n        0.5,\n        0.5,\n        hb1.norm\n      )\n      restruct.addReObjectPath(LayerMap.indices, this.visel, ipath)\n    }\n  }\n}\n\nfunction findIncomingStereoUpBond(\n  atom: Atom,\n  bid0: number,\n  includeBoldStereoBond: boolean,\n  restruct: ReStruct\n): number {\n  return atom.neighbors.findIndex(hbid => {\n    const hb = restruct.molecule.halfBonds.get(hbid)\n\n    if (!hb || hb.bid === bid0) return false\n\n    const neibond = restruct.bonds.get(hb.bid)\n\n    if (!neibond) return false\n    const singleUp =\n      neibond.b.type === Bond.PATTERN.TYPE.SINGLE &&\n      neibond.b.stereo === Bond.PATTERN.STEREO.UP\n\n    if (singleUp)\n      return (\n        neibond.b.end === hb.begin ||\n        (neibond.boldStereo && includeBoldStereoBond)\n      )\n\n    return !!(\n      neibond.b.type === Bond.PATTERN.TYPE.DOUBLE &&\n      neibond.b.stereo === Bond.PATTERN.STEREO.NONE &&\n      includeBoldStereoBond &&\n      neibond.boldStereo\n    )\n  })\n}\n\nfunction findIncomingUpBonds(\n  bid0: number,\n  bond: ReBond,\n  restruct: ReStruct\n): void {\n  const halfbonds = [bond.b.begin, bond.b.end].map(aid => {\n    const atom = restruct.molecule.atoms.get(aid)\n    if (!atom) return -1\n    const pos = findIncomingStereoUpBond(atom, bid0, true, restruct)\n    return pos < 0 ? -1 : atom.neighbors[pos]\n  })\n  console.assert(halfbonds.length === 2)\n  bond.neihbid1 = restruct.atoms.get(bond.b.begin)?.showLabel\n    ? -1\n    : halfbonds[0]\n  bond.neihbid2 = restruct.atoms.get(bond.b.end)?.showLabel ? -1 : halfbonds[1]\n}\n\nfunction checkStereoBold(bid0, bond, restruct) {\n  const halfbonds = [bond.b.begin, bond.b.end].map(aid => {\n    const atom = restruct.molecule.atoms.get(aid)\n    const pos = findIncomingStereoUpBond(atom, bid0, false, restruct)\n    return pos < 0 ? -1 : atom.neighbors[pos]\n  })\n  console.assert(halfbonds.length === 2)\n  bond.boldStereo = halfbonds[0] >= 0 && halfbonds[1] >= 0\n}\n\nfunction getBondPath(\n  restruct: ReStruct,\n  bond: ReBond,\n  hb1: HalfBond,\n  hb2: HalfBond\n) {\n  let path = null\n  const render = restruct.render\n  const struct = restruct.molecule\n  const shiftA = !restruct.atoms.get(hb1.begin)?.showLabel\n  const shiftB = !restruct.atoms.get(hb2.begin)?.showLabel\n\n  switch (bond.b.type) {\n    case Bond.PATTERN.TYPE.SINGLE:\n      switch (bond.b.stereo) {\n        case Bond.PATTERN.STEREO.UP:\n          findIncomingUpBonds(hb1.bid, bond, restruct)\n          if (bond.boldStereo && bond.neihbid1 >= 0 && bond.neihbid2 >= 0)\n            path = getBondSingleStereoBoldPath(render, hb1, hb2, bond, struct)\n          else path = getBondSingleUpPath(render, hb1, hb2, bond, struct)\n          break\n        case Bond.PATTERN.STEREO.DOWN:\n          path = getBondSingleDownPath(render, hb1, hb2, bond, struct)\n          break\n        case Bond.PATTERN.STEREO.EITHER:\n          path = getBondSingleEitherPath(render, hb1, hb2, bond, struct)\n          break\n        default:\n          path = draw.bondSingle(\n            render.paper,\n            hb1,\n            hb2,\n            render.options,\n            getStereoBondColor(render.options, bond, struct)\n          )\n          break\n      }\n      break\n    case Bond.PATTERN.TYPE.DOUBLE:\n      findIncomingUpBonds(hb1.bid, bond, restruct)\n      if (\n        bond.b.stereo === Bond.PATTERN.STEREO.NONE &&\n        bond.boldStereo &&\n        bond.neihbid1 >= 0 &&\n        bond.neihbid2 >= 0\n      )\n        path = getBondDoubleStereoBoldPath(\n          render,\n          hb1,\n          hb2,\n          bond,\n          struct,\n          shiftA,\n          shiftB\n        )\n      else path = getBondDoublePath(render, hb1, hb2, bond, shiftA, shiftB)\n      break\n    case Bond.PATTERN.TYPE.TRIPLE:\n      path = draw.bondTriple(render.paper, hb1, hb2, render.options)\n      break\n    case Bond.PATTERN.TYPE.AROMATIC:\n      const inAromaticLoop =\n        (hb1.loop >= 0 && struct.loops.get(hb1.loop)?.aromatic) ||\n        (hb2.loop >= 0 && struct.loops.get(hb2.loop)?.aromatic)\n      path = inAromaticLoop\n        ? draw.bondSingle(render.paper, hb1, hb2, render.options)\n        : getBondAromaticPath(render, hb1, hb2, bond, shiftA, shiftB)\n      break\n    case Bond.PATTERN.TYPE.SINGLE_OR_DOUBLE:\n      path = getSingleOrDoublePath(render, hb1, hb2)\n      break\n    case Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC:\n      path = getBondAromaticPath(render, hb1, hb2, bond, shiftA, shiftB)\n      break\n    case Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC:\n      path = getBondAromaticPath(render, hb1, hb2, bond, shiftA, shiftB)\n      break\n    case Bond.PATTERN.TYPE.ANY:\n      path = draw.bondAny(render.paper, hb1, hb2, render.options)\n      break\n    case Bond.PATTERN.TYPE.HYDROGEN:\n      path = draw.bondHydrogen(render.paper, hb1, hb2, render.options)\n      break\n    case Bond.PATTERN.TYPE.DATIVE:\n      path = draw.bondDative(render.paper, hb1, hb2, render.options)\n      break\n    default:\n      throw new Error('Bond type ' + bond.b.type + ' not supported')\n  }\n  return path\n}\n\n/* Get Path */\nfunction getBondSingleUpPath(\n  render: Render,\n  hb1: HalfBond,\n  hb2: HalfBond,\n  bond: ReBond,\n  struct: Struct\n) {\n  // eslint-disable-line max-params\n  const a = hb1.p,\n    b = hb2.p,\n    n = hb1.norm\n  const options = render.options\n  const bsp = 0.7 * options.stereoBond\n  let b2 = b.addScaled(n, bsp)\n  let b3 = b.addScaled(n, -bsp)\n  if (bond.neihbid2 >= 0) {\n    // if the end is shared with another up-bond heading this way\n    var coords = stereoUpBondGetCoordinates(\n      hb2,\n      bond.neihbid2,\n      options.stereoBond,\n      struct\n    )\n    b2 = coords[0]\n    b3 = coords[1]\n  }\n  return draw.bondSingleUp(\n    render.paper,\n    a,\n    b2,\n    b3,\n    options,\n    getStereoBondColor(options, bond, struct)\n  )\n}\n\nfunction getStereoBondColor(\n  options: any,\n  bond: ReBond,\n  struct: Struct\n): string {\n  const defaultColor = '#000'\n\n  if (bond.b.stereo === 0) return defaultColor\n\n  const beginAtomStereoLabel = struct.atoms.get(bond.b.begin)?.stereoLabel\n  const endAtomStereoLabel = struct.atoms.get(bond.b.end)?.stereoLabel\n\n  let stereoLabel = ''\n  if (beginAtomStereoLabel && !endAtomStereoLabel) {\n    stereoLabel = beginAtomStereoLabel\n  } else if (!beginAtomStereoLabel && endAtomStereoLabel) {\n    stereoLabel = endAtomStereoLabel\n  }\n\n  if (\n    // if no stereolabel presents or presents in both then use default color\n    !stereoLabel ||\n    options.colorStereogenicCenters === StereoColoringType.Off ||\n    options.colorStereogenicCenters === StereoColoringType.LabelsOnly\n  ) {\n    return defaultColor\n  }\n\n  return getColorFromStereoLabel(options, stereoLabel)\n}\n\nfunction getBondSingleStereoBoldPath(\n  render: Render,\n  hb1: HalfBond,\n  hb2: HalfBond,\n  bond: ReBond,\n  struct: Struct\n) {\n  // eslint-disable-line max-params\n  const options = render.options\n  const coords1 = stereoUpBondGetCoordinates(\n    hb1,\n    bond.neihbid1,\n    options.stereoBond,\n    struct\n  )\n  const coords2 = stereoUpBondGetCoordinates(\n    hb2,\n    bond.neihbid2,\n    options.stereoBond,\n    struct\n  )\n  const a1 = coords1[0]\n  const a2 = coords1[1]\n  const a3 = coords2[0]\n  const a4 = coords2[1]\n  return draw.bondSingleStereoBold(\n    render.paper,\n    a1,\n    a2,\n    a3,\n    a4,\n    options,\n    getStereoBondColor(options, bond, struct)\n  )\n}\n\nfunction getBondDoubleStereoBoldPath(\n  render: Render,\n  hb1: HalfBond,\n  hb2: HalfBond,\n  bond: ReBond,\n  struct: Struct,\n  shiftA: boolean,\n  shiftB: boolean\n) {\n  // eslint-disable-line max-params\n  const a = hb1.p,\n    b = hb2.p,\n    n = hb1.norm,\n    shift = bond.doubleBondShift\n  const bsp = 1.5 * render.options.stereoBond\n  let b1 = a.addScaled(n, bsp * shift)\n  let b2 = b.addScaled(n, bsp * shift)\n  if (shift > 0) {\n    if (shiftA)\n      b1 = b1.addScaled(\n        hb1.dir,\n        bsp * getBondLineShift(hb1.rightCos, hb1.rightSin)\n      )\n    if (shiftB)\n      b2 = b2.addScaled(\n        hb1.dir,\n        -bsp * getBondLineShift(hb2.leftCos, hb2.leftSin)\n      )\n  } else if (shift < 0) {\n    if (shiftA)\n      b1 = b1.addScaled(\n        hb1.dir,\n        bsp * getBondLineShift(hb1.leftCos, hb1.leftSin)\n      )\n    if (shiftB)\n      b2 = b2.addScaled(\n        hb1.dir,\n        -bsp * getBondLineShift(hb2.rightCos, hb2.rightSin)\n      )\n  }\n  const sgBondPath = getBondSingleStereoBoldPath(render, hb1, hb2, bond, struct)\n  return draw.bondDoubleStereoBold(\n    render.paper,\n    sgBondPath,\n    b1,\n    b2,\n    render.options,\n    getStereoBondColor(render.options, bond, struct)\n  )\n}\n\nfunction getBondLineShift(cos: number, sin: number): number {\n  if (sin < 0 || Math.abs(cos) > 0.9) return 0\n  return sin / (1 - cos)\n}\n\nfunction stereoUpBondGetCoordinates(\n  hb: HalfBond,\n  neihbid: number,\n  bondSpace: any,\n  struct: Struct\n): [Vec2, Vec2] {\n  const neihb = struct.halfBonds.get(neihbid)\n  const cos = Vec2.dot(hb.dir, neihb!.dir)\n  const sin = Vec2.cross(hb.dir, neihb!.dir)\n  const cosHalf = Math.sqrt(0.5 * (1 - cos))\n  const biss = neihb!.dir.rotateSC(\n    (sin >= 0 ? -1 : 1) * cosHalf,\n    Math.sqrt(0.5 * (1 + cos))\n  )\n\n  const denomAdd = 0.3\n  const scale = 0.7\n  const a1 = hb.p.addScaled(biss, (scale * bondSpace) / (cosHalf + denomAdd))\n  const a2 = hb.p.addScaled(\n    biss.negated(),\n    (scale * bondSpace) / (cosHalf + denomAdd)\n  )\n  return sin > 0 ? [a1, a2] : [a2, a1]\n}\n\nfunction getBondSingleDownPath(\n  render: Render,\n  hb1: HalfBond,\n  hb2: HalfBond,\n  bond: ReBond,\n  struct: Struct\n) {\n  const a = hb1.p,\n    b = hb2.p\n  const options = render.options\n  let d = b.sub(a)\n  const len = d.length() + 0.2\n  d = d.normalized()\n  const interval = 1.2 * options.lineWidth\n  const nlines =\n    Math.max(\n      Math.floor((len - options.lineWidth) / (options.lineWidth + interval)),\n      0\n    ) + 2\n  const step = len / (nlines - 1)\n  return draw.bondSingleDown(\n    render.paper,\n    hb1,\n    d,\n    nlines,\n    step,\n    options,\n    getStereoBondColor(options, bond, struct)\n  )\n}\n\nfunction getBondSingleEitherPath(\n  render: Render,\n  hb1: HalfBond,\n  hb2: HalfBond,\n  bond: ReBond,\n  struct: Struct\n) {\n  const a = hb1.p,\n    b = hb2.p\n  const options = render.options\n  let d = b.sub(a)\n  const len = d.length()\n  d = d.normalized()\n  const interval = 0.6 * options.lineWidth\n  const nlines =\n    Math.max(\n      Math.floor((len - options.lineWidth) / (options.lineWidth + interval)),\n      0\n    ) + 2\n  const step = len / (nlines - 0.5)\n  return draw.bondSingleEither(\n    render.paper,\n    hb1,\n    d,\n    nlines,\n    step,\n    options,\n    getStereoBondColor(options, bond, struct)\n  )\n}\n\nfunction getBondDoublePath(\n  render: Render,\n  hb1: HalfBond,\n  hb2: HalfBond,\n  bond: ReBond,\n  shiftA: boolean,\n  shiftB: boolean\n) {\n  // eslint-disable-line max-params, max-statements\n  const cisTrans = bond.b.stereo === Bond.PATTERN.STEREO.CIS_TRANS\n\n  const a = hb1.p\n  const b = hb2.p\n  const n = hb1.norm\n  const shift = cisTrans ? 0 : bond.doubleBondShift\n\n  const options = render.options\n  const bsp = options.bondSpace / 2\n  const s1 = bsp + shift * bsp\n  const s2 = -bsp + shift * bsp\n\n  let a1 = a.addScaled(n, s1)\n  let b1 = b.addScaled(n, s1)\n  let a2 = a.addScaled(n, s2)\n  let b2 = b.addScaled(n, s2)\n\n  if (shift > 0) {\n    if (shiftA) {\n      a1 = a1.addScaled(\n        hb1.dir,\n        options.bondSpace * getBondLineShift(hb1.rightCos, hb1.rightSin)\n      )\n    }\n    if (shiftB) {\n      b1 = b1.addScaled(\n        hb1.dir,\n        -options.bondSpace * getBondLineShift(hb2.leftCos, hb2.leftSin)\n      )\n    }\n  } else if (shift < 0) {\n    if (shiftA) {\n      a2 = a2.addScaled(\n        hb1.dir,\n        options.bondSpace * getBondLineShift(hb1.leftCos, hb1.leftSin)\n      )\n    }\n    if (shiftB) {\n      b2 = b2.addScaled(\n        hb1.dir,\n        -options.bondSpace * getBondLineShift(hb2.rightCos, hb2.rightSin)\n      )\n    }\n  }\n\n  return draw.bondDouble(render.paper, a1, a2, b1, b2, cisTrans, options)\n}\n\nfunction getSingleOrDoublePath(render: Render, hb1: HalfBond, hb2: HalfBond) {\n  const a = hb1.p,\n    b = hb2.p\n  const options = render.options\n\n  let nSect =\n    Vec2.dist(a, b) / Number((options.bondSpace + options.lineWidth).toFixed())\n  if (!(nSect & 1)) nSect += 1\n  return draw.bondSingleOrDouble(render.paper, hb1, hb2, nSect, options)\n}\n\nfunction getBondAromaticPath(\n  render: Render,\n  hb1: HalfBond,\n  hb2: HalfBond,\n  bond: ReBond,\n  shiftA: boolean,\n  shiftB: boolean\n) {\n  // eslint-disable-line max-params\n  const dashdotPattern = [0.125, 0.125, 0.005, 0.125]\n  let mark: number | null = null,\n    dash: number[] | null = null\n  const options = render.options\n  const bondShift = bond.doubleBondShift\n\n  if (bond.b.type === Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC) {\n    mark = bondShift > 0 ? 1 : 2\n    dash = dashdotPattern.map(v => v * options.scale)\n  }\n  if (bond.b.type === Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC) {\n    mark = 3\n    dash = dashdotPattern.map(v => v * options.scale)\n  }\n  const paths = getAromaticBondPaths(\n    hb1,\n    hb2,\n    bondShift,\n    shiftA,\n    shiftB,\n    options.bondSpace,\n    mark,\n    dash\n  )\n  return draw.bondAromatic(render.paper, paths, bondShift, options)\n}\n\nfunction getAromaticBondPaths(\n  hb1: HalfBond,\n  hb2: HalfBond,\n  shift: number,\n  shiftA: boolean,\n  shiftB: boolean,\n  bondSpace: number,\n  mask: number | null,\n  dash: number[] | null\n) {\n  // eslint-disable-line max-params, max-statements\n  const a = hb1.p,\n    b = hb2.p,\n    n = hb1.norm\n  const bsp = bondSpace / 2\n  const s1 = bsp + shift * bsp,\n    s2 = -bsp + shift * bsp\n  let a2 = a.addScaled(n, s1)\n  let b2 = b.addScaled(n, s1)\n  let a3 = a.addScaled(n, s2)\n  let b3 = b.addScaled(n, s2)\n  if (shift > 0) {\n    if (shiftA) {\n      a2 = a2.addScaled(\n        hb1.dir,\n        bondSpace * getBondLineShift(hb1.rightCos, hb1.rightSin)\n      )\n    }\n    if (shiftB) {\n      b2 = b2.addScaled(\n        hb1.dir,\n        -bondSpace * getBondLineShift(hb2.leftCos, hb2.leftSin)\n      )\n    }\n  } else if (shift < 0) {\n    if (shiftA) {\n      a3 = a3.addScaled(\n        hb1.dir,\n        bondSpace * getBondLineShift(hb1.leftCos, hb1.leftSin)\n      )\n    }\n    if (shiftB) {\n      b3 = b3.addScaled(\n        hb1.dir,\n        -bondSpace * getBondLineShift(hb2.rightCos, hb2.rightSin)\n      )\n    }\n  }\n  return draw.aromaticBondPaths(a2, a3, b2, b3, mask, dash)\n}\n\nfunction getReactingCenterPath(\n  render: Render,\n  bond: ReBond,\n  hb1: HalfBond,\n  hb2: HalfBond\n) {\n  // eslint-disable-line max-statements\n  const a = hb1.p,\n    b = hb2.p\n  const c = b.add(a).scaled(0.5)\n  const d = b.sub(a).normalized()\n  const n = d.rotateSC(1, 0)\n\n  const p: Array<Vec2> = []\n\n  const lw = render.options.lineWidth,\n    bs = render.options.bondSpace / 2\n  const alongIntRc = lw, // half interval along for CENTER\n    alongIntMadeBroken = 2 * lw, // half interval between along for MADE_OR_BROKEN\n    alongSz = 1.5 * bs, // half size along for CENTER\n    acrossInt = 1.5 * bs, // half interval across for CENTER\n    acrossSz = 3.0 * bs, // half size across for all\n    tiltTan = 0.2 // tangent of the tilt angle\n\n  switch (bond.b.reactingCenterStatus) {\n    case Bond.PATTERN.REACTING_CENTER.NOT_CENTER: // X\n      p.push(c.addScaled(n, acrossSz).addScaled(d, tiltTan * acrossSz))\n      p.push(c.addScaled(n, -acrossSz).addScaled(d, -tiltTan * acrossSz))\n      p.push(c.addScaled(n, acrossSz).addScaled(d, -tiltTan * acrossSz))\n      p.push(c.addScaled(n, -acrossSz).addScaled(d, tiltTan * acrossSz))\n      break\n    case Bond.PATTERN.REACTING_CENTER.CENTER: // #\n      p.push(\n        c\n          .addScaled(n, acrossSz)\n          .addScaled(d, tiltTan * acrossSz)\n          .addScaled(d, alongIntRc)\n      )\n      p.push(\n        c\n          .addScaled(n, -acrossSz)\n          .addScaled(d, -tiltTan * acrossSz)\n          .addScaled(d, alongIntRc)\n      )\n      p.push(\n        c\n          .addScaled(n, acrossSz)\n          .addScaled(d, tiltTan * acrossSz)\n          .addScaled(d, -alongIntRc)\n      )\n      p.push(\n        c\n          .addScaled(n, -acrossSz)\n          .addScaled(d, -tiltTan * acrossSz)\n          .addScaled(d, -alongIntRc)\n      )\n      p.push(c.addScaled(d, alongSz).addScaled(n, acrossInt))\n      p.push(c.addScaled(d, -alongSz).addScaled(n, acrossInt))\n      p.push(c.addScaled(d, alongSz).addScaled(n, -acrossInt))\n      p.push(c.addScaled(d, -alongSz).addScaled(n, -acrossInt))\n      break\n    // case Bond.PATTERN.REACTING_CENTER.UNCHANGED: draw a circle\n    case Bond.PATTERN.REACTING_CENTER.MADE_OR_BROKEN:\n      p.push(c.addScaled(n, acrossSz).addScaled(d, alongIntMadeBroken))\n      p.push(c.addScaled(n, -acrossSz).addScaled(d, alongIntMadeBroken))\n      p.push(c.addScaled(n, acrossSz).addScaled(d, -alongIntMadeBroken))\n      p.push(c.addScaled(n, -acrossSz).addScaled(d, -alongIntMadeBroken))\n      break\n    case Bond.PATTERN.REACTING_CENTER.ORDER_CHANGED:\n      p.push(c.addScaled(n, acrossSz))\n      p.push(c.addScaled(n, -acrossSz))\n      break\n    case Bond.PATTERN.REACTING_CENTER.MADE_OR_BROKEN_AND_CHANGED:\n      p.push(c.addScaled(n, acrossSz).addScaled(d, alongIntMadeBroken))\n      p.push(c.addScaled(n, -acrossSz).addScaled(d, alongIntMadeBroken))\n      p.push(c.addScaled(n, acrossSz).addScaled(d, -alongIntMadeBroken))\n      p.push(c.addScaled(n, -acrossSz).addScaled(d, -alongIntMadeBroken))\n      p.push(c.addScaled(n, acrossSz))\n      p.push(c.addScaled(n, -acrossSz))\n      break\n    default:\n      return null\n  }\n  return draw.reactingCenter(render.paper, p, render.options)\n}\n\nfunction getTopologyMark(\n  render: Render,\n  bond: ReBond,\n  hb1: HalfBond,\n  hb2: HalfBond\n) {\n  // eslint-disable-line max-statements\n  const options = render.options\n  let mark: string | null = null\n\n  if (bond.b.topology === Bond.PATTERN.TOPOLOGY.RING) mark = 'rng'\n  else if (bond.b.topology === Bond.PATTERN.TOPOLOGY.CHAIN) mark = 'chn'\n  else return null\n\n  const a = hb1.p,\n    b = hb2.p\n  const c = b.add(a).scaled(0.5)\n  const d = b.sub(a).normalized()\n  let n = d.rotateSC(1, 0)\n  let fixed = options.lineWidth\n  if (bond.doubleBondShift > 0) n = n.scaled(-bond.doubleBondShift)\n  else if (bond.doubleBondShift == 0) fixed += options.bondSpace / 2\n\n  const s = new Vec2(2, 1).scaled(options.bondSpace)\n  if (bond.b.type == Bond.PATTERN.TYPE.TRIPLE) fixed += options.bondSpace\n  const p = c.add(new Vec2(n.x * (s.x + fixed), n.y * (s.y + fixed)))\n\n  return draw.topologyMark(render.paper, p, mark, options)\n}\n\nfunction getIdsPath(\n  bid: number,\n  paper: any,\n  hb1: HalfBond,\n  hb2: HalfBond,\n  bondIdxOff: number,\n  param1: number,\n  param2: number,\n  norm: Vec2\n) {\n  // eslint-disable-line max-params\n  const pb = Vec2.lc(hb1.p, param1, hb2.p, param2, norm, bondIdxOff)\n  const ipath = paper.text(pb.x, pb.y, bid.toString())\n  const irbb = util.relBox(ipath.getBBox())\n  draw.recenterText(ipath, irbb)\n  return ipath\n}\n/* ----- */\n\nfunction setDoubleBondShift(bond: ReBond, struct: Struct): void {\n  let loop1, loop2\n  const hb1 = bond.b.hb1\n  const hb2 = bond.b.hb2\n\n  if (!hb1 || !hb2) {\n    bond.doubleBondShift = selectDoubleBondShiftChain(struct, bond)\n    return\n  }\n\n  loop1 = struct.halfBonds.get(hb1)?.loop\n  loop2 = struct.halfBonds.get(hb2)?.loop\n  if (loop1 >= 0 && loop2 >= 0) {\n    const d1 = struct.loops.get(loop1)!.dblBonds\n    const d2 = struct.loops.get(loop2)!.dblBonds\n    const n1 = struct.loops.get(loop1)!.hbs.length\n    const n2 = struct.loops.get(loop2)!.hbs.length\n    bond.doubleBondShift = selectDoubleBondShift(n1, n2, d1, d2)\n  } else if (loop1 >= 0) {\n    bond.doubleBondShift = -1\n  } else if (loop2 >= 0) {\n    bond.doubleBondShift = 1\n  } else {\n    bond.doubleBondShift = selectDoubleBondShiftChain(struct, bond)\n  }\n}\n\nfunction bondRecalc(bond: ReBond, restruct: ReStruct, options: any): void {\n  const render = restruct.render\n  const atom1 = restruct.atoms.get(bond.b.begin)\n  const atom2 = restruct.atoms.get(bond.b.end)\n\n  if (!atom1 || !atom2 || bond.b.hb1 === undefined || bond.b.hb2 === undefined)\n    return\n\n  const p1 = Scale.obj2scaled(atom1.a.pp, render.options)\n  const p2 = Scale.obj2scaled(atom2.a.pp, render.options)\n  const hb1 = restruct.molecule.halfBonds.get(bond.b.hb1)\n  const hb2 = restruct.molecule.halfBonds.get(bond.b.hb2)\n\n  if (!hb1?.dir || !hb2?.dir) return\n\n  hb1.p = shiftBondEnd(atom1, p1, hb1.dir, 2 * options.lineWidth)\n  hb2.p = shiftBondEnd(atom2, p2, hb2.dir, 2 * options.lineWidth)\n  bond.b.center = Vec2.lc2(atom1.a.pp, 0.5, atom2.a.pp, 0.5)\n  bond.b.len = Vec2.dist(p1, p2)\n  bond.b.sb = options.lineWidth * 5\n  /* eslint-disable no-mixed-operators*/\n  bond.b.sa = Math.max(bond.b.sb, bond.b.len / 2 - options.lineWidth * 2)\n  /* eslint-enable no-mixed-operators*/\n  bond.b.angle = (Math.atan2(hb1.dir.y, hb1.dir.x) * 180) / Math.PI\n}\n\nfunction shiftBondEnd(\n  atom: ReAtom,\n  pos0: Vec2,\n  dir: Vec2,\n  margin: number\n): Vec2 {\n  let t = 0\n  const visel = atom.visel\n  for (var k = 0; k < visel.exts.length; ++k) {\n    var box = visel.exts[k].translate(pos0)\n    t = Math.max(t, util.shiftRayBox(pos0, dir, box))\n  }\n  if (t > 0) pos0 = pos0.addScaled(dir, t + margin)\n  return pos0\n}\n\nfunction selectDoubleBondShift(\n  n1: number,\n  n2: number,\n  d1: number,\n  d2: number\n): number {\n  if (n1 == 6 && n2 != 6 && (d1 > 1 || d2 == 1)) return -1\n  if (n2 == 6 && n1 != 6 && (d2 > 1 || d1 == 1)) return 1\n  if (n2 * d1 > n1 * d2) return -1\n  if (n2 * d1 < n1 * d2) return 1\n  if (n2 > n1) return -1\n  return 1\n}\n\nfunction selectDoubleBondShiftChain(struct: Struct, bond: ReBond): number {\n  if (!bond.b.hb1 || !bond.b.hb2) return 0\n\n  const hb1 = struct.halfBonds.get(bond.b.hb1)\n  const hb2 = struct.halfBonds.get(bond.b.hb2)\n  if (!hb1 || !hb2) return 0\n  const nLeft = (hb1.leftSin > 0.3 ? 1 : 0) + (hb2.rightSin > 0.3 ? 1 : 0)\n  const nRight = (hb2.leftSin > 0.3 ? 1 : 0) + (hb1.rightSin > 0.3 ? 1 : 0)\n  if (nLeft > nRight) return -1\n  if (nLeft < nRight) return 1\n  if ((hb1.leftSin > 0.3 ? 1 : 0) + (hb1.rightSin > 0.3 ? 1 : 0) == 1) return 1\n  return 0\n}\n\nexport default ReBond\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Box2Abs, Scale } from 'ketcher-core'\n\nimport { LayerMap } from './GeneralEnumTypes'\nimport ReObject from './ReObject'\nimport draw from '../draw'\nimport util from '../util'\n\nclass ReRxnPlus extends ReObject {\n  constructor(/* chem.RxnPlus*/ plus) {\n    super('rxnPlus')\n    this.item = plus\n  }\n  static isSelectable() {\n    return true\n  }\n  highlightPath(render) {\n    var p = Scale.obj2scaled(this.item.pp, render.options)\n    var s = render.options.scale\n    /* eslint-disable no-mixed-operators*/\n    return render.paper.rect(p.x - s / 4, p.y - s / 4, s / 2, s / 2, s / 8)\n    /* eslint-enable no-mixed-operators*/\n  }\n  drawHighlight(render) {\n    var ret = this.highlightPath(render).attr(render.options.highlightStyle)\n    render.ctab.addReObjectPath(LayerMap.highlighting, this.visel, ret)\n    return ret\n  }\n  makeSelectionPlate(restruct, paper, styles) {\n    // TODO [MK] review parameters\n    return this.highlightPath(restruct.render).attr(styles.selectionStyle)\n  }\n  show(restruct, id, options) {\n    var render = restruct.render\n    var centre = Scale.obj2scaled(this.item.pp, options)\n    var path = draw.plus(render.paper, centre, options)\n    var offset = options.offset\n    if (offset != null) path.translateAbs(offset.x, offset.y)\n    this.visel.add(path, Box2Abs.fromRelBox(util.relBox(path.getBBox())))\n  }\n}\n\nexport default ReRxnPlus\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Box2Abs, RxnArrowMode, Scale, Vec2 } from 'ketcher-core'\n\nimport { LayerMap } from './GeneralEnumTypes'\nimport ReObject from './ReObject'\nimport draw from '../draw'\nimport util from '../util'\n\nclass ReRxnArrow extends ReObject {\n  constructor(/* chem.RxnArrow*/ arrow) {\n    super('rxnArrow')\n    this.item = arrow\n  }\n  static isSelectable() {\n    return true\n  }\n  highlightPath(render) {\n    var p = Scale.obj2scaled(this.item.pp, render.options)\n    var s = render.options.scale\n    return render.paper.rect(p.x - s, p.y - s / 4, 2 * s, s / 2, s / 8) // eslint-disable-line no-mixed-operators\n  }\n  drawHighlight(render) {\n    var ret = this.highlightPath(render).attr(render.options.highlightStyle)\n    render.ctab.addReObjectPath(LayerMap.highlighting, this.visel, ret)\n    return ret\n  }\n  makeSelectionPlate(restruct, paper, styles) {\n    return this.highlightPath(restruct.render).attr(styles.selectionStyle)\n  }\n  show(restruct, id, options) {\n    var render = restruct.render\n    var centre = Scale.obj2scaled(this.item.pp, options)\n    var startPoint = new Vec2(centre.x - options.scale, centre.y)\n    var endPoint = new Vec2(centre.x + options.scale, centre.y)\n    var path\n    switch (this.item.mode) {\n      case RxnArrowMode.simple:\n        path = draw.arrow(render.paper, startPoint, endPoint, options)\n        break\n      case RxnArrowMode.equilibrium:\n        path = draw.equilibriumArrow(\n          render.paper,\n          startPoint,\n          endPoint,\n          options\n        )\n        break\n      default:\n        break\n    }\n    var offset = options.offset\n    if (offset != null) path.translateAbs(offset.x, offset.y)\n    this.visel.add(path, Box2Abs.fromRelBox(util.relBox(path.getBBox())))\n  }\n}\nexport default ReRxnArrow\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Box2Abs, Scale, Vec2 } from 'ketcher-core'\n\nimport ReObject from './ReObject'\n\nclass ReFrag extends ReObject {\n  constructor(/* Struct.Fragment */ frag) {\n    super('frag')\n    this.item = frag\n  }\n  static isSelectable() {\n    return false\n  }\n  fragGetAtoms(restruct, fid) {\n    return Array.from(restruct.atoms.keys()).filter(\n      aid => restruct.atoms.get(aid).a.fragment === fid\n    )\n  }\n  fragGetBonds(restruct, fid) {\n    return Array.from(restruct.bonds.keys()).filter(bid => {\n      const bond = restruct.bonds.get(bid).b\n\n      const firstFrag = restruct.atoms.get(bond.begin).a.fragment\n      const secondFrag = restruct.atoms.get(bond.end).a.fragment\n\n      return firstFrag === fid && secondFrag === fid\n    })\n  }\n  calcBBox(restruct, fid, render) {\n    // TODO need to review parameter list\n    var ret\n    restruct.atoms.forEach(atom => {\n      if (atom.a.fragment !== fid) return\n\n      // TODO ReObject.calcBBox to be used instead\n      let bba = atom.visel.boundingBox\n      if (!bba) {\n        bba = new Box2Abs(atom.a.pp, atom.a.pp)\n        const ext = new Vec2(0.05 * 3, 0.05 * 3)\n        bba = bba.extend(ext, ext)\n      } else {\n        if (!render) render = global._ui_editor.render // eslint-disable-line\n        bba = bba\n          .translate((render.options.offset || new Vec2()).negated())\n          .transform(Scale.scaled2obj, render.options)\n      }\n      ret = ret ? Box2Abs.union(ret, bba) : bba\n    })\n\n    return ret\n  }\n  // TODO need to review parameter list\n  _draw(render, fid, attrs) {\n    // eslint-disable-line no-underscore-dangle\n    const bb = this.calcBBox(render.ctab, fid, render)\n\n    if (bb) {\n      const p0 = Scale.obj2scaled(new Vec2(bb.p0.x, bb.p0.y), render.options)\n      const p1 = Scale.obj2scaled(new Vec2(bb.p1.x, bb.p1.y), render.options)\n      return render.paper\n        .rect(p0.x, p0.y, p1.x - p0.x, p1.y - p0.y, 0)\n        .attr(attrs)\n    }\n\n    // TODO abnormal situation, empty fragments must be destroyed by tools\n    return console.assert(null, 'Empty fragment')\n  }\n  draw(render) {\n    // eslint-disable-line no-unused-vars\n    return null // this._draw(render, fid, { 'stroke' : 'lightgray' }); // [RB] for debugging only\n  }\n  drawHighlight(render) {\n    // eslint-disable-line no-unused-vars\n    // Do nothing. This method shouldn't actually be called.\n  }\n  setHighlight(highLight, render) {\n    let fid = render.ctab.frags.keyOf(this)\n\n    if (!fid && fid !== 0) {\n      console.warn('Fragment does not belong to the render')\n      return\n    }\n\n    fid = parseInt(fid, 10)\n\n    render.ctab.atoms.forEach(atom => {\n      if (atom.a.fragment === fid) atom.setHighlight(highLight, render)\n    })\n\n    render.ctab.bonds.forEach(bond => {\n      if (render.ctab.atoms.get(bond.b.begin).a.fragment === fid)\n        bond.setHighlight(highLight, render)\n    })\n  }\n}\nexport default ReFrag\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Box2Abs, Scale, Vec2 } from 'ketcher-core'\n\nimport { LayerMap } from './GeneralEnumTypes'\nimport ReObject from './ReObject'\nimport draw from '../draw'\nimport util from '../util'\n\nvar BORDER_EXT = new Vec2(0.05 * 3, 0.05 * 3)\nclass ReRGroup extends ReObject {\n  constructor(/* RGroup*/ rgroup) {\n    super('rgroup')\n    this.labelBox = null\n    this.item = rgroup\n  }\n  static isSelectable() {\n    return false\n  }\n  getAtoms(render) {\n    var ret = []\n    this.item.frags.forEach(fid => {\n      ret = ret.concat(\n        render.ctab.frags.get(fid).fragGetAtoms(render.ctab, fid)\n      )\n    })\n    return ret\n  }\n  getBonds(render) {\n    var ret = []\n    this.item.frags.forEach(fid => {\n      ret = ret.concat(\n        render.ctab.frags.get(fid).fragGetBonds(render.ctab, fid)\n      )\n    })\n    return ret\n  }\n  calcBBox(render) {\n    let ret = null\n    this.item.frags.forEach(fid => {\n      const bbf = render.ctab.frags.get(fid).calcBBox(render.ctab, fid, render)\n      if (bbf) ret = ret ? Box2Abs.union(ret, bbf) : bbf\n    })\n\n    if (ret) ret = ret.extend(BORDER_EXT, BORDER_EXT)\n\n    return ret\n  }\n  // TODO need to review parameter list\n  draw(render, options) {\n    // eslint-disable-line max-statements\n    const bb = this.calcBBox(render)\n\n    if (!bb) {\n      console.error(\n        'Abnormal situation, empty fragments must be destroyed by tools'\n      )\n      return {}\n    }\n\n    const ret = { data: [] }\n    const p0 = Scale.obj2scaled(bb.p0, options)\n    const p1 = Scale.obj2scaled(bb.p1, options)\n    const brackets = render.paper.set()\n\n    rGroupdrawBrackets(brackets, render, bb) // eslint-disable-line new-cap\n\n    ret.data.push(brackets)\n    const key = render.ctab.rgroups.keyOf(this)\n    const labelSet = render.paper.set()\n    const label = render.paper\n      .text(p0.x, (p0.y + p1.y) / 2, 'R' + key + '=')\n      .attr({\n        font: options.font,\n        'font-size': options.fontRLabel,\n        fill: 'black'\n      })\n\n    const labelBox = util.relBox(label.getBBox())\n    label.translateAbs(-labelBox.width / 2 - options.lineWidth, 0)\n\n    labelSet.push(label)\n    const logicStyle = {\n      font: options.font,\n      'font-size': options.fontRLogic,\n      fill: 'black'\n    }\n\n    const logic = [rLogicToString(key, this.item)]\n\n    let shift = labelBox.height / 2 + options.lineWidth / 2\n    for (let i = 0; i < logic.length; ++i) {\n      const logicPath = render.paper\n        .text(p0.x, (p0.y + p1.y) / 2, logic[i])\n        .attr(logicStyle)\n      const logicBox = util.relBox(logicPath.getBBox())\n      shift += logicBox.height / 2\n      logicPath.translateAbs(-logicBox.width / 2 - 6 * options.lineWidth, shift)\n      shift += logicBox.height / 2 + options.lineWidth / 2\n      ret.data.push(logicPath)\n      labelSet.push(logicPath)\n    }\n\n    ret.data.push(label)\n    this.labelBox = Box2Abs.fromRelBox(labelSet.getBBox()).transform(\n      Scale.scaled2obj,\n      render.options\n    )\n    return ret\n  }\n  // TODO need to review parameter list\n  _draw(render, rgid, attrs) {\n    // eslint-disable-line no-underscore-dangle\n    const bb = this.getVBoxObj(render).extend(BORDER_EXT, BORDER_EXT) // eslint-disable-line no-underscore-dangle\n\n    if (!bb) return null\n\n    const p0 = Scale.obj2scaled(bb.p0, render.options)\n    const p1 = Scale.obj2scaled(bb.p1, render.options)\n    return render.paper\n      .rect(p0.x, p0.y, p1.x - p0.x, p1.y - p0.y, 0)\n      .attr(attrs)\n  }\n  drawHighlight(render) {\n    const rgid = render.ctab.rgroups.keyOf(this)\n\n    if (!rgid) {\n      console.error(\n        'Abnormal situation, fragment does not belong to the render'\n      )\n      return null\n    }\n\n    const ret = this._draw(\n      render,\n      rgid,\n      render.options.highlightStyle /* { 'fill' : 'red' }*/\n    ) // eslint-disable-line no-underscore-dangle\n    render.ctab.addReObjectPath(LayerMap.highlighting, this.visel, ret)\n\n    this.item.frags.forEach((fnum, fid) => {\n      render.ctab.frags.get(fid).drawHighlight(render)\n    })\n\n    return ret\n  }\n  show(restruct, id, options) {\n    const drawing = this.draw(restruct.render, options)\n\n    Object.keys(drawing).forEach(group => {\n      while (drawing[group].length > 0)\n        restruct.addReObjectPath(\n          LayerMap.data,\n          this.visel,\n          drawing[group].shift(),\n          null,\n          true\n        )\n    })\n    // TODO rgroup selection & highlighting\n  }\n}\n\nfunction rGroupdrawBrackets(set, render, bb, d) {\n  d = Scale.obj2scaled(d || new Vec2(1, 0), render.options)\n  var bracketWidth = Math.min(0.25, bb.sz().x * 0.3)\n  var bracketHeight = bb.p1.y - bb.p0.y\n  var cy = 0.5 * (bb.p1.y + bb.p0.y)\n\n  var leftBracket = draw.bracket(\n    render.paper,\n    d.negated(),\n    d.negated().rotateSC(1, 0),\n    Scale.obj2scaled(new Vec2(bb.p0.x, cy), render.options),\n    bracketWidth,\n    bracketHeight,\n    render.options\n  )\n\n  var rightBracket = draw.bracket(\n    render.paper,\n    d,\n    d.rotateSC(1, 0),\n    Scale.obj2scaled(new Vec2(bb.p1.x, cy), render.options),\n    bracketWidth,\n    bracketHeight,\n    render.options\n  )\n\n  return set.push(leftBracket, rightBracket)\n}\n\nfunction rLogicToString(id, rLogic) {\n  const ifThen = rLogic.ifthen > 0 ? 'IF ' : ''\n\n  const rangeExists =\n    rLogic.range.startsWith('>') ||\n    rLogic.range.startsWith('<') ||\n    rLogic.range.startsWith('=')\n\n  let range = null\n  if (rLogic.range.length > 0)\n    range = rangeExists ? rLogic.range : '=' + rLogic.range\n  else range = '>0'\n\n  const restH = rLogic.resth ? ' (RestH)' : ''\n  const nextRg = rLogic.ifthen > 0 ? '\\nTHEN R' + rLogic.ifthen.toString() : ''\n\n  return `${ifThen}R${id.toString()}${range}${restH}${nextRg}`\n}\n\nexport default ReRGroup\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Box2Abs, Scale, StereoFlag } from 'ketcher-core'\n\nimport { Fragment } from 'ketcher-core'\nimport { LayerMap } from './GeneralEnumTypes'\nimport ReObject from './ReObject'\nimport ReStruct from './index'\nimport Render from '..'\n\nclass ReEnhancedFlag extends ReObject {\n  #path: any\n\n  constructor() {\n    super('enhancedFlag')\n  }\n\n  static isSelectable() {\n    return true\n  }\n  highlightPath(render: Render): any {\n    var box = Box2Abs.fromRelBox(this.#path.getBBox())\n    var sz = box.p1.sub(box.p0)\n    var p0 = box.p0.sub(render.options.offset)\n    return render.paper.rect(p0.x, p0.y, sz.x, sz.y)\n  }\n  drawHighlight(render: Render): any {\n    // TODO: after the enhanced flag stops being displayed, need to remove the reEnhancedflag object from ctab\n    if (!this.#path?.attrs) return null\n    var ret = this.highlightPath(render).attr(render.options.highlightStyle)\n    render.ctab.addReObjectPath(LayerMap.highlighting, this.visel, ret)\n    return ret\n  }\n  // @ts-ignore\n  makeSelectionPlate(restruct: ReStruct, paper: any, options: any): any {\n    // TODO: after the enhanced flag stops being displayed, need to remove the reEnhancedflag object from ctab\n    if (!this.#path?.attrs) return null\n    return this.highlightPath(restruct.render).attr(options.selectionStyle)\n  }\n\n  show(restruct: ReStruct, fragmentId: number, options: any): void {\n    const render = restruct.render\n    const fragment = restruct.molecule.frags.get(fragmentId)\n    if (!fragment?.enhancedStereoFlag) return\n\n    const position = fragment.stereoFlagPosition\n      ? fragment.stereoFlagPosition\n      : Fragment.getDefaultStereoFlagPosition(restruct.molecule, fragmentId)!\n\n    const paper = render.paper\n    const ps = Scale.obj2scaled(position, options)\n\n    const stereoFlagMap = {\n      [StereoFlag.Abs]: options.absFlagLabel,\n      [StereoFlag.And]: options.andFlagLabel,\n      [StereoFlag.Mixed]: options.mixedFlagLabel,\n      [StereoFlag.Or]: options.orFlagLabel\n    }\n\n    if (options.showStereoFlags) {\n      this.#path = paper\n        .text(\n          ps.x,\n          ps.y,\n          fragment.enhancedStereoFlag\n            ? stereoFlagMap[fragment.enhancedStereoFlag]\n            : ''\n        )\n        .attr({\n          font: options.font,\n          'font-size': options.fontsz,\n          fill: '#000'\n        })\n    }\n    render.ctab.addReObjectPath(\n      LayerMap.data,\n      this.visel,\n      this.#path,\n      null,\n      true\n    )\n  }\n}\n\nexport default ReEnhancedFlag\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { LayerMap } from './GeneralEnumTypes'\nimport ReObject from './ReObject'\nimport { Scale } from 'ketcher-core'\n\nclass ReDataSGroupData extends ReObject {\n  constructor(sgroup) {\n    super('sgroupData')\n    this.sgroup = sgroup\n  }\n  static isSelectable() {\n    return true\n  }\n  highlightPath(render) {\n    var box = this.sgroup.dataArea\n    var p0 = Scale.obj2scaled(box.p0, render.options)\n    var sz = Scale.obj2scaled(box.p1, render.options).sub(p0)\n    return render.paper.rect(p0.x, p0.y, sz.x, sz.y)\n  }\n  drawHighlight(render) {\n    var ret = this.highlightPath(render).attr(render.options.highlightStyle)\n    render.ctab.addReObjectPath(LayerMap.highlighting, this.visel, ret)\n    return ret\n  }\n  makeSelectionPlate(restruct, paper, styles) {\n    // TODO [MK] review parameters\n    return this.highlightPath(restruct.render).attr(styles.selectionStyle)\n  }\n}\n\nexport default ReDataSGroupData\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Box2Abs, Pile, SGroup, Scale, Vec2 } from 'ketcher-core'\n\nimport { LayerMap } from './GeneralEnumTypes'\nimport ReDataSGroupData from './redatasgroupdata'\nimport ReObject from './ReObject'\nimport draw from '../draw'\nimport util from '../util'\n\nconst tfx = util.tfx\n\nclass ReSGroup extends ReObject {\n  constructor(sgroup) {\n    super('sgroup')\n    this.item = sgroup\n  }\n  static isSelectable() {\n    return false\n  }\n  draw(remol, sgroup) {\n    var render = remol.render\n    var set = render.paper.set()\n    var atomSet = new Pile(sgroup.atoms)\n    const crossBonds = SGroup.getCrossBonds(remol.molecule, atomSet)\n    SGroup.bracketPos(sgroup, remol.molecule, crossBonds)\n    var bracketBox = sgroup.bracketBox\n    var d = sgroup.bracketDir\n    sgroup.areas = [bracketBox]\n\n    switch (sgroup.type) {\n      case 'MUL':\n        SGroupdrawBrackets(\n          set,\n          render,\n          sgroup,\n          crossBonds,\n          atomSet,\n          bracketBox,\n          d,\n          sgroup.data.mul\n        )\n        break\n      case 'SRU':\n        var connectivity = sgroup.data.connectivity || 'eu'\n        if (connectivity === 'ht') connectivity = ''\n        var subscript = sgroup.data.subscript || 'n'\n        SGroupdrawBrackets(\n          set,\n          render,\n          sgroup,\n          crossBonds,\n          atomSet,\n          bracketBox,\n          d,\n          subscript,\n          connectivity\n        )\n        break\n      case 'SUP':\n        SGroupdrawBrackets(\n          set,\n          render,\n          sgroup,\n          crossBonds,\n          atomSet,\n          bracketBox,\n          d,\n          sgroup.data.name,\n          null,\n          { 'font-style': 'italic' }\n        )\n        break\n      case 'GEN':\n        SGroupdrawBrackets(\n          set,\n          render,\n          sgroup,\n          crossBonds,\n          atomSet,\n          bracketBox,\n          d\n        )\n        break\n      case 'DAT':\n        set = drawGroupDat(remol, sgroup)\n        break\n      default:\n        break\n    }\n    return set\n  }\n  drawHighlight(render) {\n    // eslint-disable-line max-statements\n    var options = render.options\n    var paper = render.paper\n    var sGroupItem = this.item\n    var bracketBox = sGroupItem.bracketBox.transform(Scale.obj2scaled, options)\n    var lineWidth = options.lineWidth\n    var vext = new Vec2(lineWidth * 4, lineWidth * 6)\n    bracketBox = bracketBox.extend(vext, vext)\n    var d = sGroupItem.bracketDir,\n      n = d.rotateSC(1, 0)\n    var a0 = Vec2.lc2(d, bracketBox.p0.x, n, bracketBox.p0.y)\n    var a1 = Vec2.lc2(d, bracketBox.p0.x, n, bracketBox.p1.y)\n    var b0 = Vec2.lc2(d, bracketBox.p1.x, n, bracketBox.p0.y)\n    var b1 = Vec2.lc2(d, bracketBox.p1.x, n, bracketBox.p1.y)\n\n    var set = paper.set()\n    sGroupItem.highlighting = paper\n      .path(\n        'M{0},{1}L{2},{3}L{4},{5}L{6},{7}L{0},{1}',\n        tfx(a0.x),\n        tfx(a0.y),\n        tfx(a1.x),\n        tfx(a1.y),\n        tfx(b1.x),\n        tfx(b1.y),\n        tfx(b0.x),\n        tfx(b0.y)\n      )\n      .attr(options.highlightStyle)\n    set.push(sGroupItem.highlighting)\n\n    SGroup.getAtoms(render.ctab.molecule, sGroupItem).forEach(aid => {\n      set.push(render.ctab.atoms.get(aid).makeHighlightPlate(render))\n    }, this)\n    SGroup.getBonds(render.ctab.molecule, sGroupItem).forEach(bid => {\n      set.push(render.ctab.bonds.get(bid).makeHighlightPlate(render))\n    }, this)\n    render.ctab.addReObjectPath(LayerMap.highlighting, this.visel, set)\n  }\n  show(restruct) {\n    var render = restruct.render\n    var sgroup = this.item\n    if (sgroup.data.fieldName !== 'MRV_IMPLICIT_H') {\n      var remol = render.ctab\n      var path = this.draw(remol, sgroup)\n      restruct.addReObjectPath(LayerMap.data, this.visel, path, null, true)\n      this.setHighlight(this.highlight, render) // TODO: fix this\n    }\n  }\n}\n\nfunction SGroupdrawBrackets(\n  set,\n  render,\n  sg,\n  crossBonds,\n  atomSet,\n  bracketBox,\n  d,\n  lowerIndexText,\n  upperIndexText,\n  indexAttribute\n) {\n  // eslint-disable-line max-params\n  var brackets = getBracketParameters(\n    render.ctab.molecule,\n    crossBonds,\n    atomSet,\n    bracketBox,\n    d,\n    render,\n    sg.id\n  )\n  var ir = -1\n  for (var i = 0; i < brackets.length; ++i) {\n    var bracket = brackets[i]\n    var path = draw.bracket(\n      render.paper,\n      Scale.obj2scaled(bracket.d, render.options),\n      Scale.obj2scaled(bracket.n, render.options),\n      Scale.obj2scaled(bracket.c, render.options),\n      bracket.w,\n      bracket.h,\n      render.options\n    )\n    set.push(path)\n    if (\n      ir < 0 ||\n      brackets[ir].d.x < bracket.d.x ||\n      (brackets[ir].d.x === bracket.d.x && brackets[ir].d.y > bracket.d.y)\n    )\n      ir = i\n  }\n  var bracketR = brackets[ir]\n  function renderIndex(text, shift) {\n    var indexPos = Scale.obj2scaled(\n      bracketR.c.addScaled(bracketR.n, shift * bracketR.h),\n      render.options\n    )\n    var indexPath = render.paper.text(indexPos.x, indexPos.y, text).attr({\n      font: render.options.font,\n      'font-size': render.options.fontszsub\n    })\n    if (indexAttribute) indexPath.attr(indexAttribute)\n    var indexBox = Box2Abs.fromRelBox(util.relBox(indexPath.getBBox()))\n    var t =\n      Math.max(util.shiftRayBox(indexPos, bracketR.d.negated(), indexBox), 3) +\n      2\n    indexPath.translateAbs(t * bracketR.d.x, t * bracketR.d.y)\n    set.push(indexPath)\n  }\n  if (lowerIndexText) renderIndex(lowerIndexText, 0.5)\n  if (upperIndexText) renderIndex(upperIndexText, -0.5)\n}\n\nfunction showValue(paper, pos, sg, options) {\n  var text = paper.text(pos.x, pos.y, sg.data.fieldValue).attr({\n    font: options.font,\n    'font-size': options.fontsz\n  })\n  var box = text.getBBox()\n  var rect = paper.rect(\n    box.x - 1,\n    box.y - 1,\n    box.width + 2,\n    box.height + 2,\n    3,\n    3\n  )\n  rect = sg.selected\n    ? rect.attr(options.selectionStyle)\n    : rect.attr({ fill: '#fff', stroke: '#fff' })\n  var st = paper.set()\n  st.push(rect, text.toFront())\n  return st\n}\n\nfunction drawGroupDat(restruct, sgroup) {\n  sgroup.areas = sgroup.bracketBox ? [sgroup.bracketBox] : []\n\n  if (sgroup.pp === null) sgroup.calculatePP(restruct.molecule)\n\n  return sgroup.data.attached\n    ? drawAttachedDat(restruct, sgroup)\n    : drawAbsoluteDat(restruct, sgroup)\n}\n\nfunction drawAbsoluteDat(restruct, sgroup) {\n  const render = restruct.render\n  const options = render.options\n  const paper = render.paper\n  const set = paper.set()\n\n  const ps = sgroup.pp.scaled(options.scale)\n  const name = showValue(paper, ps, sgroup, options)\n  const box = util.relBox(name.getBBox())\n\n  name.translateAbs(0.5 * box.width, -0.5 * box.height)\n  set.push(name)\n\n  const sbox = Box2Abs.fromRelBox(util.relBox(name.getBBox()))\n  sgroup.dataArea = sbox.transform(Scale.scaled2obj, render.options)\n\n  if (!restruct.sgroupData.has(sgroup.id))\n    restruct.sgroupData.set(sgroup.id, new ReDataSGroupData(sgroup))\n\n  return set\n}\n\nfunction drawAttachedDat(restruct, sgroup) {\n  const render = restruct.render\n  const options = render.options\n  const paper = render.paper\n  const set = paper.set()\n\n  SGroup.getAtoms(restruct, sgroup).forEach(aid => {\n    const atom = restruct.atoms.get(aid)\n    const p = Scale.obj2scaled(atom.a.pp, options)\n    const bb = atom.visel.boundingBox\n\n    if (bb !== null) p.x = Math.max(p.x, bb.p1.x)\n\n    p.x += options.lineWidth // shift a bit to the right\n\n    const nameI = showValue(paper, p, sgroup, options)\n    const boxI = util.relBox(nameI.getBBox())\n\n    nameI.translateAbs(0.5 * boxI.width, -0.3 * boxI.height)\n    set.push(nameI)\n\n    let sboxI = Box2Abs.fromRelBox(util.relBox(nameI.getBBox()))\n    sboxI = sboxI.transform(Scale.scaled2obj, render.options)\n    sgroup.areas.push(sboxI)\n  })\n\n  return set\n}\n\nfunction getBracketParameters(\n  mol,\n  crossBonds,\n  atomSet,\n  bracketBox,\n  d,\n  render,\n  id\n) {\n  // eslint-disable-line max-params\n  function BracketParams(c, d, w, h) {\n    this.c = c\n    this.d = d\n    this.n = d.rotateSC(1, 0)\n    this.w = w\n    this.h = h\n  }\n  var brackets = []\n  var n = d.rotateSC(1, 0)\n\n  const crossBondsPerAtom = Object.values(crossBonds)\n  const crossBondsValues = crossBondsPerAtom.flat()\n  if (crossBondsValues.length < 2) {\n    ;(function () {\n      d = d || new Vec2(1, 0)\n      n = n || d.rotateSC(1, 0)\n      var bracketWidth = Math.min(0.25, bracketBox.sz().x * 0.3)\n      var cl = Vec2.lc2(\n        d,\n        bracketBox.p0.x,\n        n,\n        0.5 * (bracketBox.p0.y + bracketBox.p1.y)\n      )\n      var cr = Vec2.lc2(\n        d,\n        bracketBox.p1.x,\n        n,\n        0.5 * (bracketBox.p0.y + bracketBox.p1.y)\n      )\n      var bracketHeight = bracketBox.sz().y\n\n      brackets.push(\n        new BracketParams(cl, d.negated(), bracketWidth, bracketHeight),\n        new BracketParams(cr, d, bracketWidth, bracketHeight)\n      )\n    })()\n  } else if (crossBondsValues.length === 2 && crossBondsPerAtom.length === 2) {\n    ;(function () {\n      // eslint-disable-line max-statements\n      var b1 = mol.bonds.get(crossBondsValues[0])\n      var b2 = mol.bonds.get(crossBondsValues[1])\n      var cl0 = b1.getCenter(mol)\n      var cr0 = b2.getCenter(mol)\n      var tl = -1\n      var tr = -1\n      var tt = -1\n      var tb = -1\n      var cc = Vec2.centre(cl0, cr0)\n      var dr = Vec2.diff(cr0, cl0).normalized()\n      var dl = dr.negated()\n      var dt = dr.rotateSC(1, 0)\n      var db = dt.negated()\n\n      mol.sGroupForest.children.get(id).forEach(sgid => {\n        var bba = render.ctab.sgroups.get(sgid).visel.boundingBox\n        bba = bba\n          .translate((render.options.offset || new Vec2()).negated())\n          .transform(Scale.scaled2obj, render.options)\n        tl = Math.max(tl, util.shiftRayBox(cl0, dl, bba))\n        tr = Math.max(tr, util.shiftRayBox(cr0, dr, bba))\n        tt = Math.max(tt, util.shiftRayBox(cc, dt, bba))\n        tb = Math.max(tb, util.shiftRayBox(cc, db, bba))\n      }, this)\n      tl = Math.max(tl + 0.2, 0)\n      tr = Math.max(tr + 0.2, 0)\n      tt = Math.max(Math.max(tt, tb) + 0.1, 0)\n      var bracketWidth = 0.25\n      var bracketHeight = 1.5 + tt\n      brackets.push(\n        new BracketParams(\n          cl0.addScaled(dl, tl),\n          dl,\n          bracketWidth,\n          bracketHeight\n        ),\n        new BracketParams(\n          cr0.addScaled(dr, tr),\n          dr,\n          bracketWidth,\n          bracketHeight\n        )\n      )\n    })()\n  } else {\n    ;(function () {\n      for (var i = 0; i < crossBondsValues.length; ++i) {\n        var b = mol.bonds.get(crossBondsValues[i])\n        var c = b.getCenter(mol)\n        var d = atomSet.has(b.begin) ? b.getDir(mol) : b.getDir(mol).negated()\n        brackets.push(new BracketParams(c, d, 0.2, 1.0))\n      }\n    })()\n  }\n  return brackets\n}\n\nexport default ReSGroup\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Box2Abs, Scale, SimpleObjectMode, Vec2 } from 'ketcher-core'\n\nimport { LayerMap } from './GeneralEnumTypes'\nimport ReObject from './ReObject'\nimport ReStruct from './index'\nimport Render from '..'\nimport draw from '../draw'\nimport util from '../util'\n\nconst tfx = util.tfx\ninterface MinDistanceWithReferencePoint {\n  minDist: number\n  refPoint: Vec2 | null\n}\ninterface StyledPath {\n  path: any\n  stylesApplied: boolean\n}\nclass ReSimpleObject extends ReObject {\n  private item: any\n\n  constructor(simpleObject: any) {\n    super('simpleObject')\n    this.item = simpleObject\n  }\n  static isSelectable(): boolean {\n    return true\n  }\n  calcDistance(p: Vec2, s: any): MinDistanceWithReferencePoint {\n    const point: Vec2 = new Vec2(p.x, p.y)\n    let dist: number\n    let distRef: MinDistanceWithReferencePoint\n    const item = this.item\n    const mode = item.mode\n    const pos = item.pos\n\n    switch (mode) {\n      case SimpleObjectMode.ellipse: {\n        const rad = Vec2.diff(pos[1], pos[0])\n        const rx = rad.x / 2\n        const ry = rad.y / 2\n        const center = Vec2.sum(pos[0], new Vec2(rx, ry))\n        const pointToCenter = Vec2.diff(point, center)\n        if (rx !== 0 && ry !== 0) {\n          dist = Math.abs(\n            1 -\n              (pointToCenter.x * pointToCenter.x) / (rx * rx) -\n              (pointToCenter.y * pointToCenter.y) / (ry * ry)\n          )\n        } else {\n          // in case rx or ry is equal to 0 we have a line as a trivial case of ellipse\n          // in such case distance need to be calculated as a distance between line and current point\n          dist = calculateDistanceToLine(pos, point)\n        }\n        break\n      }\n      case SimpleObjectMode.rectangle: {\n        const topX = Math.min(pos[0].x, pos[1].x)\n        const topY = Math.min(pos[0].y, pos[1].y)\n        const bottomX = Math.max(pos[0].x, pos[1].x)\n        const bottomY = Math.max(pos[0].y, pos[1].y)\n\n        const distances: Array<number> = []\n\n        if (point.x >= topX && point.x <= bottomX) {\n          if (point.y < topY) {\n            distances.push(topY - point.y)\n          } else if (point.y > bottomY) {\n            distances.push(point.y - bottomY)\n          } else {\n            distances.push(point.y - topY, bottomY - point.y)\n          }\n        }\n        if (point.x < topX && point.y < topY) {\n          distances.push(Vec2.dist(new Vec2(topX, topY), point))\n        }\n        if (point.x > bottomX && point.y > bottomY) {\n          distances.push(Vec2.dist(new Vec2(bottomX, bottomY), point))\n        }\n        if (point.x < topX && point.y > bottomY) {\n          distances.push(Vec2.dist(new Vec2(topX, bottomY), point))\n        }\n        if (point.x > bottomX && point.y < topY) {\n          distances.push(Vec2.dist(new Vec2(bottomX, topY), point))\n        }\n        if (point.y >= topY && point.y <= bottomY) {\n          if (point.x < topX) {\n            distances.push(topX - point.x)\n          } else if (point.x > bottomX) {\n            distances.push(point.x - bottomX)\n          } else {\n            distances.push(point.x - topX, bottomX - point.x)\n          }\n        }\n        dist = Math.min(...distances)\n        break\n      }\n      case SimpleObjectMode.line: {\n        dist = calculateDistanceToLine(pos, point)\n        break\n      }\n\n      default: {\n        throw new Error('Unsupported shape type')\n      }\n    }\n\n    distRef = this.getReferencePointDistance(p)\n    const refPoint: Vec2 | null =\n      distRef.minDist <= 8 / s ? distRef.refPoint : null\n    // distance is a smallest between dist to figure and it's reference points\n    dist = Math.min(distRef.minDist, dist)\n    return { minDist: dist, refPoint }\n  }\n\n  getReferencePointDistance(p: Vec2): MinDistanceWithReferencePoint {\n    let dist: any = []\n    const refPoints = this.getReferencePoints()\n    refPoints.forEach(rp => {\n      dist.push({ minDist: Math.abs(Vec2.dist(p, rp)), refPoint: rp })\n    })\n\n    const minDist: MinDistanceWithReferencePoint = dist.reduce(\n      (acc, current) =>\n        !acc ? current : acc.minDist < current.minDist ? acc : current,\n      null\n    )\n\n    return minDist\n  }\n  getReferencePoints(onlyOnObject: boolean = false): Array<Vec2> {\n    const refPoints: Array<Vec2> = []\n    switch (this.item.mode) {\n      case SimpleObjectMode.ellipse:\n      case SimpleObjectMode.rectangle: {\n        const p0: Vec2 = new Vec2(\n          Math.min(this.item.pos[0].x, this.item.pos[1].x),\n          Math.min(this.item.pos[0].y, this.item.pos[1].y)\n        )\n        const w = Math.abs(Vec2.diff(this.item.pos[0], this.item.pos[1]).x)\n        const h = Math.abs(Vec2.diff(this.item.pos[0], this.item.pos[1]).y)\n\n        refPoints.push(\n          new Vec2(p0.x + 0.5 * w, p0.y),\n          new Vec2(p0.x + w, p0.y + 0.5 * h),\n          new Vec2(p0.x + 0.5 * w, p0.y + h),\n          new Vec2(p0.x, p0.y + 0.5 * h)\n        )\n        if (!onlyOnObject || this.item.mode === SimpleObjectMode.rectangle) {\n          refPoints.push(\n            p0,\n            new Vec2(p0.x, p0.y + h),\n            new Vec2(p0.x + w, p0.y + h),\n            new Vec2(p0.x + w, p0.y)\n          )\n        }\n        break\n      }\n      case SimpleObjectMode.line: {\n        this.item.pos.forEach(i => refPoints.push(new Vec2(i.x, i.y, 0)))\n        break\n      }\n\n      default: {\n        throw new Error('Unsupported shape type')\n      }\n    }\n    return refPoints\n  }\n  highlightPath(render: Render): Array<StyledPath> {\n    const point: Array<Vec2> = []\n\n    this.item.pos.forEach((p, index) => {\n      point[index] = Scale.obj2scaled(p, render.options)\n    })\n    const scaleFactor = render.options.scale\n\n    const path: Array<any> = []\n\n    //TODO: It seems that inheritance will be the better approach here\n    switch (this.item.mode) {\n      case SimpleObjectMode.ellipse: {\n        const rad = Vec2.diff(point[1], point[0])\n        const rx = rad.x / 2\n        const ry = rad.y / 2\n        path.push(\n          render.paper.ellipse(\n            tfx(point[0].x + rx),\n            tfx(point[0].y + ry),\n            tfx(Math.abs(rx) + scaleFactor / 8),\n            tfx(Math.abs(ry) + scaleFactor / 8)\n          )\n        )\n        if (\n          Math.abs(rx) - scaleFactor / 8 > 0 &&\n          Math.abs(ry) - scaleFactor / 8 > 0\n        )\n          path.push(\n            render.paper.ellipse(\n              tfx(point[0].x + rx),\n              tfx(point[0].y + ry),\n              tfx(Math.abs(rx) - scaleFactor / 8),\n              tfx(Math.abs(ry) - scaleFactor / 8)\n            )\n          )\n        break\n      }\n\n      case SimpleObjectMode.rectangle: {\n        path.push(\n          render.paper.rect(\n            tfx(Math.min(point[0].x, point[1].x) - scaleFactor / 8),\n            tfx(Math.min(point[0].y, point[1].y) - scaleFactor / 8),\n            tfx(\n              Math.max(point[0].x, point[1].x) -\n                Math.min(point[0].x, point[1].x) +\n                scaleFactor / 4\n            ),\n            tfx(\n              Math.max(point[0].y, point[1].y) -\n                Math.min(point[0].y, point[1].y) +\n                scaleFactor / 4\n            )\n          )\n        )\n\n        path.push(\n          render.paper.rect(\n            tfx(Math.min(point[0].x, point[1].x) + scaleFactor / 8),\n            tfx(Math.min(point[0].y, point[1].y) + scaleFactor / 8),\n            tfx(\n              Math.max(point[0].x, point[1].x) -\n                Math.min(point[0].x, point[1].x) -\n                scaleFactor / 4\n            ),\n            tfx(\n              Math.max(point[0].y, point[1].y) -\n                Math.min(point[0].y, point[1].y) -\n                scaleFactor / 4\n            )\n          )\n        )\n\n        break\n      }\n      case SimpleObjectMode.line: {\n        //TODO: reuse this code for polyline\n        const poly: Array<string | number> = []\n\n        let angle = Math.atan(\n          (point[1].y - point[0].y) / (point[1].x - point[0].x)\n        )\n\n        const p0 = { x: 0, y: 0 }\n        const p1 = { x: 0, y: 0 }\n\n        const k = point[0].x > point[1].x ? -1 : 1\n\n        p0.x = point[0].x - k * ((scaleFactor / 8) * Math.cos(angle))\n        p0.y = point[0].y - k * ((scaleFactor / 8) * Math.sin(angle))\n        p1.x = point[1].x + k * ((scaleFactor / 8) * Math.cos(angle))\n        p1.y = point[1].y + k * ((scaleFactor / 8) * Math.sin(angle))\n\n        poly.push(\n          'M',\n          p0.x + ((k * scaleFactor) / 8) * Math.sin(angle),\n          p0.y - ((k * scaleFactor) / 8) * Math.cos(angle)\n        )\n        poly.push(\n          'L',\n          p1.x + ((k * scaleFactor) / 8) * Math.sin(angle),\n          p1.y - ((k * scaleFactor) / 8) * Math.cos(angle)\n        )\n        poly.push(\n          'L',\n          p1.x - ((k * scaleFactor) / 8) * Math.sin(angle),\n          p1.y + ((k * scaleFactor) / 8) * Math.cos(angle)\n        )\n        poly.push(\n          'L',\n          p0.x - ((k * scaleFactor) / 8) * Math.sin(angle),\n          p0.y + ((k * scaleFactor) / 8) * Math.cos(angle)\n        )\n        poly.push(\n          'L',\n          p0.x + ((k * scaleFactor) / 8) * Math.sin(angle),\n          p0.y - ((k * scaleFactor) / 8) * Math.cos(angle)\n        )\n\n        path.push(render.paper.path(poly))\n        break\n      }\n      default: {\n        throw new Error('Unsupported shape type')\n      }\n    }\n\n    const enhPaths: Array<StyledPath> = path.map(p => {\n      return { path: p, stylesApplied: false }\n    })\n\n    return enhPaths\n  }\n\n  drawHighlight(render: Render): Array<any> {\n    const paths: Array<any> = this.highlightPath(render).map(enhPath => {\n      if (!enhPath.stylesApplied) {\n        return enhPath.path.attr(render.options.highlightStyle)\n      }\n      return enhPath.path\n    })\n\n    render.ctab.addReObjectPath(LayerMap.highlighting, this.visel, paths)\n    return paths\n  }\n\n  makeSelectionPlate(restruct: ReStruct, paper: any, styles: any): any {\n    const pos = this.item.pos.map(p => {\n      return Scale.obj2scaled(p, restruct.render.options) || new Vec2()\n    })\n\n    const refPoints = this.getReferencePoints()\n    const scaleFactor = restruct.render.options.scale\n    var selectionSet = restruct.render.paper.set()\n    selectionSet.push(\n      generatePath(this.item.mode, paper, pos).attr(\n        styles.highlightStyleSimpleObject\n      )\n    )\n    refPoints.forEach(rp => {\n      const scaledRP = Scale.obj2scaled(rp, restruct.render.options)\n      selectionSet.push(\n        restruct.render.paper\n          .circle(scaledRP.x, scaledRP.y, scaleFactor / 8)\n          .attr({ fill: 'black' })\n      )\n    })\n    return selectionSet\n  }\n  show(restruct: ReStruct, options: any): void {\n    const render = restruct.render\n    const pos = this.item.pos.map(p => {\n      return Scale.obj2scaled(p, options) || new Vec2()\n    })\n\n    const path = generatePath(this.item.mode, render.paper, pos, options)\n\n    var offset = options.offset\n    if (offset != null) path.translateAbs(offset.x, offset.y)\n\n    // @ts-ignore\n    this.visel.add(path, Box2Abs.fromRelBox(util.relBox(path.getBBox())))\n  }\n}\nfunction calculateDistanceToLine(pos: Vec2, point: Vec2): number {\n  let dist: number\n  if (\n    (point.x < Math.min(pos[0].x, pos[1].x) ||\n      point.x > Math.max(pos[0].x, pos[1].x)) &&\n    (point.y < Math.min(pos[0].y, pos[1].y) ||\n      point.y > Math.max(pos[0].y, pos[1].y))\n  )\n    dist = Math.min(Vec2.dist(pos[0], point), Vec2.dist(pos[1], point))\n  else {\n    const a = Vec2.dist(pos[0], pos[1])\n    const b = Vec2.dist(pos[0], point)\n    const c = Vec2.dist(pos[1], point)\n    const per = (a + b + c) / 2\n    dist = (2 / a) * Math.sqrt(per * (per - a) * (per - b) * (per - c))\n  }\n  return dist\n}\n\nfunction generatePath(mode: SimpleObjectMode, paper, pos: Vec2, options?): any {\n  let path: any\n  switch (mode) {\n    case SimpleObjectMode.ellipse: {\n      path = draw.ellipse(paper, pos, options)\n      break\n    }\n    case SimpleObjectMode.rectangle: {\n      path = draw.rectangle(paper, pos, options)\n      break\n    }\n    case SimpleObjectMode.line: {\n      path = draw.line(paper, pos, options)\n      break\n    }\n    default: {\n      throw new Error('Unsupported shape type')\n    }\n  }\n\n  return path\n}\n\nexport default ReSimpleObject\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  DraftInlineStyleType,\n  RawDraftContentBlock,\n  RawDraftContentState,\n  RawDraftInlineStyleRange\n} from 'draft-js'\nimport { Scale, Text, TextCommand, Vec2 } from 'ketcher-core'\nimport { flatten, isEqual } from 'lodash/fp'\n\nimport { LayerMap } from './GeneralEnumTypes'\nimport ReObject from './ReObject'\nimport ReStruct from './ReStruct'\n\nclass ReText extends ReObject {\n  private item: Text\n  paths: Array<Array<any>> = []\n\n  constructor(text: Text) {\n    super('text')\n    this.item = text\n  }\n  static isSelectable() {\n    return true\n  }\n\n  getReferencePoints(): Array<Vec2> {\n    const { p0, p1 } = this.getRelBox(this.paths)\n\n    const p = this.item.position\n    const w = Math.abs(Vec2.diff(p0, p1).x) / 40\n    const h = Math.abs(Vec2.diff(p0, p1).y) / 40\n\n    const refPoints: Array<Vec2> = []\n\n    refPoints.push(\n      this.item.position,\n      new Vec2(p.x, p.y + h),\n      new Vec2(p.x + w, p.y + h),\n      new Vec2(p.x + w, p.y)\n    )\n\n    return refPoints\n  }\n\n  highlightPath(render: any): any {\n    const { p0, p1 } = this.getRelBox(this.paths)\n    const topLeft = p0.sub(render.options.offset)\n    const { x: width, y: height } = p1.sub(p0)\n\n    return render.paper.rect(topLeft.x, topLeft.y, width, height, 5)\n  }\n\n  getRelBox(paths: Array<Array<any>>): { p0: Vec2; p1: Vec2 } {\n    const firstElOfFirstRow: any = paths[0][0]\n    const leftEdge = firstElOfFirstRow.getBBox().x\n\n    const firstRow: Array<any> = paths[0]\n    const topEdge: number = Math.min(...firstRow.map(path => path.getBBox().y))\n\n    const widestRow: Array<any> = paths.reduce(\n      (widestRow, nextRow) =>\n        this.getRowWidth(nextRow) > this.getRowWidth(widestRow)\n          ? nextRow\n          : widestRow,\n      paths[0]\n    )\n    const lastElOfWidestRow: any = widestRow[widestRow.length - 1]\n    const rightEdge: number =\n      lastElOfWidestRow.getBBox().x + lastElOfWidestRow.getBBox().width\n\n    const lastRow: Array<any> = paths[paths.length - 1]\n    const bottomEdge: number = Math.max(\n      ...lastRow.map(path => path.getBBox().y + path.getBBox().height)\n    )\n\n    return {\n      p0: new Vec2(leftEdge, topEdge),\n      p1: new Vec2(rightEdge, bottomEdge)\n    }\n  }\n\n  getRowWidth(row: Array<any>): number {\n    return row.reduce((rowWidth, nextRow) => {\n      rowWidth += nextRow.getBBox().width\n      return rowWidth\n    }, 0)\n  }\n\n  drawHighlight(render: any): any {\n    if (!this.paths.length) return null\n    const ret = this.highlightPath(render).attr(render.options.highlightStyle)\n    render.ctab.addReObjectPath(LayerMap.highlighting, this.visel, ret)\n    return ret\n  }\n\n  makeSelectionPlate(restruct: ReStruct, paper: any, options: any): any {\n    if (!this.paths.length || !paper) return null\n    return this.highlightPath(restruct.render).attr(options.selectionStyle)\n  }\n\n  show(restruct: ReStruct, _id: number, options: any): void {\n    const render = restruct.render\n    const paper = render.paper\n    const paperScale = Scale.obj2scaled(this.item.position, options)\n\n    let shiftY: number = 0\n    this.paths = []\n    //TODO: create parser in ketcher-core package\n    const rawContentState: RawDraftContentState | null = this.item.content\n      ? (JSON.parse(this.item.content) as RawDraftContentState)\n      : null\n    if (!rawContentState) return\n\n    rawContentState.blocks.forEach((block: RawDraftContentBlock) => {\n      const ranges: Array<\n        [number, number, Record<string, any>]\n      > = this.getRanges(block, options)\n\n      let shiftX: number = 0\n      const row: Array<any> = []\n      ranges.forEach(([start, end, styles]) => {\n        block.text = block.text.replace(/[^\\S\\r\\n]/g, '\\u00a0')\n\n        const path = paper\n          .text(\n            paperScale.x,\n            paperScale.y,\n            block.text.substring(start, end + 1) || '\\u00a0'\n          )\n          .attr({\n            font: options.font,\n            'font-size': options.fontsz,\n            'text-anchor': 'start',\n            fill: '#000000',\n            ...styles\n          })\n\n        path.translateAbs(shiftX, shiftY + (styles.shiftY || 0))\n\n        row.push(path)\n        shiftX += path.getBBox().width\n      })\n\n      this.paths.push(row)\n\n      const { p0, p1 } = this.getRelBox([row])\n      shiftY += Math.abs(Vec2.diff(p0, p1).y)\n    })\n\n    render.ctab.addReObjectPath(\n      LayerMap.data,\n      this.visel,\n      flatten(this.paths),\n      null,\n      true\n    )\n  }\n\n  getRanges(\n    block: RawDraftContentBlock,\n    options: any\n  ): Array<[number, number, Record<string, any>]> {\n    const ranges: Array<[number, number, Record<string, any>]> = []\n\n    let start: number = 0\n    let styles: Record<string, any> = this.getStyles(block, start, options)\n    for (let i = 1; i < block.text.length; i++) {\n      const nextStyles = this.getStyles(block, i, options)\n\n      if (!isEqual(styles, nextStyles)) {\n        ranges.push([start, i - 1, styles])\n        styles = nextStyles\n        start = i\n      }\n    }\n    ranges.push([start, block.text.length - 1, styles])\n\n    return ranges\n  }\n\n  getStyles(\n    block: RawDraftContentBlock,\n    index: number,\n    options: any\n  ): Record<string, string> {\n    return block.inlineStyleRanges\n      .filter(\n        (inlineRange: CustomRawDraftInlineStyleRange) =>\n          inlineRange.offset <= index &&\n          index < inlineRange.offset + inlineRange.length\n      )\n      .reduce((styles: any, textRange: CustomRawDraftInlineStyleRange) => {\n        switch (textRange.style) {\n          case TextCommand.Bold:\n            styles['font-weight'] = 'bold'\n            break\n\n          case TextCommand.Italic:\n            styles['font-style'] = 'italic'\n            break\n\n          case TextCommand.Subscript:\n            styles['font-size'] = options.fontszsub + 'px'\n            styles.shiftY = options.fontsz / 3\n            break\n\n          case TextCommand.Superscript:\n            styles['font-size'] = options.fontszsub + 'px'\n            styles.shiftY = -options.fontsz / 3\n            break\n\n          default:\n        }\n\n        return styles\n      }, {})\n  }\n}\n\ninterface CustomRawDraftInlineStyleRange\n  extends Omit<RawDraftInlineStyleRange, 'style'> {\n  style: DraftInlineStyleType | TextCommand.Subscript | TextCommand.Superscript\n}\n\nexport default ReText\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Bond, Scale, Vec2 } from 'ketcher-core'\n\nimport { LayerMap } from './GeneralEnumTypes'\nimport ReObject from './ReObject'\nimport util from '../util'\n\nconst tfx = util.tfx\n\nclass ReLoop extends ReObject {\n  constructor(loop) {\n    super('loop')\n    this.loop = loop\n    this.centre = new Vec2()\n    this.radius = new Vec2()\n  }\n  static isSelectable() {\n    return false\n  }\n  show(restruct, rlid, options) {\n    // eslint-disable-line max-statements\n    var render = restruct.render\n    var paper = render.paper\n    var molecule = restruct.molecule\n    var loop = this.loop\n    this.centre = new Vec2()\n    loop.hbs.forEach(hbid => {\n      var hb = molecule.halfBonds.get(hbid)\n      var bond = restruct.bonds.get(hb.bid)\n      var apos = Scale.obj2scaled(restruct.atoms.get(hb.begin).a.pp, options)\n      if (bond.b.type !== Bond.PATTERN.TYPE.AROMATIC) loop.aromatic = false\n      this.centre.add_(apos) // eslint-disable-line no-underscore-dangle\n    })\n    loop.convex = true\n    for (var k = 0; k < this.loop.hbs.length; ++k) {\n      var hba = molecule.halfBonds.get(loop.hbs[k])\n      var hbb = molecule.halfBonds.get(loop.hbs[(k + 1) % loop.hbs.length])\n      var angle = Math.atan2(\n        Vec2.cross(hba.dir, hbb.dir),\n        Vec2.dot(hba.dir, hbb.dir)\n      )\n      if (angle > 0) loop.convex = false\n    }\n\n    this.centre = this.centre.scaled(1.0 / loop.hbs.length)\n    this.radius = -1\n    loop.hbs.forEach(hbid => {\n      var hb = molecule.halfBonds.get(hbid)\n      var apos = Scale.obj2scaled(restruct.atoms.get(hb.begin).a.pp, options)\n      var bpos = Scale.obj2scaled(restruct.atoms.get(hb.end).a.pp, options)\n      var n = Vec2.diff(bpos, apos).rotateSC(1, 0).normalized()\n      var dist = Vec2.dot(Vec2.diff(apos, this.centre), n)\n      this.radius = this.radius < 0 ? dist : Math.min(this.radius, dist)\n    })\n    this.radius *= 0.7\n    if (!loop.aromatic) return\n    var path = null\n    if (loop.convex && options.aromaticCircle) {\n      path = paper.circle(this.centre.x, this.centre.y, this.radius).attr({\n        stroke: '#000',\n        'stroke-width': options.lineattr['stroke-width']\n      })\n    } else {\n      var pathStr = ''\n      for (k = 0; k < loop.hbs.length; ++k) {\n        hba = molecule.halfBonds.get(loop.hbs[k])\n        hbb = molecule.halfBonds.get(loop.hbs[(k + 1) % loop.hbs.length])\n        angle = Math.atan2(\n          Vec2.cross(hba.dir, hbb.dir),\n          Vec2.dot(hba.dir, hbb.dir)\n        )\n        var halfAngle = (Math.PI - angle) / 2\n        var dir = hbb.dir.rotate(halfAngle)\n        var pi = Scale.obj2scaled(restruct.atoms.get(hbb.begin).a.pp, options)\n        var sin = Math.sin(halfAngle)\n        var minSin = 0.1\n        if (Math.abs(sin) < minSin) sin = (sin * minSin) / Math.abs(sin)\n        var offset = options.bondSpace / sin\n        var qi = pi.addScaled(dir, -offset)\n        pathStr += k === 0 ? 'M' : 'L'\n        pathStr += tfx(qi.x) + ',' + tfx(qi.y)\n      }\n      pathStr += 'Z'\n      path = paper.path(pathStr).attr({\n        stroke: '#000',\n        'stroke-width': options.lineattr['stroke-width'],\n        'stroke-dasharray': '- '\n      })\n    }\n    restruct.addReObjectPath(LayerMap.data, this.visel, path, null, true)\n  }\n  isValid(struct, rlid) {\n    const halfBonds = struct.halfBonds\n    return this.loop.hbs.every(\n      hbid => halfBonds.has(hbid) && halfBonds.get(hbid).loop === rlid\n    )\n  }\n}\n\nexport default ReLoop\n","import { Box2Abs, Pile, Pool, Struct, Vec2 } from 'ketcher-core'\n\nimport { LayerMap } from './GeneralEnumTypes'\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport ReAtom from './reatom'\nimport ReBond from './rebond'\nimport ReDataSGroupData from './redatasgroupdata'\nimport ReEnhancedFlag from './ReEnhancedFlag'\nimport ReFrag from './refrag'\nimport ReLoop from './reloop'\nimport ReRGroup from './rergroup'\nimport ReRxnArrow from './rerxnarrow'\nimport ReRxnPlus from './rerxnplus'\nimport ReSGroup from './resgroup'\nimport ReSimpleObject from './ReSimpleObject'\nimport ReText from './ReText'\nimport Render from '..'\nimport Visel from './visel'\nimport util from '../util'\n\nclass ReStruct {\n  public static maps = {\n    atoms: ReAtom,\n    bonds: ReBond,\n    rxnPluses: ReRxnPlus,\n    rxnArrows: ReRxnArrow,\n    frags: ReFrag,\n    rgroups: ReRGroup,\n    sgroupData: ReDataSGroupData,\n    enhancedFlags: ReEnhancedFlag,\n    sgroups: ReSGroup,\n    reloops: ReLoop,\n    simpleObjects: ReSimpleObject,\n    texts: ReText\n  }\n  public render: Render\n  public molecule: Struct\n  public atoms: Map<number, ReAtom> = new Map()\n  public bonds: Map<number, ReBond> = new Map()\n  public reloops: Map<number, ReLoop> = new Map()\n  public rxnPluses: Map<number, ReRxnPlus> = new Map()\n  public rxnArrows: Map<number, ReRxnArrow> = new Map()\n  public frags: Pool = new Pool()\n  public rgroups: Pool = new Pool()\n  public sgroups: Map<number, ReSGroup> = new Map()\n  public sgroupData: Map<number, ReDataSGroupData> = new Map()\n  public enhancedFlags: Map<number, ReEnhancedFlag> = new Map()\n  private simpleObjects: Map<number, ReSimpleObject> = new Map()\n  public texts: Map<number, ReText> = new Map()\n  private initialized: boolean = false\n  private layers: Array<any> = []\n  public connectedComponents: Pool = new Pool()\n  private ccFragmentType: Pool = new Pool()\n  private structChanged: boolean = false\n\n  private atomsChanged: Map<number, ReAtom> = new Map()\n  private simpleObjectsChanged: Map<number, ReSimpleObject> = new Map()\n  private rxnArrowsChanged: Map<number, ReRxnArrow> = new Map()\n  private rxnPlusesChanged: Map<number, ReRxnPlus> = new Map()\n  private enhancedFlagsChanged: Map<number, ReEnhancedFlag> = new Map()\n  private bondsChanged: Map<number, ReEnhancedFlag> = new Map()\n  private textsChanged: Map<number, ReText> = new Map()\n  constructor(molecule, render: Render) {\n    // eslint-disable-line max-statements\n    this.render = render\n    this.molecule = molecule || new Struct()\n    this.initLayers()\n    this.clearMarks()\n    // TODO: eachItem ?\n\n    molecule.atoms.forEach((atom, aid) => {\n      this.atoms.set(aid, new ReAtom(atom))\n    })\n\n    molecule.bonds.forEach((bond, bid) => {\n      this.bonds.set(bid, new ReBond(bond))\n    })\n\n    molecule.loops.forEach((loop, lid) => {\n      this.reloops.set(lid, new ReLoop(loop))\n    })\n\n    molecule.rxnPluses.forEach((item, id) => {\n      this.rxnPluses.set(id, new ReRxnPlus(item))\n    })\n\n    molecule.rxnArrows.forEach((item, id) => {\n      this.rxnArrows.set(id, new ReRxnArrow(item))\n    })\n\n    molecule.simpleObjects.forEach((item, id) => {\n      this.simpleObjects.set(id, new ReSimpleObject(item))\n    })\n\n    molecule.texts.forEach((item, id) => {\n      this.texts.set(id, new ReText(item))\n    })\n\n    molecule.frags.forEach((item, id) => {\n      this.frags.set(id, new ReFrag(item))\n      if (item) this.enhancedFlags.set(id, new ReEnhancedFlag())\n    })\n\n    molecule.rgroups.forEach((item, id) => {\n      this.rgroups.set(id, new ReRGroup(item))\n    })\n\n    molecule.sgroups.forEach((item, id) => {\n      this.sgroups.set(id, new ReSGroup(item))\n      if (item.type === 'DAT' && !item.data.attached)\n        this.sgroupData.set(id, new ReDataSGroupData(item)) // [MK] sort of a hack, we use the SGroup id for the data field id\n    })\n  }\n\n  connectedComponentRemoveAtom(aid: number, reAtom?: ReAtom): void {\n    const atom = reAtom || this.atoms.get(aid)\n    if (!atom || atom.component < 0) return\n    var cc = this.connectedComponents.get(atom.component)\n\n    cc.delete(aid)\n    if (cc.size < 1) this.connectedComponents.delete(atom.component)\n\n    atom.component = -1\n  }\n\n  clearConnectedComponents(): void {\n    this.connectedComponents.clear()\n    this.atoms.forEach(atom => {\n      atom.component = -1\n    })\n  }\n\n  getConnectedComponent(\n    aid: Array<number> | number,\n    adjacentComponents: Pile\n  ): Pile {\n    const list = Array.isArray(aid) ? Array.from(aid) : [aid]\n    const ids = new Pile()\n\n    while (list.length > 0) {\n      const aid = list.pop()!\n      ids.add(aid)\n      const atom = this.atoms.get(aid)\n      if (!atom) continue\n      if (atom.component >= 0) adjacentComponents.add(atom.component)\n\n      atom.a.neighbors.forEach(neighbor => {\n        let halfBond = this.molecule.halfBonds.get(neighbor)\n        if (!halfBond) return\n        const neiId = halfBond.end\n        if (!ids.has(neiId)) list.push(neiId)\n      })\n    }\n\n    return ids\n  }\n\n  addConnectedComponent(idSet: Pile<number>): number {\n    const compId = this.connectedComponents.add(idSet)\n    const adjacentComponents = new Pile()\n    const aidSet = this.getConnectedComponent(\n      Array.from(idSet),\n      adjacentComponents\n    )\n\n    adjacentComponents.delete(compId)\n\n    let type = -1\n    aidSet.forEach(aid => {\n      const atom = this.atoms.get(aid)\n      if (!atom) return\n      atom.component = compId\n      if (atom.a.rxnFragmentType !== -1) type = atom.a.rxnFragmentType\n    })\n\n    this.ccFragmentType.set(compId, type)\n    return compId\n  }\n\n  removeConnectedComponent(ccid: number): boolean {\n    this.connectedComponents.get(ccid).forEach(aid => {\n      const atom = this.atoms.get(aid)\n      if (atom) atom.component = -1\n    })\n\n    return this.connectedComponents.delete(ccid)\n  }\n\n  assignConnectedComponents(): void {\n    this.atoms.forEach((atom, aid) => {\n      if (atom.component >= 0) return\n\n      const adjacentComponents = new Pile()\n      const idSet = this.getConnectedComponent(aid, adjacentComponents)\n      adjacentComponents.forEach(ccid => {\n        this.removeConnectedComponent(ccid)\n      })\n\n      this.addConnectedComponent(idSet)\n    })\n  }\n\n  initLayers(): void {\n    for (const group in LayerMap) {\n      this.layers[LayerMap[group]] = this.render.paper\n        .rect(0, 0, 10, 10)\n        .attr({\n          class: group + 'Layer',\n          fill: '#000',\n          opacity: '0.0'\n        })\n        .toFront()\n    }\n  }\n\n  addReObjectPath(\n    group: LayerMap,\n    visel: Visel,\n    path,\n    pos: Vec2 | null = null,\n    visible: boolean = false\n  ): void {\n    // eslint-disable-line max-params\n    if (!path || !this.layers[group].node.parentNode) return\n\n    const paths = Array.isArray(path) ? path : [path]\n\n    paths.forEach(path => {\n      const offset = this.render.options.offset\n      let bb = visible ? Box2Abs.fromRelBox(util.relBox(path.getBBox())) : null\n      const ext = pos && bb ? bb.translate(pos.negated()) : null\n      if (offset !== null) {\n        path.translateAbs(offset.x, offset.y)\n        bb = bb ? bb.translate(offset) : null\n      }\n      visel.add(path, bb, ext)\n      path.insertBefore(this.layers[LayerMap[group]])\n    })\n  }\n\n  clearMarks(): void {\n    Object.keys(ReStruct.maps).forEach(map => {\n      this[map + 'Changed'] = new Map()\n    })\n\n    this.structChanged = false\n  }\n\n  markItemRemoved(): void {\n    this.structChanged = true\n  }\n\n  markBond(bid: number, mark: number): void {\n    this.markItem('bonds', bid, mark)\n  }\n\n  markAtom(aid: number, mark: number): void {\n    this.markItem('atoms', aid, mark)\n  }\n\n  markItem(map: string, id: number, mark: number): void {\n    const mapChanged = this[map + 'Changed']\n\n    const value = mapChanged.has(id) ? Math.max(mark, mapChanged.get(id)) : mark\n\n    mapChanged.set(id, value)\n\n    if (this[map].has(id)) this.clearVisel(this[map].get(id).visel)\n  }\n\n  clearVisel(visel: Visel): void {\n    visel.paths.forEach(path => {\n      path.remove()\n    })\n    visel.clear()\n  }\n\n  eachItem(func) {\n    Object.keys(ReStruct.maps).forEach(map => {\n      this[map].forEach(func)\n    })\n  }\n\n  getVBoxObj(selection): Box2Abs | null {\n    selection = selection || {}\n\n    if (isSelectionEmpty(selection)) {\n      Object.keys(ReStruct.maps).forEach(map => {\n        selection[map] = Array.from(this[map].keys())\n      })\n    }\n\n    let vbox: Box2Abs | null = null\n    Object.keys(ReStruct.maps).forEach(map => {\n      if (!selection[map]) return\n\n      selection[map].forEach(id => {\n        const box = this[map].get(id).getVBoxObj(this.render)\n        if (box) vbox = vbox ? Box2Abs.union(vbox, box) : box.clone()\n      })\n    })\n\n    vbox = vbox || new Box2Abs(0, 0, 0, 0)\n    return vbox\n  }\n\n  translate(d): void {\n    this.eachItem(item => item.visel.translate(d))\n  }\n\n  scale(s: number): void {\n    // NOTE: bounding boxes are not valid after scaling\n    this.eachItem(item => scaleVisel(item.visel, s))\n  }\n\n  clearVisels(): void {\n    this.eachItem(item => this.clearVisel(item.visel))\n  }\n\n  update(force: boolean): boolean {\n    // eslint-disable-line max-statements\n    force = force || !this.initialized\n\n    // check items to update\n    Object.keys(ReStruct.maps).forEach(map => {\n      const mapChanged = this[map + 'Changed']\n      if (force) {\n        this[map].forEach((_item, id) => mapChanged.set(id, 1))\n      } else {\n        // check if some of the items marked are already gone\n        mapChanged.forEach((_value, id) => {\n          if (!this[map].has(id)) mapChanged.delete(id)\n        })\n      }\n    })\n\n    this.atomsChanged.forEach((_value, aid) =>\n      this.connectedComponentRemoveAtom(aid)\n    )\n\n    // clean up empty fragments\n    // TODO: fragment removal should be triggered by the action responsible for the fragment contents removal and form an operation of its own\n    const emptyFrags = this.frags.filter(\n      (fid, frag) => !frag.calcBBox(this.render.ctab, fid, this.render)\n    )\n\n    emptyFrags.forEach((frag, fid) => {\n      this.clearVisel(frag.visel)\n      this.frags.delete(fid)\n      this.molecule.frags.delete(fid)\n    })\n\n    Object.keys(ReStruct.maps).forEach(map => {\n      const mapChanged = this[map + 'Changed']\n\n      mapChanged.forEach((_value, id) => {\n        this.clearVisel(this[map].get(id).visel)\n        this.structChanged = this.structChanged || mapChanged.get(id) > 0\n      })\n    })\n\n    // TODO: when to update sgroup?\n    this.sgroups.forEach(sgroup => {\n      this.clearVisel(sgroup.visel)\n      sgroup.highlighting = null\n      sgroup.selectionPlate = null\n    })\n\n    // TODO [RB] need to implement update-on-demand for fragments and r-groups\n    this.frags.forEach(frag => {\n      this.clearVisel(frag.visel)\n    })\n\n    this.rgroups.forEach(rgroup => {\n      this.clearVisel(rgroup.visel)\n    })\n\n    if (force) {\n      // clear and recreate all half-bonds\n      this.clearConnectedComponents()\n      this.molecule.initHalfBonds()\n      this.molecule.initNeighbors()\n    }\n\n    // only update half-bonds adjacent to atoms that have moved\n    const atomsChangedArray = Array.from(this.atomsChanged.keys())\n    this.molecule.updateHalfBonds(atomsChangedArray)\n    this.molecule.sortNeighbors(atomsChangedArray)\n\n    this.assignConnectedComponents()\n    this.initialized = true\n\n    this.verifyLoops()\n    const updLoops = force || this.structChanged\n    if (updLoops) this.updateLoops()\n    this.showLabels()\n    this.showBonds()\n    if (updLoops) this.showLoops()\n    this.showReactionSymbols()\n    this.showSGroups()\n\n    this.showFragments()\n    this.showRGroups()\n    this.showEnhancedFlags()\n    this.showSimpleObjects()\n    this.showTexts()\n    this.clearMarks()\n\n    return true\n  }\n\n  updateLoops(): void {\n    this.reloops.forEach(reloop => {\n      this.clearVisel(reloop.visel)\n    })\n    const ret = this.molecule.findLoops()\n    ret.bondsToMark.forEach(bid => {\n      this.markBond(bid, 1)\n    })\n    ret.newLoops.forEach(loopId => {\n      this.reloops.set(loopId, new ReLoop(this.molecule.loops.get(loopId)))\n    })\n  }\n\n  showLoops(): void {\n    const options = this.render.options\n    this.reloops.forEach((reloop, rlid) => {\n      reloop.show(this, rlid, options)\n    })\n  }\n\n  showSimpleObjects(): void {\n    const options = this.render.options\n\n    this.simpleObjectsChanged.forEach((_value, id) => {\n      const simpleObject = this.simpleObjects.get(id)\n      if (simpleObject) simpleObject.show(this, options)\n    })\n  }\n\n  showTexts() {\n    const options = this.render.options\n\n    this.textsChanged.forEach((_value, id) => {\n      const text = this.texts.get(id)\n      if (text) text.show(this, id, options)\n    })\n  }\n\n  showReactionSymbols(): void {\n    const options = this.render.options\n\n    this.rxnArrowsChanged.forEach((_value, id) => {\n      const arrow = this.rxnArrows.get(id)\n      if (arrow) arrow.show(this, id, options)\n    })\n\n    this.rxnPlusesChanged.forEach((_value, id) => {\n      const plus = this.rxnPluses.get(id)\n      if (plus) plus.show(this, id, options)\n    })\n  }\n\n  showSGroups(): void {\n    this.molecule.sGroupForest\n      .getSGroupsBFS()\n      .reverse()\n      .forEach(id => {\n        const resgroup = this.sgroups.get(id)\n        if (!resgroup) return\n        resgroup.show(this)\n      })\n  }\n\n  showFragments(): void {\n    this.frags.forEach((frag, id) => {\n      const path = frag.draw(this.render, id)\n      if (path)\n        this.addReObjectPath(LayerMap.data, frag.visel, path, null, true)\n      // TODO fragment selection & highlighting\n    })\n  }\n\n  showRGroups(): void {\n    const options = this.render.options\n    this.rgroups.forEach((rgroup, id) => {\n      rgroup.show(this, id, options)\n    })\n  }\n\n\n  loopRemove(loopId: number): void {\n    const reloop = this.reloops.get(loopId)\n    if (!reloop) {\n      return\n    }\n    this.clearVisel(reloop.visel)\n\n    const bondlist: Array<number> = []\n\n    reloop.loop.hbs.forEach(hbid => {\n      const hb = this.molecule.halfBonds.get(hbid)\n      if (!hb) return\n      hb.loop = -1\n      this.markBond(hb.bid, 1)\n      this.markAtom(hb.begin, 1)\n      bondlist.push(hb.bid)\n    })\n\n    this.reloops.delete(loopId)\n    this.molecule.loops.delete(loopId)\n  }\n\n  verifyLoops(): void {\n    this.reloops.forEach((reloop, rlid) => {\n      if (!reloop.isValid(this.molecule, rlid)) this.loopRemove(rlid)\n    })\n  }\n\n  showLabels(): void {\n    // eslint-disable-line max-statements\n    const options = this.render.options\n\n    this.atomsChanged.forEach((_value, aid) => {\n      const atom = this.atoms.get(aid)\n      if (atom) atom.show(this, aid, options)\n    })\n  }\n\n  showEnhancedFlags(): void {\n    const options = this.render.options\n\n    this.enhancedFlagsChanged.forEach((_value, chid) => {\n      const flag = this.enhancedFlags.get(chid)\n      if (flag) flag.show(this, chid, options)\n    })\n  }\n\n  showBonds(): void {\n    // eslint-disable-line max-statements\n    const options = this.render.options\n\n    this.bondsChanged.forEach((_value, bid) => {\n      const bond = this.bonds.get(bid)\n      if (bond) bond.show(this, bid, options)\n    })\n  }\n\n  setSelection(selection) {\n    const redraw = arguments.length === 0 // render.update only\n\n    Object.keys(ReStruct.maps).forEach(map => {\n      if (ReStruct.maps[map].isSelectable()) {\n        this[map].forEach((item, id) => {\n          const selected = redraw\n            ? item.selected\n            : selection && selection[map] && selection[map].indexOf(id) > -1\n\n          this.showItemSelection(item, selected)\n        })\n      }\n    })\n  }\n  showItemSelection(item, selected) {\n    var exists = isSelectionSvgObjectExists(item)\n    // TODO: simplify me, who sets `removed`?\n    item.selected = selected\n    if (item instanceof ReDataSGroupData) item.sgroup.selected = selected\n    if (selected) {\n      if (!exists) {\n        var render = this.render\n        var options = render.options\n        var paper = render.paper\n\n        item.selectionPlate = item.makeSelectionPlate(this, paper, options)\n        this.addReObjectPath(\n          LayerMap.selectionPlate,\n          item.visel,\n          item.selectionPlate\n        )\n      }\n      if (item.selectionPlate) item.selectionPlate.show() // TODO [RB] review\n    } else if (exists && item.selectionPlate) {\n      item.selectionPlate.hide() // TODO [RB] review\n    }\n  }\n}\n\nfunction isSelectionEmpty(selection) {\n  if (!selection) return true\n\n  const anySelection = Object.keys(ReStruct.maps).some(\n    map => selection[map] && selection[map].length > 0\n  )\n\n  return !anySelection\n}\n\nfunction scaleRPath(path, scaleFactor: number): void {\n  if (path.type == 'set') {\n    // TODO: rework scaling\n    for (var i = 0; i < path.length; ++i) scaleRPath(path[i], scaleFactor)\n  } else {\n    if (!(typeof path.attrs === 'undefined')) {\n      if ('font-size' in path.attrs)\n        path.attr('font-size', path.attrs['font-size'] * scaleFactor)\n      else if ('stroke-width' in path.attrs)\n        path.attr('stroke-width', path.attrs['stroke-width'] * scaleFactor)\n    }\n    path.scale(scaleFactor, scaleFactor, 0, 0)\n  }\n}\n\nfunction scaleVisel(visel, s) {\n  for (let i = 0; i < visel.paths.length; ++i) scaleRPath(visel.paths[i], s)\n}\n\n/**\n * SelectionPlate could be an item then value would be in it\n * or it could be a set of items then removed value need to be check on at least one of items in set\n * @param item\n * @returns {boolean}\n */\nfunction isSelectionSvgObjectExists(item) {\n  return (\n    item.selectionPlate !== null &&\n    ((!item.selectionPlate.items && !item.selectionPlate.removed) ||\n      (Array.isArray(item.selectionPlate.items) &&\n        !item.selectionPlate[0].removed))\n  )\n}\n\nexport default ReStruct\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Vec2 } from 'ketcher-core'\nimport { inRange } from 'lodash'\n\nlet FRAC = Math.PI / 12 // '15º'\n\nfunction setFracAngle(angle) {\n  FRAC = (Math.PI / 180) * angle\n}\n\nfunction calcAngle(pos0, pos1) {\n  const v = Vec2.diff(pos1, pos0)\n  return Math.atan2(v.y, v.x)\n}\n\nfunction fracAngle(angle, angle2) {\n  if (angle2) angle = calcAngle(angle, angle2)\n  return Math.round(angle / FRAC) * FRAC\n}\n\nfunction calcNewAtomPos(pos0, pos1, ctrlKey) {\n  const v = new Vec2(1, 0).rotate(\n    ctrlKey ? calcAngle(pos0, pos1) : fracAngle(pos0, pos1)\n  )\n  v.add_(pos0) // eslint-disable-line no-underscore-dangle\n  return v\n}\n\nfunction degrees(angle) {\n  let degree = Math.round((angle / Math.PI) * 180)\n  if (degree > 180) degree -= 360\n  else if (degree <= -180) degree += 360\n  return degree\n}\n\nconst BONDS_MERGE_ANGLE = 10 // 'º'\nconst BONDS_MERGE_SCALE = 0.2\n\nfunction mergeBondsParams(struct1, bond1, struct2, bond2) {\n  const begin1 = struct1.atoms.get(bond1.begin)\n  const begin2 = struct2.atoms.get(bond2.begin)\n  const end1 = struct1.atoms.get(bond1.end)\n  const end2 = struct2.atoms.get(bond2.end)\n\n  const angle = calcAngle(begin1.pp, end1.pp) - calcAngle(begin2.pp, end2.pp)\n  const mergeAngle = Math.abs(degrees(angle) % 180)\n\n  const scale = Vec2.dist(begin1.pp, end1.pp) / Vec2.dist(begin2.pp, end2.pp)\n\n  const merged =\n    !inRange(mergeAngle, BONDS_MERGE_ANGLE, 180 - BONDS_MERGE_ANGLE) &&\n    inRange(scale, 1 - BONDS_MERGE_SCALE, 1 + BONDS_MERGE_SCALE)\n\n  return { merged, angle, scale, cross: Math.abs(degrees(angle)) > 90 }\n}\n\nexport default {\n  calcAngle,\n  fracAngle,\n  calcNewAtomPos,\n  degrees,\n  setFracAngle,\n  mergeBondsParams\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Box2Abs, Scale, Struct, Vec2 } from 'ketcher-core'\n\nimport Raphael from '../raphael-ext'\nimport ReStruct from './restruct'\nimport defaultOptions from './options'\n\nvar DEBUG = { debug: false, logcnt: 0, logmouse: false, hl: false }\nDEBUG.logMethod = function () {}\n// DEBUG.logMethod = function (method) {addionalAtoms(\"METHOD: \" + method);\n\nfunction Render(clientArea, opt) {\n  let renderWidth = clientArea.clientWidth - 10\n  let renderHeight = clientArea.clientHeight - 10\n  renderWidth = renderWidth > 0 ? renderWidth : 0\n  renderHeight = renderHeight > 0 ? renderHeight : 0\n\n  this.userOpts = opt\n  this.clientArea = clientArea\n  this.paper = new Raphael(clientArea, renderWidth, renderHeight)\n  this.sz = Vec2.ZERO\n  this.ctab = new ReStruct(new Struct(), this)\n  this.options = defaultOptions(this.userOpts)\n}\n\nRender.prototype.view2obj = function (p, isRelative) {\n  var scroll = this.scrollPos()\n  if (!this.useOldZoom) {\n    p = p.scaled(1 / this.options.zoom)\n    scroll = scroll.scaled(1 / this.options.zoom)\n  }\n  p = isRelative ? p : p.add(scroll).sub(this.options.offset)\n  return Scale.scaled2obj(p, this.options)\n}\n\nRender.prototype.obj2view = function (v, isRelative) {\n  var p = Scale.obj2scaled(v, this.options)\n  p = isRelative\n    ? p\n    : p\n        .add(this.options.offset)\n        .sub(this.scrollPos().scaled(1 / this.options.zoom))\n  if (!this.useOldZoom) p = p.scaled(this.options.zoom)\n  return p\n}\n\nRender.prototype.scrollPos = function () {\n  return new Vec2(this.clientArea.scrollLeft, this.clientArea.scrollTop)\n}\n\nfunction cumulativeOffset(el) {\n  var curtop = 0\n  var curleft = 0\n  if (el.parentNode) {\n    do {\n      curtop += el.offsetTop || 0\n      curleft += el.offsetLeft || 0\n      el = el.offsetParent\n    } while (el)\n  }\n  return { left: curleft, top: curtop }\n}\n\nRender.prototype.page2obj = function (pagePos) {\n  var offset = cumulativeOffset(this.clientArea)\n  var pp = new Vec2(pagePos.pageX - offset.left, pagePos.pageY - offset.top)\n  return this.view2obj(pp)\n}\n\nRender.prototype.setPaperSize = function (sz) {\n  DEBUG.logMethod('setPaperSize')\n  this.sz = sz\n  this.paper.setSize(sz.x * this.options.zoom, sz.y * this.options.zoom)\n  this.setViewBox(this.options.zoom)\n}\n\nRender.prototype.setOffset = function (newoffset) {\n  DEBUG.logMethod('setOffset')\n  var delta = new Vec2(\n    newoffset.x - this.options.offset.x,\n    newoffset.y - this.options.offset.y\n  )\n  this.clientArea.scrollLeft += delta.x\n  this.clientArea.scrollTop += delta.y\n  this.options.offset = newoffset\n}\n\nRender.prototype.setZoom = function (zoom) {\n  // when scaling the canvas down it may happen that the scaled canvas is smaller than the view window\n  // don't forget to call setScrollOffset after zooming (or use extendCanvas directly)\n  console.info('set zoom', zoom)\n  this.options.zoom = zoom\n  this.paper.setSize(this.sz.x * zoom, this.sz.y * zoom)\n  this.setViewBox(zoom)\n}\n\nfunction calcExtend(sSz, x0, y0, x1, y1) {\n  // eslint-disable-line max-params\n  var ex = x0 < 0 ? -x0 : 0\n  var ey = y0 < 0 ? -y0 : 0\n\n  if (sSz.x < x1) ex += x1 - sSz.x\n  if (sSz.y < y1) ey += y1 - sSz.y\n  return new Vec2(ex, ey)\n}\n\nRender.prototype.setScrollOffset = function (x, y) {\n  var clientArea = this.clientArea\n  var cx = clientArea.clientWidth\n  var cy = clientArea.clientHeight\n  var e = calcExtend(\n    this.sz.scaled(this.options.zoom),\n    x,\n    y,\n    cx + x,\n    cy + y\n  ).scaled(1 / this.options.zoom)\n  if (e.x > 0 || e.y > 0) {\n    this.setPaperSize(this.sz.add(e))\n    var d = new Vec2(x < 0 ? -x : 0, y < 0 ? -y : 0).scaled(\n      1 / this.options.zoom\n    )\n    if (d.x > 0 || d.y > 0) {\n      this.ctab.translate(d)\n      this.setOffset(this.options.offset.add(d))\n    }\n  }\n  clientArea.scrollLeft = x\n  clientArea.scrollTop = y\n  // TODO: store drag position in scaled systems\n  // scrollLeft = clientArea.scrollLeft;\n  // scrollTop = clientArea.scrollTop;\n  this.update(false)\n}\n\nRender.prototype.setScale = function (z) {\n  if (this.options.offset)\n    this.options.offset = this.options.offset.scaled(1 / z).scaled(z)\n  this.userOpts.scale *= z\n  this.options = null\n  this.update(true)\n}\n\nRender.prototype.setViewBox = function (z) {\n  if (!this.useOldZoom)\n    this.paper.canvas.setAttribute(\n      'viewBox',\n      '0 0 ' + this.sz.x + ' ' + this.sz.y\n    )\n  else this.setScale(z)\n}\n\nRender.prototype.setMolecule = function (ctab) {\n  DEBUG.logMethod('setMolecule')\n  this.paper.clear()\n  this.ctab = new ReStruct(ctab, this)\n  this.options.offset = new Vec2()\n  this.update(false)\n}\n\nRender.prototype.update = function (force, viewSz) {\n  // eslint-disable-line max-statements\n  viewSz =\n    viewSz ||\n    new Vec2(\n      this.clientArea.clientWidth || 100,\n      this.clientArea.clientHeight || 100\n    )\n\n  var changes = this.ctab.update(force)\n  this.ctab.setSelection() // [MK] redraw the selection bits where necessary\n  if (changes) {\n    var sf = this.options.scale\n    var bb = this.ctab\n      .getVBoxObj()\n      .transform(Scale.obj2scaled, this.options)\n      .translate(this.options.offset || new Vec2())\n\n    if (!this.options.autoScale) {\n      var ext = Vec2.UNIT.scaled(sf)\n      var eb = bb.sz().length() > 0 ? bb.extend(ext, ext) : bb\n      var vb = new Box2Abs(\n        this.scrollPos(),\n        viewSz.scaled(1 / this.options.zoom).sub(Vec2.UNIT.scaled(20))\n      )\n      var cb = Box2Abs.union(vb, eb)\n      if (!this.oldCb) this.oldCb = new Box2Abs()\n\n      var sz = cb.sz().floor()\n      var delta = this.oldCb.p0.sub(cb.p0).ceil()\n      this.oldBb = bb\n      if (!this.sz || sz.x != this.sz.x || sz.y != this.sz.y)\n        this.setPaperSize(sz)\n\n      this.options.offset = this.options.offset || new Vec2()\n      if (delta.x != 0 || delta.y != 0) {\n        this.setOffset(this.options.offset.add(delta))\n        this.ctab.translate(delta)\n      }\n    } else {\n      var sz1 = bb.sz()\n      var marg = this.options.autoScaleMargin\n      var mv = new Vec2(marg, marg)\n      var csz = viewSz\n      if (csz.x < 2 * marg + 1 || csz.y < 2 * marg + 1)\n        throw new Error('View box too small for the given margin')\n      var rescale = Math.max(\n        sz1.x / (csz.x - 2 * marg),\n        sz1.y / (csz.y - 2 * marg)\n      )\n      if (this.options.maxBondLength / rescale > 1.0) rescale = 1.0\n      var sz2 = sz1.add(mv.scaled(2 * rescale))\n      /* eslint-disable no-mixed-operators*/\n      this.paper.setViewBox(\n        bb.pos().x - marg * rescale - (csz.x * rescale - sz2.x) / 2,\n        bb.pos().y - marg * rescale - (csz.y * rescale - sz2.y) / 2,\n        csz.x * rescale,\n        csz.y * rescale\n      )\n      /* eslint-enable no-mixed-operators*/\n    }\n  }\n}\n\nexport default Render\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Vec2 } from 'ketcher-core'\nimport utils from '../editor/shared/utils'\n\nfunction defaultOptions(opt) {\n  const scaleFactor = opt.scale || 100\n\n  if (opt.rotationStep) utils.setFracAngle(opt.rotationStep)\n\n  const labelFontSize = Math.ceil(1.9 * (scaleFactor / 6))\n  const subFontSize = Math.ceil(0.7 * labelFontSize)\n\n  const defaultOptions = {\n    // flags for debugging\n    showAtomIds: false,\n    showBondIds: false,\n    showHalfBondIds: false,\n    showLoopIds: false,\n    // rendering customization flags\n    // TODO: hide enhanced flags opts\n    showValenceWarnings: true,\n    autoScale: false, // scale structure to fit into the given view box, used in view mode\n    autoScaleMargin: 0,\n    maxBondLength: 0, // 0 stands for \"not specified\"\n    atomColoring: true,\n    hideImplicitHydrogen: false,\n    hideTerminalLabels: false,\n    // atoms\n    carbonExplicitly: false,\n    showCharge: true,\n    showHydrogenLabels: 'on',\n    showValence: true,\n    // bonds\n    aromaticCircle: true,\n\n    scale: scaleFactor,\n    zoom: 1.0,\n    offset: new Vec2(),\n\n    lineWidth: scaleFactor / 20,\n    bondSpace: opt.doubleBondWidth || scaleFactor / 7,\n    stereoBond: opt.stereoBondWidth || scaleFactor / 7,\n    subFontSize,\n    font: '30px Arial',\n    fontsz: labelFontSize,\n    fontszsub: subFontSize,\n    fontRLabel: labelFontSize * 1.2,\n    fontRLogic: labelFontSize * 0.7,\n\n    /* styles */\n    lineattr: {\n      stroke: '#000',\n      'stroke-width': opt.bondThickness || scaleFactor / 20,\n      'stroke-linecap': 'round',\n      'stroke-linejoin': 'round'\n    },\n    /* eslint-enable quote-props */\n    selectionStyle: {\n      fill: '#7f7',\n      stroke: 'none'\n    },\n    highlightStyle: {\n      stroke: '#0c0',\n      'stroke-width': (0.6 * scaleFactor) / 20\n    },\n    sgroupBracketStyle: {\n      stroke: 'darkgray',\n      'stroke-width': (0.5 * scaleFactor) / 20\n    },\n    lassoStyle: {\n      stroke: 'gray',\n      'stroke-width': '1px'\n    },\n    highlightStyleSimpleObject: {\n      stroke: '#0c0',\n      'stroke-width': scaleFactor / 4,\n      'stroke-linecap': 'round',\n      'stroke-opacity': 0.6\n    },\n    atomSelectionPlateRadius: labelFontSize * 1.2\n  }\n\n  return Object.assign({}, defaultOptions, opt)\n}\n\nexport default defaultOptions\n","/****************************************************************************\n * Copyright 2018 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport {\n  FormatterFactory,\n  GenerateImageOptions,\n  MolSerializer,\n  MolfileFormat,\n  Struct,\n  StructService,\n  SupportedFormat\n} from 'ketcher-core'\n\nimport Editor from './editor'\nimport Render from './render'\nimport { isEqual } from 'lodash/fp'\n\ninterface UI {\n  load: (structStr: string | null, options?: any) => undefined\n  loadStruct: (struct: Struct) => any\n}\n\nfunction getStructureAsync(\n  structureFormat: SupportedFormat = 'rxn',\n  formatterFactory: FormatterFactory,\n  struct: Struct\n): Promise<string> {\n  const formatter = formatterFactory.create(structureFormat)\n  return formatter.getStructureFromStructAsync(struct)\n}\n\nclass Ketcher {\n  private origin = null\n\n  constructor(\n    readonly editor: Editor,\n    readonly server: StructService, // todo: remove\n    readonly ui: UI,\n    private readonly formatterFactory: FormatterFactory\n  ) {}\n\n  getSmilesAsync(isExtended: boolean = false): Promise<string> {\n    const format: SupportedFormat = isExtended ? 'smilesExt' : 'smiles'\n    return getStructureAsync(\n      format,\n      this.formatterFactory,\n      this.editor.struct()\n    )\n  }\n\n  getMolfileAsync(molfileFormat: MolfileFormat = 'v2000'): Promise<string> {\n    if (this.containsReaction()) {\n      throw Error(\n        'The structure cannot be saved as *.MOL due to reaction arrrows.'\n      )\n    }\n    const format: SupportedFormat =\n      molfileFormat === 'v3000' ? 'molV3000' : 'mol'\n    return getStructureAsync(\n      format,\n      this.formatterFactory,\n      this.editor.struct()\n    )\n  }\n\n  getGraphAsync(): Promise<string> {\n    return getStructureAsync(\n      'graph',\n      this.formatterFactory,\n      this.editor.struct()\n    )\n  }\n\n  containsReaction(): boolean {\n    return this.editor.struct().hasRxnArrow()\n  }\n\n  getRxnAsync(molfileFormat: MolfileFormat = 'v2000'): Promise<string> {\n    if (!this.containsReaction()) {\n      throw Error(\n        'The structure cannot be saved as *.RXN: there is no reaction arrows.'\n      )\n    }\n    const format: SupportedFormat =\n      molfileFormat === 'v3000' ? 'rxnV3000' : 'rxn'\n    return getStructureAsync(\n      format,\n      this.formatterFactory,\n      this.editor.struct()\n    )\n  }\n\n  setMolecule(molString: string, rescale = true): void {\n    if (typeof molString !== 'string') return\n    this.ui.load(molString, {\n      rescale\n    })\n  }\n\n  addFragment(molString: string): void {\n    if (typeof molString !== 'string') return\n    this.ui.load(molString, {\n      rescale: true,\n      fragment: true\n    })\n  }\n\n  showMolfile(clientArea: any, molString: string, options: any): Render {\n    const render = new Render(\n      clientArea,\n      Object.assign(\n        {\n          scale: options.bondLength || 75\n        },\n        options\n      )\n    )\n    if (molString) {\n      const molSerializer = new MolSerializer()\n      const mol = molSerializer.deserialize(molString)\n      render.setMolecule(mol)\n    }\n    render.update()\n    // not sure we need to expose guts\n    return render\n  }\n\n  isDirty(): boolean {\n    const position = this.editor.historyPtr\n    const length = this.editor.historyStack.length\n    if (!length || !this.origin) {\n      return false\n    }\n    return !isEqual(this.editor.historyStack[position - 1], this.origin)\n  }\n\n  setOrigin(): void {\n    const position = this.editor.historyPtr\n    this.origin = position ? this.editor.historyStack[position - 1] : null\n  }\n\n  generateImageAsync(\n    data: string,\n    options: GenerateImageOptions = { outputFormat: 'png' }\n  ): Promise<Blob> {\n    let meta = ''\n\n    switch (options.outputFormat) {\n      case 'svg':\n        meta = 'image/svg+xml'\n        break\n\n      case 'png':\n      default:\n        meta = 'image/png'\n        options.outputFormat = 'png' // if option wasn't pass\n    }\n\n    return this.server.generateImageAsBase64(data, options).then(base64 => {\n      const byteCharacters = atob(base64)\n      const byteNumbers = new Array(byteCharacters.length)\n      for (let i = 0; i < byteCharacters.length; i++) {\n        byteNumbers[i] = byteCharacters.charCodeAt(i)\n      }\n      const byteArray = new Uint8Array(byteNumbers)\n      const blob = new Blob([byteArray], { type: meta })\n      return Promise.resolve(blob)\n    })\n  }\n}\n\nexport type { UI }\nexport { Ketcher }\n","import React from 'react'\n\nexport interface ISettingsContext {\n  staticResourcesUrl: string\n}\n\nconst settingsContext = React.createContext<ISettingsContext>(\n  {} as ISettingsContext\n)\n\nexport default settingsContext\n","import React from 'react'\n\nconst formContext = React.createContext(null)\n\nexport default formContext\n","import React from 'react'\n\nexport interface IAppContext {\n  getKetcherInstance: () => any\n}\n\nconst appContext = React.createContext<IAppContext>({} as IAppContext)\n\nexport default appContext\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nexport const basicAtoms = ['H', 'C', 'N', 'O', 'S', 'P', 'F', 'Cl', 'Br', 'I']\n\nexport const atomCuts = {\n  H: 'h',\n  C: 'c',\n  N: 'n',\n  O: 'o',\n  S: 's',\n  P: 'p',\n  F: 'f',\n  Cl: 'Shift+c',\n  Br: 'Shift+b',\n  I: 'i',\n  A: 'a'\n}\n\nexport default Object.keys(atomCuts).reduce((res, label) => {\n  res[`atom-${label.toLowerCase()}`] = {\n    title: `Atom ${label}`,\n    shortcut: atomCuts[label],\n    action: {\n      tool: 'atom',\n      opts: { label }\n    }\n  }\n  return res\n}, {})\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { MolSerializer } from 'ketcher-core'\n\nconst debugObj = {\n  // original: for dev purposes\n  'force-update': {\n    shortcut: 'Ctrl+Shift+r',\n    action: editor => {\n      editor.update(true)\n    }\n  },\n  'qs-serialize': {\n    shortcut: 'Alt+Shift+r',\n    action: editor => {\n      const molSerializer = new MolSerializer()\n      const molStr = molSerializer.serialize(editor.struct())\n      const molQs = 'mol=' + encodeURIComponent(molStr).replace(/%20/g, '+')\n      const qs = document.location.search\n      document.location.search = !qs\n        ? '?' + molQs // eslint-disable-line\n        : qs.search('mol=') === -1\n        ? qs + '&' + molQs\n        : qs.replace(/mol=[^&$]*/, molQs)\n    }\n  }\n}\n\nexport default debugObj\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { Component, createRef } from 'react'\n\nconst ieCb = window.clipboardData\n\nclass ClipArea extends Component {\n  constructor(props) {\n    super(props)\n    this.textAreaRef = createRef()\n  }\n\n  componentDidMount() {\n    const el = this.textAreaRef.current\n    this.target = this.props.target || el.parentNode\n\n    this.listeners = {\n      mouseup: event => {\n        if (\n          el === event.target ||\n          (!isActiveElement(event.target) && this.props.focused())\n        )\n          autofocus(el)\n      },\n      mousedown: event => {\n        if (event.shiftKey && !isActiveElement(event.target))\n          event.preventDefault()\n      },\n      copy: event => {\n        if (this.props.focused() && this.props.onCopy) {\n          const data = this.props.onCopy()\n\n          if (data) copy(event.clipboardData, data)\n\n          event.preventDefault()\n        }\n      },\n      cut: event => {\n        if (this.props.focused() && this.props.onCut) {\n          const data = this.props.onCut()\n\n          if (data) copy(event.clipboardData, data)\n\n          event.preventDefault()\n        }\n      },\n      paste: event => {\n        if (this.props.focused() && this.props.onPaste) {\n          const data = paste(event.clipboardData, this.props.formats)\n\n          if (data) this.props.onPaste(data)\n\n          event.preventDefault()\n        }\n      }\n    }\n\n    Object.keys(this.listeners).forEach(en => {\n      this.target.addEventListener(en, this.listeners[en])\n    })\n  }\n\n  shouldComponentUpdate() {\n    return false\n  }\n\n  componentWillUnmount() {\n    Object.keys(this.listeners).forEach(en => {\n      this.target.removeEventListener(en, this.listeners[en])\n    })\n  }\n\n  render() {\n    return (\n      <textarea\n        ref={this.textAreaRef}\n        className=\"cliparea\"\n        contentEditable\n        autoFocus // eslint-disable-line jsx-a11y/no-autofocus\n        suppressContentEditableWarning={true}\n      />\n    )\n  }\n}\n\nfunction isActiveElement(el) {\n  if (el.tagName === 'INPUT' && el.type === 'button') return false\n  return ['INPUT', 'SELECT', 'TEXTAREA', 'OPTION', 'LABEL'].includes(el.tagName)\n}\n\nfunction autofocus(cliparea) {\n  cliparea.value = ' '\n  cliparea.focus()\n  cliparea.select()\n}\n\nfunction copy(cb, data) {\n  if (!cb && ieCb) {\n    ieCb.setData('text', data['text/plain'])\n  } else {\n    let curFmt = null\n    cb.setData('text/plain', data['text/plain'])\n    try {\n      Object.keys(data).forEach(fmt => {\n        curFmt = fmt\n        cb.setData(fmt, data[fmt])\n      })\n    } catch (ex) {\n      console.info(`Could not write exact type ${curFmt}`)\n    }\n  }\n}\n\nfunction paste(cb, formats) {\n  let data = {}\n  if (!cb && ieCb) {\n    data['text/plain'] = ieCb.getData('text')\n  } else {\n    data['text/plain'] = cb.getData('text/plain')\n    data = formats.reduce((res, fmt) => {\n      const d = cb.getData(fmt)\n      if (d) res[fmt] = d\n      return res\n    }, data)\n  }\n  return data\n}\n\nexport const actions = ['cut', 'copy', 'paste']\n\nexport function exec(action) {\n  let enabled = document.queryCommandSupported(action)\n  if (enabled) {\n    try {\n      enabled = document.execCommand(action) || window.ClipboardEvent || ieCb\n    } catch (ex) {\n      // FF < 41\n      enabled = false\n    }\n  }\n  return enabled\n}\n\nexport default ClipArea\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  StereLabelStyleType,\n  StereoColoringType\n} from '../../../render/restruct/GeneralEnumTypes'\nimport jsonschema, { Schema } from 'jsonschema'\n\ntype ExtendedSchema = Schema & { enumNames?: Array<string>; default?: any }\n\nconst editor: {\n  resetToSelect: ExtendedSchema\n  rotationStep: ExtendedSchema\n} = {\n  resetToSelect: {\n    title: 'Reset to Select Tool',\n    enum: [true, 'paste', false],\n    enumNames: ['on', 'After Paste', 'off'],\n    default: 'paste'\n  },\n  rotationStep: {\n    title: 'Rotation Step, º',\n    type: 'integer',\n    minimum: 1,\n    maximum: 90,\n    default: 15\n  }\n}\n\nconst render: {\n  showValenceWarnings: ExtendedSchema\n  atomColoring: ExtendedSchema\n  showStereoFlags: ExtendedSchema\n  stereoLabelStyle: ExtendedSchema\n  colorOfAbsoluteCenters: ExtendedSchema\n  colorOfAndCenters: ExtendedSchema\n  colorOfOrCenters: ExtendedSchema\n  colorStereogenicCenters: ExtendedSchema\n  absFlagLabel: ExtendedSchema\n  andFlagLabel: ExtendedSchema\n  mixedFlagLabel: ExtendedSchema\n  orFlagLabel: ExtendedSchema\n  font: ExtendedSchema\n  fontsz: ExtendedSchema\n  fontszsub: ExtendedSchema\n  carbonExplicitly: ExtendedSchema\n  showCharge: ExtendedSchema\n  showValence: ExtendedSchema\n  showHydrogenLabels: ExtendedSchema\n  aromaticCircle: ExtendedSchema\n  doubleBondWidth: ExtendedSchema\n  bondThickness: ExtendedSchema\n  stereoBondWidth: ExtendedSchema\n} = {\n  showValenceWarnings: {\n    title: 'Show valence warnings',\n    type: 'boolean',\n    default: true\n  },\n  atomColoring: {\n    title: 'Atom coloring',\n    type: 'boolean',\n    default: true\n  },\n  showStereoFlags: {\n    title: 'Show the Stereo flags',\n    type: 'boolean',\n    default: true\n  },\n  stereoLabelStyle: {\n    title: 'Label display at stereogenic centers',\n    enum: [\n      StereLabelStyleType.IUPAC,\n      StereLabelStyleType.Classic,\n      StereLabelStyleType.On,\n      StereLabelStyleType.Off\n    ],\n    enumNames: ['IUPAC style', 'Classic', 'On', 'Off'],\n    default: StereLabelStyleType.IUPAC\n  },\n  colorOfAbsoluteCenters: {\n    title: ' Color of Absolute Center',\n    type: 'string',\n    default: '#ff0000'\n  },\n  colorOfAndCenters: {\n    title: 'Color of AND Centers',\n    type: 'string',\n    default: '#0000cd'\n  },\n  colorOfOrCenters: {\n    title: 'Color of OR Centers',\n    type: 'string',\n    default: '#228b22'\n  },\n  colorStereogenicCenters: {\n    title: 'Color stereogenic centers',\n    enum: [\n      StereoColoringType.LabelsOnly,\n      StereoColoringType.BondsOnly,\n      StereoColoringType.LabelsAndBonds,\n      StereoColoringType.Off\n    ],\n    enumNames: ['Labels Only', 'Bonds Only', 'Labels And Bonds', 'Off'],\n    default: StereoColoringType.LabelsOnly\n  },\n  absFlagLabel: {\n    title: 'Text of Absolute flag',\n    type: 'String',\n    default: 'ABS (Chiral)'\n  },\n  andFlagLabel: {\n    title: 'Text of AND flag',\n    type: 'String',\n    default: 'AND Enantiomer'\n  },\n  mixedFlagLabel: {\n    title: 'Text of Mixed flag',\n    type: 'String',\n    default: 'Mixed'\n  },\n  orFlagLabel: {\n    title: 'Text of OR flag',\n    type: 'String',\n    default: 'OR Enantiomer'\n  },\n  font: {\n    title: 'Font',\n    type: 'string',\n    default: '30px Arial'\n  },\n  fontsz: {\n    title: 'Font size',\n    type: 'integer',\n    default: 13,\n    minimum: 1,\n    maximum: 96\n  },\n  fontszsub: {\n    title: 'Sub font size',\n    type: 'integer',\n    default: 13,\n    minimum: 1,\n    maximum: 96\n  },\n  // Atom\n  carbonExplicitly: {\n    title: 'Display carbon explicitly',\n    type: 'boolean',\n    default: false\n  },\n  showCharge: {\n    title: 'Display charge',\n    type: 'boolean',\n    default: true\n  },\n  showValence: {\n    title: 'Display valence',\n    type: 'boolean',\n    default: true\n  },\n  showHydrogenLabels: {\n    title: 'Show hydrogen labels',\n    enum: ['off', 'Hetero', 'Terminal', 'Terminal and Hetero', 'on'],\n    default: 'on'\n  },\n  // Bonds\n  aromaticCircle: {\n    title: 'Aromatic Bonds as circle',\n    type: 'boolean',\n    default: true\n  },\n  doubleBondWidth: {\n    title: 'Double bond width',\n    type: 'integer',\n    default: 6,\n    minimum: 1,\n    maximum: 96\n  },\n  bondThickness: {\n    title: 'Bond thickness',\n    type: 'integer',\n    default: 2,\n    minimum: 1,\n    maximum: 96\n  },\n  stereoBondWidth: {\n    title: 'Stereo (Wedge) bond width',\n    type: 'integer',\n    default: 6,\n    minimum: 1,\n    maximum: 96\n  }\n}\n\nconst server: {\n  'smart-layout': ExtendedSchema\n  'ignore-stereochemistry-errors': ExtendedSchema\n  'mass-skip-error-on-pseudoatoms': ExtendedSchema\n  'gross-formula-add-rsites': ExtendedSchema\n  'gross-formula-add-isotopes': ExtendedSchema\n} = {\n  'smart-layout': {\n    title: 'Smart-layout',\n    type: 'boolean',\n    default: true\n  },\n  'ignore-stereochemistry-errors': {\n    title: 'Ignore stereochemistry errors',\n    type: 'boolean',\n    default: true\n  },\n  'mass-skip-error-on-pseudoatoms': {\n    title: 'Ignore pseudoatoms at mass',\n    type: 'boolean',\n    default: false\n  },\n  'gross-formula-add-rsites': {\n    title: 'Add Rsites at mass calculation',\n    type: 'boolean',\n    default: true\n  },\n  'gross-formula-add-isotopes': {\n    title: 'Add Isotopes at mass calculation',\n    type: 'boolean',\n    default: true\n  }\n}\n\nexport const SERVER_OPTIONS = Object.keys(server)\n\nconst debug: {\n  showAtomIds: ExtendedSchema\n  showBondIds: ExtendedSchema\n  showHalfBondIds: ExtendedSchema\n  showLoopIds: ExtendedSchema\n} = {\n  showAtomIds: {\n    title: 'Show atom Ids',\n    type: 'boolean',\n    default: false\n  },\n  showBondIds: {\n    title: 'Show bonds Ids',\n    type: 'boolean',\n    default: false\n  },\n  showHalfBondIds: {\n    title: 'Show half bonds Ids',\n    type: 'boolean',\n    default: false\n  },\n  showLoopIds: {\n    title: 'Show loop Ids',\n    type: 'boolean',\n    default: false\n  }\n}\n\nconst miew: {\n  miewMode: ExtendedSchema\n  miewTheme: ExtendedSchema\n  miewAtomLabel: ExtendedSchema\n} = {\n  miewMode: {\n    title: 'Display mode',\n    enum: ['LN', 'BS', 'LC'],\n    enumNames: ['Lines', 'Balls and Sticks', 'Licorice'],\n    default: 'LN'\n  },\n  miewTheme: {\n    title: 'Background color',\n    enum: ['light', 'dark'],\n    enumNames: ['Light', 'Dark'],\n    default: 'light'\n  },\n  miewAtomLabel: {\n    title: 'Label coloring',\n    enum: ['no', 'bright', 'blackAndWhite', 'black'],\n    enumNames: ['No', 'Bright', 'Black and White', 'Black'],\n    default: 'bright'\n  }\n}\n\nexport const MIEW_OPTIONS = Object.keys(miew)\n\nconst optionsSchema: ExtendedSchema = {\n  title: 'Settings',\n  type: 'object',\n  required: [],\n  properties: {\n    ...editor,\n    ...render,\n    ...server,\n    ...debug,\n    ...miew\n  }\n}\n\nexport default optionsSchema\n\nexport function getDefaultOptions(): Record<string, any> {\n  if (!optionsSchema.properties) return {}\n\n  return Object.keys(optionsSchema.properties).reduce((res, prop) => {\n    res[prop] = (optionsSchema.properties![prop] as ExtendedSchema).default\n    return res\n  }, {})\n}\n\nexport function validation(settings): Record<string, string> | null {\n  if (typeof settings !== 'object' || settings === null) return null\n\n  const v = new jsonschema.Validator()\n  const { errors } = v.validate(settings, optionsSchema)\n  const errProps = errors.map(err => err.property.split('.')[1])\n\n  return Object.keys(settings).reduce((res, prop) => {\n    if (!optionsSchema.properties) return res\n\n    if (optionsSchema.properties[prop] && errProps.indexOf(prop) === -1)\n      res[prop] = settings[prop]\n\n    return res\n  }, {})\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\n/* local storage */\nexport const storage = {\n  warningMessage:\n    'Your changes will be lost after the tab closing. See Help (Note 2).',\n  isAvailable() {\n    try {\n      return localStorage\n    } catch (ex) {\n      return false\n    }\n  },\n  getItem(key) {\n    let item = null\n    try {\n      item = JSON.parse(localStorage.getItem(key))\n    } catch (ex) {\n      console.info('LocalStorage:', ex.name)\n    }\n    return item\n  },\n  setItem(key, data) {\n    let isSet = null\n    try {\n      localStorage.setItem(key, JSON.stringify(data))\n      isSet = true\n    } catch (ex) {\n      console.info('LocalStorage:', ex.name)\n      isSet = false\n    }\n    return isSet\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  SERVER_OPTIONS,\n  getDefaultOptions,\n  validation\n} from '../../data/schema/options-schema'\n\nimport { pick } from 'lodash/fp'\nimport { storage } from '../../storage-ext'\n\nexport const initOptionsState = {\n  app: {\n    server: false,\n    templates: false\n  },\n  analyse: {\n    values: null,\n    roundWeight: 3,\n    roundMass: 3,\n    roundElAnalysis: 1\n  },\n  check: {\n    checkOptions: [\n      'valence',\n      'radicals',\n      'pseudoatoms',\n      'stereo',\n      'query',\n      'overlapping_atoms',\n      'overlapping_bonds',\n      'rgroups',\n      'chiral',\n      '3d',\n      'chiral_flag'\n    ]\n  },\n  recognize: {\n    file: null,\n    structStr: null,\n    fragment: false,\n    version: null\n  },\n  settings: Object.assign(\n    getDefaultOptions(),\n    validation(storage.getItem('ketcher-opts'))\n  ),\n  getServerSettings() {\n    return pick(SERVER_OPTIONS, this.settings)\n  }\n}\n\nexport function appUpdate(data) {\n  return dispatch => {\n    dispatch({ type: 'APP_OPTIONS', data })\n    dispatch({ type: 'UPDATE' })\n  }\n}\n\n/* SETTINGS */\nexport function saveSettings(newSettings) {\n  storage.setItem('ketcher-opts', newSettings)\n  return {\n    type: 'SAVE_SETTINGS',\n    data: newSettings\n  }\n}\n\n/* ANALYZE */\nexport function changeRound(roundName, value) {\n  return {\n    type: 'CHANGE_ANALYSE',\n    data: { [roundName]: value }\n  }\n}\n\n/* RECOGNIZE */\nconst recognizeActions = [\n  'SET_RECOGNIZE_STRUCT',\n  'CHANGE_RECOGNIZE_FILE',\n  'CHANGE_IMAGO_VERSION',\n  'IS_FRAGMENT_RECOGNIZE'\n]\n\nexport function setStruct(str) {\n  return {\n    type: 'SET_RECOGNIZE_STRUCT',\n    data: { structStr: str }\n  }\n}\n\nexport function changeVersion(version) {\n  return {\n    type: 'CHANGE_IMAGO_VERSION',\n    data: { version }\n  }\n}\n\nexport function changeImage(file) {\n  return {\n    type: 'CHANGE_RECOGNIZE_FILE',\n    data: {\n      file,\n      structStr: null\n    }\n  }\n}\n\nexport function shouldFragment(isFrag) {\n  return {\n    type: 'IS_FRAGMENT_RECOGNIZE',\n    data: { fragment: isFrag }\n  }\n}\n\n/* CHECK */\nexport function checkOpts(data) {\n  return {\n    type: 'SAVE_CHECK_OPTS',\n    data\n  }\n}\n\n/* REDUCER */\nfunction optionsReducer(state = {}, action) {\n  const { type, data } = action\n\n  if (type === 'APP_OPTIONS')\n    return { ...state, app: { ...state.app, ...data } }\n\n  if (type === 'SAVE_SETTINGS') return { ...state, settings: data }\n\n  if (type === 'SAVE_CHECK_OPTS') return { ...state, check: data }\n\n  if (type === 'CHANGE_ANALYSE')\n    return { ...state, analyse: { ...state.analyse, ...data, loading: false } }\n\n  if (type === 'ANALYSE_LOADING')\n    return { ...state, analyse: { ...state.analyse, loading: true } }\n\n  if (recognizeActions.includes(type))\n    return { ...state, recognize: { ...state.recognize, ...data } }\n  return state\n}\n\nexport default optionsReducer\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\n/* schema utils */\nfunction constant(schema, prop) {\n  const desc = schema.properties[prop]\n  return desc.constant || desc.enum[0] // see https://git.io/v6hyP\n}\n\nexport function mapOf(schema, prop) {\n  console.assert(schema.oneOf)\n  return schema.oneOf.reduce((res, desc) => {\n    res[constant(desc, prop)] = desc\n    return res\n  }, {})\n}\n\nexport function selectListOf(schema, prop) {\n  const desc = schema.properties && schema.properties[prop]\n  if (desc) {\n    return desc.enum.map((value, i) => {\n      const title = desc.enumNames && desc.enumNames[i]\n      return title ? { title, value } : value\n    })\n  }\n  return schema.oneOf.map(ds =>\n    !ds.title\n      ? constant(ds, prop)\n      : {\n          title: ds.title,\n          value: constant(ds, prop)\n        }\n  )\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { mapOf } from './schema-helper'\n\nconst radioButtonsSchema = {\n  enum: ['Absolute', 'Relative', 'Attached'],\n  default: 'Absolute'\n}\n\nconst contextSchema = {\n  title: 'Context',\n  enum: ['Fragment', 'Multifragment', 'Bond', 'Atom', 'Group'],\n  default: 'Fragment'\n}\n\nconst sData = {\n  Fragment: {\n    title: 'Fragment',\n    type: 'Object',\n    oneOf: [\n      {\n        key: 'FRG_STR',\n        title: 'MDLBG_FRAGMENT_STEREO',\n        properties: {\n          type: { enum: ['DAT'] },\n          fieldName: {\n            title: 'Field name',\n            enum: ['MDLBG_FRAGMENT_STEREO'],\n            default: 'MDLBG_FRAGMENT_STEREO'\n          },\n          fieldValue: {\n            title: 'Field value',\n            type: 'array',\n            items: {\n              enum: [\n                'abs',\n                '(+)-enantiomer',\n                '(-)-enantiomer',\n                'racemate',\n                'steric',\n                'rel',\n                'R(a)',\n                'S(a)',\n                'R(p)',\n                'S(p)'\n              ]\n            },\n            default: ['abs']\n          },\n          radiobuttons: radioButtonsSchema\n        },\n        required: ['fieldName', 'fieldValue', 'radiobuttons']\n      },\n      {\n        key: 'FRG_COEFF',\n        title: 'MDLBG_FRAGMENT_COEFFICIENT',\n        properties: {\n          type: { enum: ['DAT'] },\n          fieldName: {\n            title: 'Field name',\n            enum: ['MDLBG_FRAGMENT_COEFFICIENT'],\n            default: 'MDLBG_FRAGMENT_COEFFICIENT'\n          },\n          fieldValue: {\n            title: 'Field value',\n            type: 'string',\n            default: '',\n            minLength: 1,\n            invalidMessage: 'Please, specify field name'\n          },\n          radiobuttons: radioButtonsSchema\n        },\n        required: ['fieldName', 'fieldValue', 'radiobuttons']\n      },\n      {\n        key: 'FRG_CHRG',\n        title: 'MDLBG_FRAGMENT_CHARGE',\n        properties: {\n          type: { enum: ['DAT'] },\n          fieldName: {\n            title: 'Field name',\n            enum: ['MDLBG_FRAGMENT_CHARGE'],\n            default: 'MDLBG_FRAGMENT_CHARGE'\n          },\n          fieldValue: {\n            title: 'Field value',\n            type: 'string',\n            default: '',\n            minLength: 1,\n            invalidMessage: 'Please, specify field name'\n          },\n          radiobuttons: radioButtonsSchema\n        },\n        required: ['fieldName', 'fieldValue', 'radiobuttons']\n      },\n      {\n        key: 'FRG_RAD',\n        title: 'MDLBG_FRAGMENT_RADICALS',\n        properties: {\n          type: { enum: ['DAT'] },\n          fieldName: {\n            title: 'Field name',\n            enum: ['MDLBG_FRAGMENT_RADICALS'],\n            default: 'MDLBG_FRAGMENT_RADICALS'\n          },\n          fieldValue: {\n            title: 'Field value',\n            type: 'string',\n            default: '',\n            minLength: 1,\n            invalidMessage: 'Please, specify field name'\n          },\n          radiobuttons: radioButtonsSchema\n        },\n        required: ['fieldName', 'fieldValue', 'radiobuttons']\n      }\n    ]\n  },\n  Multifragment: {\n    title: 'Multifragment',\n    type: 'Object',\n    oneOf: [\n      {\n        key: 'MLT_FRG',\n        title: 'KETCHER_MULTIPLE_FRAGMENT',\n        properties: {\n          type: { enum: ['DAT'] },\n          fieldName: {\n            title: 'Field name',\n            enum: ['KETCHER_MULTIPLE_FRAGMENT'],\n            default: 'KETCHER_MULTIPLE_FRAGMENT'\n          },\n          fieldValue: {\n            title: 'Field value',\n            type: 'array',\n            items: {\n              enum: [\n                'aerosol',\n                'alloy',\n                'catenane',\n                'complex',\n                'composite',\n                'co-polymer',\n                'emulsion',\n                'host-guest complex',\n                'mixture',\n                'rotaxane',\n                'suspension'\n              ]\n            },\n            default: ['aerosol']\n          },\n          radiobuttons: radioButtonsSchema\n        },\n        required: ['fieldName', 'fieldValue', 'radiobuttons']\n      }\n    ]\n  },\n  Bond: {\n    title: 'Bond',\n    type: 'Object',\n    oneOf: [\n      {\n        key: 'SB_STR',\n        title: 'MDLBG_STEREO_KEY',\n        properties: {\n          type: { enum: ['DAT'] },\n          fieldName: {\n            title: 'Field name',\n            enum: ['MDLBG_STEREO_KEY'],\n            default: 'MDLBG_STEREO_KEY'\n          },\n          fieldValue: {\n            title: 'Field value',\n            type: 'array',\n            items: {\n              enum: [\n                'erythro',\n                'threo',\n                'alpha',\n                'beta',\n                'endo',\n                'exo',\n                'anti',\n                'syn',\n                'ECL',\n                'STG'\n              ]\n            },\n            default: ['erythro']\n          },\n          radiobuttons: radioButtonsSchema\n        },\n        required: ['fieldName', 'fieldValue', 'radiobuttons']\n      },\n      {\n        key: 'SB_BND',\n        title: 'MDLBG_BOND_KEY',\n        properties: {\n          type: { enum: ['DAT'] },\n          fieldName: {\n            title: 'Field name',\n            enum: ['MDLBG_BOND_KEY'],\n            default: 'MDLBG_BOND_KEY'\n          },\n          fieldValue: {\n            title: 'Field value',\n            type: 'array',\n            items: {\n              enum: ['Value=4']\n            },\n            default: ['Value=4']\n          },\n          radiobuttons: radioButtonsSchema\n        },\n        required: ['fieldName', 'fieldValue', 'radiobuttons']\n      }\n    ]\n  },\n  Atom: {\n    title: 'Atom',\n    type: 'Object',\n    oneOf: [\n      {\n        key: 'AT_STR',\n        title: 'MDLBG_STEREO_KEY',\n        properties: {\n          type: { enum: ['DAT'] },\n          fieldName: {\n            title: 'Field name',\n            enum: ['MDLBG_STEREO_KEY'],\n            default: 'MDLBG_STEREO_KEY'\n          },\n          fieldValue: {\n            title: 'Field value',\n            type: 'array',\n            items: {\n              enum: [\n                'RS',\n                'SR',\n                'P-3',\n                'P-3-PI',\n                'SP-4',\n                'SP-4-PI',\n                'T-4',\n                'T-4-PI',\n                'SP-5',\n                'SP-5-PI',\n                'TB-5',\n                'TB-5-PI',\n                'OC-6',\n                'TP-6',\n                'PB-7',\n                'CU-8',\n                'SA-8',\n                'DD-8',\n                'HB-9',\n                'TPS-9'\n              ]\n            },\n            default: ['RS']\n          },\n          radiobuttons: radioButtonsSchema\n        },\n        required: ['fieldName', 'fieldValue', 'radiobuttons']\n      }\n    ]\n  },\n  Group: {\n    title: 'Group',\n    type: 'Object',\n    oneOf: [\n      {\n        key: 'GRP_STR',\n        title: 'MDLBG_STEREO_KEY',\n        properties: {\n          type: { enum: ['DAT'] },\n          fieldName: {\n            title: 'Field name',\n            enum: ['MDLBG_STEREO_KEY'],\n            default: 'MDLBG_STEREO_KEY'\n          },\n          fieldValue: {\n            title: 'Field value',\n            type: 'array',\n            items: {\n              enum: ['cis', 'trans']\n            },\n            default: ['cis']\n          },\n          radiobuttons: radioButtonsSchema\n        },\n        required: ['fieldName', 'fieldValue', 'radiobuttons']\n      }\n    ]\n  }\n}\n\nexport const sdataCustomSchema = {\n  key: 'Custom',\n  properties: {\n    type: { enum: ['DAT'] },\n    context: {\n      title: 'Context',\n      enum: ['Fragment', 'Multifragment', 'Bond', 'Atom', 'Group'],\n      default: 'Fragment'\n    },\n    fieldName: {\n      title: 'Field name',\n      type: 'string',\n      default: '',\n      minLength: 1,\n      invalidMessage: 'Please, specify field name'\n    },\n    fieldValue: {\n      title: 'Field value',\n      type: 'string',\n      default: '',\n      minLength: 1,\n      invalidMessage: 'Please, specify field value'\n    },\n    radiobuttons: {\n      enum: ['Absolute', 'Relative', 'Attached'],\n      default: 'Absolute'\n    }\n  },\n  required: ['context', 'fieldName', 'fieldValue', 'radiobuttons']\n}\n\nexport const sdataSchema = Object.keys(sData).reduce((acc, title) => {\n  acc[title] = mapOf(sData[title], 'fieldName')\n  Object.keys(acc[title]).forEach(fieldName => {\n    acc[title][fieldName].properties.context = contextSchema\n  })\n  return acc\n}, {})\n\n/**\n * Returns first key of passed object\n * @param obj { object }\n */\nfunction firstKeyOf(obj) {\n  return Object.keys(obj)[0]\n}\n\n/**\n * Returns schema default values. Depends on passed arguments:\n * pass schema only -> returns default context\n * pass schema & context -> returns default fieldName\n * pass schema & context & fieldName -> returns default fieldValue\n * @param context? { string }\n * @param fieldName? { string }\n * @returns { string }\n */\nexport function getSdataDefault(context, fieldName) {\n  if (!context && !fieldName) return firstKeyOf(sdataSchema)\n\n  if (!fieldName) return firstKeyOf(sdataSchema[context])\n\n  return sdataSchema[context][fieldName]\n    ? sdataSchema[context][fieldName].properties.fieldValue.default\n    : ''\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { getSdataDefault, sdataSchema } from '../../data/schema/sdata-schema'\n\nexport const initSdata = () => {\n  const context = getSdataDefault()\n  const fieldName = getSdataDefault(context)\n  const fieldValue = getSdataDefault(context, fieldName)\n  const radiobuttons = 'Absolute'\n\n  return {\n    errors: {},\n    valid: true,\n    result: {\n      context,\n      fieldName,\n      fieldValue,\n      radiobuttons,\n      type: 'DAT'\n    }\n  }\n}\n\nexport function sdataReducer(state, action) {\n  if (action.data.result.init) {\n    return correctErrors(\n      {\n        ...state,\n        result: Object.assign({}, state.result, action.data.result)\n      },\n      action.data\n    )\n  }\n\n  const actionContext = action.data.result.context\n  const actionFieldName = action.data.result.fieldName\n\n  let newstate = null\n\n  if (actionContext !== state.result.context)\n    newstate = onContextChange(state, action.data.result)\n  else if (actionFieldName !== state.result.fieldName)\n    newstate = onFieldNameChange(state, action.data.result)\n\n  newstate = newstate || {\n    ...state,\n    result: Object.assign({}, state.result, action.data.result)\n  }\n\n  return correctErrors(newstate, action.data)\n}\n\nconst correctErrors = (state, payload) => {\n  const { valid, errors } = payload\n  const { fieldName, fieldValue } = state.result\n\n  return {\n    result: state.result,\n    valid: valid && !!fieldName && !!fieldValue,\n    errors\n  }\n}\n\nconst onContextChange = (state, payload) => {\n  const { context, fieldValue } = payload\n\n  const fieldName = getSdataDefault(context)\n\n  let fValue = fieldValue\n  if (fValue === state.result.fieldValue)\n    fValue = getSdataDefault(context, fieldName)\n\n  return {\n    result: {\n      ...payload,\n      context,\n      fieldName,\n      fieldValue: fValue\n    }\n  }\n}\n\nconst onFieldNameChange = (state, payload) => {\n  const { fieldName } = payload\n\n  const context = state.result.context\n\n  let fieldValue = payload.fieldValue\n\n  if (sdataSchema[context][fieldName])\n    fieldValue = getSdataDefault(context, fieldName)\n\n  if (\n    fieldValue === state.result.fieldValue &&\n    sdataSchema[context][state.result.fieldName]\n  )\n    fieldValue = ''\n\n  return {\n    result: {\n      ...payload,\n      fieldName,\n      fieldValue\n    }\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { initSdata, sdataReducer } from './sdata'\n\nimport { getDefaultOptions } from '../../data/schema/options-schema'\n\nexport const formsState = {\n  // TODO: create from schema.{smth}.defaultValue\n  // TODO: change validation method, no 'valid:true' props as default\n  atomProps: {\n    errors: {},\n    valid: true,\n    result: {\n      label: '',\n      charge: 0,\n      explicitValence: -1,\n      hCount: 0,\n      invRet: 0,\n      isotope: 0,\n      radical: 0,\n      ringBondCount: 0,\n      substitutionCount: 0\n    }\n  },\n  attachmentPoints: {\n    errors: {},\n    valid: true,\n    result: {\n      primary: false,\n      secondary: false\n    }\n  },\n  automap: {\n    errors: {},\n    valid: true,\n    result: {\n      mode: 'discard'\n    }\n  },\n  bondProps: {\n    errors: {},\n    valid: true,\n    result: {\n      type: 'single',\n      topology: 0,\n      center: 0\n    }\n  },\n  check: {\n    errors: {},\n    moleculeErrors: {}\n  },\n  labelEdit: {\n    errors: {},\n    valid: true,\n    result: {\n      label: ''\n    }\n  },\n  rgroup: {\n    errors: {},\n    valid: true,\n    result: {\n      values: []\n    }\n  },\n  rgroupLogic: {\n    errors: {},\n    valid: true,\n    result: {\n      ifthen: 0,\n      range: '>0',\n      resth: false\n    }\n  },\n  save: {\n    errors: {},\n    valid: true,\n    result: {\n      filename: 'ketcher',\n      format: 'mol'\n    }\n  },\n  settings: {\n    errors: {},\n    valid: true,\n    result: getDefaultOptions()\n  },\n  sgroup: {\n    errors: {},\n    valid: true,\n    result: {\n      type: 'GEN'\n    }\n  },\n  text: {\n    errors: {},\n    valid: true,\n    result: {}\n  },\n  sdata: initSdata()\n}\n\nexport function updateFormState(data) {\n  return {\n    type: 'UPDATE_FORM',\n    data\n  }\n}\n\nexport function checkErrors(errors) {\n  return {\n    type: 'UPDATE_FORM',\n    data: { moleculeErrors: errors }\n  }\n}\n\nexport function setDefaultSettings() {\n  return {\n    type: 'UPDATE_FORM',\n    data: {\n      result: getDefaultOptions(),\n      valid: true,\n      errors: {}\n    }\n  }\n}\n\nexport function formReducer(state, action, formName) {\n  if (formName === 'sdata') return sdataReducer(state, action)\n\n  return Object.assign({}, state, action.data)\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  INDIGO_VERIFICATION,\n  RequestActionTypes,\n  RequestState\n} from './request.types'\n\nexport function indigoVerification(data: boolean): RequestActionTypes {\n  return {\n    type: INDIGO_VERIFICATION,\n    data\n  }\n}\n\nconst initialState = {\n  indigoVerification: false\n}\n\nexport default function (\n  state = initialState,\n  action: RequestActionTypes\n): RequestState {\n  const { type, data } = action\n\n  switch (type) {\n    case INDIGO_VERIFICATION: {\n      return {\n        ...state,\n        indigoVerification: data\n      }\n    }\n    default:\n      return state\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nexport const INDIGO_VERIFICATION = 'INDIGO_VERIFICATION'\n\nexport interface RequestState {\n  indigoVerification: boolean\n}\n\ninterface IndigoVerificationAction {\n  type: typeof INDIGO_VERIFICATION\n  data: boolean\n}\n\nexport type RequestActionTypes = IndigoVerificationAction\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { OperationType } from './OperationType'\n// todo: rename file in another PR\nimport Restruct from '../../render/restruct'\nimport { StereLabelStyleType } from '../../render/restruct/GeneralEnumTypes'\n\ntype ValueOf<TObject extends object> = Readonly<TObject[keyof TObject]>\ntype OperationType = ValueOf<typeof OperationType>\n\nclass BaseOperation {\n  private _inverted: BaseOperation | undefined\n  type: OperationType\n  priority: number\n\n  constructor(type: OperationType, priority = 0) {\n    this.type = type\n    this.priority = priority\n  }\n\n  // @ts-ignore\n  execute(restruct: Restruct): void {\n    throw new Error('Operation.execute() is not implemented')\n  }\n\n  perform(restruct: Restruct): BaseOperation {\n    this.execute(restruct)\n    if (!this._inverted) {\n      this._inverted = this.invert()\n      this._inverted._inverted = this\n    }\n    return this._inverted\n  }\n\n  invert(): BaseOperation {\n    throw new Error('Operation.invert() is not implemented')\n  }\n\n  // @ts-ignore\n  isDummy(restruct: Restruct): boolean {\n    return false\n  }\n\n  protected static invalidateAtom(restruct: Restruct, atomId: number, level?) {\n    const atom = restruct.atoms.get(atomId)\n    if (!atom) {\n      return\n    }\n\n    restruct.markAtom(atomId, level ? 1 : 0)\n\n    const halfBonds = restruct.molecule.halfBonds\n\n    atom.a.neighbors.forEach(halfBondId => {\n      if (!halfBonds.has(halfBondId)) {\n        return\n      }\n\n      const halfBond = halfBonds.get(halfBondId)\n      if (!halfBond) {\n        return\n      }\n\n      restruct.markBond(halfBond.bid, 1)\n      restruct.markAtom(halfBond.end, 0)\n\n      if (level) {\n        BaseOperation.invalidateLoop(restruct, halfBond.bid)\n      }\n    })\n\n    const fragment = atom.a.fragment\n    const stereoLabelStyle = restruct.render.options.stereoLabelStyle\n\n    restruct.atoms.forEach((atom, atomId) => {\n      if (\n        stereoLabelStyle === StereLabelStyleType.IUPAC ||\n        stereoLabelStyle === StereLabelStyleType.Classic\n      ) {\n        if (atom.a.fragment === fragment) restruct.markAtom(atomId, 0)\n      }\n    })\n  }\n\n  protected static invalidateLoop(restruct: Restruct, bondId: number) {\n    const bond = restruct.bonds.get(bondId)\n    if (!bond || !bond.b.hb1 || !bond.b.hb2) {\n      return\n    }\n\n    const halfBond1 = restruct.molecule.halfBonds.get(bond.b.hb1)\n    const halfBond2 = restruct.molecule.halfBonds.get(bond.b.hb2)\n\n    if (halfBond1 && halfBond1.loop >= 0) {\n      restruct.loopRemove(halfBond1.loop)\n    }\n\n    if (halfBond2 && halfBond2.loop >= 0) {\n      restruct.loopRemove(halfBond2.loop)\n    }\n  }\n\n  protected static invalidateBond(restruct: Restruct, bondId: number) {\n    BaseOperation.invalidateLoop(restruct, bondId)\n\n    const bond = restruct.bonds.get(bondId)\n    if (!bond) {\n      return\n    }\n    BaseOperation.invalidateAtom(restruct, bond.b.begin, 0)\n    BaseOperation.invalidateAtom(restruct, bond.b.end, 0)\n  }\n\n  protected static invalidateItem(\n    restruct: Restruct,\n    map,\n    id: number,\n    level?: any\n  ) {\n    if (map === 'atoms') {\n      BaseOperation.invalidateAtom(restruct, id, level)\n      return\n    }\n\n    if (map === 'bonds') {\n      BaseOperation.invalidateBond(restruct, id)\n\n      if (level > 0) {\n        BaseOperation.invalidateLoop(restruct, id)\n      }\n      return\n    }\n\n    restruct.markItem(map, id, level)\n  }\n\n  protected static invalidateEnhancedFlag(\n    restruct: Restruct,\n    fragmentId: number\n  ) {\n    BaseOperation.invalidateItem(restruct, 'enhancedFlags', fragmentId, 1)\n  }\n}\n\nexport { BaseOperation }\nexport default BaseOperation\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nexport const OperationType = Object.freeze({\n  ATOM_ADD: 'Add atom',\n  ATOM_DELETE: 'Delete atom',\n  ATOM_ATTR: 'Set atom attribute',\n  ATOM_MOVE: 'Move atom',\n  CALC_IMPLICIT_H: 'Calculate implicit hydrogen',\n  BOND_ADD: 'Add bond',\n  BOND_DELETE: 'Delete bond',\n  BOND_ATTR: 'Set bond attribute',\n  BOND_MOVE: 'Move bond',\n  LOOP_MOVE: 'Move loop',\n  S_GROUP_ATOM_ADD: 'Add atom to s-group',\n  S_GROUP_ATOM_REMOVE: 'Remove atom from s-group',\n  S_GROUP_ATTR: 'Set s-group attribute',\n  S_GROUP_CREATE: 'Create s-group',\n  S_GROUP_DELETE: 'Delete s-group',\n  S_GROUP_ADD_TO_HIERACHY: 'Add s-group to hierarchy',\n  S_GROUP_REMOVE_FROM_HIERACHY: 'Delete s-group from hierarchy',\n  R_GROUP_ATTR: 'Set r-group attribute',\n  R_GROUP_FRAGMENT: 'R-group fragment',\n  UPDATE_IF_THEN: 'Update',\n  RESTORE_IF_THEN: 'Restore',\n  RXN_ARROW_ADD: 'Add rxn arrow',\n  RXN_ARROW_DELETE: 'Delete rxn arrow',\n  RXN_ARROW_MOVE: 'Move rxn arrow',\n  RXN_PLUS_ADD: 'Add rxn plus',\n  RXN_PLUS_DELETE: 'Delete rxn plus',\n  RXN_PLUS_MOVE: 'Move rxn plus',\n  S_GROUP_DATA_MOVE: 'Move s-group data',\n  CANVAS_LOAD: 'Load canvas',\n  ALIGN_DESCRIPTORS: 'Align descriptors',\n  SIMPLE_OBJECT_ADD: 'Add simple object',\n  SIMPLE_OBJECT_DELETE: 'Delete simple object',\n  SIMPLE_OBJECT_MOVE: 'Move simple object',\n  SIMPLE_OBJECT_RESIZE: 'Resize simple object',\n  RESTORE_DESCRIPTORS_POSITION: 'Restore descriptors position',\n  FRAGMENT_ADD: 'Add fragment',\n  FRAGMENT_DELETE: 'Delete fragment',\n  FRAGMENT_STEREO_FLAG: 'Add fragment stereo flag',\n  FRAGMENT_ADD_STEREO_ATOM: 'Add stereo atom to fragment',\n  FRAGMENT_DELETE_STEREO_ATOM: 'Delete stereo atom from fragment',\n  ENHANCED_FLAG_MOVE: 'Move enhanced flag',\n  TEXT_CREATE: 'Add text',\n  TEXT_UPDATE: 'Edit text',\n  TEXT_DELETE: 'Delete text',\n  TEXT_MOVE: 'Move text'\n})\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport Restruct from '../../../render/restruct'\n\ntype Data = {\n  aid?: any\n  attribute?: any\n  value?: any\n}\n\nexport class AtomAttr extends BaseOperation {\n  data: Data\n  data2: Data | null\n\n  constructor(atomId?: any, attribute?: any, value?: any) {\n    super(OperationType.ATOM_ATTR, 1)\n    this.data = { aid: atomId, attribute, value }\n    this.data2 = null\n  }\n\n  execute(restruct: Restruct) {\n    const { aid, attribute, value } = this.data\n\n    const atom = restruct.molecule.atoms.get(aid)!\n    if (!this.data2) {\n      this.data2 = {\n        aid,\n        attribute,\n        value: atom[attribute]\n      }\n    }\n\n    atom[attribute] = value\n    BaseOperation.invalidateAtom(restruct, aid)\n  }\n\n  invert() {\n    const inverted = new AtomAttr()\n    // @ts-ignore\n    inverted.data = this.data2\n    inverted.data2 = this.data\n    return inverted\n  }\n\n  isDummy(restruct: Restruct) {\n    return (\n      restruct.molecule.atoms.get(this.data.aid)![this.data.attribute] ===\n      this.data.value\n    )\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport Restruct from '../../../render/restruct'\nimport { Scale } from 'ketcher-core'\n\nexport class AtomMove extends BaseOperation {\n  data: {\n    aid: any\n    d: any\n    noinvalidate: any\n  }\n\n  constructor(atomId?: any, d?: any, noinvalidate?: any) {\n    super(OperationType.ATOM_MOVE, 2)\n    this.data = { aid: atomId, d, noinvalidate }\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n    const { aid, d } = this.data\n    const atom = struct.atoms.get(aid)\n    if (!atom) return\n    atom!.pp.add_(d) // eslint-disable-line no-underscore-dangle\n    const reatom = restruct.atoms.get(aid)\n    if (reatom) {\n      const scaled = Scale.obj2scaled(d, restruct.render.options)\n      reatom.visel.translate(scaled)\n    }\n\n    this.data.d = d.negated()\n\n    if (!this.data.noinvalidate) {\n      BaseOperation.invalidateAtom(restruct, aid, 1)\n    }\n  }\n\n  invert() {\n    const inverted = new AtomMove()\n    inverted.data = this.data\n    return inverted\n  }\n\n  isDummy() {\n    const { d } = this.data\n    return d.x === 0 && d.y === 0\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Atom, Pile, Vec2 } from 'ketcher-core'\nimport Restruct, { ReAtom } from '../../../render/restruct'\n\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\n\n// todo: separate classes: now here is circular dependency in `invert` method\n\ntype Data = {\n  aid: any\n  atom: any\n  pos: any\n}\n\nclass AtomAdd extends BaseOperation {\n  data: Data\n\n  constructor(atom?: any, pos?: any) {\n    super(OperationType.ATOM_ADD)\n    this.data = { atom, pos, aid: null }\n  }\n\n  execute(restruct: Restruct) {\n    const { atom, pos } = this.data\n\n    const struct = restruct.molecule\n\n    const pp: { label?: string } = {}\n    if (atom) {\n      Object.keys(atom).forEach(p => {\n        pp[p] = atom[p]\n      })\n    }\n\n    pp.label = pp.label || 'C'\n    if (typeof this.data.aid !== 'number') {\n      // @ts-ignore\n      this.data.aid = struct.atoms.add(new Atom(pp))\n    } else {\n      // @ts-ignore\n      struct.atoms.set(this.data.aid, new Atom(pp))\n    }\n\n    const { aid } = this.data\n\n    // notifyAtomAdded\n    const atomData = new ReAtom(struct.atoms.get(aid)!)\n\n    atomData.component = restruct.connectedComponents.add(new Pile([aid]))\n    restruct.atoms.set(aid, atomData)\n    restruct.markAtom(aid, 1)\n\n    struct.atomSetPos(aid, new Vec2(pos))\n\n    const arrow = struct.rxnArrows.get(0)\n    if (arrow) {\n      const atom = struct.atoms.get(aid)!\n      atom.rxnFragmentType = struct.defineRxnFragmentTypeForAtomset(\n        new Pile([aid]),\n        arrow.pp.x\n      )\n    }\n  }\n\n  invert() {\n    const inverted = new AtomDelete()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nclass AtomDelete extends BaseOperation {\n  data: Data\n\n  constructor(atomId?: any) {\n    super(OperationType.ATOM_DELETE, 4)\n    this.data = { aid: atomId, atom: null, pos: null }\n  }\n\n  execute(restruct: Restruct) {\n    const { aid } = this.data\n\n    const struct = restruct.molecule\n    if (!this.data.atom) {\n      this.data.atom = struct.atoms.get(aid)\n      this.data.pos = this.data.atom.pp\n    }\n\n    // notifyAtomRemoved(aid);\n    const restructedAtom = restruct.atoms.get(aid)\n    if (!restructedAtom) {\n      return\n    }\n\n    const set = restruct.connectedComponents.get(restructedAtom.component)\n    set.delete(aid)\n    if (set.size === 0) {\n      restruct.connectedComponents.delete(restructedAtom.component)\n    }\n\n    restruct.clearVisel(restructedAtom.visel)\n    restruct.atoms.delete(aid)\n    restruct.markItemRemoved()\n    struct.atoms.delete(aid)\n  }\n\n  invert() {\n    const inverted = new AtomAdd()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nexport { AtomAdd, AtomDelete }\nexport * from './AtomAttr'\nexport * from './AtomMove'\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport Restruct from '../../../render/restruct'\ntype Data = {\n  bid: any\n  attribute: any\n  value: any\n}\n\nexport class BondAttr extends BaseOperation {\n  data: Data\n  data2: Data | null\n\n  constructor(bondId?: any, attribute?: any, value?: any) {\n    super(OperationType.BOND_ATTR, 2)\n    this.data = { bid: bondId, attribute, value }\n    this.data2 = null\n  }\n\n  execute(restruct: Restruct) {\n    const { attribute, bid, value } = this.data\n    const bond = restruct.molecule.bonds.get(bid)!\n\n    if (!this.data2) {\n      this.data2 = {\n        bid: bid,\n        attribute: attribute,\n        value: bond[attribute]\n      }\n    }\n\n    bond[attribute] = value\n\n    BaseOperation.invalidateBond(restruct, bid)\n    if (attribute === 'type') {\n      BaseOperation.invalidateLoop(restruct, bid)\n    }\n  }\n\n  isDummy(restruct: Restruct) {\n    const { attribute, bid, value } = this.data\n    const bond = restruct.molecule.bonds.get(bid)!\n    return bond[attribute] === value\n  }\n\n  invert() {\n    const inverted = new BondAttr()\n    // @ts-ignore\n    inverted.data = this.data2\n    inverted.data2 = this.data\n    return inverted\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport Restruct from '../../../render/restruct'\nimport { Scale } from 'ketcher-core'\n\nexport class BondMove extends BaseOperation {\n  data: {\n    bid: any\n    d: any\n  }\n\n  constructor(bondId?: any, d?: any) {\n    super(OperationType.BOND_MOVE, 2)\n    this.data = { bid: bondId, d }\n  }\n\n  execute(restruct: Restruct) {\n    const { bid, d } = this.data\n    const bond = restruct.bonds.get(bid)\n    if (!bond) return\n\n    const scaled = Scale.obj2scaled(d, restruct.render.options)\n    bond.visel.translate(scaled)\n    this.data.d = d.negated()\n  }\n\n  invert() {\n    const inverted = new BondMove()\n    inverted.data = this.data\n    return inverted\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport Restruct, { ReBond } from '../../../render/restruct'\n\nimport { BaseOperation } from '../base'\nimport { Bond } from 'ketcher-core'\nimport { OperationType } from '../OperationType'\n\n// todo: separate classes: now here is circular dependency in `invert` method\n\ntype Data = {\n  bond: any\n  begin: any\n  end: any\n  bid: any\n}\n\nclass BondAdd extends BaseOperation {\n  data: Data\n\n  constructor(begin?: any, end?: any, bond?: any) {\n    super(OperationType.BOND_ADD, 1)\n    this.data = { bond, begin, end, bid: null }\n  }\n\n  execute(restruct: Restruct) {\n    const { begin, bond, end } = this.data\n    // eslint-disable-line max-statements\n    const struct = restruct.molecule\n\n    if (begin === end) {\n      throw new Error('Distinct atoms expected')\n    }\n\n    BaseOperation.invalidateAtom(restruct, begin, 1)\n    BaseOperation.invalidateAtom(restruct, end, 1)\n\n    const pp: {\n      type?: any\n      begin?: any\n      end?: any\n    } = {}\n\n    if (bond) {\n      Object.keys(bond).forEach(p => {\n        pp[p] = bond[p]\n      })\n    }\n\n    pp.type = pp.type || Bond.PATTERN.TYPE.SINGLE\n    pp.begin = begin\n    pp.end = end\n\n    // @ts-ignore\n    const newBond = new Bond(pp)\n    if (typeof this.data.bid === 'number') {\n      struct.bonds.set(this.data.bid, newBond)\n    } else {\n      this.data.bid = struct.bonds.add(newBond)\n    }\n\n    const { bid } = this.data\n    const structBond = struct.bonds.get(bid)!\n\n    struct.bondInitHalfBonds(bid)\n    struct.atomAddNeighbor(structBond.hb1)\n    struct.atomAddNeighbor(structBond.hb2)\n\n    // notifyBondAdded\n    restruct.bonds.set(bid, new ReBond(structBond))\n    restruct.markBond(bid, 1)\n  }\n\n  invert() {\n    const inverted = new BondDelete()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nclass BondDelete extends BaseOperation {\n  data: Data\n\n  constructor(bondId?: any) {\n    super(OperationType.BOND_DELETE, 3)\n    this.data = { bid: bondId, bond: null, begin: null, end: null }\n  }\n\n  execute(restruct: Restruct) {\n    const { bid } = this.data\n\n    // eslint-disable-line max-statements\n    const struct = restruct.molecule\n    if (!this.data.bond) {\n      this.data.bond = struct.bonds.get(bid)\n      this.data.begin = this.data.bond.begin\n      this.data.end = this.data.bond.end\n    }\n\n    BaseOperation.invalidateBond(restruct, bid)\n\n    // notifyBondRemoved\n    const rebond = restruct.bonds.get(bid)\n    if (!rebond) return\n    ;[rebond.b.hb1, rebond.b.hb2].forEach(hbid => {\n      if (hbid === undefined) return\n      const halfBond = restruct.molecule.halfBonds.get(hbid)\n      if (halfBond && halfBond.loop >= 0) {\n        restruct.loopRemove(halfBond.loop)\n      }\n    }, restruct)\n    restruct.clearVisel(rebond.visel)\n    restruct.bonds.delete(bid)\n    restruct.markItemRemoved()\n\n    const structBond = struct.bonds.get(bid)!\n    ;[structBond.hb1, structBond.hb2].forEach(hbid => {\n      const halfBond = struct.halfBonds.get(hbid!)\n      if (!halfBond) {\n        return\n      }\n\n      const atom = struct.atoms.get(halfBond.begin)!\n      const pos = atom.neighbors.indexOf(hbid!)\n      const prev = (pos + atom.neighbors.length - 1) % atom.neighbors.length\n      const next = (pos + 1) % atom.neighbors.length\n      struct.setHbNext(atom.neighbors[prev], atom.neighbors[next])\n      atom.neighbors.splice(pos, 1)\n    })\n    struct.halfBonds.delete(structBond.hb1!)\n    struct.halfBonds.delete(structBond.hb2!)\n\n    struct.bonds.delete(bid)\n  }\n\n  invert() {\n    const inverted = new BondAdd()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nexport { BondAdd, BondDelete }\nexport * from './BondAttr'\nexport * from './BondMove'\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport Restruct from '../../render/restruct'\nimport { Struct } from 'ketcher-core'\nimport { BaseOperation } from './base'\nimport { OperationType } from './OperationType'\n\nexport class CanvasLoad extends BaseOperation {\n  data: {\n    struct?: Struct\n  }\n\n  constructor(struct?: Struct) {\n    super(OperationType.CANVAS_LOAD)\n    this.data = { struct }\n  }\n\n  execute(restruct: Restruct) {\n    const oldStruct = restruct.molecule\n    restruct.clearVisels() // TODO: What is it?\n    restruct.render.setMolecule(this.data.struct)\n    this.data.struct = oldStruct\n  }\n\n  invert() {\n    const inverted = new CanvasLoad()\n    inverted.data = this.data\n    return inverted\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Vec2 } from 'ketcher-core'\nimport Restruct from '../../render/restruct'\nimport { BaseOperation } from './base'\nimport { OperationType } from './OperationType'\n\n// todo: separate classes: now here is circular dependency in `invert` method\n\nclass AlignDescriptors extends BaseOperation {\n  history: any\n\n  constructor() {\n    super(OperationType.ALIGN_DESCRIPTORS)\n    this.history = {}\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n    const sgroups: any[] = Array.from(struct.sgroups.values()).reverse()\n\n    const structBox: any = struct.getCoordBoundingBoxObj()\n    let alignPoint = new Vec2(structBox.max.x, structBox.min.y).add(\n      new Vec2(2.0, -1.0)\n    )\n\n    sgroups.forEach(sgroup => {\n      this.history[sgroup.id] = new Vec2(sgroup.pp)\n      alignPoint = alignPoint.add(new Vec2(0.0, 0.5))\n      sgroup.pp = alignPoint\n      struct.sgroups.set(sgroup.id, sgroup)\n      BaseOperation.invalidateItem(restruct, 'sgroupData', sgroup.id, 1)\n    })\n  }\n\n  invert() {\n    return new RestoreDescriptorsPosition(this.history)\n  }\n}\n\nclass RestoreDescriptorsPosition extends BaseOperation {\n  history: any\n\n  constructor(history: any) {\n    super(OperationType.RESTORE_DESCRIPTORS_POSITION)\n    this.history = history\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n    const sgroups: any[] = Array.from(struct.sgroups.values())\n\n    sgroups.forEach(sgroup => {\n      sgroup.pp = this.history[sgroup.id]\n      struct.sgroups.set(sgroup.id, sgroup)\n      BaseOperation.invalidateItem(restruct, 'sgroupData', sgroup.id, 1)\n    })\n  }\n\n  invert() {\n    return new AlignDescriptors()\n  }\n}\n\nexport { AlignDescriptors, RestoreDescriptorsPosition }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Fragment, Vec2 } from 'ketcher-core'\n\nimport { BaseOperation } from './base'\nimport { OperationType } from './OperationType'\nimport Restruct from '../../render/restruct'\n\nexport class EnhancedFlagMove extends BaseOperation {\n  data: {\n    frid: any\n    p: any\n  }\n\n  constructor(fragmentId?: any, p?: any) {\n    super(OperationType.ENHANCED_FLAG_MOVE)\n    this.data = { frid: fragmentId, p }\n  }\n\n  execute(restruct: Restruct) {\n    const { frid } = this.data\n    const { p } = this.data\n    const fragment = restruct.molecule.frags.get(frid)\n    if (!fragment) return\n\n    const currentPosition = fragment.stereoFlagPosition\n      ? new Vec2(fragment.stereoFlagPosition.x, fragment.stereoFlagPosition.y)\n      : Fragment.getDefaultStereoFlagPosition(restruct.molecule, frid)!\n\n    const newPosition = Vec2.sum(currentPosition, p)\n    fragment.stereoFlagPosition = newPosition\n\n    this.data.p = p.negated()\n    BaseOperation.invalidateItem(restruct, 'enhancedFlags', frid, 1)\n  }\n\n  invert() {\n    const inverted = new EnhancedFlagMove()\n    inverted.data = this.data\n    return inverted\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport Restruct from '../../render/restruct'\nimport { BaseOperation } from './base'\nimport { OperationType } from './OperationType'\n\n// todo: separate classes: now here is circular dependency in `invert` method\n\nclass UpdateIfThen extends BaseOperation {\n  rgid_new: any\n  rgid_old: any\n  ifThenHistory: any\n  skipRgids: any[]\n\n  constructor(rgNew: any, rgOld: any, skipRgids: any = []) {\n    super(OperationType.UPDATE_IF_THEN)\n    this.rgid_new = rgNew\n    this.rgid_old = rgOld\n    this.ifThenHistory = new Map()\n    this.skipRgids = skipRgids || []\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n\n    struct.rgroups.forEach((rg, rgid) => {\n      if (rg.ifthen === this.rgid_old && !this.skipRgids.includes(rgid)) {\n        rg.ifthen = this.rgid_new\n        this.ifThenHistory.set(rgid, this.rgid_old)\n        struct.rgroups.set(rgid, rg)\n      }\n    })\n  }\n\n  invert() {\n    return new RestoreIfThen(this.rgid_new, this.rgid_old, this.ifThenHistory)\n  }\n}\n\nclass RestoreIfThen extends BaseOperation {\n  rgid_new: any\n  rgid_old: any\n  ifThenHistory: any\n\n  constructor(rgNew: any, rgOld: any, history: any) {\n    super(OperationType.RESTORE_IF_THEN)\n    this.rgid_new = rgNew\n    this.rgid_old = rgOld\n    this.ifThenHistory = history || new Map()\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n\n    this.ifThenHistory.forEach((rg, rgid) => {\n      const rgValue = struct.rgroups.get(rgid)!\n      rgValue.ifthen = rg\n      struct.rgroups.set(rgid, rgValue)\n    })\n  }\n\n  invert() {\n    return new UpdateIfThen(this.rgid_old, this.rgid_new)\n  }\n}\n\nexport { UpdateIfThen, RestoreIfThen }\n","import Restruct, { ReEnhancedFlag, ReFrag } from '../../render/restruct'\n\nimport { BaseOperation } from './base'\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Fragment } from 'ketcher-core'\nimport { OperationType } from './OperationType'\n\n// todo: separate classes: now here is circular dependency in `invert` method\n\nclass FragmentAdd extends BaseOperation {\n  frid: any\n\n  constructor(fragmentId?: any) {\n    super(OperationType.FRAGMENT_ADD)\n    this.frid = typeof fragmentId === 'undefined' ? null : fragmentId\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n    const frag = new Fragment()\n\n    if (this.frid === null) {\n      this.frid = struct.frags.add(frag)\n    } else {\n      struct.frags.set(this.frid, frag)\n    }\n\n    restruct.frags.set(this.frid, new ReFrag(frag)) // TODO add ReStruct.notifyFragmentAdded\n    restruct.enhancedFlags.set(this.frid, new ReEnhancedFlag())\n  }\n\n  invert() {\n    return new FragmentDelete(this.frid)\n  }\n}\n\nclass FragmentDelete extends BaseOperation {\n  frid: any\n\n  constructor(fragmentId: any) {\n    super(OperationType.FRAGMENT_DELETE, 100)\n    this.frid = fragmentId\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n    if (!struct.frags.get(this.frid)) {\n      return\n    }\n\n    BaseOperation.invalidateItem(restruct, 'frags', this.frid, 1)\n    restruct.frags.delete(this.frid)\n    struct.frags.delete(this.frid) // TODO add ReStruct.notifyFragmentRemoved\n\n    const enhancedFalg = restruct.enhancedFlags.get(this.frid)\n    if (!enhancedFalg) return\n    restruct.clearVisel(enhancedFalg.visel)\n    restruct.enhancedFlags.delete(this.frid)\n  }\n\n  invert() {\n    return new FragmentAdd(this.frid)\n  }\n}\n\nexport { FragmentAdd, FragmentDelete }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from './base'\nimport { OperationType } from './OperationType'\nimport Restruct from '../../render/restruct'\n\n// todo: separate classes: now here is circular dependency in `invert` method\n\ntype Data = {\n  frid: any\n  aid: any\n}\n\n// todo : merge add and delete stereo atom\nclass FragmentAddStereoAtom extends BaseOperation {\n  data: Data\n\n  constructor(fragmentId: any, atomId: any) {\n    super(OperationType.FRAGMENT_ADD_STEREO_ATOM, 100)\n    this.data = { frid: fragmentId, aid: atomId }\n  }\n\n  execute(restruct: Restruct) {\n    const { aid, frid } = this.data\n\n    const frag = restruct.molecule.frags.get(frid)\n    if (frag) {\n      frag.updateStereoAtom(restruct.molecule, aid, frid, true)\n\n      BaseOperation.invalidateEnhancedFlag(restruct, frid)\n    }\n  }\n\n  invert() {\n    return new FragmentDeleteStereoAtom(this.data.frid, this.data.aid)\n  }\n}\n\nclass FragmentDeleteStereoAtom extends BaseOperation {\n  data: Data\n\n  constructor(fragmentId: any, atomId: any) {\n    super(OperationType.FRAGMENT_DELETE_STEREO_ATOM, 90)\n    this.data = { frid: fragmentId, aid: atomId }\n  }\n\n  execute(restruct: Restruct) {\n    const { aid, frid } = this.data\n\n    const frag = restruct.molecule.frags.get(frid)\n    if (frag) {\n      frag.updateStereoAtom(restruct.molecule, aid, frid, false)\n\n      BaseOperation.invalidateEnhancedFlag(restruct, frid)\n    }\n  }\n\n  invert() {\n    const { aid, frid } = this.data\n    return new FragmentAddStereoAtom(frid, aid)\n  }\n}\n\nexport { FragmentAddStereoAtom, FragmentDeleteStereoAtom }\n","import { BaseOperation } from './base'\nimport { OperationType } from './OperationType'\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport Restruct from '../../render/restruct'\n\nexport class FragmentStereoFlag extends BaseOperation {\n  frid: number\n\n  constructor(fragmentId: number) {\n    super(OperationType.FRAGMENT_STEREO_FLAG, 6)\n    this.frid = fragmentId\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n\n    const fragment = struct.frags.get(this.frid)!\n    fragment.updateStereoFlag(struct)\n\n    BaseOperation.invalidateEnhancedFlag(restruct, this.frid)\n  }\n\n  invert() {\n    const inverted = new FragmentStereoFlag(this.frid)\n    return inverted\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from './base'\nimport { OperationType } from './OperationType'\nimport Restruct from '../../render/restruct'\n\nexport class CalcImplicitH extends BaseOperation {\n  atomIds: Array<number>\n\n  constructor(aids: Array<number>) {\n    super(OperationType.CALC_IMPLICIT_H, 10)\n    this.atomIds = aids\n  }\n\n  execute(restruct: Restruct) {\n    const aIds = this.atomIds\n\n    restruct.molecule.setImplicitHydrogen(aIds)\n  }\n\n  invert() {\n    return new CalcImplicitH(this.atomIds)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from './base'\nimport { OperationType } from './OperationType'\nimport Restruct from '../../render/restruct'\nimport { Scale } from 'ketcher-core'\nexport class LoopMove extends BaseOperation {\n  data: {\n    id: any\n    d: any\n  }\n\n  constructor(id?: any, d?: any) {\n    super(OperationType.LOOP_MOVE)\n    this.data = { id, d }\n  }\n\n  execute(restruct: Restruct) {\n    // not sure if there should be an action to move a loop in the first place\n    // but we have to somehow move the aromatic ring,\n    // which is associated with the loop, rather than with any of the bonds\n    const { id, d } = this.data\n    const reloop = restruct.reloops.get(id)\n\n    if (reloop && reloop.visel) {\n      const scaled = Scale.obj2scaled(d, restruct.render.options)\n      reloop.visel.translate(scaled)\n    }\n    this.data.d = d.negated()\n  }\n\n  invert() {\n    const inverted = new LoopMove()\n    inverted.data = this.data\n    return inverted\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport Restruct from '../../../render/restruct'\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\n\ntype Data = {\n  rgid: any\n  attribute: any\n  value: any\n}\n\nexport class RGroupAttr extends BaseOperation {\n  data: Data\n  data2: Data | null\n\n  constructor(rgroupId?: any, attribute?: any, value?: any) {\n    super(OperationType.R_GROUP_ATTR)\n    this.data = { rgid: rgroupId, attribute, value }\n    this.data2 = null\n  }\n\n  execute(restruct: Restruct) {\n    const { rgid, attribute, value } = this.data\n\n    const rgp = restruct.molecule.rgroups.get(rgid)!\n    if (!this.data2) {\n      this.data2 = {\n        rgid,\n        attribute,\n        value: rgp[attribute]\n      }\n    }\n\n    rgp[attribute] = value\n\n    BaseOperation.invalidateItem(restruct, 'rgroups', rgid)\n  }\n\n  invert() {\n    const inverted = new RGroupAttr()\n    // @ts-ignore\n    inverted.data = this.data2\n    inverted.data2 = this.data\n    return inverted\n  }\n\n  isDummy(restruct: Restruct) {\n    const { rgid, attribute, value } = this.data\n    const rgroup = restruct.molecule.rgroups.get(rgid)!\n    return rgroup[attribute] === value\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport { RGroup } from 'ketcher-core'\nimport Restruct, { ReRGroup } from '../../../render/restruct'\n\nexport class RGroupFragment extends BaseOperation {\n  rgid_new: any\n  rg_new: any\n  rgid_old: any\n  rg_old: any\n  frid: any\n\n  constructor(rgroupId: any, fragmentId: any, rg: any) {\n    super(OperationType.R_GROUP_FRAGMENT)\n    this.rgid_new = rgroupId\n    this.rg_new = rg\n    this.rgid_old = null\n    this.rg_old = null\n    this.frid = fragmentId\n  }\n\n  execute(restruct: Restruct) {\n    // eslint-disable-line max-statements\n    const struct = restruct.molecule\n    this.rgid_old =\n      this.rgid_old || RGroup.findRGroupByFragment(struct.rgroups, this.frid)\n\n    this.rg_old = this.rgid_old ? struct.rgroups.get(this.rgid_old) : null\n\n    this.removeOld(struct, restruct)\n    this.setNew(struct, restruct)\n  }\n\n  private removeOld(struct: any, restruct: any) {\n    if (!this.rg_old) {\n      return\n    }\n\n    this.rg_old.frags.delete(this.frid)\n    restruct.clearVisel(restruct.rgroups.get(this.rgid_old).visel)\n\n    if (this.rg_old.frags.size === 0) {\n      restruct.rgroups.delete(this.rgid_old)\n      struct.rgroups.delete(this.rgid_old)\n      restruct.markItemRemoved()\n    } else {\n      restruct.markItem('rgroups', this.rgid_old, 1)\n    }\n  }\n\n  private setNew(struct: any, restruct: Restruct) {\n    if (!this.rgid_new) {\n      return\n    }\n\n    let rgNew = struct.rgroups.get(this.rgid_new)\n    if (!rgNew) {\n      rgNew = this.rg_new || new RGroup()\n      struct.rgroups.set(this.rgid_new, rgNew)\n      restruct.rgroups.set(this.rgid_new, new ReRGroup(rgNew))\n    } else {\n      restruct.markItem('rgroups', this.rgid_new, 1)\n    }\n\n    rgNew.frags.add(this.frid)\n  }\n\n  invert() {\n    return new RGroupFragment(this.rgid_old, this.frid, this.rg_old)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport Restruct from '../../../render/restruct'\nimport { Scale } from 'ketcher-core'\n\nexport class RxnArrowMove extends BaseOperation {\n  data: {\n    id: any\n    d: any\n    noinvalidate: any\n  }\n\n  constructor(id?: any, d?: any, noinvalidate?: any) {\n    super(OperationType.RXN_ARROW_MOVE)\n    this.data = { id, d, noinvalidate }\n  }\n\n  execute(restruct: Restruct) {\n    const { d, id, noinvalidate } = this.data\n\n    const struct = restruct.molecule\n    struct.rxnArrows.get(id)!.pp.add_(d) // eslint-disable-line no-underscore-dangle\n\n    const rxn = restruct.rxnArrows.get(id)\n    if (!rxn) return\n    const scaled = Scale.obj2scaled(d, restruct.render.options)\n    rxn.visel.translate(scaled)\n\n    this.data.d = d.negated()\n    if (!noinvalidate) {\n      BaseOperation.invalidateItem(restruct, 'rxnArrows', id, 1)\n    }\n  }\n\n  invert() {\n    const inverted = new RxnArrowMove()\n    inverted.data = this.data\n    return inverted\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from '../../base'\nimport { OperationType } from '../../OperationType'\nimport Restruct from '../../../../render/restruct'\nimport { Scale } from 'ketcher-core'\n\nexport class RxnPlusMove extends BaseOperation {\n  data: {\n    id: any\n    d: any\n    noinvalidate: any\n  }\n\n  constructor(id?: any, d?: any, noinvalidate?: any) {\n    super(OperationType.RXN_PLUS_MOVE)\n    this.data = { id, d, noinvalidate }\n  }\n\n  execute(restruct: Restruct) {\n    const { id, d, noinvalidate } = this.data\n\n    const struct = restruct.molecule\n    struct.rxnPluses.get(id)!.pp.add_(d) // eslint-disable-line no-underscore-dangle\n\n    const rxn = restruct.rxnPluses.get(id)!\n    const scaled = Scale.obj2scaled(d, restruct.render.options)\n    rxn.visel.translate(scaled)\n\n    this.data.d = d.negated()\n\n    if (!noinvalidate) {\n      BaseOperation.invalidateItem(restruct, 'rxnPluses', id, 1)\n    }\n  }\n\n  invert() {\n    const inverted = new RxnPlusMove()\n    inverted.data = this.data\n    return inverted\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { RxnPlus, Vec2 } from 'ketcher-core'\nimport Restruct, { ReRxnPlus } from '../../../../render/restruct'\nimport { BaseOperation } from '../../base'\nimport { OperationType } from '../../OperationType'\n\n// todo: separate classes: now here is circular dependency in `invert` method\n\ntype Data = {\n  plid: any\n  pos: any\n}\n\nclass RxnPlusAdd extends BaseOperation {\n  data: Data\n\n  constructor(pos?: any) {\n    super(OperationType.RXN_PLUS_ADD)\n    this.data = { plid: null, pos }\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n\n    const newRxn = new RxnPlus()\n    if (typeof this.data.plid === 'number') {\n      struct.rxnPluses.set(this.data.plid, newRxn)\n    } else {\n      this.data.plid = struct.rxnPluses.add(newRxn)\n    }\n\n    const { pos, plid } = this.data\n\n    const structRxn = struct.rxnPluses.get(plid)\n    // notifyRxnPlusAdded\n    restruct.rxnPluses.set(plid, new ReRxnPlus(structRxn))\n\n    struct.rxnPlusSetPos(plid, new Vec2(pos))\n\n    BaseOperation.invalidateItem(restruct, 'rxnPluses', plid, 1)\n  }\n\n  invert() {\n    const inverted = new RxnPlusDelete()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nclass RxnPlusDelete extends BaseOperation {\n  data: Data\n\n  constructor(plid?: any) {\n    super(OperationType.RXN_PLUS_DELETE)\n    this.data = { plid, pos: null }\n  }\n\n  execute(restruct: Restruct) {\n    const { plid } = this.data\n\n    const struct = restruct.molecule\n    if (!this.data.pos) {\n      this.data.pos = struct.rxnPluses.get(plid)!.pp\n    }\n\n    // notifyRxnPlusRemoved\n    restruct.markItemRemoved()\n    const rxn = restruct.rxnPluses.get(plid)\n    if (!rxn) return\n    restruct.clearVisel(rxn.visel)\n    restruct.rxnPluses.delete(plid)\n\n    struct.rxnPluses.delete(plid)\n  }\n\n  invert() {\n    const inverted = new RxnPlusAdd()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nexport { RxnPlusAdd, RxnPlusDelete }\nexport * from './RxnPlusMove'\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { RxnArrow, RxnArrowMode, Vec2 } from 'ketcher-core'\nimport Restruct, { ReRxnArrow } from '../../../render/restruct'\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\n\n// todo: separate classes: now here is circular dependency in `invert` method\n\ntype Data = {\n  pos: any\n  arid: any\n  mode: RxnArrowMode\n}\n\nclass RxnArrowAdd extends BaseOperation {\n  data: Data\n\n  constructor(mode: RxnArrowMode, pos: any, arid = null) {\n    super(OperationType.RXN_ARROW_ADD)\n    this.data = { pos, arid, mode }\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n\n    if (typeof this.data.arid === 'number') {\n      struct.rxnArrows.set(\n        this.data.arid,\n        new RxnArrow(new Vec2(), this.data.mode)\n      )\n    } else {\n      this.data.arid = struct.rxnArrows.add(\n        new RxnArrow(new Vec2(), this.data.mode)\n      )\n    }\n\n    const { pos, arid } = this.data\n\n    const rxn = struct.rxnArrows.get(arid)!\n    // notifyRxnArrowAdded\n    restruct.rxnArrows.set(arid, new ReRxnArrow(rxn))\n\n    struct.rxnArrowSetPos(arid, new Vec2(pos))\n\n    const components = struct.getComponents()\n\n    const reactants = components.reactants.reduce(\n      (acc, item) => acc.concat(...item),\n      [] as number[]\n    )\n    const products = components.products.reduce(\n      (acc, item) => acc.concat(...item),\n      [] as number[]\n    )\n\n    reactants.forEach(aid => {\n      const atom = struct.atoms.get(aid)!\n      atom.rxnFragmentType = 1\n    })\n\n    products.forEach(aid => {\n      const atom = struct.atoms.get(aid)!\n      atom.rxnFragmentType = 2\n    })\n\n    BaseOperation.invalidateItem(restruct, 'rxnArrows', this.data.arid, 1)\n  }\n\n  invert() {\n    const inverted = new RxnArrowDelete()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nclass RxnArrowDelete extends BaseOperation {\n  data: Data\n\n  constructor(arid?: any) {\n    super(OperationType.RXN_ARROW_DELETE)\n    this.data = { arid, pos: null, mode: RxnArrowMode.simple }\n  }\n\n  execute(restruct: any) {\n    const { arid } = this.data\n    const struct = restruct.molecule\n\n    if (!this.data.pos || !this.data.mode) {\n      const arrow = struct.rxnArrows.get(arid)\n      this.data.pos = arrow.pp\n      this.data.mode = arrow.mode\n    }\n\n    // notifyRxnArrowRemoved\n    restruct.markItemRemoved()\n    const rxn = restruct.rxnArrows.get(arid)\n    restruct.clearVisel(rxn.visel)\n    restruct.rxnArrows.delete(arid)\n\n    struct.rxnArrows.delete(arid)\n\n    struct.atoms.forEach(atom => {\n      atom.rxnFragmentType = -1\n    })\n  }\n\n  invert() {\n    return new RxnArrowAdd(this.data.mode, this.data.pos, this.data.arid)\n  }\n}\n\nexport { RxnArrowAdd, RxnArrowDelete }\nexport * from './RxnArrowMove'\nexport * from './plus'\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Scale, SimpleObject, SimpleObjectMode, Vec2 } from 'ketcher-core'\n\nimport Base from './base'\nimport { OperationType } from './OperationType'\nimport { ReSimpleObject } from '../../render/restruct'\nimport util from '../../render/util'\n\nconst tfx = util.tfx\n\ninterface SimpleObjectAddData {\n  id?: number\n  pos: Array<Vec2>\n  mode: SimpleObjectMode\n  toCircle: boolean\n}\nexport class SimpleObjectAdd extends Base {\n  data: SimpleObjectAddData\n\n  constructor(\n    pos: Array<Vec2> = [],\n    mode: SimpleObjectMode = SimpleObjectMode.line,\n    toCircle: boolean = false,\n    id?: number\n  ) {\n    super(OperationType.SIMPLE_OBJECT_ADD)\n    this.data = { pos, mode, toCircle, id }\n  }\n\n  execute(restruct: any): void {\n    const struct = restruct.molecule\n    const item = new SimpleObject({ mode: this.data.mode })\n\n    if (this.data.id == null) {\n      const index = struct.simpleObjects.add(item)\n      this.data.id = index\n    } else {\n      struct.simpleObjects.set(this.data.id!, item)\n    }\n\n    const itemId = this.data.id!\n\n    restruct.simpleObjects.set(itemId, new ReSimpleObject(item))\n\n    const positions = [...this.data.pos]\n    if (this.data.toCircle) {\n      positions[1] = makeCircleFromEllipse(positions[0], positions[1])\n    }\n    struct.simpleObjectSetPos(\n      itemId,\n      positions.map(p => new Vec2(p))\n    )\n\n    Base.invalidateItem(restruct, 'simpleObjects', itemId, 1)\n  }\n  invert(): Base {\n    return new SimpleObjectDelete(this.data.id!)\n  }\n}\n\ninterface SimpleObjectDeleteData {\n  id: number\n  pos?: Array<Vec2>\n  mode?: SimpleObjectMode\n  toCircle?: boolean\n}\n\nexport class SimpleObjectDelete extends Base {\n  data: SimpleObjectDeleteData\n  performed: boolean\n\n  constructor(id: number) {\n    super(OperationType.SIMPLE_OBJECT_DELETE)\n    this.data = { id, pos: [], mode: SimpleObjectMode.line, toCircle: false }\n    this.performed = false\n  }\n\n  execute(restruct: any): void {\n    const struct = restruct.molecule\n    const item = struct.simpleObjects.get(this.data.id) as any\n    //save to data current values. In future they could be used in invert for restoring simple object\n    this.data.pos = item.pos\n    this.data.mode = item.mode\n    this.data.toCircle = item.toCircle\n    this.performed = true\n\n    restruct.markItemRemoved()\n    restruct.clearVisel(restruct.simpleObjects.get(this.data.id).visel)\n    restruct.simpleObjects.delete(this.data.id)\n\n    struct.simpleObjects.delete(this.data.id)\n  }\n\n  invert(): Base {\n    return new SimpleObjectAdd(\n      this.data.pos,\n      this.data.mode,\n      this.data.toCircle,\n      this.data.id\n    )\n  }\n}\n\ninterface SimpleObjectMoveData {\n  id: number\n  d: any\n  noinvalidate: boolean\n}\n\nexport class SimpleObjectMove extends Base {\n  data: SimpleObjectMoveData\n\n  constructor(id: number, d: any, noinvalidate: boolean) {\n    super(OperationType.SIMPLE_OBJECT_MOVE)\n    this.data = { id, d, noinvalidate }\n  }\n  execute(restruct: any): void {\n    const struct = restruct.molecule\n    const id = this.data.id\n    const d = this.data.d\n    const item = struct.simpleObjects.get(id)\n    item.pos.forEach(p => p.add_(d))\n    restruct.simpleObjects\n      .get(id)\n      .visel.translate(Scale.obj2scaled(d, restruct.render.options))\n    this.data.d = d.negated()\n    if (!this.data.noinvalidate) {\n      Base.invalidateItem(restruct, 'simpleObjects', id, 1)\n    }\n  }\n\n  invert(): Base {\n    const move = new SimpleObjectMove(\n      this.data.id,\n      this.data.d,\n      this.data.noinvalidate\n    )\n    //todo Need further investigation on why this is needed?\n    move.data = this.data\n    return move\n  }\n}\n\ninterface SimpleObjectResizeData {\n  id: number\n  d: any\n  current: Vec2\n  anchor: Vec2\n  noinvalidate: boolean\n  toCircle: boolean\n}\n\nfunction handleRectangleChangeWithAnchor(item, anchor, current) {\n  const previousPos0 = item.pos[0].get_xy0()\n  const previousPos1 = item.pos[1].get_xy0()\n\n  if (tfx(anchor.x) === tfx(item.pos[1].x)) {\n    item.pos[1].x = anchor.x = current.x\n    current.x = previousPos1.x\n  }\n  if (tfx(anchor.y) === tfx(item.pos[1].y)) {\n    item.pos[1].y = anchor.y = current.y\n    current.y = previousPos1.y\n  }\n  if (tfx(anchor.x) === tfx(item.pos[0].x)) {\n    item.pos[0].x = anchor.x = current.x\n    current.x = previousPos0.x\n  }\n  if (tfx(anchor.y) === tfx(item.pos[0].y)) {\n    item.pos[0].y = anchor.y = current.y\n    current.y = previousPos0.y\n  }\n}\n\nexport class SimpleObjectResize extends Base {\n  data: SimpleObjectResizeData\n\n  constructor(\n    id: number,\n    d: any,\n    current: Vec2,\n    anchor: any,\n    noinvalidate: boolean,\n    toCircle: boolean\n  ) {\n    super(OperationType.SIMPLE_OBJECT_RESIZE)\n    this.data = { id, d, current, anchor, noinvalidate, toCircle }\n  }\n\n  execute(restruct: any): void {\n    const struct = restruct.molecule\n    const id = this.data.id\n    const d = this.data.d\n    const current = this.data.current\n    const item = struct.simpleObjects.get(id)\n    const anchor = this.data.anchor\n    if (item.mode === SimpleObjectMode.ellipse) {\n      if (anchor) {\n        handleRectangleChangeWithAnchor(item, anchor, current)\n      } else if (this.data.toCircle) {\n        const previousPos1 = item.pos[1].get_xy0()\n        const circlePoint = makeCircleFromEllipse(item.pos[0], current)\n        item.pos[1].x = circlePoint.x\n        item.pos[1].y = circlePoint.y\n        this.data.current = previousPos1\n      } else {\n        const previousPos1 = item.pos[1].get_xy0()\n        item.pos[1].x = current.x\n        item.pos[1].y = current.y\n        this.data.current = previousPos1\n      }\n    } else if (item.mode === SimpleObjectMode.line && anchor) {\n      const previousPos0 = item.pos[0].get_xy0()\n      const previousPos1 = item.pos[1].get_xy0()\n\n      if (\n        tfx(anchor.x) === tfx(item.pos[1].x) &&\n        tfx(anchor.y) === tfx(item.pos[1].y)\n      ) {\n        item.pos[1].x = anchor.x = current.x\n        current.x = previousPos1.x\n        item.pos[1].y = anchor.y = current.y\n        current.y = previousPos1.y\n      }\n\n      if (\n        tfx(anchor.x) === tfx(item.pos[0].x) &&\n        tfx(anchor.y) === tfx(item.pos[0].y)\n      ) {\n        item.pos[0].x = anchor.x = current.x\n        current.x = previousPos0.x\n        item.pos[0].y = anchor.y = current.y\n        current.y = previousPos0.y\n      }\n    } else if (item.mode === SimpleObjectMode.rectangle && anchor) {\n      handleRectangleChangeWithAnchor(item, anchor, current)\n    } else item.pos[1].add_(d)\n\n    restruct.simpleObjects\n      .get(id)\n      .visel.translate(Scale.obj2scaled(d, restruct.render.options))\n    this.data.d = d.negated()\n    if (!this.data.noinvalidate) {\n      Base.invalidateItem(\n        restruct,\n        'simpleObjects',\n        // @ts-ignore\n        id,\n        1\n      )\n    }\n  }\n  invert(): Base {\n    return new SimpleObjectResize(\n      this.data.id,\n      this.data.d,\n      this.data.current,\n      this.data.anchor,\n      this.data.noinvalidate,\n      this.data.toCircle\n    )\n  }\n}\n\nexport function makeCircleFromEllipse(position0: Vec2, position1: Vec2): Vec2 {\n  const diff = Vec2.diff(position1, position0)\n  const min = Math.abs(diff.x) < Math.abs(diff.y) ? diff.x : diff.y\n  return new Vec2(\n    position0.x + (diff.x > 0 ? 1 : -1) * Math.abs(min),\n    position0.y + (diff.y > 0 ? 1 : -1) * Math.abs(min),\n    0\n  )\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport { SGroup } from 'ketcher-core'\nimport Restruct from '../../../render/restruct'\n\n// todo: separate classes: now here is circular dependency in `invert` method\n\ntype Data = {\n  sgid: any\n  aid: any\n}\n\nclass SGroupAtomAdd extends BaseOperation {\n  data: Data\n\n  constructor(sgroupId?: any, aid?: any) {\n    super(OperationType.S_GROUP_ATOM_ADD, 3)\n    this.data = { sgid: sgroupId, aid }\n  }\n\n  execute(restruct: Restruct) {\n    const { aid, sgid } = this.data\n\n    const struct = restruct.molecule\n    const atom = struct.atoms.get(aid)!\n    const sgroup = struct.sgroups.get(sgid)!\n\n    if (sgroup.atoms.indexOf(aid) >= 0) {\n      throw new Error(\n        'The same atom cannot be added to an S-group more than once'\n      )\n    }\n\n    if (!atom) {\n      throw new Error('OpSGroupAtomAdd: Atom ' + aid + ' not found')\n    }\n\n    struct.atomAddToSGroup(sgid, aid)\n    BaseOperation.invalidateAtom(restruct, aid)\n  }\n\n  invert() {\n    const inverted = new SGroupAtomRemove()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nclass SGroupAtomRemove extends BaseOperation {\n  data: Data\n\n  constructor(sgroupId?: any, aid?: any) {\n    super(OperationType.S_GROUP_ATOM_REMOVE)\n    this.data = { sgid: sgroupId, aid }\n  }\n\n  execute(restruct: Restruct) {\n    const { aid, sgid } = this.data\n\n    const struct = restruct.molecule\n    const atom = struct.atoms.get(aid)!\n    const sgroup = struct.sgroups.get(sgid)!\n\n    SGroup.removeAtom(sgroup, aid)\n    atom.sgs.delete(sgid)\n    BaseOperation.invalidateAtom(restruct, aid)\n  }\n\n  invert() {\n    const inverted = new SGroupAtomAdd()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nexport { SGroupAtomAdd, SGroupAtomRemove }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport Restruct from '../../../render/restruct'\n\nexport class SGroupAttr extends BaseOperation {\n  data: {\n    sgid: any\n    attr: any\n    value: any\n  }\n\n  constructor(sgroupId?: any, attribute?: any, value?: any) {\n    super(OperationType.S_GROUP_ATTR, 4)\n    this.data = {\n      sgid: sgroupId,\n      attr: attribute,\n      value\n    }\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n    const sgroupId = this.data.sgid\n    const sgroup = struct.sgroups.get(sgroupId)!\n\n    const sgroupData = restruct.sgroupData.get(sgroupId)\n    if (sgroup.type === 'DAT' && sgroupData) {\n      // clean the stuff here, else it might be left behind if the sgroups is set to \"attached\"\n      restruct.clearVisel(sgroupData.visel)\n      restruct.sgroupData.delete(sgroupId)\n    }\n\n    this.data.value = sgroup.setAttr(this.data.attr, this.data.value)\n  }\n\n  invert() {\n    const inverted = new SGroupAttr()\n    inverted.data = this.data\n    return inverted\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport Restruct from '../../../render/restruct'\n\nexport class SGroupDataMove extends BaseOperation {\n  data: {\n    id: any\n    d: any\n  }\n\n  constructor(id?: any, d?: any) {\n    super(OperationType.S_GROUP_DATA_MOVE)\n    this.data = { id, d }\n  }\n\n  execute(restruct: Restruct) {\n    const { d, id } = this.data\n    const { sgroups } = restruct.molecule\n\n    sgroups.get(id)!.pp?.add_(d) // eslint-disable-line no-underscore-dangle\n    this.data.d = d.negated()\n\n    // [MK] this currently does nothing since the DataSGroupData Visel only contains the highlighting/selection and SGroups are redrawn every time anyway\n    BaseOperation.invalidateItem(restruct, 'sgroupData', id, 1)\n  }\n\n  invert() {\n    const inverted = new SGroupDataMove()\n    inverted.data = this.data\n    return inverted\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport Restruct from '../../../render/restruct'\n\n// todo: separate classes: now here is circular dependency in `invert` method\n\ntype Data = {\n  sgid: any\n  parent?: any\n  children?: any\n}\n\nclass SGroupAddToHierarchy extends BaseOperation {\n  data: Data\n\n  constructor(sgroupId?: any, parent?: any, children?: any) {\n    super(OperationType.S_GROUP_ADD_TO_HIERACHY, 4)\n    this.data = { sgid: sgroupId, parent, children }\n  }\n\n  execute(restruct: Restruct) {\n    const { sgid, parent, children } = this.data\n\n    const struct = restruct.molecule\n    const sgroup = struct.sgroups.get(sgid)!\n    const relations = struct.sGroupForest.insert(sgroup, parent, children)\n\n    this.data.parent = relations.parent\n    this.data.children = relations.children\n  }\n\n  invert() {\n    const inverted = new SGroupRemoveFromHierarchy()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nclass SGroupRemoveFromHierarchy extends BaseOperation {\n  data: Data\n\n  constructor(sgroupId?: any) {\n    super(OperationType.S_GROUP_REMOVE_FROM_HIERACHY)\n    this.data = { sgid: sgroupId }\n  }\n\n  execute(restruct: any) {\n    const { sgid } = this.data\n    const struct = restruct.molecule\n\n    this.data.parent = struct.sGroupForest.parent.get(sgid)\n    this.data.children = struct.sGroupForest.children.get(sgid)\n    struct.sGroupForest.remove(sgid)\n  }\n\n  invert() {\n    const inverted = new SGroupAddToHierarchy()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nexport { SGroupAddToHierarchy, SGroupRemoveFromHierarchy }\n","import Restruct, { ReSGroup } from '../../../render/restruct'\nimport { SGroup, Vec2 } from 'ketcher-core'\n\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\n\n// todo: separate classes: now here is circular dependency in `invert` method\n\ntype Data = {\n  sgid: any\n  type?: any\n  pp?: any\n}\n\nclass SGroupCreate extends BaseOperation {\n  data: Data\n\n  constructor(sgroupId?: any, type?: any, pp?: any) {\n    super(OperationType.S_GROUP_CREATE)\n    this.data = { sgid: sgroupId, type, pp }\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n    const sgroup = new SGroup(this.data.type)\n    const { sgid, pp } = this.data\n\n    sgroup.id = sgid\n    struct.sgroups.set(sgid, sgroup)\n\n    if (pp) {\n      struct.sgroups.get(sgid)!.pp = new Vec2(pp)\n    }\n\n    restruct.sgroups.set(sgid, new ReSGroup(struct.sgroups.get(sgid)))\n    this.data.sgid = sgid\n  }\n\n  invert() {\n    const inverted = new SGroupDelete()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nclass SGroupDelete extends BaseOperation {\n  data: Data\n\n  constructor(sgroupId?: any) {\n    super(OperationType.S_GROUP_DELETE, 95)\n    this.data = { sgid: sgroupId }\n  }\n\n  execute(restruct: Restruct) {\n    const struct = restruct.molecule\n    const { sgid } = this.data\n    const sgroup = restruct.sgroups.get(sgid)\n    const sgroupData = restruct.sgroupData.get(sgid)\n    if (!sgroup) return\n    this.data.type = sgroup.item.type\n    this.data.pp = sgroup.item.pp\n\n    if (sgroup.item.type === 'DAT' && sgroupData) {\n      restruct.clearVisel(sgroupData.visel)\n      restruct.sgroupData.delete(sgid)\n    }\n\n    restruct.clearVisel(sgroup.visel)\n    if (sgroup.item.atoms.length !== 0) {\n      throw new Error('S-Group not empty!')\n    }\n\n    restruct.sgroups.delete(sgid)\n    struct.sgroups.delete(sgid)\n  }\n\n  invert() {\n    const inverted = new SGroupCreate()\n    inverted.data = this.data\n    return inverted\n  }\n}\n\nexport { SGroupCreate, SGroupDelete }\nexport * from './sgroupAtom'\nexport * from './SGroupAttr'\nexport * from './SGroupDataMove'\nexport * from './sgroupHierarchy'\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport Restruct, { ReText } from '../../../render/restruct'\nimport { Text, Vec2 } from 'ketcher-core'\n\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\n\ninterface TextCreateData {\n  id?: number\n  content: string\n  position: Vec2\n}\n\nexport class TextCreate extends BaseOperation {\n  data: TextCreateData\n\n  constructor(content: string, position: Vec2, id?: number) {\n    super(OperationType.TEXT_CREATE)\n    this.data = { content: content, position, id }\n  }\n\n  execute(restruct: Restruct): void {\n    const struct = restruct.molecule\n    const item = new Text(this.data)\n\n    if (this.data.id == null) {\n      const index = struct.texts.add(item)\n      this.data.id = index\n    } else {\n      struct.texts.set(this.data.id!, item)\n    }\n\n    const itemId = this.data.id!\n\n    restruct.texts.set(itemId, new ReText(item))\n\n    struct.textSetPosition(itemId, new Vec2(this.data.position))\n    BaseOperation.invalidateItem(restruct, 'texts', itemId, 1)\n  }\n\n  invert(): BaseOperation {\n    return new TextDelete(this.data.id!)\n  }\n}\n\ninterface TextDeleteData {\n  id: number\n  content?: string\n  position?: Vec2\n}\n\nexport class TextDelete extends BaseOperation {\n  data: TextDeleteData\n\n  constructor(id: number) {\n    super(OperationType.TEXT_DELETE)\n    this.data = { id }\n  }\n\n  execute(restruct: Restruct): void {\n    const struct = restruct.molecule\n    const item = struct.texts.get(this.data.id)!\n    if (!item) return\n\n    this.data.content = item.content!\n    this.data.position = item.position\n\n    restruct.markItemRemoved()\n\n    restruct.clearVisel(restruct.texts.get(this.data.id)!.visel)\n    restruct.texts.delete(this.data.id)\n\n    struct.texts.delete(this.data.id)\n  }\n\n  invert(): BaseOperation {\n    return new TextCreate(this.data.content!, this.data.position!, this.data.id)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport Restruct from '../../../render/restruct'\n\ninterface TextUpdateData {\n  id: number\n  content: string\n  previousContent?: string\n}\n\nexport class TextUpdate extends BaseOperation {\n  data: TextUpdateData\n\n  constructor(id: number, content: string) {\n    super(OperationType.TEXT_UPDATE)\n    this.data = { id, content: content }\n  }\n\n  execute(restruct: Restruct) {\n    const { id, content } = this.data\n    const text = restruct.molecule.texts.get(id)\n\n    if (text) {\n      this.data.previousContent = text.content!\n      text.content = content\n    }\n\n    BaseOperation.invalidateItem(restruct, 'texts', id, 1)\n  }\n\n  invert() {\n    const inverted = new TextUpdate(this.data.id, this.data.previousContent!)\n\n    inverted.data.previousContent = this.data.content\n    return inverted\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseOperation } from '../base'\nimport { OperationType } from '../OperationType'\nimport Restruct from '../../../render/restruct'\nimport { Scale } from 'ketcher-core'\n\ninterface TextMoveData {\n  id: any\n  d: any\n  noinvalidate: boolean\n}\n\nexport class TextMove extends BaseOperation {\n  data: TextMoveData\n\n  constructor(id: any, d: any, noinvalidate: boolean) {\n    super(OperationType.TEXT_MOVE)\n    this.data = { id, d, noinvalidate }\n  }\n\n  execute(restruct: Restruct): void {\n    const struct = restruct.molecule\n    const id = this.data.id\n    const difference = this.data.d\n    const item = struct.texts.get(id)\n\n    item?.position?.add_(difference)\n    restruct.texts\n      .get(id)\n      ?.visel.translate(Scale.obj2scaled(difference, restruct.render.options))\n\n    this.data.d = difference.negated()\n\n    if (!this.data.noinvalidate) {\n      BaseOperation.invalidateItem(restruct, 'texts', id, 1)\n    }\n  }\n\n  invert(): BaseOperation {\n    const move = new TextMove(this.data.id, this.data.d, this.data.noinvalidate)\n\n    move.data = this.data\n\n    return move\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Fragment, Vec2 } from 'ketcher-core'\n\nconst SELECTION_DISTANCE_COEFFICIENT = 0.4\nconst SELECTION_WITHIN_TEXT = 0\n\nconst findMaps = {\n  atoms: findClosestAtom,\n  bonds: findClosestBond,\n  enhancedFlags: findClosestEnhancedFlag,\n  sgroupData: findClosestDataSGroupData,\n  sgroups: findClosestSGroup,\n  rxnArrows: findClosestRxnArrow,\n  rxnPluses: findClosestRxnPlus,\n  frags: findClosestFrag,\n  rgroups: findClosestRGroup,\n  simpleObjects: findClosestSimpleObject,\n  texts: findClosestText\n}\n\nfunction findClosestText(restruct, cursorPosition) {\n  let minDist = null\n  let ret = null\n\n  restruct.texts.forEach((text, id) => {\n    const referencePoints = text.getReferencePoints(restruct)\n    const topX = referencePoints[0].x\n    const topY = referencePoints[0].y\n    const bottomX = referencePoints[2].x\n    const bottomY = referencePoints[2].y\n\n    const distances = []\n\n    if (cursorPosition.x >= topX && cursorPosition.x <= bottomX) {\n      if (cursorPosition.y < topY) {\n        distances.push(topY - cursorPosition.y)\n      } else if (cursorPosition.y > bottomY) {\n        distances.push(cursorPosition.y - bottomY)\n      } else {\n        distances.push(cursorPosition.y - topY, bottomY - cursorPosition.y)\n      }\n    }\n\n    if (cursorPosition.x < topX && cursorPosition.y < topY) {\n      distances.push(Vec2.dist(new Vec2(topX, topY), cursorPosition))\n    }\n\n    if (cursorPosition.x > bottomX && cursorPosition.y > bottomY) {\n      distances.push(Vec2.dist(new Vec2(bottomX, bottomY), cursorPosition))\n    }\n\n    if (cursorPosition.x < topX && cursorPosition.y > bottomY) {\n      distances.push(Vec2.dist(new Vec2(topX, bottomY), cursorPosition))\n    }\n\n    if (cursorPosition.x > bottomX && cursorPosition.y < topY) {\n      distances.push(Vec2.dist(new Vec2(bottomX, topY), cursorPosition))\n    }\n\n    if (cursorPosition.y >= topY && cursorPosition.y <= bottomY) {\n      if (cursorPosition.x < topX) {\n        distances.push(topX - cursorPosition.x)\n      } else if (cursorPosition.x > bottomX) {\n        distances.push(cursorPosition.x - bottomX)\n      } else {\n        distances.push(SELECTION_WITHIN_TEXT)\n      }\n    }\n\n    let dist = Math.min(...distances)\n\n    if (dist < SELECTION_DISTANCE_COEFFICIENT && (!ret || dist < minDist)) {\n      minDist = dist\n      ret = { id, dist: minDist }\n    }\n  })\n  return ret\n}\n\nfunction findClosestSimpleObject(restruct, pos) {\n  let minDist = null\n  let refPoint = null\n  let ret = null\n\n  restruct.simpleObjects.forEach((simpleObject, id) => {\n    const dist = simpleObject.calcDistance(pos, restruct.render.options.scale)\n\n    if (dist.minDist < 0.3 && (!ret || dist.minDist < minDist)) {\n      minDist = dist.minDist\n      refPoint = dist.refPoint\n\n      ret = { id, dist: minDist, ref: refPoint }\n    }\n  })\n  return ret\n}\n\nfunction findClosestAtom(restruct, pos, skip, minDist) {\n  let closestAtom = null\n  const maxMinDist = SELECTION_DISTANCE_COEFFICIENT\n  const skipId = skip && skip.map === 'atoms' ? skip.id : null\n\n  minDist = minDist || maxMinDist\n  minDist = Math.min(minDist, maxMinDist)\n\n  restruct.atoms.forEach((atom, aid) => {\n    if (aid === skipId) return\n\n    const dist = Vec2.dist(pos, atom.a.pp)\n\n    if (dist < minDist) {\n      closestAtom = aid\n      minDist = dist\n    }\n  })\n\n  if (closestAtom !== null) {\n    return {\n      id: closestAtom,\n      dist: minDist\n    }\n  }\n\n  return null\n}\n\nfunction findClosestBond(restruct, pos, skip, minDist, scale) {\n  // eslint-disable-line max-params\n  let closestBond = null\n  let closestBondCenter = null\n  const maxMinDist = 0.8 * SELECTION_DISTANCE_COEFFICIENT\n  const skipId = skip && skip.map === 'bonds' ? skip.id : null\n\n  minDist = minDist || maxMinDist\n  minDist = Math.min(minDist, maxMinDist)\n\n  let minCDist = minDist\n\n  restruct.bonds.forEach((bond, bid) => {\n    if (bid === skipId) return\n\n    const p1 = restruct.atoms.get(bond.b.begin).a.pp\n    const p2 = restruct.atoms.get(bond.b.end).a.pp\n\n    const mid = Vec2.lc2(p1, 0.5, p2, 0.5)\n    const cdist = Vec2.dist(pos, mid)\n\n    if (cdist < minCDist) {\n      minCDist = cdist\n      closestBondCenter = bid\n    }\n  })\n\n  restruct.bonds.forEach((bond, bid) => {\n    if (bid === skipId) return\n\n    const hb = restruct.molecule.halfBonds.get(bond.b.hb1)\n    const dir = hb.dir\n    const norm = hb.norm\n\n    const p1 = restruct.atoms.get(bond.b.begin).a.pp\n    const p2 = restruct.atoms.get(bond.b.end).a.pp\n\n    const inStripe = Vec2.dot(pos.sub(p1), dir) * Vec2.dot(pos.sub(p2), dir) < 0\n\n    if (inStripe) {\n      const dist = Math.abs(Vec2.dot(pos.sub(p1), norm))\n\n      if (dist < minDist) {\n        closestBond = bid\n        minDist = dist\n      }\n    }\n  })\n\n  if (closestBondCenter !== null) {\n    return {\n      id: closestBondCenter,\n      dist: minCDist\n    }\n  }\n\n  if (\n    closestBond !== null &&\n    minDist > SELECTION_DISTANCE_COEFFICIENT * scale\n  ) {\n    return {\n      id: closestBond,\n      dist: minDist\n    }\n  }\n\n  return null\n}\n\nfunction findClosestEnhancedFlag(restruct, pos) {\n  let minDist\n  let ret = null\n  restruct.enhancedFlags.forEach((item, id) => {\n    const fragment = restruct.molecule.frags.get(id)\n    if (!fragment) return\n\n    const p = fragment.stereoFlagPosition\n      ? new Vec2(fragment.stereoFlagPosition.x, fragment.stereoFlagPosition.y)\n      : Fragment.getDefaultStereoFlagPosition(restruct.molecule, id)\n    if (!p || Math.abs(pos.x - p.x) >= 1.0) return\n\n    const dist = Math.abs(pos.y - p.y)\n\n    if (dist < 0.3 && (!ret || dist < minDist)) {\n      minDist = dist\n      ret = { id, dist: minDist }\n    }\n  })\n  return ret\n}\n\nfunction findClosestDataSGroupData(restruct, pos) {\n  let minDist = null\n  let ret = null\n\n  restruct.sgroupData.forEach((item, id) => {\n    if (item.sgroup.type !== 'DAT') throw new Error('Data group expected')\n\n    if (item.sgroup.data.fieldName !== 'MRV_IMPLICIT_H') {\n      const box = item.sgroup.dataArea\n      const inBox =\n        box.p0.y < pos.y &&\n        box.p1.y > pos.y &&\n        box.p0.x < pos.x &&\n        box.p1.x > pos.x\n      const xDist = Math.min(\n        Math.abs(box.p0.x - pos.x),\n        Math.abs(box.p1.x - pos.x)\n      )\n\n      if (inBox && (ret === null || xDist < minDist)) {\n        ret = { id, dist: xDist }\n        minDist = xDist\n      }\n    }\n  })\n\n  return ret\n}\n\nfunction findClosestFrag(restruct, pos, skip, minDist, scale) {\n  minDist = Math.min(\n    minDist || SELECTION_DISTANCE_COEFFICIENT,\n    SELECTION_DISTANCE_COEFFICIENT\n  )\n\n  const struct = restruct.molecule\n\n  const closestAtom = findClosestAtom(restruct, pos, skip, minDist)\n\n  if (closestAtom) {\n    return {\n      id: struct.atoms.get(closestAtom.id).fragment,\n      dist: closestAtom.dist\n    }\n  }\n\n  const closestBond = findClosestBond(restruct, pos, skip, minDist, scale)\n\n  if (closestBond) {\n    const atomId = struct.bonds.get(closestBond.id).begin\n    return {\n      id: struct.atoms.get(atomId).fragment,\n      dist: closestBond.dist\n    }\n  }\n\n  return null\n}\n\nfunction findClosestRGroup(restruct, pos, skip, minDist) {\n  minDist = Math.min(\n    minDist || SELECTION_DISTANCE_COEFFICIENT,\n    SELECTION_DISTANCE_COEFFICIENT\n  )\n\n  let ret = null\n\n  restruct.rgroups.forEach((rgroup, rgid) => {\n    if (\n      rgid !== skip &&\n      rgroup.labelBox &&\n      rgroup.labelBox.contains(pos, 0.5)\n    ) {\n      const dist = Vec2.dist(rgroup.labelBox.centre(), pos)\n\n      if (!ret || dist < minDist) {\n        minDist = dist\n        ret = { id: rgid, dist: minDist }\n      }\n    }\n  })\n\n  return ret\n}\n\nfunction findClosestRxnArrow(restruct, pos) {\n  let minDist = null\n  let ret = null\n\n  restruct.rxnArrows.forEach((arrow, id) => {\n    const p = arrow.item.pp\n\n    if (Math.abs(pos.x - p.x) >= 1.0) return\n\n    const dist = Math.abs(pos.y - p.y)\n\n    if (dist < 0.3 && (!ret || dist < minDist)) {\n      minDist = dist\n      ret = { id, dist: minDist }\n    }\n  })\n\n  return ret\n}\n\nfunction findClosestRxnPlus(restruct, pos) {\n  let minDist = null\n  let ret = null\n\n  restruct.rxnPluses.forEach((plus, id) => {\n    const p = plus.item.pp\n    const dist = Math.max(Math.abs(pos.x - p.x), Math.abs(pos.y - p.y))\n\n    if (dist < 0.3 && (!ret || dist < minDist)) {\n      minDist = dist\n      ret = { id, dist: minDist }\n    }\n  })\n\n  return ret\n}\n\nfunction findClosestSGroup(restruct, pos) {\n  let ret = null\n  let minDist = SELECTION_DISTANCE_COEFFICIENT\n\n  restruct.molecule.sgroups.forEach((sg, sgid) => {\n    const d = sg.bracketDir\n    const n = d.rotateSC(1, 0)\n    const pg = new Vec2(Vec2.dot(pos, d), Vec2.dot(pos, n))\n\n    sg.areas.forEach(box => {\n      const inBox =\n        box.p0.y < pg.y && box.p1.y > pg.y && box.p0.x < pg.x && box.p1.x > pg.x\n      const xDist = Math.min(\n        Math.abs(box.p0.x - pg.x),\n        Math.abs(box.p1.x - pg.x)\n      )\n\n      if (inBox && (ret === null || xDist < minDist)) {\n        ret = sgid\n        minDist = xDist\n      }\n    })\n  })\n\n  if (ret !== null) {\n    return {\n      id: ret,\n      dist: minDist\n    }\n  }\n\n  return null\n}\n\nfunction findClosestItem(restruct, pos, maps, skip, scale) {\n  // eslint-disable-line max-params\n  maps = maps || Object.keys(findMaps)\n\n  return maps.reduce((res, mp) => {\n    const minDist = res ? res.dist : null\n    const item = findMaps[mp](restruct, pos, skip, minDist, scale)\n\n    if (item !== null && (res === null || item.dist < res.dist)) {\n      const { id, dist, ...other } = item\n      return {\n        map: mp,\n        id: id,\n        dist: dist,\n        ...other\n      }\n    }\n\n    return res\n  }, null)\n}\n\n/**\n * @param restruct { ReStruct }\n * @param selected { object }\n * @param maps { Array<string> }\n * @param scale { number }\n * @return {{\n * \t\tatoms: Map<number, number>?\n * \t\tbonds: Map<number, number>?\n * }}\n */\nfunction findCloseMerge(restruct, selected, maps = ['atoms', 'bonds'], scale) {\n  const pos = {\n    atoms: new Map(), // aid -> position\n    bonds: new Map() // bid -> position\n  }\n\n  const struct = restruct.molecule\n\n  selected.atoms.forEach(aid => {\n    pos.atoms.set(aid, struct.atoms.get(aid).pp)\n  })\n\n  selected.bonds.forEach(bid => {\n    const bond = struct.bonds.get(bid)\n    pos.bonds.set(\n      bid,\n      Vec2.lc2(\n        struct.atoms.get(bond.begin).pp,\n        0.5,\n        struct.atoms.get(bond.end).pp,\n        0.5\n      )\n    )\n  })\n\n  const result = {}\n  maps.forEach(mp => {\n    result[mp] = Array.from(pos[mp].keys()).reduce((res, srcId) => {\n      const skip = { map: mp, id: srcId }\n      const item = findMaps[mp](restruct, pos[mp].get(srcId), skip, null, scale)\n\n      if (item && !selected[mp].includes(item.id)) res.set(srcId, item.id)\n\n      return res\n    }, new Map())\n  })\n\n  return result\n}\n\nexport default {\n  atom: findClosestAtom, // used in Actions\n  item: findClosestItem,\n  merge: findCloseMerge\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Vec2 } from 'ketcher-core'\nimport closest from '../shared/closest'\nimport { difference } from 'lodash'\n\nexport function atomGetAttr(restruct, aid, name) {\n  return restruct.molecule.atoms.get(aid)[name]\n}\n\nexport function atomGetDegree(restruct, aid) {\n  return restruct.atoms.get(aid).a.neighbors.length\n}\n\nexport function atomGetSGroups(restruct, aid) {\n  return Array.from(restruct.atoms.get(aid).a.sgs)\n}\n\nexport function atomGetPos(restruct, id) {\n  return restruct.molecule.atoms.get(id).pp\n}\n\nexport function findStereoAtoms(struct, aids) {\n  return aids.filter(aid => struct.atoms.get(aid).stereoLabel !== null)\n}\n\nexport function structSelection(struct) {\n  return [\n    'atoms',\n    'bonds',\n    'frags',\n    'sgroups',\n    'rgroups',\n    'rxnArrows',\n    'rxnPluses',\n    'simpleObjects',\n    'texts'\n  ].reduce((res, key) => {\n    res[key] = Array.from(struct[key].keys())\n    return res\n  }, {})\n}\n\n// Get new atom id/label and pos for bond being added to existing atom\nexport function atomForNewBond(restruct, id) {\n  // eslint-disable-line max-statements\n  const neighbours = []\n  const pos = atomGetPos(restruct, id)\n\n  restruct.molecule.atomGetNeighbors(id).forEach(nei => {\n    const neiPos = atomGetPos(restruct, nei.aid)\n\n    if (Vec2.dist(pos, neiPos) < 0.1) return\n\n    neighbours.push({ id: nei.aid, v: Vec2.diff(neiPos, pos) })\n  })\n\n  neighbours.sort(\n    (nei1, nei2) =>\n      Math.atan2(nei1.v.y, nei1.v.x) - Math.atan2(nei2.v.y, nei2.v.x)\n  )\n\n  var i\n  var maxI = 0\n  var angle\n  var maxAngle = 0\n\n  // TODO: impove layout: tree, ...\n\n  for (i = 0; i < neighbours.length; i++) {\n    angle = Vec2.angle(\n      neighbours[i].v,\n      neighbours[(i + 1) % neighbours.length].v\n    )\n\n    if (angle < 0) angle += 2 * Math.PI\n\n    if (angle > maxAngle) {\n      maxI = i\n      maxAngle = angle\n    }\n  }\n\n  let v = new Vec2(1, 0)\n\n  if (neighbours.length > 0) {\n    if (neighbours.length === 1) {\n      maxAngle = -((4 * Math.PI) / 3)\n\n      // zig-zag\n      const nei = restruct.molecule.atomGetNeighbors(id)[0]\n      if (atomGetDegree(restruct, nei.aid) > 1) {\n        const neiNeighbours = []\n        const neiPos = atomGetPos(restruct, nei.aid)\n        const neiV = Vec2.diff(pos, neiPos)\n        const neiAngle = Math.atan2(neiV.y, neiV.x)\n\n        restruct.molecule.atomGetNeighbors(nei.aid).forEach(neiNei => {\n          const neiNeiPos = atomGetPos(restruct, neiNei.aid)\n\n          if (neiNei.bid === nei.bid || Vec2.dist(neiPos, neiNeiPos) < 0.1)\n            return\n\n          const vDiff = Vec2.diff(neiNeiPos, neiPos)\n          let ang = Math.atan2(vDiff.y, vDiff.x) - neiAngle\n\n          if (ang < 0) ang += 2 * Math.PI\n\n          neiNeighbours.push(ang)\n        })\n        neiNeighbours.sort((nei1, nei2) => nei1 - nei2)\n\n        if (\n          neiNeighbours[0] <= Math.PI * 1.01 &&\n          neiNeighbours[neiNeighbours.length - 1] <= 1.01 * Math.PI\n        )\n          maxAngle *= -1\n      }\n    }\n\n    angle =\n      maxAngle / 2 + Math.atan2(neighbours[maxI].v.y, neighbours[maxI].v.x)\n\n    v = v.rotate(angle)\n  }\n\n  v.add_(pos) // eslint-disable-line no-underscore-dangle\n\n  let a = closest.atom(restruct, v, null, 0.1)\n  a = a === null ? { label: 'C' } : a.id\n\n  return { atom: a, pos: v }\n}\n\nexport function getRelSgroupsBySelection(restruct, selectedAtoms) {\n  return restruct.molecule.sgroups.filter(\n    (sgid, sg) =>\n      !sg.data.attached &&\n      !sg.data.absolute &&\n      difference(sg.atoms, selectedAtoms).length === 0\n  )\n}\n","import { BaseOperation } from '../operations/base'\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport Restruct from '../../render/restruct'\n//\n// Undo/redo actions\n//\nclass Action {\n  operations: BaseOperation[]\n\n  constructor(operations = []) {\n    this.operations = operations\n  }\n\n  addOp(operation: BaseOperation, restruct?: Restruct): BaseOperation {\n    if (!restruct || !operation.isDummy(restruct)) {\n      this.operations.push(operation)\n    }\n\n    return operation\n  }\n\n  mergeWith(action) {\n    this.operations = this.operations.concat(action.operations)\n    return this\n  }\n\n  // Perform action and return inverted one\n  perform(restruct: Restruct) {\n    const action = new Action()\n    const sortedOperations = [...this.operations].sort(\n      (a, b) => a.priority - b.priority\n    )\n    sortedOperations.forEach(operation => {\n      const invertedOperation = operation.perform(restruct)\n      action.addOp(invertedOperation)\n    })\n\n    return action\n  }\n\n  isDummy(restruct?: Restruct) {\n    return (\n      this.operations.find(\n        // TODO [RB] the condition is always true for op.* operations\n        operation => (restruct ? !operation.isDummy(restruct) : true)\n      ) === undefined\n    )\n  }\n}\n\nexport default Action\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { RGroupAttr, RGroupFragment, UpdateIfThen } from '../operations'\n\nimport Action from '../shared/action'\n\nexport function fromRGroupAttrs(restruct, id, attrs) {\n  const action = new Action()\n\n  Object.keys(attrs).forEach(key => {\n    action.addOp(new RGroupAttr(id, key, attrs[key]))\n  })\n\n  return action.perform(restruct)\n}\n\nexport function fromRGroupFragment(restruct, rgidNew, frid) {\n  const action = new Action()\n  action.addOp(new RGroupFragment(rgidNew, frid))\n\n  return action.perform(restruct)\n}\n\nexport function fromUpdateIfThen(restruct, rgidNew, rgidOld, skipRgids) {\n  const action = new Action()\n  if (!restruct.molecule.rgroups.get(rgidOld))\n    action.addOp(new UpdateIfThen(rgidNew, rgidOld, skipRgids))\n\n  return action.perform(restruct)\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nexport const SgContexts = {\n  Fragment: 'Fragment',\n  Multifragment: 'Multifragment',\n  Bond: 'Bond',\n  Atom: 'Atom',\n  Group: 'Group'\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  AtomAttr,\n  SGroupAddToHierarchy,\n  SGroupAtomAdd,\n  SGroupAtomRemove,\n  SGroupAttr,\n  SGroupCreate,\n  SGroupDelete,\n  SGroupRemoveFromHierarchy\n} from '../operations'\nimport { Pile, SGroup } from 'ketcher-core'\nimport { atomGetAttr, atomGetDegree, atomGetSGroups } from './utils'\n\nimport Action from '../shared/action'\nimport { SgContexts } from '../shared/constants'\nimport { uniq } from 'lodash/fp'\n\nexport function fromSeveralSgroupAddition(restruct, type, atoms, attrs) {\n  const descriptors = attrs.fieldValue\n\n  if (typeof descriptors === 'string' || type !== 'DAT')\n    return fromSgroupAddition(\n      restruct,\n      type,\n      atoms,\n      attrs,\n      restruct.molecule.sgroups.newId()\n    )\n\n  return descriptors.reduce((acc, fValue) => {\n    const localAttrs = Object.assign({}, attrs)\n    localAttrs.fieldValue = fValue\n\n    return acc.mergeWith(\n      fromSgroupAddition(\n        restruct,\n        type,\n        atoms,\n        localAttrs,\n        restruct.molecule.sgroups.newId()\n      )\n    )\n  }, new Action())\n}\n\nexport function fromSgroupAttrs(restruct, id, attrs) {\n  const action = new Action()\n\n  Object.keys(attrs).forEach(key => {\n    action.addOp(new SGroupAttr(id, key, attrs[key]))\n  })\n\n  return action.perform(restruct)\n}\n\nexport function sGroupAttributeAction(id, attrs) {\n  const action = new Action()\n\n  Object.keys(attrs).forEach(key => {\n    action.addOp(new SGroupAttr(id, key, attrs[key]))\n  })\n\n  return action\n}\n\nexport function fromSgroupDeletion(restruct, id) {\n  let action = new Action()\n  const struct = restruct.molecule\n\n  const sG = restruct.sgroups.get(id).item\n\n  if (sG.type === 'SRU') {\n    struct.sGroupsRecalcCrossBonds()\n\n    sG.neiAtoms.forEach(aid => {\n      if (atomGetAttr(restruct, aid, 'label') === '*')\n        action.addOp(new AtomAttr(aid, 'label', 'C'))\n    })\n  }\n\n  const sg = struct.sgroups.get(id)\n  const atoms = SGroup.getAtoms(struct, sg)\n  const attrs = sg.getAttrs()\n\n  action.addOp(new SGroupRemoveFromHierarchy(id))\n\n  atoms.forEach(atom => {\n    action.addOp(new SGroupAtomRemove(id, atom))\n  })\n\n  action.addOp(new SGroupDelete(id))\n\n  action = action.perform(restruct)\n\n  action.mergeWith(sGroupAttributeAction(id, attrs))\n\n  return action\n}\n\nexport function fromSgroupAddition(restruct, type, atoms, attrs, sgid, pp) {\n  // eslint-disable-line\n  let action = new Action()\n\n  // TODO: shoud the id be generated when OpSGroupCreate is executed?\n  //      if yes, how to pass it to the following operations?\n  sgid = sgid - 0 === sgid ? sgid : restruct.molecule.sgroups.newId()\n\n  action.addOp(new SGroupCreate(sgid, type, pp))\n\n  atoms.forEach(atom => {\n    action.addOp(new SGroupAtomAdd(sgid, atom))\n  })\n\n  action.addOp(\n    type !== 'DAT'\n      ? new SGroupAddToHierarchy(sgid)\n      : new SGroupAddToHierarchy(sgid, -1, [])\n  )\n\n  action = action.perform(restruct)\n\n  if (type === 'SRU') {\n    restruct.molecule.sGroupsRecalcCrossBonds()\n    let asteriskAction = new Action()\n\n    restruct.sgroups.get(sgid).item.neiAtoms.forEach(aid => {\n      const plainCarbon = restruct.atoms.get(aid).a.isPlainCarbon()\n\n      if (atomGetDegree(restruct, aid) === 1 && plainCarbon)\n        asteriskAction.addOp(new AtomAttr(aid, 'label', '*'))\n    })\n\n    asteriskAction = asteriskAction.perform(restruct)\n    asteriskAction.mergeWith(action)\n    action = asteriskAction\n  }\n\n  return fromSgroupAttrs(restruct, sgid, attrs).mergeWith(action)\n}\n\nexport function fromSgroupAction(\n  context,\n  restruct,\n  newSg,\n  sourceAtoms,\n  selection\n) {\n  if (context === SgContexts.Bond)\n    return fromBondAction(restruct, newSg, sourceAtoms, selection)\n\n  const atomsFromBonds = getAtomsFromBonds(restruct.molecule, selection.bonds)\n  const newSourceAtoms = uniq(sourceAtoms.concat(atomsFromBonds))\n\n  if (context === SgContexts.Fragment)\n    return fromGroupAction(\n      restruct,\n      newSg,\n      newSourceAtoms,\n      Array.from(restruct.atoms.keys())\n    )\n\n  if (context === SgContexts.Multifragment)\n    return fromMultiFragmentAction(restruct, newSg, newSourceAtoms)\n\n  if (context === SgContexts.Group)\n    return fromGroupAction(restruct, newSg, newSourceAtoms, newSourceAtoms)\n\n  if (context === SgContexts.Atom)\n    return fromAtomAction(restruct, newSg, newSourceAtoms)\n\n  return {\n    action: fromSeveralSgroupAddition(\n      restruct,\n      newSg.type,\n      sourceAtoms,\n      newSg.attrs\n    )\n  }\n}\n\nfunction fromAtomAction(restruct, newSg, sourceAtoms) {\n  return sourceAtoms.reduce(\n    (acc, atom) => {\n      acc.action = acc.action.mergeWith(\n        fromSeveralSgroupAddition(restruct, newSg.type, [atom], newSg.attrs)\n      )\n      return acc\n    },\n    {\n      action: new Action(),\n      selection: {\n        atoms: sourceAtoms,\n        bonds: []\n      }\n    }\n  )\n}\n\nfunction fromGroupAction(restruct, newSg, sourceAtoms, targetAtoms) {\n  const allFragments = new Pile(\n    sourceAtoms.map(aid => restruct.atoms.get(aid).a.fragment)\n  )\n\n  return Array.from(allFragments).reduce(\n    (acc, fragId) => {\n      const atoms = targetAtoms.reduce((res, aid) => {\n        const atom = restruct.atoms.get(aid).a\n        if (fragId === atom.fragment) res.push(aid)\n\n        return res\n      }, [])\n\n      const bonds = getAtomsBondIds(restruct.molecule, atoms)\n\n      acc.action = acc.action.mergeWith(\n        fromSeveralSgroupAddition(restruct, newSg.type, atoms, newSg.attrs)\n      )\n\n      acc.selection.atoms = acc.selection.atoms.concat(atoms)\n      acc.selection.bonds = acc.selection.bonds.concat(bonds)\n\n      return acc\n    },\n    {\n      action: new Action(),\n      selection: {\n        atoms: [],\n        bonds: []\n      }\n    }\n  )\n}\n\nfunction fromBondAction(restruct, newSg, sourceAtoms, currSelection) {\n  const struct = restruct.molecule\n  let bonds = getAtomsBondIds(struct, sourceAtoms)\n\n  if (currSelection.bonds) bonds = uniq(bonds.concat(currSelection.bonds))\n\n  return bonds.reduce(\n    (acc, bondid) => {\n      const bond = struct.bonds.get(bondid)\n\n      acc.action = acc.action.mergeWith(\n        fromSeveralSgroupAddition(\n          restruct,\n          newSg.type,\n          [bond.begin, bond.end],\n          newSg.attrs\n        )\n      )\n\n      acc.selection.bonds.push(bondid)\n\n      return acc\n    },\n    {\n      action: new Action(),\n      selection: {\n        atoms: sourceAtoms,\n        bonds: []\n      }\n    }\n  )\n}\n\nfunction fromMultiFragmentAction(restruct, newSg, atoms) {\n  const bonds = getAtomsBondIds(restruct.molecule, atoms)\n  return {\n    action: fromSeveralSgroupAddition(restruct, newSg.type, atoms, newSg.attrs),\n    selection: {\n      atoms,\n      bonds\n    }\n  }\n}\n\n// Add action operation to remove atom from s-group if needed\nexport function removeAtomFromSgroupIfNeeded(action, restruct, id) {\n  const sgroups = atomGetSGroups(restruct, id)\n\n  if (sgroups.length > 0) {\n    sgroups.forEach(sid => {\n      action.addOp(new SGroupAtomRemove(sid, id))\n    })\n\n    return true\n  }\n\n  return false\n}\n\n// Add action operations to remove whole s-group if needed\nexport function removeSgroupIfNeeded(action, restruct, atoms) {\n  const struct = restruct.molecule\n  const sgCounts = new Map()\n\n  atoms.forEach(id => {\n    const sgroups = atomGetSGroups(restruct, id)\n\n    sgroups.forEach(sid => {\n      sgCounts.set(sid, sgCounts.has(sid) ? sgCounts.get(sid) + 1 : 1)\n    })\n  })\n\n  sgCounts.forEach((count, sid) => {\n    const sG = restruct.sgroups.get(sid).item\n    const sgAtoms = SGroup.getAtoms(restruct.molecule, sG)\n\n    if (sgAtoms.length === count) {\n      // delete whole s-group\n      const sgroup = struct.sgroups.get(sid)\n      action.mergeWith(sGroupAttributeAction(sid, sgroup.getAttrs()))\n      action.addOp(new SGroupRemoveFromHierarchy(sid))\n      action.addOp(new SGroupDelete(sid))\n    }\n  })\n}\n\nfunction getAtomsBondIds(struct, atoms) {\n  const atomSet = new Pile(atoms)\n\n  return Array.from(struct.bonds.keys()).filter(bid => {\n    const bond = struct.bonds.get(bid)\n    return atomSet.has(bond.begin) && atomSet.has(bond.end)\n  })\n}\n\nfunction getAtomsFromBonds(struct, bonds) {\n  bonds = bonds || []\n  return bonds.reduce((acc, bondid) => {\n    const bond = struct.bonds.get(bondid)\n    acc = acc.concat([bond.begin, bond.end])\n    return acc\n  }, [])\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Atom, Bond, RGroup } from 'ketcher-core'\nimport {\n  AtomAdd,\n  AtomAttr,\n  AtomDelete,\n  BondAdd,\n  BondAttr,\n  BondDelete,\n  FragmentAdd,\n  FragmentAddStereoAtom,\n  FragmentDelete,\n  FragmentDeleteStereoAtom,\n  SGroupAtomAdd,\n  CalcImplicitH\n} from '../operations'\nimport { atomGetAttr, atomGetDegree, atomGetSGroups } from './utils'\nimport { fromRGroupFragment, fromUpdateIfThen } from './rgroup'\nimport { removeAtomFromSgroupIfNeeded, removeSgroupIfNeeded } from './sgroup'\nimport { fromBondStereoUpdate } from './bond'\n\nimport Action from '../shared/action'\nimport { without } from 'lodash/fp'\n\nexport function fromAtomAddition(restruct, pos, atom) {\n  atom = Object.assign({}, atom)\n  const action = new Action()\n  atom.fragment = action.addOp(new FragmentAdd().perform(restruct)).frid\n\n  const aid = action.addOp(new AtomAdd(atom, pos).perform(restruct)).data.aid\n  action.addOp(new CalcImplicitH([aid]).perform(restruct))\n\n  return action\n}\n\n/**\n * @param restruct { ReStruct }\n * @param ids { Array<number>|number }\n * @param attrs { object }\n * @param reset { boolean? }\n */\nexport function fromAtomsAttrs(restruct, ids, attrs, reset) {\n  const action = new Action()\n  const aids = Array.isArray(ids) ? ids : [ids]\n\n  aids.forEach(aid => {\n    Object.keys(Atom.attrlist).forEach(key => {\n      if (key === 'attpnt' && !(key in attrs)) return\n      if (!(key in attrs) && !reset) return\n\n      const value = key in attrs ? attrs[key] : Atom.attrGetDefault(key)\n\n      switch (key) {\n        case 'stereoLabel':\n          if (key in attrs && value)\n            action.addOp(new AtomAttr(aid, key, value).perform(restruct))\n          break\n        case 'stereoParity':\n          if (key in attrs && value)\n            action.addOp(new AtomAttr(aid, key, value).perform(restruct))\n          break\n        default:\n          action.addOp(new AtomAttr(aid, key, value).perform(restruct))\n          break\n      }\n    })\n\n    if (\n      !reset &&\n      'label' in attrs &&\n      attrs.label !== null &&\n      attrs.label !== 'L#' &&\n      !attrs['atomList']\n    )\n      action.addOp(new AtomAttr(aid, 'atomList', null).perform(restruct))\n\n    action.addOp(new CalcImplicitH([aid]).perform(restruct))\n\n    const atomNeighbors = restruct.molecule.atomGetNeighbors(aid)\n    const bond = restruct.molecule.bonds.get(atomNeighbors[0]?.bid)\n    if (bond) {\n      action.mergeWith(fromBondStereoUpdate(restruct, bond))\n    }\n  })\n\n  return action\n}\n\nexport function fromStereoAtomAttrs(restruct, aid, attrs, withReverse) {\n  const action = new Action()\n  const atom = restruct.molecule.atoms.get(aid)\n  if (atom) {\n    const frid = atom.fragment\n\n    if ('stereoParity' in attrs)\n      action.addOp(\n        new AtomAttr(aid, 'stereoParity', attrs['stereoParity']).perform(\n          restruct\n        )\n      )\n    if ('stereoLabel' in attrs) {\n      action.addOp(\n        new AtomAttr(aid, 'stereoLabel', attrs['stereoLabel']).perform(restruct)\n      )\n      if (attrs['stereoLabel'] === null) {\n        action.addOp(new FragmentDeleteStereoAtom(frid, aid).perform(restruct))\n      } else {\n        action.addOp(new FragmentAddStereoAtom(frid, aid).perform(restruct))\n      }\n    }\n    if (withReverse) action.operations.reverse()\n  }\n\n  return action\n}\n\nexport function fromAtomsFragmentAttr(restruct, aids, newfrid) {\n  const action = new Action()\n\n  aids.forEach(aid => {\n    const atom = restruct.molecule.atoms.get(aid)\n    const oldfrid = atom.fragment\n    action.addOp(new AtomAttr(aid, 'fragment', newfrid))\n\n    if (atom.stereoLabel !== null) {\n      action.addOp(new FragmentAddStereoAtom(newfrid, aid))\n      action.addOp(new FragmentDeleteStereoAtom(oldfrid, aid))\n    }\n  })\n\n  return action.perform(restruct)\n}\n\n/**\n * @param restruct { ReStruct }\n * @param srcId { number }\n * @param dstId { number }\n * @return { Action }\n */\nexport function fromAtomMerge(restruct, srcId, dstId) {\n  if (srcId === dstId) return new Action()\n\n  const fragAction = new Action()\n  mergeFragmentsIfNeeded(fragAction, restruct, srcId, dstId)\n\n  const action = new Action()\n\n  const atomNeighbors = restruct.molecule.atomGetNeighbors(srcId)\n  atomNeighbors.forEach(nei => {\n    const bond = restruct.molecule.bonds.get(nei.bid)\n\n    if (dstId === bond.begin || dstId === bond.end) {\n      // src & dst have one nei\n      action.addOp(new BondDelete(nei.bid))\n      return\n    }\n\n    const begin = bond.begin === nei.aid ? nei.aid : dstId\n    const end = bond.begin === nei.aid ? dstId : nei.aid\n\n    const mergeBondId = restruct.molecule.findBondId(begin, end)\n\n    if (mergeBondId === null) {\n      action.addOp(new BondAdd(begin, end, bond))\n    } else {\n      // replace old bond with new bond\n      const attrs = Bond.getAttrHash(bond)\n      Object.keys(attrs).forEach(key => {\n        action.addOp(new BondAttr(mergeBondId, key, attrs[key]))\n      })\n    }\n\n    action.addOp(new BondDelete(nei.bid))\n  })\n\n  const attrs = Atom.getAttrHash(restruct.molecule.atoms.get(srcId))\n\n  if (atomGetDegree(restruct, srcId) === 1 && attrs['label'] === '*')\n    attrs['label'] = 'C'\n\n  Object.keys(attrs).forEach(key => {\n    if (key !== 'stereoLabel' && key !== 'stereoParity') {\n      action.addOp(new AtomAttr(dstId, key, attrs[key]))\n    }\n  })\n\n  const sgChanged = removeAtomFromSgroupIfNeeded(action, restruct, srcId)\n\n  if (sgChanged) removeSgroupIfNeeded(action, restruct, [srcId])\n\n  action.addOp(new AtomDelete(srcId))\n  action.addOp(new CalcImplicitH([dstId]))\n  const dstAtomNeighbors = restruct.molecule.atomGetNeighbors(dstId)\n  const bond = restruct.molecule.bonds.get(\n    dstAtomNeighbors[0]?.bid || atomNeighbors[0]?.bid\n  )\n\n  return action\n    .perform(restruct)\n    .mergeWith(fragAction)\n    .mergeWith(fromBondStereoUpdate(restruct, bond))\n}\n\nexport function mergeFragmentsIfNeeded(action, restruct, srcId, dstId) {\n  const frid = atomGetAttr(restruct, srcId, 'fragment')\n  const frid2 = atomGetAttr(restruct, dstId, 'fragment')\n  if (frid2 === frid || typeof frid2 !== 'number') return\n\n  const struct = restruct.molecule\n\n  const rgid = RGroup.findRGroupByFragment(struct.rgroups, frid2)\n  if (!(typeof rgid === 'undefined')) {\n    action\n      .mergeWith(fromRGroupFragment(restruct, null, frid2))\n      .mergeWith(fromUpdateIfThen(restruct, 0, rgid))\n  }\n\n  const fridAtoms = struct.getFragmentIds(frid)\n\n  const atomsToNewFrag = []\n  struct.atoms.forEach((atom, aid) => {\n    if (atom.fragment === frid2) atomsToNewFrag.push(aid)\n  })\n  const moveAtomsAction = fromAtomsFragmentAttr(restruct, atomsToNewFrag, frid)\n\n  mergeSgroups(action, restruct, fridAtoms, dstId)\n  action.addOp(new FragmentDelete(frid2).perform(restruct))\n  action.mergeWith(moveAtomsAction)\n}\n\nexport function mergeSgroups(action, restruct, srcAtoms, dstAtom) {\n  const sgroups = atomGetSGroups(restruct, dstAtom)\n\n  sgroups.forEach(sid => {\n    const sgroup = restruct.molecule.sgroups.get(sid)\n    const notExpandedContexts = ['Atom', 'Bond', 'Group']\n    if (\n      sgroup.type === 'DAT' &&\n      notExpandedContexts.includes(sgroup.data.context)\n    )\n      return\n    const atomsToSgroup = without(sgroup.atoms, srcAtoms)\n    atomsToSgroup.forEach(aid =>\n      action.addOp(new SGroupAtomAdd(sid, aid).perform(restruct))\n    )\n  })\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  Atom,\n  Bond,\n  Neighbor,\n  StereoLabel,\n  StereoValidator,\n  Vec2,\n  Struct\n} from 'ketcher-core'\nimport {\n  AtomAdd,\n  AtomAttr,\n  BondAdd,\n  BondAttr,\n  BondDelete,\n  CalcImplicitH,\n  FragmentAdd\n} from '../operations'\nimport { atomForNewBond, atomGetAttr } from './utils'\nimport {\n  fromAtomMerge,\n  fromStereoAtomAttrs,\n  mergeFragmentsIfNeeded,\n  mergeSgroups\n} from './atom'\n\nimport Action from '../shared/action'\nimport ReStruct from '../../render/restruct'\nimport utils from '../shared/utils'\n\nexport function fromBondAddition(\n  restruct: ReStruct,\n  bond: Bond,\n  begin: any,\n  end: any,\n  pos?: Vec2,\n  pos2?: Vec2\n): [Action, number, number, number] {\n  // eslint-disable-line\n  if (end === undefined) {\n    const atom = atomForNewBond(restruct, begin)\n    end = atom.atom\n    pos = atom.pos\n  }\n  const action = new Action()\n  const struct = restruct.molecule\n  let mergeFragments = false\n\n  let frid = null\n\n  if (!(typeof begin === 'number')) {\n    if (typeof end === 'number') frid = atomGetAttr(restruct, end, 'fragment')\n  } else {\n    frid = atomGetAttr(restruct, begin, 'fragment')\n    if (typeof end === 'number') mergeFragments = true\n  }\n\n  if (frid == null)\n    frid = (action.addOp(new FragmentAdd().perform(restruct)) as FragmentAdd)\n      .frid\n\n  if (!(typeof begin === 'number')) {\n    begin.fragment = frid\n    begin = (action.addOp(new AtomAdd(begin, pos).perform(restruct)) as AtomAdd)\n      .data.aid\n    if (typeof end === 'number') mergeSgroups(action, restruct, [begin], end)\n    pos = pos2\n  } else if (atomGetAttr(restruct, begin, 'label') === '*') {\n    action.addOp(new AtomAttr(begin, 'label', 'C').perform(restruct))\n  }\n\n  if (!(typeof end === 'number')) {\n    end.fragment = frid\n    // TODO: <op>.data.aid here is a hack, need a better way to access the id of a created atom\n    end = (action.addOp(new AtomAdd(end, pos).perform(restruct)) as AtomAdd)\n      .data.aid\n    if (typeof begin === 'number') mergeSgroups(action, restruct, [end], begin)\n  } else if (atomGetAttr(restruct, end, 'label') === '*') {\n    action.addOp(new AtomAttr(end, 'label', 'C').perform(restruct))\n  }\n\n  const bid = (action.addOp(\n    new BondAdd(begin, end, bond).perform(restruct)\n  ) as BondAdd).data.bid\n\n  const bnd = struct.bonds.get(bid)\n\n  if (bnd) {\n    action.addOp(new CalcImplicitH([bnd.begin, bnd.end]).perform(restruct))\n    action.mergeWith(fromBondStereoUpdate(restruct, bnd))\n  }\n\n  action.operations.reverse()\n\n  if (mergeFragments) mergeFragmentsIfNeeded(action, restruct, begin, end)\n\n  return [action, begin, end, bid]\n}\n\nexport function fromBondsAttrs(\n  restruct: ReStruct,\n  ids: Array<number> | number,\n  attrs: Bond,\n  reset?: boolean\n): Action {\n  const struct = restruct.molecule\n  const action = new Action()\n  const bids = Array.isArray(ids) ? ids : [ids]\n\n  bids.forEach(bid => {\n    Object.keys(Bond.attrlist).forEach(key => {\n      if (!(key in attrs) && !reset) return\n\n      const value = key in attrs ? attrs[key] : Bond.attrGetDefault(key)\n\n      action.addOp(new BondAttr(bid, key, value).perform(restruct))\n      if (key === 'stereo' && key in attrs) {\n        const bond = struct.bonds.get(bid)\n        if (bond) {\n          action.addOp(\n            new CalcImplicitH([bond.begin, bond.end]).perform(restruct)\n          )\n          action.mergeWith(fromBondStereoUpdate(restruct, bond))\n        }\n      }\n    })\n  })\n\n  return action\n}\n\nexport function fromBondsMerge(\n  restruct: ReStruct,\n  mergeMap: Map<number, number>\n): Action {\n  const struct = restruct.molecule\n\n  const atomPairs = new Map()\n  let action = new Action()\n\n  mergeMap.forEach((dstId, srcId) => {\n    const bond = struct.bonds.get(srcId)\n    const bondCI = struct.bonds.get(dstId)\n    if (!bond || !bondCI) return\n    const params = utils.mergeBondsParams(struct, bond, struct, bondCI)\n    if (!params.merged) return\n    atomPairs.set(bond.begin, !params.cross ? bondCI.begin : bondCI.end)\n    atomPairs.set(bond.end, !params.cross ? bondCI.end : bondCI.begin)\n  })\n\n  atomPairs.forEach((dst, src) => {\n    action = fromAtomMerge(restruct, src, dst).mergeWith(action)\n  })\n\n  return action\n}\n\nfunction fromBondFlipping(restruct: ReStruct, id: number): Action {\n  const bond = restruct.molecule.bonds.get(id)\n\n  const action = new Action()\n  action.addOp(new BondDelete(id).perform(restruct))\n\n  // TODO: find better way to avoid problem with bond.begin = 0\n  if (Number.isInteger(bond?.end) && Number.isInteger(bond?.begin)) {\n    action.addOp(new BondAdd(bond?.end, bond?.begin, bond).perform(restruct))\n  }\n\n  // todo: swap atoms stereoLabels and stereoAtoms in fragment\n\n  return action\n}\n\nexport function fromBondStereoUpdate(\n  restruct: ReStruct,\n  bond: Bond,\n  withReverse?: boolean\n): Action {\n  const action = new Action()\n  const struct = restruct.molecule\n\n  const beginFrId = struct.atoms.get(bond?.begin)?.fragment\n  const endFrId = struct.atoms.get(bond?.end)?.fragment\n\n  const fragmentStereoBonds: Array<Bond> = []\n\n  struct.bonds.forEach(bond => {\n    if (struct.atoms.get(bond.begin)?.fragment === beginFrId) {\n      fragmentStereoBonds.push(bond)\n    }\n\n    if (\n      beginFrId !== endFrId &&\n      struct.atoms.get(bond.begin)?.fragment === endFrId\n    ) {\n      fragmentStereoBonds.push(bond)\n    }\n  })\n\n  const stereoAtomsMap = getStereoAtomsMap(struct, fragmentStereoBonds, bond)\n\n  stereoAtomsMap.forEach((stereoProp, aId) => {\n    if (struct.atoms.get(aId)?.stereoLabel !== stereoProp.stereoLabel) {\n      action.mergeWith(\n        fromStereoAtomAttrs(restruct, aId, stereoProp, withReverse)\n      )\n    }\n  })\n\n  return action\n}\n\nexport function getStereoAtomsMap(\n  struct: Struct,\n  bonds: Array<Bond>,\n  bond?: Bond\n) {\n  const stereoAtomsMap = new Map()\n  const correctAtomIds: Array<number> = []\n\n  bonds.forEach((bond: Bond | undefined) => {\n    if (bond) {\n      const beginNeighs: Array<Neighbor> | undefined = struct.atomGetNeighbors(\n        bond.begin\n      )\n      const endNeighs: Array<Neighbor> | undefined = struct.atomGetNeighbors(\n        bond.end\n      )\n\n      if (\n        StereoValidator.isCorrectStereoCenter(\n          bond,\n          beginNeighs,\n          endNeighs,\n          struct\n        )\n      ) {\n        const stereoLabel = struct.atoms.get(bond.begin)?.stereoLabel\n        if (\n          stereoLabel == null ||\n          stereoAtomsMap.get(bond.begin)?.stereoLabel == null\n        ) {\n          stereoAtomsMap.set(bond.begin, {\n            stereoParity: getStereoParity(bond.stereo),\n            stereoLabel: stereoLabel || `${StereoLabel.Abs}`\n          })\n        }\n        correctAtomIds.push(bond.begin)\n      } else {\n        if (!correctAtomIds.includes(bond.begin)) {\n          stereoAtomsMap.set(bond.begin, {\n            stereoParity: Atom.PATTERN.STEREO_PARITY.NONE,\n            stereoLabel: null\n          })\n        }\n        if (!correctAtomIds.includes(bond.end)) {\n          stereoAtomsMap.set(bond.end, {\n            stereoParity: Atom.PATTERN.STEREO_PARITY.NONE,\n            stereoLabel: null\n          })\n        }\n      }\n    }\n  })\n\n  // in case the stereo band is flipped, changed or removed\n  // TODO the duplication of the code below should be fixed, mayby by function\n  if (bond) {\n    if (!correctAtomIds.includes(bond.begin)) {\n      stereoAtomsMap.set(bond.begin, {\n        stereoParity: Atom.PATTERN.STEREO_PARITY.NONE,\n        stereoLabel: null\n      })\n    }\n    if (!correctAtomIds.includes(bond.end)) {\n      stereoAtomsMap.set(bond.end, {\n        stereoParity: Atom.PATTERN.STEREO_PARITY.NONE,\n        stereoLabel: null\n      })\n    }\n  }\n\n  return stereoAtomsMap\n}\n\nfunction getStereoParity(stereo: Number): number | null {\n  let newAtomParity: number | null = null\n  switch (stereo) {\n    case Bond.PATTERN.STEREO.UP:\n      newAtomParity = Atom.PATTERN.STEREO_PARITY.ODD\n      break\n    case Bond.PATTERN.STEREO.EITHER:\n      newAtomParity = Atom.PATTERN.STEREO_PARITY.EITHER\n      break\n    case Bond.PATTERN.STEREO.DOWN:\n      newAtomParity = Atom.PATTERN.STEREO_PARITY.EVEN\n      break\n  }\n  return newAtomParity\n}\n\nexport function bondChangingAction(\n  restruct: ReStruct,\n  itemID: number,\n  bond: Bond,\n  bondProps: any\n): Action {\n  const action = new Action()\n  let newItemId = itemID\n  if (\n    ((bondProps.stereo !== Bond.PATTERN.STEREO.NONE && //\n      bondProps.type === Bond.PATTERN.TYPE.SINGLE) ||\n      bond.type === Bond.PATTERN.TYPE.DATIVE) &&\n    bond.type === bondProps.type &&\n    bond.stereo === bondProps.stereo\n  ) {\n    action.mergeWith(fromBondFlipping(restruct, itemID))\n    newItemId = (action.operations[1] as BondAdd).data.bid\n  }\n  // if bondTool is stereo and equal to bond for change\n\n  const loop = plainBondTypes.includes(bondProps.type) ? plainBondTypes : null\n  if (\n    bondProps.stereo === Bond.PATTERN.STEREO.NONE &&\n    bondProps.type === Bond.PATTERN.TYPE.SINGLE &&\n    bond.stereo === Bond.PATTERN.STEREO.NONE &&\n    loop\n  )\n    // if `Single bond` tool is chosen and bond for change in `plainBondTypes`\n    bondProps.type = loop[(loop.indexOf(bond.type) + 1) % loop.length]\n\n  return fromBondsAttrs(restruct, newItemId, bondProps).mergeWith(action)\n}\n\nconst plainBondTypes = [\n  Bond.PATTERN.TYPE.SINGLE,\n  Bond.PATTERN.TYPE.DOUBLE,\n  Bond.PATTERN.TYPE.TRIPLE\n]\n","import {\n  FormatterFactory,\n  Pile,\n  SGroup,\n  identifyStructFormat\n} from 'ketcher-core'\n\nimport { getStereoAtomsMap } from '../../editor/actions/bond'\n\nexport function onAction(action) {\n  if (action && action.dialog) {\n    return {\n      type: 'MODAL_OPEN',\n      data: { name: action.dialog }\n    }\n  }\n  if (action && action.thunk) {\n    return action.thunk\n  }\n\n  return {\n    type: 'ACTION',\n    action\n  }\n}\n\nexport function loadStruct(struct) {\n  return (dispatch, getState) => {\n    const editor = getState().editor\n    editor.struct(struct)\n  }\n}\n\nfunction parseStruct(struct, server, options) {\n  if (typeof struct === 'string') {\n    options = options || {}\n    const { rescale, fragment, ...formatterOptions } = options\n\n    const format = identifyStructFormat(struct)\n    const factory = new FormatterFactory(server)\n\n    const service = factory.create(format, formatterOptions)\n    return service.getStructureFromStringAsync(struct)\n  } else {\n    return Promise.resolve(struct)\n  }\n}\n\nexport function load(struct, options) {\n  return (dispatch, getState) => {\n    const state = getState()\n    const editor = state.editor\n    const server = state.server\n\n    options = options || {}\n\n    return parseStruct(struct, server, options).then(\n      struct => {\n        const { rescale, fragment } = options\n        if (rescale) {\n          struct.rescale() // TODO: move out parsing?\n\n          //NB: reset id\n          const oldStruct = editor.struct().clone()\n\n          struct.sgroups.forEach((sg, sgId) => {\n            const offset = SGroup.getOffset(oldStruct.sgroups.get(sgId))\n            const atomSet = new Pile(sg.atoms)\n            const crossBonds = SGroup.getCrossBonds(struct, atomSet)\n            SGroup.bracketPos(sg, struct, crossBonds)\n            if(offset) sg.updateOffset(offset)\n          })\n        }\n\n        struct.findConnectedComponents()\n        struct.setImplicitHydrogen()\n\n        const stereAtomsMap = getStereoAtomsMap(\n          struct,\n          Array.from(struct.bonds.values())\n        )\n\n        struct.atoms.forEach((atom, id) => {\n          if (struct.atomGetNeighbors(id).length === 0) {\n            atom.stereoLabel = null\n            atom.stereoParity = 0\n          } else {\n            const stereoProp = stereAtomsMap.get(id)\n            if (stereoProp) {\n              atom.stereoLabel = stereoProp.stereoLabel\n              atom.stereoParity = stereoProp.stereoParity\n            }\n          }\n        })\n\n        struct.markFragments()\n\n        if (struct.isBlank()) {\n          return\n        }\n        if (fragment) {\n          dispatch(onAction({ tool: 'paste', opts: struct }))\n        } else {\n          editor.struct(struct)\n        }\n      },\n      err => {\n        //TODO: add error handler call\n        alert(err)\n      }\n    )\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { appUpdate, setStruct } from '../options'\nimport { omit, without } from 'lodash/fp'\n\nimport { MolSerializer } from 'ketcher-core'\nimport { checkErrors } from '../modal/form'\nimport { indigoVerification } from '../request'\nimport { load } from '../shared'\n\nexport function checkServer() {\n  return (dispatch, getState) => {\n    const server = getState().server\n\n    server.then(\n      res =>\n        dispatch(\n          appUpdate({\n            indigoVersion: res?.indigoVersion,\n            imagoVersions: res?.imagoVersions,\n            server: res?.isAvailable\n          })\n        ),\n      err => console.info(err)\n      // TODO: notification info\n    )\n  }\n}\n\nexport function recognize(file, version) {\n  return (dispatch, getState) => {\n    const rec = getState().server.recognize\n\n    const process = rec(file, version).then(\n      res => {\n        dispatch(setStruct(res.struct))\n      },\n      () => {\n        dispatch(setStruct(null))\n        //TODO: add error handler call\n        //legacy message: The picture isn't recognized\n      }\n    )\n    dispatch(setStruct(process))\n  }\n}\n\nfunction ketcherCheck(struct, checkParams) {\n  const errors = {}\n\n  if (checkParams.includes('chiral_flag')) {\n    const isAbs = Array.from(struct.frags.values()).some(fr =>\n      fr ? fr.enhancedStereoFlag === 'abs' : false\n    )\n    if (isAbs) errors['chiral_flag'] = 'Chiral flag is present on the canvas'\n  }\n\n  if (checkParams.includes('valence')) {\n    let badVal = 0\n    struct.atoms.forEach(atom => atom.badConn && badVal++)\n    if (badVal > 0)\n      errors['valence'] = `Structure contains ${badVal} atom${\n        badVal !== 1 ? 's' : ''\n      } with bad valence`\n  }\n\n  return errors\n}\n\nexport function check(optsTypes) {\n  return (dispatch, getState) => {\n    const { editor, server } = getState()\n    const ketcherErrors = ketcherCheck(editor.struct(), optsTypes)\n\n    const options = getState().options.getServerSettings()\n    options.data = { types: without(['valence', 'chiral_flag'], optsTypes) }\n\n    return serverCall(editor, server, 'check', options)\n      .then(res => {\n        res = Object.assign(res, ketcherErrors) // merge Indigo check with Ketcher check\n        dispatch(checkErrors(res))\n      })\n      .catch(e => {\n        //TODO: add error handler call\n        //legacy message: Failed check\n      })\n    // TODO: notification\n  }\n}\n\nexport function automap(res) {\n  return serverTransform('automap', res)\n}\n\nexport function analyse() {\n  return (dispatch, getState) => {\n    //reset values to initial state\n    dispatch({\n      type: 'ANALYSE_LOADING'\n    })\n    const { editor, server, options } = getState()\n    const serverSettings = options.getServerSettings()\n    serverSettings.data = {\n      properties: [\n        'molecular-weight',\n        'most-abundant-mass',\n        'monoisotopic-mass',\n        'gross',\n        'mass-composition'\n      ]\n    }\n\n    return serverCall(editor, server, 'calculate', serverSettings)\n      .then(values =>\n        dispatch({\n          type: 'CHANGE_ANALYSE',\n          data: { values }\n        })\n      )\n      .catch(e => {\n        //TODO: add error handler call\n        throw e\n      }) // eslint-disable-line no-undef\n    // TODO: notification\n  }\n}\n\nexport function serverTransform(method, data, struct) {\n  return (dispatch, getState) => {\n    const state = getState()\n    const opts = state.options.getServerSettings()\n    opts.data = data\n    dispatch(indigoVerification(true))\n\n    serverCall(state.editor, state.server, method, opts, struct)\n      .then(res => {\n        // TODO: it should be removed after implementing of 'Internal Format'  epic\n        const previousStruct = struct || state.editor.struct()\n        const loadedStruct = new MolSerializer().deserialize(res.struct)\n        loadedStruct.simpleObjects = previousStruct.simpleObjects\n        loadedStruct.texts = previousStruct.texts\n\n        return dispatch(\n          load(loadedStruct, {\n            rescale: method === 'layout',\n            reactionRelayout: method === 'clean'\n          })\n        )\n      })\n      .catch(e => {\n        //TODO: add error handler call\n      })\n      .finally(() => {\n        dispatch(indigoVerification(false))\n      })\n    // TODO: notification\n  }\n}\n\nexport function serverCall(editor, server, method, options, struct) {\n  const selection = editor.selection()\n  let selectedAtoms = []\n  const aidMap = new Map()\n  const currentStruct = (struct || editor.struct()).clone(\n    null,\n    null,\n    false,\n    aidMap\n  )\n  if (selection) {\n    selectedAtoms = (selection.atoms\n      ? selection.atoms\n      : editor.explicitSelected().atoms\n    ).map(aid => aidMap.get(aid))\n\n    if (currentStruct.hasRxnArrow()) {\n      const components = currentStruct.getComponents()\n      const reindexMap = getReindexMap(components)\n      selectedAtoms = selectedAtoms.map(aid => reindexMap.get(aid))\n    }\n  }\n  const molSerializer = new MolSerializer({ ignoreErrors: true })\n  return server.then(() =>\n    server[method](\n      Object.assign(\n        {\n          struct: molSerializer.serialize(currentStruct)\n        },\n        selectedAtoms && selectedAtoms.length > 0\n          ? {\n              selected: selectedAtoms\n            }\n          : null,\n        options.data\n      ),\n      omit('data', options)\n    )\n  )\n}\n\nfunction getReindexMap(components) {\n  const map = [...components.reactants, ...components.products]\n    .reduce((acc, set) => {\n      acc = [...acc, ...set]\n      return acc\n    }, [])\n    .reduce((acc, aid, index) => {\n      acc.set(aid, index)\n      return acc\n    }, new Map())\n\n  return map\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { serverTransform } from '../state/server'\n\nconst config = {\n  layout: {\n    shortcut: 'Mod+l',\n    title: 'Layout',\n    action: {\n      thunk: serverTransform('layout')\n    },\n    disabled: (editor, server, options) => !options.app.server,\n    hidden: options => isHidden(options, 'layout')\n  },\n  clean: {\n    shortcut: 'Mod+Shift+l',\n    title: 'Clean Up',\n    action: {\n      thunk: serverTransform('clean')\n    },\n    disabled: (editor, server, options) => !options.app.server,\n    hidden: options => isHidden(options, 'clean')\n  },\n  arom: {\n    title: 'Aromatize',\n    action: {\n      thunk: serverTransform('aromatize')\n    },\n    disabled: (editor, server, options) => !options.app.server,\n    hidden: options => isHidden(options, 'arom')\n  },\n  dearom: {\n    title: 'Dearomatize',\n    action: {\n      thunk: serverTransform('dearomatize')\n    },\n    disabled: (editor, server, options) => !options.app.server,\n    hidden: options => isHidden(options, 'dearom')\n  },\n  cip: {\n    shortcut: 'Mod+p',\n    title: 'Calculate CIP',\n    action: {\n      thunk: serverTransform('calculateCip')\n    },\n    disabled: (editor, server, options) => !options.app.server,\n    hidden: options => isHidden(options, 'cip')\n  },\n  check: {\n    title: 'Check Structure',\n    action: { dialog: 'check' },\n    disabled: (editor, server, options) => !options.app.server,\n    hidden: options => isHidden(options, 'check')\n  },\n  analyse: {\n    title: 'Calculated Values',\n    action: { dialog: 'analyse' },\n    disabled: (editor, server, options) => !options.app.server,\n    hidden: options => isHidden(options, 'analyse')\n  },\n  recognize: {\n    title: 'Recognize Molecule',\n    action: { dialog: 'recognize' },\n    disabled: (editor, server, options) =>\n      //TODO: provide the list of disabled functions as array\n      !options.app.server || global.ketcher.standalone,\n    hidden: options => isHidden(options, 'recognize')\n  },\n  miew: {\n    title: '3D Viewer',\n    action: { dialog: 'miew' },\n    disabled: () => !window.Miew,\n    hidden: options => isHidden(options, 'miew')\n  }\n}\n\nfunction isHidden(options, buttonName) {\n  return Boolean(options.buttons?.[buttonName]?.hidden)\n}\n\nexport default config\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { MolSerializer } from 'ketcher-core'\n\nconst molSerializer = new MolSerializer()\n\nexport default [\n  'Benzene\\n' +\n    '  Ketcher 11161218352D 1   1.00000     0.00000     0\\n' +\n    '\\n' +\n    '  6  6  0     0  0            999 V2000\\n' +\n    '    0.8660    2.0000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    1.7320    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    1.7320    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.8660    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.0000    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.0000    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '  1  2  1  0     0  0\\n' +\n    '  2  3  2  0     0  0\\n' +\n    '  3  4  1  0     0  0\\n' +\n    '  4  5  2  0     0  0\\n' +\n    '  5  6  1  0     0  0\\n' +\n    '  6  1  2  0     0  0\\n' +\n    'M  END\\n',\n  'Cyclopentadiene\\n' +\n    '  Ketcher 11161218352D 1   1.00000     0.00000     0\\n' +\n    '\\n' +\n    '  5  5  0     0  0            999 V2000\\n' +\n    '    0.0000    1.4257    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.8090    0.8379    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.5000   -0.1132    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '   -0.5000   -0.1132    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '   -0.8090    0.8379    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '  1  2  1  0     0  0\\n' +\n    '  2  3  2  0     0  0\\n' +\n    '  3  4  1  0     0  0\\n' +\n    '  4  5  2  0     0  0\\n' +\n    '  5  1  1  0     0  0\\n' +\n    'M  END\\n',\n\n  'Cyclohexane\\n' +\n    '  Ketcher 11161218352D 1   1.00000     0.00000     0\\n' +\n    '\\n' +\n    '  6  6  0     0  0            999 V2000\\n' +\n    '    0.8660    2.0000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    1.7320    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    1.7320    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.8660    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.0000    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.0000    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '  1  2  1  0     0  0\\n' +\n    '  2  3  1  0     0  0\\n' +\n    '  3  4  1  0     0  0\\n' +\n    '  4  5  1  0     0  0\\n' +\n    '  5  6  1  0     0  0\\n' +\n    '  6  1  1  0     0  0\\n' +\n    'M  END\\n',\n\n  'Cyclopentane\\n' +\n    '  Ketcher 11161218352D 1   1.00000     0.00000     0\\n' +\n    '\\n' +\n    '  5  5  0     0  0            999 V2000\\n' +\n    '    0.8090    1.5389    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    1.6180    0.9511    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    1.3090    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.3090    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.0000    0.9511    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '  1  2  1  0     0  0\\n' +\n    '  2  3  1  0     0  0\\n' +\n    '  3  4  1  0     0  0\\n' +\n    '  4  5  1  0     0  0\\n' +\n    '  5  1  1  0     0  0\\n' +\n    'M  END\\n',\n\n  'Cyclopropane\\n' +\n    '  Ketcher 11161218352D 1   1.00000     0.00000     0\\n' +\n    '\\n' +\n    '  3  3  0     0  0            999 V2000\\n' +\n    '   -3.2250   -0.2750    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '   -2.2250   -0.2750    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '   -2.7250    0.5910    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '  1  2  1  0     0  0\\n' +\n    '  2  3  1  0     0  0\\n' +\n    '  1  3  1  0     0  0\\n' +\n    'M  END\\n',\n\n  'Cyclobutane\\n' +\n    '  Ketcher 11161218352D 1   1.00000     0.00000     0\\n' +\n    '\\n' +\n    '  4  4  0     0  0            999 V2000\\n' +\n    '   -3.8250    1.5500    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '   -3.8250    0.5500    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '   -2.8250    1.5500    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '   -2.8250    0.5500    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '  1  2  1  0     0  0\\n' +\n    '  1  3  1  0     0  0\\n' +\n    '  3  4  1  0     0  0\\n' +\n    '  4  2  1  0     0  0\\n' +\n    'M  END\\n',\n\n  'Cycloheptane\\n' +\n    '  Ketcher 11161218352D 1   1.00000     0.00000     0\\n' +\n    '\\n' +\n    '  7  7  0     0  0            999 V2000\\n' +\n    '    0.0000    1.6293    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.7835    2.2465    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    1.7559    2.0242    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    2.1897    1.1289    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.0000    0.6228    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    1.7566    0.2224    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.7835    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '  6  7  1  0     0  0\\n' +\n    '  5  7  1  0     0  0\\n' +\n    '  1  5  1  0     0  0\\n' +\n    '  4  6  1  0     0  0\\n' +\n    '  3  4  1  0     0  0\\n' +\n    '  2  3  1  0     0  0\\n' +\n    '  1  2  1  0     0  0\\n' +\n    'M  END\\n',\n\n  'Cyclooctane\\n' +\n    '  Ketcher 11161218352D 1   1.00000     0.00000     0\\n' +\n    '\\n' +\n    '  8  8  0     0  0            999 V2000\\n' +\n    '    0.0000    0.7053    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.0000    1.7078    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.7053    2.4131    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    0.7056    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    1.7079    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    2.4133    0.7053    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    2.4133    1.7078    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '    1.7079    2.4131    0.0000 C   0  0  0  0  0  0        0  0  0\\n' +\n    '  8  3  1  0     0  0\\n' +\n    '  7  8  1  0     0  0\\n' +\n    '  6  7  1  0     0  0\\n' +\n    '  5  6  1  0     0  0\\n' +\n    '  4  5  1  0     0  0\\n' +\n    '  1  4  1  0     0  0\\n' +\n    '  2  3  1  0     0  0\\n' +\n    '  1  2  1  0     0  0\\n' +\n    'M  END\\n'\n].map(structStr => molSerializer.deserialize(structStr))\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport templates from '../data/templates'\n\nconst templateLib = {\n  'template-lib': {\n    shortcut: 'Shift+t',\n    title: 'Custom Templates',\n    action: { dialog: 'templates' },\n    disabled: (editor, server, options) => !options.app.templates\n  }\n}\n\nexport default templates.reduce((res, struct, i) => {\n  res[`template-${i}`] = {\n    title: `${struct.name}`,\n    shortcut: 't',\n    action: {\n      tool: 'template',\n      opts: { struct }\n    }\n  }\n  return res\n}, templateLib)\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { mapOf } from './schema-helper'\nimport { range } from 'lodash/fp'\n\nexport const atom = {\n  title: 'Atom',\n  type: 'object',\n  required: 'label',\n  properties: {\n    label: {\n      title: 'Label',\n      type: 'string', // TODO:should really be enum of elements\n      maxLength: 3,\n      invalidMessage: 'Wrong label'\n    },\n    alias: {\n      title: 'Alias',\n      type: 'string',\n      invalidMessage: 'Leading and trailing spaces are not allowed'\n    },\n    charge: {\n      title: 'Charge',\n      type: 'string',\n      pattern: /^([+-]?)(\\d{1,3}|1000)([+-]?)$/,\n      maxLength: 5,\n      default: '0',\n      invalidMessage: 'Invalid charge value'\n    },\n    explicitValence: {\n      title: 'Valence',\n      enum: [-1, 0, 1, 2, 3, 4, 5, 6, 7, 8],\n      enumNames: ['', '0', 'I', 'II', 'III', 'IV', 'V', 'VI', 'VII', 'VIII'],\n      default: -1\n    },\n    isotope: {\n      title: 'Isotope',\n      type: 'integer',\n      minimum: 0,\n      default: 0,\n      invalidMessage: 'There must be integer'\n    },\n    radical: {\n      title: 'Radical',\n      enum: [0, 2, 1, 3],\n      enumNames: [\n        '',\n        'Monoradical',\n        'Diradical (singlet)',\n        'Diradical (triplet)'\n      ],\n      default: 0\n    },\n    ringBondCount: {\n      title: 'Ring bond count',\n      enum: [0, -2, -1, 2, 3, 4],\n      enumNames: ['', 'As drawn', '0', '2', '3', '4'],\n      default: 0\n    },\n    hCount: {\n      title: 'H count',\n      enum: [0, 1, 2, 3, 4, 5],\n      enumNames: ['', '0', '1', '2', '3', '4'],\n      default: 0\n    },\n    substitutionCount: {\n      title: 'Substitution count',\n      enum: [0, -2, -1, 1, 2, 3, 4, 5, 6],\n      enumNames: ['', 'As drawn', '0', '1', '2', '3', '4', '5', '6'],\n      default: 0\n    },\n    unsaturatedAtom: {\n      title: 'Unsaturated',\n      type: 'boolean',\n      default: false\n    },\n    invRet: {\n      title: 'Inversion',\n      enum: [0, 1, 2],\n      enumNames: ['', 'Inverts', 'Retains'],\n      default: 0\n    },\n    exactChangeFlag: {\n      title: 'Exact change',\n      type: 'boolean',\n      default: false\n    }\n  }\n}\n\nexport const rgroupSchema = {\n  title: 'R-group',\n  type: 'object',\n  properties: {\n    values: {\n      type: 'array',\n      items: {\n        type: 'string',\n        enum: range(1, 33),\n        enumNames: range(1, 33).map(item => 'R' + item)\n      }\n    }\n  }\n}\n\nexport const labelEdit = {\n  title: 'Label Edit',\n  type: 'object',\n  required: ['label'],\n  properties: {\n    label: {\n      title: 'Atom',\n      default: '',\n      invalidMessage: 'Wrong atom symbol'\n    }\n  }\n}\n\nexport const attachmentPoints = {\n  title: 'Attachment Points',\n  type: 'object',\n  properties: {\n    primary: {\n      title: 'Primary attachment point',\n      type: 'boolean'\n    },\n    secondary: {\n      title: 'Secondary attachment point',\n      type: 'boolean'\n    }\n  }\n}\n\nexport const bond = {\n  title: 'Bond',\n  type: 'object',\n  required: ['type'],\n  properties: {\n    type: {\n      title: 'Type',\n      enum: [\n        'single',\n        'up',\n        'down',\n        'updown',\n        'double',\n        'crossed',\n        'triple',\n        'aromatic',\n        'any',\n        'hydrogen',\n        'singledouble',\n        'singlearomatic',\n        'doublearomatic',\n        'dative'\n      ],\n      enumNames: [\n        'Single',\n        'Single Up',\n        'Single Down',\n        'Single Up/Down',\n        'Double',\n        'Double Cis/Trans',\n        'Triple',\n        'Aromatic',\n        'Any',\n        'Hydrogen',\n        'Single/Double',\n        'Single/Aromatic',\n        'Double/Aromatic',\n        'Dative'\n      ],\n      default: 'single'\n    },\n    topology: {\n      title: 'Topology',\n      enum: [0, 1, 2],\n      enumNames: ['Either', 'Ring', 'Chain'],\n      default: 0\n    },\n    center: {\n      title: 'Reacting Center',\n      enum: [0, -1, 1, 2, 4, 8, 12], // 5, 9, 13\n      enumNames: [\n        'Unmarked',\n        'Not center',\n        'Center',\n        'No change',\n        'Made/broken',\n        'Order changes',\n        'Made/broken and changes'\n      ], // \"Order changes\" x 3\n      default: 0\n    }\n  }\n}\n\nconst sgroup = {\n  title: 'SGroup',\n  type: 'object',\n  required: ['type'],\n  oneOf: [\n    {\n      key: 'GEN',\n      title: 'Generic',\n      properties: {\n        type: { enum: ['GEN'] }\n      }\n    },\n    {\n      key: 'MUL',\n      title: 'Multiple group',\n      type: 'object',\n      properties: {\n        type: { enum: ['MUL'] },\n        mul: {\n          title: 'Repeat count',\n          type: 'integer',\n          default: 1,\n          minimum: 1,\n          maximum: 1000,\n          invalidMessage: 'Value out of range: must be between 1 and 1000'\n        }\n      },\n      required: ['mul']\n    },\n    {\n      key: 'SRU',\n      title: 'SRU polymer',\n      properties: {\n        type: { enum: ['SRU'] },\n        subscript: {\n          title: 'Polymer label',\n          type: 'string',\n          default: 'n',\n          pattern: /^[a-zA-Z]$/,\n          invalidMessage: 'SRU subscript should consist of a single letter'\n        },\n        connectivity: {\n          title: 'Repeat Pattern',\n          enum: ['ht', 'hh', 'eu'],\n          enumNames: ['Head-to-tail', 'Head-to-head', 'Either unknown'],\n          default: 'ht'\n        }\n      },\n      required: ['subscript', 'connectivity']\n    },\n    {\n      key: 'SUP',\n      title: 'Superatom',\n      properties: {\n        type: { enum: ['SUP'] },\n        name: {\n          title: 'Name',\n          type: 'string',\n          default: '',\n          minLength: 1,\n          invalidMessage: 'Please, provide a name for the superatom'\n        }\n      },\n      required: ['name']\n    }\n  ]\n}\nexport const sgroupMap = mapOf(sgroup, 'type')\n\nexport const rgroupLogic = {\n  title: 'R-Group',\n  type: 'object',\n  properties: {\n    range: {\n      title: 'Occurrence',\n      type: 'string',\n      maxLength: 50,\n      invalidMessage: 'Wrong value'\n    },\n    resth: {\n      title: 'RestH',\n      type: 'boolean'\n    },\n    ifthen: {\n      title: 'Condition',\n      type: 'integer',\n      minium: 0\n    }\n  }\n}\n\nexport const textSchema = {\n  title: 'Text Edit',\n  type: 'object',\n  required: ['label'],\n  properties: {\n    label: {\n      default: '',\n      type: 'string'\n    }\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { AtomList, Bond, Elements, StereoLabel } from 'ketcher-core'\n\nimport { atom as atomSchema } from '../schema/struct-schema'\nimport { capitalize } from 'lodash/fp'\nimport { sdataSchema } from '../schema/sdata-schema'\n\nconst DefaultStereoGroupNumber = 1\n\nexport function fromElement(selem) {\n  if (selem.label === 'R#') {\n    return {\n      type: 'rlabel',\n      values: fromRlabel(selem.rglabel),\n      ...selem\n    }\n  }\n  if (selem.label === 'L#') return fromAtomList(selem)\n\n  if (Elements.get(selem.label)) return fromAtom(selem)\n\n  if (!selem.label && 'attpnt' in selem) return { ap: fromApoint(selem.attpnt) }\n\n  return selem // probably generic\n}\n\nexport function toElement(elem) {\n  if (elem.type === 'rlabel') {\n    return {\n      label: elem.values.length ? 'R#' : 'C',\n      rglabel: elem.values.length === 0 ? null : toRlabel(elem.values)\n    }\n  }\n  if (elem.type === 'list' || elem.type === 'not-list') return toAtomList(elem)\n\n  if (!elem.label && 'ap' in elem) return { attpnt: toApoint(elem.ap) }\n\n  if (Elements.get(capitalize(elem.label))) return toAtom(elem)\n\n  if (\n    elem.label === 'A' ||\n    elem.label === '*' ||\n    elem.label === 'Q' ||\n    elem.label === 'X' ||\n    elem.label === 'R'\n  ) {\n    elem.pseudo = elem.label\n    return toAtom(elem)\n  }\n\n  return elem\n}\n\nfunction fromAtom(satom) {\n  const alias = satom.alias || ''\n  const charge = satom.charge.toString()\n\n  return {\n    alias,\n    label: satom.label,\n    charge,\n    isotope: satom.isotope,\n    explicitValence: satom.explicitValence,\n    radical: satom.radical,\n    invRet: satom.invRet,\n    exactChangeFlag: !!satom.exactChangeFlag,\n    ringBondCount: satom.ringBondCount,\n    substitutionCount: satom.substitutionCount,\n    unsaturatedAtom: !!satom.unsaturatedAtom,\n    hCount: satom.hCount,\n    stereoParity: satom.stereoParity\n  }\n}\n\nfunction toAtom(atom) {\n  // TODO merge this to Atom.attrlist?\n  //      see ratomtool\n  const chargeRegexp = atomSchema.properties.charge.pattern\n  const pch = chargeRegexp.exec(atom.charge)\n  const charge = pch ? parseInt(pch[1] + pch[3] + pch[2]) : atom.charge\n\n  const conv = Object.assign({}, atom, {\n    label: capitalize(atom.label),\n    alias: atom.alias || null\n  })\n  if (charge !== undefined) conv.charge = charge\n  return conv\n}\n\nfunction fromAtomList(satom) {\n  return {\n    type: satom.atomList.notList ? 'not-list' : 'list',\n    values: satom.atomList.ids.map(i => Elements.get(i).label)\n  }\n}\n\nfunction toAtomList(atom) {\n  return {\n    pseudo: null,\n    label: 'L#',\n    atomList: new AtomList({\n      notList: atom.type === 'not-list',\n      ids: atom.values.map(el => Elements.get(el).number)\n    })\n  }\n}\n\nexport function fromStereoLabel(stereoLabel) {\n  if (stereoLabel === null) return { type: null }\n  const type = stereoLabel.match(/\\D+/g)[0]\n  const number = +stereoLabel.replace(type, '')\n\n  if (type === StereoLabel.Abs) {\n    return {\n      type: stereoLabel,\n      orNumber: DefaultStereoGroupNumber,\n      andNumber: DefaultStereoGroupNumber\n    }\n  }\n\n  if (type === StereoLabel.And) {\n    return {\n      type: type,\n      orNumber: DefaultStereoGroupNumber,\n      andNumber: number\n    }\n  }\n\n  if (type === StereoLabel.Or) {\n    return {\n      type: type,\n      orNumber: number,\n      andNumber: DefaultStereoGroupNumber\n    }\n  }\n}\n\nexport function toStereoLabel(stereoLabel) {\n  switch (stereoLabel.type) {\n    case StereoLabel.And:\n      return `${StereoLabel.And}${stereoLabel.andNumber || 1}`\n\n    case StereoLabel.Or:\n      return `${StereoLabel.Or}${stereoLabel.orNumber || 1}`\n\n    default:\n      return stereoLabel.type\n  }\n}\n\nfunction fromApoint(sap) {\n  return {\n    primary: ((sap || 0) & 1) > 0,\n    secondary: ((sap || 0) & 2) > 0\n  }\n}\n\nfunction toApoint(ap) {\n  return (ap.primary && 1) + (ap.secondary && 2)\n}\n\nfunction fromRlabel(rg) {\n  const res = []\n  let rgi\n  let val\n  for (rgi = 0; rgi < 32; rgi++) {\n    if (rg & (1 << rgi)) {\n      val = rgi + 1\n      res.push(val) // push the string\n    }\n  }\n  return res\n}\n\nfunction toRlabel(values) {\n  let res = 0\n  values.forEach(val => {\n    const rgi = val - 1\n    res |= 1 << rgi\n  })\n  return res\n}\n\nexport function fromBond(sbond) {\n  const type = sbond.type\n  const stereo = sbond.stereo\n  return {\n    type: fromBondType(type, stereo),\n    topology: sbond.topology || 0,\n    center: sbond.reactingCenterStatus || 0\n  }\n}\n\nexport function toBond(bond) {\n  return {\n    topology: bond.topology,\n    reactingCenterStatus: bond.center,\n    ...toBondType(bond.type)\n  }\n}\n\nexport function toBondType(caption) {\n  return Object.assign({}, bondCaptionMap[caption])\n}\n\nfunction fromBondType(type, stereo) {\n  for (const caption in bondCaptionMap) {\n    if (\n      bondCaptionMap[caption].type === type &&\n      bondCaptionMap[caption].stereo === stereo\n    )\n      return caption\n  }\n  throw Error('No such bond caption')\n}\n\nconst bondCaptionMap = {\n  single: {\n    type: Bond.PATTERN.TYPE.SINGLE,\n    stereo: Bond.PATTERN.STEREO.NONE\n  },\n  up: {\n    type: Bond.PATTERN.TYPE.SINGLE,\n    stereo: Bond.PATTERN.STEREO.UP\n  },\n  down: {\n    type: Bond.PATTERN.TYPE.SINGLE,\n    stereo: Bond.PATTERN.STEREO.DOWN\n  },\n  updown: {\n    type: Bond.PATTERN.TYPE.SINGLE,\n    stereo: Bond.PATTERN.STEREO.EITHER\n  },\n  double: {\n    type: Bond.PATTERN.TYPE.DOUBLE,\n    stereo: Bond.PATTERN.STEREO.NONE\n  },\n  crossed: {\n    type: Bond.PATTERN.TYPE.DOUBLE,\n    stereo: Bond.PATTERN.STEREO.CIS_TRANS\n  },\n  triple: {\n    type: Bond.PATTERN.TYPE.TRIPLE,\n    stereo: Bond.PATTERN.STEREO.NONE\n  },\n  aromatic: {\n    type: Bond.PATTERN.TYPE.AROMATIC,\n    stereo: Bond.PATTERN.STEREO.NONE\n  },\n  singledouble: {\n    type: Bond.PATTERN.TYPE.SINGLE_OR_DOUBLE,\n    stereo: Bond.PATTERN.STEREO.NONE\n  },\n  singlearomatic: {\n    type: Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC,\n    stereo: Bond.PATTERN.STEREO.NONE\n  },\n  doublearomatic: {\n    type: Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC,\n    stereo: Bond.PATTERN.STEREO.NONE\n  },\n  any: {\n    type: Bond.PATTERN.TYPE.ANY,\n    stereo: Bond.PATTERN.STEREO.NONE\n  },\n  hydrogen: {\n    type: Bond.PATTERN.TYPE.HYDROGEN,\n    stereo: Bond.PATTERN.STEREO.NONE\n  },\n  dative: {\n    type: Bond.PATTERN.TYPE.DATIVE,\n    stereo: Bond.PATTERN.STEREO.NONE\n  }\n}\n\nexport function fromSgroup(ssgroup) {\n  const type = ssgroup.type || 'GEN'\n  const { context, fieldName, fieldValue, absolute, attached } = ssgroup.attrs\n\n  if (absolute === false && attached === false)\n    ssgroup.attrs.radiobuttons = 'Relative'\n  else ssgroup.attrs.radiobuttons = attached ? 'Attached' : 'Absolute'\n\n  if (\n    sdataSchema[context][fieldName] &&\n    sdataSchema[context][fieldName].properties.fieldValue.items\n  )\n    ssgroup.attrs.fieldValue = fieldValue.split('\\n')\n\n  return Object.assign({ type }, ssgroup.attrs)\n}\n\nexport function toSgroup(sgroup) {\n  const { type, radiobuttons, ...props } = sgroup\n  const attrs = { ...props }\n\n  const absolute = 'absolute'\n  const attached = 'attached'\n\n  switch (radiobuttons) {\n    case 'Absolute':\n      attrs[absolute] = true\n      attrs[attached] = false\n      break\n    case 'Attached':\n      attrs[absolute] = false\n      attrs[attached] = true\n      break\n    case 'Relative':\n      attrs[absolute] = false\n      attrs[attached] = false\n      break\n    default:\n      break\n  }\n\n  if (attrs.fieldName) attrs.fieldName = attrs.fieldName.trim()\n\n  if (attrs.fieldValue) {\n    attrs.fieldValue =\n      typeof attrs.fieldValue === 'string'\n        ? attrs.fieldValue.trim()\n        : attrs.fieldValue\n  }\n\n  return {\n    type,\n    attrs\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { RxnArrowMode, SimpleObjectMode } from 'ketcher-core'\n\nimport { bond as bondSchema } from '../data/schema/struct-schema'\nimport { toBondType } from '../data/convert/structconv'\n\nconst toolActions = {\n  'select-lasso': {\n    title: 'Lasso Selection',\n    shortcut: 'Escape',\n    action: { tool: 'select', opts: 'lasso' }\n  },\n  'select-rectangle': {\n    title: 'Rectangle Selection',\n    shortcut: 'Escape',\n    action: { tool: 'select', opts: 'rectangle' }\n  },\n  'select-fragment': {\n    title: 'Fragment Selection',\n    shortcut: 'Escape',\n    action: { tool: 'select', opts: 'fragment' }\n  },\n  erase: {\n    title: 'Erase',\n    shortcut: ['Delete', 'Backspace'],\n    action: { tool: 'eraser', opts: 1 } // TODO last selector mode is better\n  },\n  chain: {\n    title: 'Chain',\n    action: { tool: 'chain' }\n  },\n  'enhanced-stereo': {\n    shortcut: 'Alt+e',\n    title: 'Stereochemistry',\n    action: { tool: 'enhancedStereo' }\n  },\n  'charge-plus': {\n    shortcut: '5',\n    title: 'Charge Plus',\n    action: { tool: 'charge', opts: 1 }\n  },\n  'charge-minus': {\n    shortcut: '5',\n    title: 'Charge Minus',\n    action: { tool: 'charge', opts: -1 }\n  },\n  'transform-rotate': {\n    shortcut: 'Alt+r',\n    title: 'Rotate Tool',\n    action: { tool: 'rotate' }\n  },\n  'transform-flip-h': {\n    shortcut: 'Alt+h',\n    title: 'Horizontal Flip',\n    action: { tool: 'rotate', opts: 'horizontal' }\n  },\n  'transform-flip-v': {\n    shortcut: 'Alt+v',\n    title: 'Vertical Flip',\n    action: { tool: 'rotate', opts: 'vertical' }\n  },\n  sgroup: {\n    shortcut: 'Mod+g',\n    title: 'S-Group',\n    action: { tool: 'sgroup' }\n  },\n  'sgroup-data': {\n    shortcut: 'Mod+g',\n    title: 'Data S-Group',\n    action: { tool: 'sgroup', opts: 'DAT' }\n  },\n  'reaction-arrow': {\n    title: 'Reaction Arrow Tool',\n    action: { tool: 'reactionarrow', opts: RxnArrowMode.simple }\n  },\n  'reaction-arrow-equilibrium': {\n    title: 'Reaction Arrow Equilibrium Tool',\n    action: { tool: 'reactionarrow', opts: RxnArrowMode.equilibrium }\n  },\n  'reaction-plus': {\n    title: 'Reaction Plus Tool',\n    action: { tool: 'reactionplus' }\n  },\n  'reaction-map': {\n    title: 'Reaction Mapping Tool',\n    action: { tool: 'reactionmap' }\n  },\n  'reaction-unmap': {\n    title: 'Reaction Unmapping Tool',\n    action: { tool: 'reactionunmap' }\n  },\n  'rgroup-label': {\n    shortcut: 'Mod+r',\n    title: 'R-Group Label Tool',\n    action: { tool: 'rgroupatom' }\n  },\n  'rgroup-fragment': {\n    shortcut: ['Mod+Shift+r', 'Mod+r'],\n    title: 'R-Group Fragment Tool',\n    action: { tool: 'rgroupfragment' }\n  },\n  'rgroup-attpoints': {\n    shortcut: 'Mod+r',\n    title: 'Attachment Point Tool',\n    action: { tool: 'apoint' }\n  },\n  'shape-ellipse': {\n    title: 'Shape Ellipse',\n    action: { tool: 'simpleobject', opts: SimpleObjectMode.ellipse }\n  },\n  'shape-rectangle': {\n    title: 'Shape Rectangle',\n    action: { tool: 'simpleobject', opts: SimpleObjectMode.rectangle }\n  },\n  'shape-line': {\n    title: 'Shape Line',\n    action: { tool: 'simpleobject', opts: SimpleObjectMode.line }\n  },\n  text: {\n    title: 'Add text',\n    action: { tool: 'text' }\n  }\n}\n\nconst bondCuts = {\n  single: '1',\n  double: '2',\n  triple: '3',\n  up: '1',\n  down: '1',\n  updown: '1',\n  crossed: '2',\n  any: '0',\n  aromatic: '4'\n}\n\nconst typeSchema = bondSchema.properties.type\n\nexport default typeSchema.enum.reduce((res, type, i) => {\n  res[`bond-${type}`] = {\n    title: `${typeSchema.enumNames[i]} Bond`,\n    shortcut: bondCuts[type],\n    action: {\n      tool: 'bond',\n      opts: toBondType(type)\n    }\n  }\n  return res\n}, toolActions)\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { findIndex, findLastIndex } from 'lodash/fp'\n\nexport const zoomList = [\n  0.2,\n  0.3,\n  0.4,\n  0.5,\n  0.6,\n  0.7,\n  0.8,\n  0.9,\n  1,\n  1.1,\n  1.2,\n  1.3,\n  1.4,\n  1.5,\n  1.7,\n  2,\n  2.5,\n  3,\n  3.5,\n  4\n]\n\nexport default {\n  zoom: {\n    selected: editor => editor.zoom()\n  },\n  'zoom-out': {\n    shortcut: ['-', '_', 'Shift+-'],\n    title: 'Zoom Out',\n    disabled: editor => editor.zoom() <= zoomList[0], // unsave\n    action: editor => {\n      const zoom = editor.zoom()\n      const i = findIndex(z => z >= zoom, zoomList)\n      editor.zoom(zoomList[zoomList[i] === zoom && i > 0 ? i - 1 : i])\n    }\n  },\n  'zoom-in': {\n    shortcut: ['+', '=', 'Shift+='],\n    title: 'Zoom In',\n    disabled: editor => zoomList[zoomList.length - 1] <= editor.zoom(),\n    action: editor => {\n      const zoom = editor.zoom()\n      const i = findLastIndex(z => z <= zoom, zoomList)\n      editor.zoom(\n        zoomList[zoomList[i] === zoom && i < zoomList.length - 1 ? i + 1 : i]\n      )\n    }\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport atoms from './atoms'\nimport debug from './debug'\nimport { exec } from '../component/cliparea'\nimport server from './server'\nimport templates from './templates'\nimport tools from './tools'\nimport zoom from './zoom'\n\nexport * from './action.types'\n\nconst config = {\n  new: {\n    shortcut: 'Mod+Delete',\n    title: 'Clear Canvas',\n    action: {\n      thunk: (dispatch, getState) => {\n        const editor = getState().editor\n        if (!editor.struct().isBlank()) editor.struct(null)\n        dispatch({ type: 'ACTION', action: tools['select-lasso'].action })\n      }\n    }\n  },\n  open: {\n    shortcut: 'Mod+o',\n    title: 'Open…',\n    action: { dialog: 'open' }\n  },\n  save: {\n    shortcut: 'Mod+s',\n    title: 'Save As…',\n    action: { dialog: 'save' }\n  },\n  undo: {\n    shortcut: 'Mod+z',\n    title: 'Undo',\n    action: editor => {\n      editor.undo()\n    },\n    disabled: editor => editor.historySize().undo === 0\n  },\n  redo: {\n    shortcut: ['Mod+Shift+z', 'Mod+y'],\n    title: 'Redo',\n    action: editor => {\n      editor.redo()\n    },\n    disabled: editor => editor.historySize().redo === 0\n  },\n  cut: {\n    shortcut: 'Mod+x',\n    title: 'Cut',\n    action: () => {\n      exec('cut') || dontClipMessage('Cut') // eslint-disable-line no-unused-expressions\n    },\n    disabled: editor => !hasSelection(editor)\n  },\n  copy: {\n    shortcut: 'Mod+c',\n    title: 'Copy',\n    action: () => {\n      exec('copy') || dontClipMessage('Copy') // eslint-disable-line no-unused-expressions\n    },\n    disabled: editor => !hasSelection(editor)\n  },\n  paste: {\n    shortcut: 'Mod+v',\n    title: 'Paste',\n    action: () => {\n      exec('paste') || dontClipMessage('Paste') // eslint-disable-line no-unused-expressions\n    },\n    selected: ({ actions }) =>\n      actions && // TMP\n      actions.active &&\n      actions.active.tool === 'paste'\n  },\n  settings: {\n    title: 'Settings',\n    action: { dialog: 'settings' }\n  },\n  help: {\n    shortcut: ['?', '&', 'Shift+/'],\n    title: 'Help',\n    action: { dialog: 'help' }\n  },\n  about: {\n    title: 'About',\n    action: { dialog: 'about' }\n  },\n  'reaction-automap': {\n    title: 'Reaction Auto-Mapping Tool',\n    action: { dialog: 'automap' },\n    disabled: (editor, server, options) =>\n      !options.app.server || !editor.struct().hasRxnArrow()\n  },\n  'period-table': {\n    title: 'Periodic Table',\n    action: { dialog: 'period-table' }\n  },\n  'select-all': {\n    title: 'Select All',\n    shortcut: 'Mod+a',\n    action: {\n      thunk: (dispatch, getState) => {\n        getState().editor.selection('all')\n        const selectionTool = getState().toolbar.visibleTools.select\n        dispatch({ type: 'ACTION', action: tools[selectionTool].action })\n      }\n    }\n  },\n  'deselect-all': {\n    title: 'Deselect All',\n    shortcut: 'Mod+Shift+a',\n    action: editor => {\n      editor.selection(null)\n    }\n  },\n  'select-descriptors': {\n    title: 'Select descriptors',\n    shortcut: 'Mod+d',\n    action: {\n      thunk: (dispatch, getState) => {\n        const selectionTool = getState().toolbar.visibleTools.select\n        const editor = getState().editor\n        editor.alignDescriptors()\n        editor.selection('descriptors')\n        dispatch({ type: 'ACTION', action: tools[selectionTool].action })\n      }\n    }\n  },\n  ...server,\n  ...debug,\n  ...tools,\n  ...atoms,\n  ...zoom,\n  ...templates\n}\n\nfunction hasSelection(editor) {\n  const selection = editor.selection()\n  return (\n    selection && // if not only sgroupData selected\n    Object.keys(selection).filter(key => !['sgroupData'].includes(key)).length >\n      0\n  )\n}\n\nfunction dontClipMessage(title) {\n  //TODO: add error handler call\n  alert(\n    'This action is unavailable via menu.\\n' + // eslint-disable-line no-undef\n      'Instead, use shortcut to ' +\n      title +\n      '.'\n  )\n}\n\nexport default config\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { isEmpty, isEqual, pickBy } from 'lodash/fp'\n\nimport actions from '../../action'\n\nfunction execute(activeTool, { action, editor, server, options }) {\n  if (action.tool) {\n    if (editor.tool(action.tool, action.opts)) {\n      return action\n    }\n  } else if (typeof action === 'function') {\n    action(editor, server, options)\n  } else {\n    console.info('no action')\n  }\n  return activeTool\n}\n\nfunction selected(actObj, activeTool, { editor, server }) {\n  if (typeof actObj.selected === 'function')\n    return actObj.selected(editor, server)\n  else if (actObj.action && actObj.action.tool)\n    return isEqual(activeTool, actObj.action)\n  return false\n}\n\nfunction disabled(actObj, { editor, server, options }) {\n  if (typeof actObj.disabled === 'function')\n    return actObj.disabled(editor, server, options)\n  return false\n}\n\nfunction hidden(actObj, { options }) {\n  if (typeof actObj.hidden === 'function') return actObj.hidden(options)\n  return false\n}\n\nfunction status(actionName, activeTool, params) {\n  const actObj = actions[actionName]\n  return pickBy(x => x, {\n    selected: selected(actObj, activeTool, params),\n    disabled: disabled(actObj, params),\n    hidden: hidden(actObj, params)\n  })\n}\n\nexport default function (state = null, { type, action, ...params }) {\n  let activeTool\n  switch (type) {\n    case 'INIT':\n      action = actions['select-lasso'].action\n    case 'ACTION': // eslint-disable-line no-case-declarations\n      activeTool = execute(state && state.activeTool, {\n        ...params,\n        action\n      })\n    case 'UPDATE':\n      return Object.keys(actions).reduce(\n        (res, actionName) => {\n          const value = status(actionName, res.activeTool, params)\n          if (!isEmpty(value)) res[actionName] = value\n          return res\n        },\n        { activeTool: activeTool || state.activeTool }\n      )\n    default:\n      return state\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { formReducer, formsState } from './form'\n\nexport function openDialog(dispatch, dialogName, props) {\n  return new Promise((resolve, reject) => {\n    dispatch({\n      type: 'MODAL_OPEN',\n      data: {\n        name: dialogName,\n        prop: {\n          ...props,\n          onResult: resolve,\n          onCancel: reject\n        }\n      }\n    })\n  })\n}\n\nfunction modalReducer(state = null, action) {\n  const { type, data } = action\n\n  if (type === 'UPDATE_FORM') {\n    const formState = formReducer(state.form, action, state.name)\n    return { ...state, form: formState }\n  }\n\n  switch (type) {\n    case 'MODAL_CLOSE':\n      return null\n    case 'MODAL_OPEN':\n      return {\n        name: data.name,\n        form: formsState[data.name] || null,\n        prop: data.prop || null\n      }\n    default:\n      return state\n  }\n}\n\nexport default modalReducer\n","import { storage } from '../../storage-ext'\nimport { SdfSerializer, MolSerializer } from 'ketcher-core'\nimport { appUpdate } from '../options'\n\nexport function initLib(lib) {\n  return {\n    type: 'TMPL_INIT',\n    data: { lib }\n  }\n}\n\nexport default function initTmplLib(dispatch, baseUrl, cacheEl) {\n  const sdfSerializer = new SdfSerializer()\n  prefetchStatic(`${baseUrl}/templates/library.sdf`)\n    .then(text => {\n      const tmpls = sdfSerializer.deserialize(text)\n      const prefetch = prefetchRender(tmpls, baseUrl + '/templates/', cacheEl)\n\n      return prefetch.then(cachedFiles =>\n        tmpls.map(tmpl => {\n          const pr = prefetchSplit(tmpl)\n          if (pr.file)\n            tmpl.props.prerender =\n              cachedFiles.indexOf(pr.file) !== -1 ? `#${pr.id}` : ''\n\n          return tmpl\n        })\n      )\n    })\n    .then(res => {\n      const lib = res.concat(userTmpls())\n      dispatch(initLib(lib))\n      dispatch(appUpdate({ templates: true }))\n    })\n}\n\nfunction userTmpls() {\n  const userLib = storage.getItem('ketcher-tmpls')\n  if (!Array.isArray(userLib) || userLib.length === 0) return []\n  const molSerializer = new MolSerializer()\n  return userLib\n    .map(tmpl => {\n      try {\n        if (tmpl.props === '') tmpl.props = {}\n        tmpl.props.group = 'User Templates'\n\n        return {\n          struct: molSerializer.deserialize(tmpl.struct),\n          props: tmpl.props\n        }\n      } catch (ex) {\n        return null\n      }\n    })\n    .filter(tmpl => tmpl !== null)\n}\n\nfunction prefetchStatic(url) {\n  return fetch(url, { credentials: 'same-origin' }).then(resp => {\n    if (resp.ok) return resp.text()\n    throw Error('Could not fetch ' + url)\n  })\n}\n\nfunction prefetchSplit(tmpl) {\n  const pr = tmpl.props.prerender\n  const res = pr && pr.split('#', 2)\n\n  return {\n    file: pr && res[0],\n    id: pr && res[1]\n  }\n}\n\nfunction prefetchRender(tmpls, baseUrl, cacheEl) {\n  const files = tmpls.reduce((res, tmpl) => {\n    const file = prefetchSplit(tmpl).file\n\n    if (file && res.indexOf(file) === -1) res.push(file)\n\n    return res\n  }, [])\n\n  const fetch = Promise.all(\n    files.map(fn => prefetchStatic(baseUrl + fn).catch(() => null))\n  )\n\n  return fetch.then(svgs => {\n    svgs.forEach(svgContent => {\n      if (svgContent) cacheEl.innerHTML += svgContent\n    })\n\n    return files.filter((file, i) => !!svgs[i])\n  })\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport initTmplLib, { initLib } from './init-lib'\n\nimport { MolSerializer } from 'ketcher-core'\nimport { omit } from 'lodash/fp'\nimport { openDialog } from '../modal'\nimport { storage } from '../../storage-ext'\n\nexport { initTmplLib }\n\n/* TEMPLATES */\nexport function selectTmpl(tmpl) {\n  return {\n    type: 'TMPL_SELECT',\n    data: { selected: tmpl }\n  }\n}\n\nexport function changeGroup(group) {\n  return {\n    type: 'TMPL_CHANGE_GROUP',\n    data: { group, selected: null }\n  }\n}\n\nexport function changeFilter(filter) {\n  return {\n    type: 'TMPL_CHANGE_FILTER',\n    data: { filter: filter.trim(), selected: null } // TODO: change this\n  }\n}\n\n/* TEMPLATE-ATTACH-EDIT */\nexport function initAttach(name, attach) {\n  return {\n    type: 'INIT_ATTACH',\n    data: {\n      name,\n      atomid: attach.atomid,\n      bondid: attach.bondid\n    }\n  }\n}\n\nexport function setAttachPoints(attach) {\n  return {\n    type: 'SET_ATTACH_POINTS',\n    data: {\n      atomid: attach.atomid,\n      bondid: attach.bondid\n    }\n  }\n}\n\nexport function setTmplName(name) {\n  return {\n    type: 'SET_TMPL_NAME',\n    data: { name }\n  }\n}\n\nexport function editTmpl(tmpl) {\n  return (dispatch, getState) => {\n    openDialog(dispatch, 'attach', { tmpl })\n      .then(\n        ({ name, attach }) => {\n          tmpl.struct.name = name\n          tmpl.props = Object.assign({}, tmpl.props, attach)\n\n          if (tmpl.props.group === 'User Templates')\n            updateLocalStore(getState().templates.lib)\n        },\n        () => null\n      )\n      .then(() => openDialog(dispatch, 'templates').catch(() => null))\n  }\n}\n\nexport function deleteUserTmpl(tmpl) {\n  return {\n    type: 'TMPL_DELETE',\n    data: {\n      tmpl: tmpl\n    }\n  }\n}\n\nexport function deleteTmpl(tmpl) {\n  return (dispatch, getState) => {\n    const lib = getState().templates.lib.filter(value => value !== tmpl)\n    dispatch(deleteUserTmpl(tmpl))\n    updateLocalStore(lib)\n  }\n}\n\n/* SAVE */\nexport function saveUserTmpl(struct) {\n  // TODO: structStr can be not in mol format => structformat.toString ...\n  const tmpl = { struct: struct.clone(), props: {} }\n\n  return (dispatch, getState) => {\n    openDialog(dispatch, 'attach', { tmpl })\n      .then(({ name, attach }) => {\n        tmpl.struct.name = name\n        tmpl.props = { ...attach, group: 'User Templates' }\n\n        const lib = getState().templates.lib.concat(tmpl)\n        dispatch(initLib(lib))\n        updateLocalStore(lib)\n      })\n      .catch(() => null)\n  }\n}\n\nfunction updateLocalStore(lib) {\n  const molSerializer = new MolSerializer()\n  const userLib = lib\n    .filter(item => item.props.group === 'User Templates')\n    .map(item => ({\n      struct: molSerializer.serialize(item.struct),\n      props: Object.assign({}, omit(['group'], item.props))\n    }))\n\n  storage.setItem('ketcher-tmpls', userLib)\n}\n\n/* REDUCER */\nexport const initTmplsState = {\n  lib: [],\n  selected: null,\n  filter: '',\n  group: null,\n  attach: {}\n}\n\nconst tmplActions = [\n  'TMPL_INIT',\n  'TMPL_SELECT',\n  'TMPL_CHANGE_GROUP',\n  'TMPL_CHANGE_FILTER'\n]\n\nconst attachActions = ['INIT_ATTACH', 'SET_ATTACH_POINTS', 'SET_TMPL_NAME']\n\nfunction templatesReducer(state = initTmplsState, action) {\n  if (tmplActions.includes(action.type))\n    return Object.assign({}, state, action.data)\n\n  if (attachActions.includes(action.type)) {\n    const attach = Object.assign({}, state.attach, action.data)\n    return { ...state, attach }\n  }\n\n  if (action.type === 'TMPL_DELETE') {\n    const currentState = Object.assign({}, state)\n    const lib = currentState.lib.filter(value => value !== action.data.tmpl)\n    return { ...currentState, lib: lib }\n  }\n\n  return state\n}\n\nexport default templatesReducer\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { capitalize, isEqual, throttle } from 'lodash/fp'\n\nimport { basicAtoms } from '../../action/atoms'\nimport tools from '../../action/tools'\n\nconst initial = {\n  freqAtoms: [],\n  currentAtom: 0,\n  opened: null,\n  visibleTools: {\n    select: 'select-lasso'\n  }\n}\nconst MAX_ATOMS = 7\n\nfunction updateVisibleTools(visibleTool, activeTool) {\n  const regExp = /(bond)(-)(common|stereo|query)/\n  const menuHeight = window.innerHeight\n\n  return Object.keys(visibleTool).reduce(\n    (res, key) => {\n      if (key === 'bond' && menuHeight > 700) return res // TODO remove me after update styles\n      if (key === 'transform' && menuHeight > 800) return res\n      if (key === 'rgroup' && menuHeight > 850) return res\n      if (key === 'shape' && menuHeight > 900) return res\n      if (!key.match(regExp) || menuHeight > 700) res[key] = visibleTool[key]\n      return res\n    },\n    { ...activeTool }\n  )\n}\n\nexport function initResize() {\n  return function (dispatch, getState) {\n    const onResize = throttle(250, () => {\n      const state = getState()\n      state.editor.render.update()\n      dispatch({ type: 'CLEAR_VISIBLE', data: state.actionState.activeTool })\n    })\n    addEventListener('resize', onResize) // eslint-disable-line\n  }\n}\n\n/* REDUCER */\nexport default function (state = initial, action) {\n  const { type, data } = action\n\n  switch (type) {\n    case 'ACTION': {\n      const visibleTool = toolInMenu(action.action)\n      return visibleTool\n        ? {\n            ...state,\n            opened: null,\n            visibleTools: { ...state.visibleTools, ...visibleTool }\n          }\n        : { ...state, opened: null }\n    }\n    case 'ADD_ATOMS': {\n      const newState = addFreqAtom(data, state.freqAtoms, state.currentAtom)\n      return { ...state, ...newState }\n    }\n    case 'CLEAR_VISIBLE': {\n      const activeTool = toolInMenu(action.data)\n      const correctTools = updateVisibleTools(state.visibleTools, activeTool)\n      return { ...state, opened: null, visibleTools: { ...correctTools } }\n    }\n    case 'OPENED': {\n      return data.isSelected && state.opened\n        ? { ...state, opened: null }\n        : { ...state, opened: data.menuName }\n    }\n    case 'UPDATE':\n      return { ...state, opened: null }\n    case 'MODAL_OPEN':\n      return { ...state, opened: null }\n    default:\n      return state\n  }\n}\n/* ------- */\n\nfunction addFreqAtom(label, freqAtoms, index) {\n  label = capitalize(label)\n  if (basicAtoms.indexOf(label) > -1 || freqAtoms.indexOf(label) !== -1)\n    return { freqAtoms }\n\n  freqAtoms[index] = label\n  index = (index + 1) % MAX_ATOMS\n\n  return { freqAtoms, currentAtom: index }\n}\n\nexport function addAtoms(atomLabel) {\n  return {\n    type: 'ADD_ATOMS',\n    data: atomLabel\n  }\n}\n\nfunction toolInMenu(action) {\n  const tool = Object.keys(tools).find(toolName =>\n    isEqual(action, tools[toolName].action)\n  )\n\n  const sel = document.getElementById(tool)\n  const dropdown = sel && hiddenAncestor(sel)\n\n  return dropdown && dropdown.id !== '' ? { [dropdown.id]: sel.id } : null\n}\n\nexport function hiddenAncestor(el, base) {\n  base = base || document.body\n  let findEl = el\n\n  while (\n    findEl &&\n    window.getComputedStyle(findEl).overflow !== 'hidden' &&\n    !findEl.classList.contains('opened')\n  ) {\n    if (findEl === base) return null\n    findEl = findEl.parentNode\n  }\n\n  return findEl\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { pick } from 'lodash/fp'\n\nimport { createStore, combineReducers, applyMiddleware } from 'redux'\nimport thunk from 'redux-thunk'\nimport { logger } from 'redux-logger'\n\nimport actionStateReducer from './action'\nimport modalReducer from './modal'\nimport optionsReducer, { initOptionsState } from './options'\nimport templatesReducer, { initTmplsState } from './templates'\nimport toolbarReducer from './toolbar'\nimport requestReducer from './request'\n\nimport { onAction, load } from './shared'\n\nexport { onAction, load }\n\nconst shared = combineReducers({\n  actionState: actionStateReducer,\n  toolbar: toolbarReducer,\n  modal: modalReducer,\n  server: (store = null) => store,\n  editor: (store = null) => store,\n  options: optionsReducer,\n  templates: templatesReducer,\n  requestsStatuses: requestReducer\n})\n\nfunction getRootReducer(setEditor) {\n  return function root(state, action) {\n    switch (\n      action.type // eslint-disable-line default-case\n    ) {\n      case 'INIT':\n        setEditor(action.editor)\n\n      case 'UPDATE': // eslint-disable-line no-case-declarations\n        const { type, ...data } = action\n        if (data) state = { ...state, ...data }\n    }\n\n    const sh = shared(state, {\n      ...action,\n      ...pick(['editor', 'server', 'options'], state)\n    })\n\n    const finalState =\n      sh === state.shared\n        ? state\n        : {\n            ...state,\n            ...sh\n          }\n\n    //TODO: temporary solution. Need to review work with redux store\n    global.currentState = finalState\n    return finalState\n  }\n}\n\nexport default function (options, server, setEditor) {\n  const { buttons = {}, ...restOptions } = options\n\n  // TODO: redux localStorage here\n  const initState = {\n    actionState: null,\n    editor: null,\n    modal: null,\n    options: Object.assign(initOptionsState, { app: restOptions, buttons }),\n    server: server || Promise.reject(new Error('Standalone mode!')),\n    templates: initTmplsState\n  }\n\n  const middleware = [thunk]\n\n  if (process.env.NODE_ENV !== 'production') middleware.push(logger)\n\n  const rootReducer = getRootReducer(setEditor)\n  return createStore(rootReducer, initState, applyMiddleware(...middleware))\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport * as KN from 'w3c-keyname'\n\nconst mac =\n  typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false // eslint-disable-line no-undef\n\nfunction normalizeKeyName(name) {\n  const parts = name.split(/\\+(?!$)/)\n  let result = parts[parts.length - 1]\n  if (result === 'Space') result = ' '\n  let alt\n  let ctrl\n  let shift\n  let meta\n\n  for (let i = 0; i < parts.length - 1; i++) {\n    const mod = parts[i]\n    if (/^(cmd|meta|m)$/i.test(mod)) meta = true\n    else if (/^a(lt)?$/i.test(mod)) alt = true\n    else if (/^(c|ctrl|control)$/i.test(mod)) ctrl = true\n    else if (/^s(hift)?$/i.test(mod)) shift = true\n    else if (/^mod$/i.test(mod))\n      if (mac) meta = true\n      else ctrl = true\n    else throw new Error('Unrecognized modifier name: ' + mod)\n  }\n\n  if (alt) result = 'Alt+' + result\n  if (ctrl) result = 'Ctrl+' + result\n  if (meta) result = 'Meta+' + result\n  if (shift) result = 'Shift+' + result\n\n  return result\n}\n\nfunction normalizeKeyMap(map) {\n  const copy = Object.create(null)\n\n  Object.keys(map).forEach(prop => {\n    copy[normalizeKeyName(prop)] = map[prop]\n  })\n\n  return copy\n}\n\nfunction modifiers(name, event, shift) {\n  if (event.altKey) name = 'Alt+' + name\n  if (event.ctrlKey) name = 'Ctrl+' + name\n  if (event.metaKey) name = 'Meta+' + name\n  if (shift !== false && event.shiftKey) name = 'Shift+' + name\n\n  return name\n}\n\nfunction rusToEng(name, event) {\n  return name\n    .replace(/[а-я]/, KN.base[event.keyCode])\n    .replace(/[А-Я]/, KN.shift[event.keyCode])\n}\n\nfunction normalizeKeyEvent(event, base = false) {\n  const name = rusToEng(KN.keyName(event), event)\n  const isChar = name.length === 1 && name !== ' '\n\n  return isChar && !base\n    ? modifiers(name, event, !isChar)\n    : modifiers(KN.base[event.keyCode], event, true)\n}\n\nfunction keyNorm(obj) {\n  if (obj instanceof KeyboardEvent)\n    // eslint-disable-line no-undef\n    return normalizeKeyEvent(...arguments) // eslint-disable-line prefer-rest-params\n\n  return typeof obj === 'object' ? normalizeKeyMap(obj) : normalizeKeyName(obj)\n}\n\nfunction lookup(map, event) {\n  let name = rusToEng(KN.keyName(event), event)\n  if (name === 'Add') name = '+' // numpad '+' and '-'\n  if (name === 'Subtract') name = '-'\n\n  const isChar = name.length === 1 && name !== ' '\n  let res = map[modifiers(name, event, !isChar)]\n  let baseName\n\n  if (event.shiftKey && isChar && (baseName = KN.base[event.keyCode]))\n    res = map[modifiers(baseName, event, true)] || res\n\n  return res\n}\n\nkeyNorm.lookup = lookup\n\nexport default keyNorm\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport * as clipArea from '../component/cliparea'\n\nimport { KetSerializer, MolSerializer, formatProperties } from 'ketcher-core'\nimport { debounce, isEqual } from 'lodash/fp'\nimport { load, onAction } from './shared'\n\nimport actions from '../action'\nimport keyNorm from '../data/convert/keynorm'\nimport { openDialog } from './modal'\n\nexport function initKeydownListener(element) {\n  return function (dispatch, getState) {\n    const hotKeys = initHotKeys()\n    element.addEventListener('keydown', event =>\n      keyHandle(dispatch, getState(), hotKeys, event)\n    )\n  }\n}\n\n/* HotKeys */\nfunction keyHandle(dispatch, state, hotKeys, event) {\n  if (state.modal) return\n\n  const editor = state.editor\n  const actionState = state.actionState\n  const actionTool = actionState.activeTool\n\n  const key = keyNorm(event)\n  const atomsSelected = editor.selection() && editor.selection().atoms\n\n  let group = null\n\n  if (key && key.length === 1 && atomsSelected && key.match(/\\w/)) {\n    console.assert(atomsSelected.length > 0)\n    openDialog(dispatch, 'labelEdit', { letter: key })\n      .then(res => {\n        dispatch(onAction({ tool: 'atom', opts: res }))\n      })\n      .catch(() => null)\n    event.preventDefault()\n  } else if ((group = keyNorm.lookup(hotKeys, event)) !== undefined) {\n    let index = checkGroupOnTool(group, actionTool) // index currentTool in group || -1\n    index = (index + 1) % group.length\n\n    const actName = group[index]\n    if (actionState[actName] && actionState[actName].disabled === true) {\n      event.preventDefault()\n      return\n    }\n    if (clipArea.actions.indexOf(actName) === -1) {\n      const newAction = actions[actName].action\n      dispatch(onAction(newAction))\n      event.preventDefault()\n    } else if (window.clipboardData) {\n      // IE support\n      clipArea.exec(event)\n    }\n  }\n}\n\nfunction setHotKey(key, actName, hotKeys) {\n  if (Array.isArray(hotKeys[key])) hotKeys[key].push(actName)\n  else hotKeys[key] = [actName]\n}\n\nfunction initHotKeys() {\n  const hotKeys = {}\n  let act\n\n  Object.keys(actions).forEach(actName => {\n    act = actions[actName]\n    if (!act.shortcut) return\n\n    if (Array.isArray(act.shortcut)) {\n      act.shortcut.forEach(key => {\n        setHotKey(key, actName, hotKeys)\n      })\n    } else {\n      setHotKey(act.shortcut, actName, hotKeys)\n    }\n  })\n\n  return keyNorm(hotKeys)\n}\n\nfunction checkGroupOnTool(group, actionTool) {\n  let index = group.indexOf(actionTool.tool)\n\n  group.forEach((actName, i) => {\n    if (isEqual(actions[actName].action, actionTool)) index = i\n  })\n\n  return index\n}\n\nconst rxnTextPlain = /\\$RXN\\n+\\s+0\\s+0\\s+0\\n*/\n\n/* ClipArea */\nexport function initClipboard(dispatch, getState) {\n  const formats = Object.keys(formatProperties).map(\n    format => formatProperties[format].mime\n  )\n\n  const debAction = debounce(0, action => dispatch(onAction(action)))\n  const loadStruct = debounce(0, (structStr, opts) =>\n    dispatch(load(structStr, opts))\n  )\n\n  return {\n    formats,\n    focused() {\n      const state = global.currentState\n      return !state.modal\n    },\n    onCut() {\n      const state = global.currentState\n      const editor = state.editor\n      const data = clipData(editor)\n      if (data) debAction({ tool: 'eraser', opts: 1 })\n      else editor.selection(null)\n      return data\n    },\n    onCopy() {\n      const state = global.currentState\n      const editor = state.editor\n      const data = clipData(editor)\n      editor.selection(null)\n      return data\n    },\n    onPaste(data) {\n      const structStr =\n        data['application/json'] ||\n        data['chemical/x-mdl-molfile'] ||\n        data['chemical/x-mdl-rxnfile'] ||\n        data['text/plain']\n\n      if (structStr || !rxnTextPlain.test(data['text/plain']))\n        loadStruct(structStr, { fragment: true })\n    }\n  }\n}\n\nfunction clipData(editor) {\n  const res = {}\n  const struct = editor.structSelected()\n\n  if (struct.isBlank()) return null\n  const molSerializer = new MolSerializer()\n  try {\n    const serializer = new KetSerializer()\n    const graph = serializer.serialize(struct)\n    res['application/json'] = graph\n\n    const type = struct.isReaction\n      ? 'chemical/x-mdl-molfile'\n      : 'chemical/x-mdl-rxnfile'\n    const data = molSerializer.serialize(struct)\n    res['text/plain'] = data\n    res[type] = data\n\n    // res['chemical/x-daylight-smiles'] = smiles.stringify(struct);\n    return res\n  } catch (ex) {\n    //TODO: add error handler call\n    alert(ex)\n  }\n\n  return null\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { connect } from 'react-redux'\nimport ClipArea from '../component/cliparea'\nimport { initClipboard } from '../state/hotkeys'\n\nconst AppClipArea = connect(null, dispatch => dispatch(initClipboard))(ClipArea)\n\nexport default AppClipArea\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  fromBond,\n  fromElement,\n  fromSgroup,\n  fromStereoLabel,\n  toBond,\n  toElement,\n  toSgroup,\n  toStereoLabel\n} from '../../data/convert/structconv'\n\nimport { Elements } from 'ketcher-core'\nimport acts from '../../action'\nimport { debounce } from 'lodash/fp'\nimport { onAction } from '../shared'\nimport { openDialog } from '../modal'\nimport { serverCall } from '../server'\n\nexport default function initEditor(dispatch, getState) {\n  const updateAction = debounce(100, () => dispatch({ type: 'UPDATE' }))\n  const sleep = time => new Promise(resolve => setTimeout(resolve, time))\n\n  function resetToSelect(dispatch) {\n    // eslint-disable-line no-shadow\n    const state = global.currentState\n    const activeTool = state.actionState.activeTool.tool\n    if (activeTool === 'select') return\n    const selectMode = state.toolbar.visibleTools.select\n    const resetOption = state.options.settings.resetToSelect\n    if (resetOption === true || resetOption === activeTool)\n      // example: 'paste'\n      dispatch({ type: 'ACTION', action: acts[selectMode].action })\n    else updateAction()\n  }\n\n  return {\n    onInit: editor => {\n      dispatch({ type: 'INIT', editor })\n    },\n    onChange: action => {\n      if (action === undefined) sleep(0).then(() => dispatch(resetToSelect))\n      // new tool in reducer\n      else dispatch(resetToSelect)\n    },\n    onSelectionChange: () => {\n      updateAction()\n    },\n    onElementEdit: selem => {\n      const elem = selem.type === 'text' ? selem : fromElement(selem)\n      let dlg = null\n      if (elem.type === 'text') {\n        // TODO: move textdialog opening logic to another place\n        return openDialog(dispatch, 'text', elem)\n      } else if (Elements.get(elem.label)) {\n        dlg = openDialog(dispatch, 'atomProps', elem)\n      } else if (Object.keys(elem).length === 1 && 'ap' in elem) {\n        dlg = openDialog(dispatch, 'attachmentPoints', elem.ap).then(res => ({\n          ap: res\n        }))\n      } else if (elem.type === 'list' || elem.type === 'not-list') {\n        dlg = openDialog(dispatch, 'period-table', elem)\n      } else if (elem.type === 'rlabel') {\n        const rgroups = getState().editor.struct().rgroups\n        const params = {\n          type: 'atom',\n          values: elem.values,\n          disabledIds: Array.from(rgroups.entries()).reduce(\n            (acc, [rgid, rg]) => {\n              if (rg.frags.has(elem.fragId)) acc.push(rgid)\n\n              return acc\n            },\n            []\n          )\n        }\n        dlg = openDialog(dispatch, 'rgroup', params).then(res => ({\n          values: res.values,\n          type: 'rlabel'\n        }))\n      } else {\n        dlg = openDialog(dispatch, 'period-table', elem)\n      }\n      return dlg.then(toElement)\n    },\n\n    // TODO: correct\n    onEnhancedStereoEdit: ({ ...init }) =>\n      sleep(0).then(() => {\n        init = fromStereoLabel(init.stereoLabel)\n        return openDialog(dispatch, 'enhancedStereo', {\n          init\n        }).then(res => toStereoLabel(res), () => null)\n      }),\n\n    onQuickEdit: atom => openDialog(dispatch, 'labelEdit', atom),\n    onBondEdit: bond =>\n      openDialog(dispatch, 'bondProps', fromBond(bond)).then(toBond),\n    onRgroupEdit: rgroup => {\n      const struct = getState().editor.struct()\n\n      if (Object.keys(rgroup).length > 2) {\n        const rgroupLabels = Array.from(struct.rgroups.keys())\n        if (!rgroup.range) rgroup.range = '>0'\n\n        return openDialog(\n          dispatch,\n          'rgroupLogic',\n          Object.assign({ rgroupLabels }, rgroup)\n        )\n      }\n\n      const disabledIds = Array.from(struct.atoms.values()).reduce(\n        (acc, atom) => {\n          if (atom.fragment === rgroup.fragId && atom.rglabel !== null)\n            return acc.concat(fromElement(atom).values)\n\n          return acc\n        },\n        []\n      )\n      const params = {\n        type: 'fragment',\n        values: [rgroup.label],\n        disabledIds\n      }\n      return openDialog(dispatch, 'rgroup', params).then(res => ({\n        label: res.values[0]\n      }))\n    },\n    onSgroupEdit: sgroup =>\n      sleep(0) // huck to open dialog after dispatch sgroup tool action\n        .then(() => openDialog(dispatch, 'sgroup', fromSgroup(sgroup)))\n        .then(toSgroup),\n    onSdataEdit: sgroup =>\n      sleep(0)\n        .then(() =>\n          openDialog(\n            dispatch,\n            sgroup.type === 'DAT' ? 'sdata' : 'sgroup',\n            fromSgroup(sgroup)\n          )\n        )\n        .then(toSgroup),\n    onMessage: msg => {\n      if (msg.error) {\n        //TODO: add error handler call\n      }\n    },\n    onAromatizeStruct: struct => {\n      const state = getState()\n      const serverOpts = state.options.getServerSettings()\n      return serverCall(\n        state.editor,\n        state.server,\n        'aromatize',\n        serverOpts,\n        struct\n      )\n    },\n    onDearomatizeStruct: struct => {\n      const state = getState()\n      const serverOpts = state.options.getServerSettings()\n      return serverCall(\n        state.editor,\n        state.server,\n        'dearomatize',\n        serverOpts,\n        struct\n      )\n    },\n    onMouseDown: () => {\n      updateAction()\n    }\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport * as KN from 'w3c-keyname'\n\nimport React, {FC, useEffect, useRef} from 'react'\n\nimport clsx from 'clsx'\nimport styles from './Dialog.module.less'\n\ninterface DialogProps {\n  title: string\n  params: DialogParams\n  buttons?: Array<string | React.ReactElement>\n  className: string\n}\nexport interface DialogParams extends DialogParamsCallProps {\n  className?: string\n}\n\ninterface DialogParamsCallProps {\n  onCancel: () => void\n  onOk: (result: any) => void\n}\n\ninterface DialogCallProps {\n  result: () => any\n  valid?: () => boolean\n}\n\ntype Props = DialogProps & DialogCallProps\n\nconst Dialog: FC<Props> = props => {\n  const {\n    children,\n    title,\n    params,\n    result = () => null,\n    valid = () => !!result(),\n    buttons = ['Cancel', 'OK'],\n    className,\n    ...rest\n  } = props\n  const dialogRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    (dialogRef.current as any).focus()\n    return () => {\n      (dialogRef.current\n          ?.closest('.editor')\n          ?.getElementsByClassName('cliparea')[0] as any).focus()\n    }\n  }, [])\n\n  const exit = mode => {\n    const key = mode === 'OK' ? 'onOk' : 'onCancel'\n    if (params && key in params && (key !== 'onOk' || valid()))\n      params[key](result())\n  }\n\n  const keyDown = event => {\n    const key = KN.keyName(event)\n    const active = document.activeElement\n    const activeTextarea = active && active.tagName === 'TEXTAREA'\n    if (key === 'Escape' || (key === 'Enter' && !activeTextarea)) {\n      exit(key === 'Enter' ? 'OK' : 'Cancel')\n      event.preventDefault()\n      event.stopPropagation()\n    }\n  }\n\n  return (\n    <div\n      ref={dialogRef}\n      role=\"dialog\"\n      onSubmit={event => event.preventDefault()}\n      onKeyDown={keyDown}\n      tabIndex={-1}\n      className={clsx(styles.form, className, params.className)}\n      {...rest}>\n      <header>\n        {title}\n        {title && (\n          <button className={styles.close} onClick={() => exit('Cancel')}>\n            ×\n          </button>\n        )}\n      </header>\n      <div className={styles.dialog_body}>{children}</div>\n\n      <footer>\n        {buttons.map(button =>\n          typeof button !== 'string' ? (\n            button\n          ) : (\n            <input\n              key={button}\n              type=\"button\"\n              value={button}\n              disabled={button === 'OK' && !valid()}\n              onClick={() => exit(button)}\n            />\n          )\n        )}\n      </footer>\n    </div>\n  )\n}\n\nexport default Dialog\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { AlignDescriptors, CanvasLoad } from '../operations'\n\nimport Action from '../shared/action'\n\nexport function fromNewCanvas(restruct, struct) {\n  var action = new Action()\n\n  action.addOp(new CanvasLoad(struct))\n  return action.perform(restruct)\n}\n\nexport function fromDescriptorsAlign(restruct) {\n  const action = new Action()\n  action.addOp(new AlignDescriptors(restruct))\n  return action.perform(restruct)\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { fromAtomsAttrs } from '../actions/atom'\n\nfunction APointTool(editor) {\n  if (!(this instanceof APointTool)) return new APointTool(editor)\n\n  this.editor = editor\n  this.editor.selection(null)\n}\n\nAPointTool.prototype.mousemove = function (event) {\n  this.editor.hover(this.editor.findItem(event, ['atoms']))\n}\n\nAPointTool.prototype.click = function (event) {\n  var editor = this.editor\n  var struct = editor.render.ctab.molecule\n  var ci = editor.findItem(event, ['atoms'])\n\n  if (ci && ci.map === 'atoms') {\n    this.editor.hover(null)\n    var atom = struct.atoms.get(ci.id)\n    var res = editor.event.elementEdit.dispatch({\n      attpnt: atom.attpnt\n    })\n    Promise.resolve(res)\n      .then(newatom => {\n        if (atom.attpnt !== newatom.attpnt) {\n          var action = fromAtomsAttrs(editor.render.ctab, ci.id, newatom)\n          editor.update(action)\n        }\n      })\n      .catch(() => null) // w/o changes\n    return true\n  }\n  return true\n}\n\nexport default APointTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Atom, Bond } from 'ketcher-core'\nimport { fromAtomAddition, fromAtomsAttrs } from '../actions/atom'\n\nimport { fromBondAddition } from '../actions/bond'\nimport utils from '../shared/utils'\n\nfunction AtomTool(editor, atomProps) {\n  if (!(this instanceof AtomTool)) {\n    if (!editor.selection() || !editor.selection().atoms)\n      return new AtomTool(editor, atomProps)\n\n    const action = fromAtomsAttrs(\n      editor.render.ctab,\n      editor.selection().atoms,\n      atomProps,\n      true\n    )\n    editor.update(action)\n    editor.selection(null)\n    return null\n  }\n\n  this.editor = editor\n  this.atomProps = atomProps\n  this.bondProps = { type: 1, stereo: Bond.PATTERN.STEREO.NONE }\n}\n\nAtomTool.prototype.mousedown = function (event) {\n  this.editor.hover(null)\n  this.editor.selection(null)\n  const ci = this.editor.findItem(event, ['atoms'])\n\n  if (!ci) {\n    // ci.type == 'Canvas'\n    this.dragCtx = {}\n  } else if (ci.map === 'atoms') {\n    this.dragCtx = { item: ci }\n  }\n}\n\nAtomTool.prototype.mousemove = function (event) {\n  const rnd = this.editor.render\n  if (!this.dragCtx || !this.dragCtx.item) {\n    this.editor.hover(this.editor.findItem(event, ['atoms']))\n    return\n  }\n\n  const dragCtx = this.dragCtx\n  const ci = this.editor.findItem(event, ['atoms'])\n\n  if (ci && ci.map === 'atoms' && ci.id === dragCtx.item.id) {\n    // fromAtomsAttrs\n    this.editor.hover(this.editor.findItem(event, ['atoms']))\n    return\n  }\n\n  // fromAtomAddition\n  const atom = rnd.ctab.molecule.atoms.get(dragCtx.item.id)\n  let angle = utils.calcAngle(atom.pp, rnd.page2obj(event))\n  if (!event.ctrlKey) angle = utils.fracAngle(angle)\n  const degrees = utils.degrees(angle)\n  this.editor.event.message.dispatch({ info: degrees + 'º' })\n  const newAtomPos = utils.calcNewAtomPos(\n    atom.pp,\n    rnd.page2obj(event),\n    event.ctrlKey\n  )\n  if (dragCtx.action) dragCtx.action.perform(rnd.ctab)\n\n  dragCtx.action = fromBondAddition(\n    rnd.ctab,\n    this.bondProps,\n    dragCtx.item.id,\n    Object.assign({}, this.atomProps),\n    newAtomPos,\n    newAtomPos\n  )[0]\n  this.editor.update(dragCtx.action, true)\n}\n\nAtomTool.prototype.mouseup = function (event) {\n  if (this.dragCtx) {\n    const dragCtx = this.dragCtx\n    const rnd = this.editor.render\n\n    this.editor.update(\n      dragCtx.action ||\n        (dragCtx.item\n          ? fromAtomsAttrs(rnd.ctab, dragCtx.item.id, this.atomProps, true)\n          : fromAtomAddition(rnd.ctab, rnd.page2obj(event), this.atomProps))\n    )\n\n    delete this.dragCtx\n  }\n  this.editor.event.message.dispatch({\n    info: false\n  })\n}\n\nexport function atomLongtapEvent(tool, render) {\n  const dragCtx = tool.dragCtx\n  const editor = tool.editor\n\n  const atomid = dragCtx.item && dragCtx.item.id\n\n  // edit atom or add atom\n  const atom =\n    atomid !== undefined && atomid !== null\n      ? render.ctab.molecule.atoms.get(atomid)\n      : new Atom({ label: '' })\n\n  // TODO: longtab event\n  dragCtx.timeout = setTimeout(() => {\n    delete tool.dragCtx\n    editor.selection(null)\n    const res = editor.event.quickEdit.dispatch(atom)\n    Promise.resolve(res)\n      .then(newatom => {\n        const action = atomid\n          ? fromAtomsAttrs(render.ctab, atomid, newatom)\n          : fromAtomAddition(render.ctab, dragCtx.xy0, newatom)\n        editor.update(action)\n      })\n      .catch(() => null) // w/o changes\n  }, 750)\n\n  dragCtx.stopTapping = function () {\n    if (dragCtx.timeout) {\n      clearTimeout(dragCtx.timeout)\n      delete dragCtx.timeout\n    }\n  }\n}\n\nexport default AtomTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Elements } from 'ketcher-core'\n\nfunction AttachTool(editor, attachPoints) {\n  if (!(this instanceof AttachTool)) return new AttachTool(editor, attachPoints)\n\n  this.attach = {\n    atomid: attachPoints.atomid || 0,\n    bondid: attachPoints.bondid || 0\n  }\n  this.editor = editor\n\n  this.editor.selection({\n    atoms: [this.attach.atomid],\n    bonds: [this.attach.bondid]\n  })\n}\n\nAttachTool.prototype.mousemove = function (event) {\n  const rnd = this.editor.render\n\n  const ci = this.editor.findItem(event, ['atoms', 'bonds'])\n  const struct = rnd.ctab.molecule\n  if (\n    ci &&\n    ((ci.map === 'atoms' && Elements.get(struct.atoms.get(ci.id)?.label)) ||\n      ci.map === 'bonds')\n  )\n    this.editor.hover(ci)\n  else this.editor.hover(null)\n  return true\n}\n\nAttachTool.prototype.click = function (event) {\n  const editor = this.editor\n  const rnd = editor.render\n  const struct = rnd.ctab.molecule\n  const ci = editor.findItem(event, ['atoms', 'bonds'])\n\n  if (\n    ci &&\n    ((ci.map === 'atoms' && Elements.get(struct.atoms.get(ci.id)?.label)) ||\n      ci.map === 'bonds')\n  ) {\n    if (ci.map === 'atoms') this.attach.atomid = ci.id\n    else this.attach.bondid = ci.id\n\n    this.editor.selection({\n      atoms: [this.attach.atomid],\n      bonds: [this.attach.bondid]\n    })\n    this.editor.event.attachEdit.dispatch(this.attach)\n  }\n  return true\n}\n\nexport default AttachTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Bond, Vec2 } from 'ketcher-core'\nimport {\n  bondChangingAction,\n  fromBondAddition,\n  fromBondsAttrs\n} from '../actions/bond'\n\nimport utils from '../shared/utils'\n\nfunction BondTool(editor, bondProps) {\n  if (!(this instanceof BondTool)) {\n    if (!editor.selection() || !editor.selection().bonds)\n      return new BondTool(editor, bondProps)\n\n    const action = fromBondsAttrs(\n      editor.render.ctab,\n      editor.selection().bonds,\n      bondProps\n    )\n    editor.update(action)\n    editor.selection(null)\n    return null\n  }\n\n  this.editor = editor\n  this.atomProps = { label: 'C' }\n  this.bondProps = bondProps\n}\n\nBondTool.prototype.mousedown = function (event) {\n  const rnd = this.editor.render\n  this.editor.hover(null)\n  this.editor.selection(null)\n  this.dragCtx = {\n    xy0: rnd.page2obj(event),\n    item: this.editor.findItem(event, ['atoms', 'bonds'])\n  }\n  if (!this.dragCtx.item)\n    // ci.type == 'Canvas'\n    delete this.dragCtx.item\n  return true\n}\n\nBondTool.prototype.mousemove = function (event) {\n  // eslint-disable-line max-statements\n  const editor = this.editor\n  const rnd = editor.render\n  if ('dragCtx' in this) {\n    const dragCtx = this.dragCtx\n\n    const pos = rnd.page2obj(event)\n    let angle = utils.calcAngle(dragCtx.xy0, pos)\n    if (!event.ctrlKey) angle = utils.fracAngle(angle)\n\n    const degrees = utils.degrees(angle)\n    this.editor.event.message.dispatch({ info: degrees + 'º' })\n\n    if (!('item' in dragCtx) || dragCtx.item.map === 'atoms') {\n      if ('action' in dragCtx) dragCtx.action.perform(rnd.ctab)\n      let i1\n      let i2\n      let p1\n      let p2\n      if ('item' in dragCtx && dragCtx.item.map === 'atoms') {\n        // first mousedown event intersect with any atom\n        i1 = dragCtx.item.id\n        i2 = editor.findItem(event, ['atoms'], dragCtx.item)\n      } else {\n        // first mousedown event intersect with any canvas\n        i1 = this.atomProps\n        p1 = dragCtx.xy0\n        i2 = editor.findItem(event, ['atoms'])\n      }\n      let dist = Number.MAX_VALUE\n      if (i2 && i2.map === 'atoms') {\n        // after mousedown events is appered, cursor is moved and then cursor intersects any atoms\n        i2 = i2.id\n      } else {\n        i2 = this.atomProps\n        const xy1 = rnd.page2obj(event)\n        dist = Vec2.dist(dragCtx.xy0, xy1)\n        if (p1) {\n          // rotation only, leght of bond = 1;\n          p2 = utils.calcNewAtomPos(p1, xy1, event.ctrlKey)\n        } else {\n          // first mousedown event intersect with any atom and\n          // rotation only, leght of bond = 1;\n          const atom = rnd.ctab.molecule.atoms.get(i1)\n          p1 = utils.calcNewAtomPos(atom.pp.get_xy0(), xy1, event.ctrlKey)\n        }\n      }\n      // don't rotate the bond if the distance between the start and end point is too small\n      if (dist > 0.3)\n        dragCtx.action = fromBondAddition(\n          rnd.ctab,\n          this.bondProps,\n          i1,\n          i2,\n          p1,\n          p2\n        )[0]\n      else delete dragCtx.action\n      this.editor.update(dragCtx.action, true)\n      return true\n    }\n  }\n  this.editor.hover(this.editor.findItem(event, ['atoms', 'bonds']))\n  return true\n}\n\nBondTool.prototype.mouseup = function (event) {\n  // eslint-disable-line max-statements\n  if ('dragCtx' in this) {\n    var dragCtx = this.dragCtx\n    var rnd = this.editor.render\n    var struct = rnd.ctab.molecule\n    if ('action' in dragCtx) {\n      this.editor.update(dragCtx.action)\n    } else if (!('item' in dragCtx)) {\n      var xy = rnd.page2obj(event)\n      var v = new Vec2(1.0 / 2, 0).rotate(\n        this.bondProps.type === Bond.PATTERN.TYPE.SINGLE ? -Math.PI / 6 : 0\n      )\n      var bondAddition = fromBondAddition(\n        rnd.ctab,\n        this.bondProps,\n        { label: 'C' },\n        { label: 'C' },\n        Vec2.diff(xy, v),\n        Vec2.sum(xy, v)\n      )\n\n      this.editor.update(bondAddition[0])\n    } else if (dragCtx.item.map === 'atoms') {\n      // when does it hapend?\n      this.editor.update(\n        fromBondAddition(rnd.ctab, this.bondProps, dragCtx.item.id)[0]\n      )\n    } else if (dragCtx.item.map === 'bonds') {\n      var bondProps = Object.assign({}, this.bondProps)\n      var bond = struct.bonds.get(dragCtx.item.id)\n\n      this.editor.update(\n        bondChangingAction(rnd.ctab, dragCtx.item.id, bond, bondProps)\n      )\n    }\n    delete this.dragCtx\n  }\n  this.editor.event.message.dispatch({\n    info: false\n  })\n  return true\n}\n\nexport default BondTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport Action from '../shared/action'\nimport { fromAtomMerge } from './atom'\nimport { fromBondsMerge } from './bond'\nimport utils from '../shared/utils'\n\nexport function fromItemsFuse(restruct, items) {\n  let action = new Action()\n\n  if (!items) return action\n\n  const usedAtoms = new Set()\n\n  // merge single atoms\n  items.atoms.forEach((dst, src) => {\n    if (usedAtoms.has(dst) || usedAtoms.has(src)) return\n\n    action = fromAtomMerge(restruct, src, dst).mergeWith(action)\n    usedAtoms.add(dst).add(src)\n  })\n\n  // merge bonds\n  action = fromBondsMerge(restruct, items.bonds).mergeWith(action)\n\n  return action\n}\n\nexport function getItemsToFuse(editor, items) {\n  const struct = editor.render.ctab.molecule\n\n  const mergeItems = items || {\n    atoms: Array.from(struct.atoms.keys()),\n    bonds: Array.from(struct.bonds.keys())\n  }\n\n  return closestToMerge(\n    struct,\n    editor.findMerge(mergeItems, ['atoms', 'bonds'])\n  )\n}\n\nexport function getHoverToFuse(items) {\n  if (!items) return null\n\n  const hoverItems = {\n    atoms: Array.from(items.atoms.values()),\n    bonds: Array.from(items.bonds.values())\n  }\n\n  return { map: 'merge', id: +Date.now(), items: hoverItems }\n}\n\n/**\n * @param struct\n * @param closestMap {{\n * \t\tatoms: Map<number, number>,\n * \t\tbonds: Map<number, number>\n * }}\n * @return {{\n * \t\tatoms: Map<number, number>,\n * \t\tbonds: Map<number, number>\n * }}\n */\nfunction closestToMerge(struct, closestMap) {\n  const mergeMap = {\n    atoms: new Map(closestMap.atoms),\n    bonds: new Map(closestMap.bonds)\n  }\n\n  closestMap.bonds.forEach((dstId, srcId) => {\n    const bond = struct.bonds.get(srcId)\n    const bondCI = struct.bonds.get(dstId)\n\n    if (utils.mergeBondsParams(struct, bond, struct, bondCI).merged) {\n      mergeMap.atoms.delete(bond.begin)\n      mergeMap.atoms.delete(bond.end)\n    } else {\n      mergeMap.bonds.delete(srcId)\n    }\n  })\n\n  if (mergeMap.atoms.size === 0 && mergeMap.bonds.size === 0) return null\n\n  return mergeMap\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Bond, Vec2 } from 'ketcher-core'\nimport {\n  fromItemsFuse,\n  getHoverToFuse,\n  getItemsToFuse\n} from '../actions/closely-fusing'\n\nimport { atomLongtapEvent } from './atom'\nimport { bondChangingAction } from '../actions/bond'\nimport { fromChain } from '../actions/chain'\nimport utils from '../shared/utils'\n\nfunction ChainTool(editor) {\n  if (!(this instanceof ChainTool)) return new ChainTool(editor)\n\n  this.editor = editor\n  this.editor.selection(null)\n}\n\nChainTool.prototype.mousedown = function (event) {\n  const rnd = this.editor.render\n  const ci = this.editor.findItem(event, ['atoms', 'bonds'])\n  this.editor.hover(null)\n  this.dragCtx = {\n    xy0: rnd.page2obj(event),\n    item: ci\n  }\n  if (ci && ci.map === 'atoms') {\n    this.editor.selection({ atoms: [ci.id] }) // for change atom\n    // this event has to be stopped in others events by `tool.dragCtx.stopTapping()`\n    atomLongtapEvent(this, rnd)\n  }\n  if (!this.dragCtx.item)\n    // ci.type == 'Canvas'\n    delete this.dragCtx.item\n  return true\n}\n\nChainTool.prototype.mousemove = function (event) {\n  // eslint-disable-line max-statements\n  const editor = this.editor\n  const restruct = editor.render.ctab\n  const dragCtx = this.dragCtx\n\n  editor.hover(this.editor.findItem(event, ['atoms', 'bonds']))\n  if (!dragCtx) return true\n\n  if (dragCtx && dragCtx.stopTapping) dragCtx.stopTapping()\n\n  editor.selection(null)\n\n  if (!dragCtx.item || dragCtx.item.map === 'atoms') {\n    if (dragCtx.action) dragCtx.action.perform(restruct)\n\n    const atoms = restruct.molecule.atoms\n\n    const pos0 = dragCtx.item ? atoms.get(dragCtx.item.id).pp : dragCtx.xy0\n\n    const pos1 = editor.render.page2obj(event)\n    const sectCount = Math.ceil(Vec2.diff(pos1, pos0).length())\n\n    const angle = event.ctrlKey\n      ? utils.calcAngle(pos0, pos1)\n      : utils.fracAngle(pos0, pos1)\n\n    const [action, newItems] = fromChain(\n      restruct,\n      pos0,\n      angle,\n      sectCount,\n      dragCtx.item ? dragCtx.item.id : null\n    )\n\n    editor.event.message.dispatch({\n      info: sectCount + ' sectors'\n    })\n\n    dragCtx.action = action\n    editor.update(dragCtx.action, true)\n\n    dragCtx.mergeItems = getItemsToFuse(editor, newItems)\n    editor.hover(getHoverToFuse(dragCtx.mergeItems))\n\n    return true\n  }\n\n  return true\n}\n\nChainTool.prototype.mouseup = function () {\n  const dragCtx = this.dragCtx\n  if (!dragCtx) return true\n  delete this.dragCtx\n\n  const editor = this.editor\n  const restruct = editor.render.ctab\n  const struct = restruct.molecule\n\n  if (dragCtx.stopTapping) dragCtx.stopTapping()\n\n  if (!dragCtx.action && dragCtx.item && dragCtx.item.map === 'bonds') {\n    const bond = struct.bonds.get(dragCtx.item.id)\n\n    dragCtx.action = bondChangingAction(restruct, dragCtx.item.id, bond, {\n      type: Bond.PATTERN.TYPE.SINGLE,\n      stereo: Bond.PATTERN.STEREO.NONE\n    })\n  } else {\n    dragCtx.action = dragCtx.action\n      ? fromItemsFuse(restruct, dragCtx.mergeItems).mergeWith(dragCtx.action)\n      : fromItemsFuse(restruct, dragCtx.mergeItems)\n  }\n\n  editor.selection(null)\n  editor.hover(null)\n\n  if (dragCtx.action) editor.update(dragCtx.action)\n\n  editor.event.message.dispatch({\n    info: false\n  })\n\n  return true\n}\n\nChainTool.prototype.cancel = ChainTool.prototype.mouseup\n\nChainTool.prototype.mouseleave = ChainTool.prototype.mouseup\n\nexport default ChainTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Elements } from 'ketcher-core'\nimport { fromAtomsAttrs } from '../actions/atom'\n\nfunction ChargeTool(editor, charge) {\n  if (!(this instanceof ChargeTool)) return new ChargeTool(editor, charge)\n\n  this.editor = editor\n  this.editor.selection(null)\n  this.charge = charge\n}\n\nChargeTool.prototype.mousemove = function (event) {\n  var rnd = this.editor.render\n  var ci = this.editor.findItem(event, ['atoms'])\n  var struct = rnd.ctab.molecule\n  if (ci && ci.map === 'atoms' && Elements.get(struct.atoms.get(ci.id)?.label))\n    this.editor.hover(ci)\n  else this.editor.hover(null)\n  return true\n}\n\nChargeTool.prototype.click = function (event) {\n  var editor = this.editor\n  var rnd = editor.render\n  var struct = rnd.ctab.molecule\n  var ci = editor.findItem(event, ['atoms'])\n  if (\n    ci &&\n    ci.map === 'atoms' &&\n    Elements.get(struct.atoms.get(ci.id)?.label)\n  ) {\n    this.editor.hover(null)\n    this.editor.update(\n      fromAtomsAttrs(rnd.ctab, ci.id, {\n        charge: struct.atoms.get(ci.id).charge + this.charge\n      })\n    )\n  }\n  return true\n}\n\nexport default ChargeTool\n","import {\n  AtomMove,\n  BondMove,\n  EnhancedFlagMove,\n  FragmentAdd,\n  FragmentDelete,\n  FragmentDeleteStereoAtom,\n  FragmentStereoFlag,\n  LoopMove,\n  RxnArrowMove,\n  RxnPlusMove,\n  SGroupDataMove,\n  SimpleObjectMove,\n  TextMove\n} from '../operations'\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Pile, RGroup, Vec2 } from 'ketcher-core'\nimport { getRelSgroupsBySelection } from './utils'\nimport { fromRGroupFragment, fromUpdateIfThen } from './rgroup'\n\nimport Action from '../shared/action'\nimport { fromAtomsFragmentAttr } from './atom'\n\nexport function fromMultipleMove(restruct, lists, d) {\n  d = new Vec2(d)\n\n  const action = new Action()\n  const struct = restruct.molecule\n  const loops = new Pile()\n  const atomsToInvalidate = new Pile()\n\n  if (lists.atoms) {\n    const atomSet = new Pile(lists.atoms)\n    const bondlist = []\n\n    restruct.bonds.forEach((bond, bid) => {\n      if (atomSet.has(bond.b.begin) && atomSet.has(bond.b.end)) {\n        bondlist.push(bid)\n        // add all adjacent loops\n        // those that are not completely inside the structure will get redrawn anyway\n        ;['hb1', 'hb2'].forEach(hb => {\n          const loop = struct.halfBonds.get(bond.b[hb]).loop\n          if (loop >= 0) loops.add(loop)\n        })\n        return\n      }\n\n      if (atomSet.has(bond.b.begin)) {\n        atomsToInvalidate.add(bond.b.begin)\n        return\n      }\n\n      if (atomSet.has(bond.b.end)) atomsToInvalidate.add(bond.b.end)\n    })\n\n    bondlist.forEach(bond => {\n      action.addOp(new BondMove(bond, d))\n    })\n\n    loops.forEach(loopId => {\n      if (restruct.reloops.get(loopId) && restruct.reloops.get(loopId).visel)\n        // hack\n        action.addOp(new LoopMove(loopId, d))\n    })\n\n    lists.atoms.forEach(aid => {\n      action.addOp(new AtomMove(aid, d, !atomsToInvalidate.has(aid)))\n    })\n\n    if (lists.sgroupData && lists.sgroupData.length === 0) {\n      const sgroups = getRelSgroupsBySelection(restruct, lists.atoms)\n      sgroups.forEach(sg => {\n        action.addOp(new SGroupDataMove(sg.id, d))\n      })\n    }\n  }\n\n  if (lists.rxnArrows) {\n    lists.rxnArrows.forEach(rxnArrow => {\n      action.addOp(new RxnArrowMove(rxnArrow, d, true))\n    })\n  }\n\n  if (lists.rxnPluses) {\n    lists.rxnPluses.forEach(rxnPulse => {\n      action.addOp(new RxnPlusMove(rxnPulse, d, true))\n    })\n  }\n\n  if (lists.simpleObjects) {\n    lists.simpleObjects.forEach(simpleObject => {\n      action.addOp(new SimpleObjectMove(simpleObject, d, true))\n    })\n  }\n\n  if (lists.sgroupData) {\n    lists.sgroupData.forEach(sgData => {\n      action.addOp(new SGroupDataMove(sgData, d))\n    })\n  }\n\n  if (lists.enhancedFlags) {\n    lists.enhancedFlags.forEach(fid => {\n      action.addOp(new EnhancedFlagMove(fid, d))\n    })\n  }\n\n  if (lists.texts) {\n    lists.texts.forEach(text => {\n      action.addOp(new TextMove(text, d, true))\n    })\n  }\n\n  return action.perform(restruct)\n}\n\nexport function fromStereoFlagUpdate(restruct, frid, flag) {\n  const action = new Action()\n\n  if (!flag) {\n    const struct = restruct.molecule\n    const frag = restruct.molecule.frags.get(frid)\n    frag.stereoAtoms.forEach(aid => {\n      if (struct.atoms.get(aid).stereoLabel === null)\n        action.addOp(new FragmentDeleteStereoAtom(frid, aid))\n    })\n  }\n\n  action.addOp(new FragmentStereoFlag(frid, flag))\n  return action.perform(restruct)\n}\n\n/**\n * @param restruct { ReStruct }\n * @param aid { number }\n * @param frid { number }\n * @param newfrid { number }\n * @returns { Action }\n */\nfunction processAtom(restruct, aid, frid, newfrid) {\n  const queue = [aid]\n  const usedIds = new Pile(queue)\n\n  while (queue.length > 0) {\n    const id = queue.shift()\n\n    restruct.molecule.atomGetNeighbors(id).forEach(nei => {\n      if (\n        restruct.molecule.atoms.get(nei.aid).fragment === frid &&\n        !usedIds.has(nei.aid)\n      ) {\n        usedIds.add(nei.aid)\n        queue.push(nei.aid)\n      }\n    })\n  }\n\n  return fromAtomsFragmentAttr(restruct, usedIds, newfrid)\n}\n\n/**\n * @param restruct { ReStruct }\n * @param frid { number }\n * @param rgForRemove\n * @return { Action }\n */\n// TODO [RB] the thing is too tricky :) need something else in future\nexport function fromFragmentSplit(restruct, frid, rgForRemove = []) {\n  const action = new Action()\n  const rgid = RGroup.findRGroupByFragment(restruct.molecule.rgroups, frid)\n\n  restruct.molecule.atoms.forEach((atom, aid) => {\n    if (atom.fragment === frid) {\n      const newfrid = action.addOp(new FragmentAdd().perform(restruct)).frid\n\n      action.mergeWith(processAtom(restruct, aid, frid, newfrid))\n\n      if (rgid) action.mergeWith(fromRGroupFragment(restruct, rgid, newfrid))\n    }\n  })\n\n  if (frid !== -1) {\n    action.mergeWith(fromRGroupFragment(restruct, 0, frid))\n    action.addOp(new FragmentDelete(frid).perform(restruct))\n    action.mergeWith(fromUpdateIfThen(restruct, 0, rgid, rgForRemove))\n  }\n\n  action.operations.reverse()\n  return action\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Atom, Bond, RGroup } from 'ketcher-core'\nimport {\n  AtomDelete,\n  AtomAttr,\n  BondDelete,\n  CalcImplicitH,\n  RxnArrowDelete,\n  RxnPlusDelete,\n  SimpleObjectDelete,\n  TextDelete\n} from '../operations'\nimport { fromBondStereoUpdate } from '../actions/bond'\nimport { atomGetDegree } from './utils'\nimport {\n  fromSgroupDeletion,\n  removeAtomFromSgroupIfNeeded,\n  removeSgroupIfNeeded\n} from './sgroup'\n\nimport Action from '../shared/action'\nimport { Pile } from 'ketcher-core'\nimport { fromFragmentSplit } from './fragment'\nimport { fromStereoAtomAttrs } from './atom'\n\nexport function fromOneAtomDeletion(restruct, id) {\n  return fromFragmentDeletion(restruct, { atoms: [id] })\n}\n\nfunction fromBondDeletion(restruct, bid, skipAtoms = []) {\n  let action = new Action()\n  const bond = restruct.molecule.bonds.get(bid)\n  const atomsToRemove = []\n\n  action.addOp(new BondDelete(bid))\n\n  if (\n    !skipAtoms.includes(bond.begin) &&\n    atomGetDegree(restruct, bond.begin) === 1\n  ) {\n    if (removeAtomFromSgroupIfNeeded(action, restruct, bond.begin))\n      atomsToRemove.push(bond.begin)\n\n    action.addOp(new AtomDelete(bond.begin))\n  }\n\n  if (\n    !skipAtoms.includes(bond.end) &&\n    atomGetDegree(restruct, bond.end) === 1\n  ) {\n    if (removeAtomFromSgroupIfNeeded(action, restruct, bond.end))\n      atomsToRemove.push(bond.end)\n\n    action.addOp(new AtomDelete(bond.end))\n  }\n\n  removeSgroupIfNeeded(action, restruct, atomsToRemove)\n  action = action.perform(restruct)\n  action.addOp(new CalcImplicitH([bond.begin, bond.end]).perform(restruct))\n  action.mergeWith(fromBondStereoUpdate(restruct, bond, false))\n\n  action.operations.reverse()\n\n  return action\n}\n\nexport function fromOneBondDeletion(restruct, id) {\n  const frid = restruct.molecule.getBondFragment(id)\n  let action = fromBondDeletion(restruct, id)\n\n  action = fromFragmentSplit(restruct, frid).mergeWith(action)\n\n  return action\n}\n\nexport function fromFragmentDeletion(restruct, selection) {\n  // eslint-disable-line max-statements\n  console.assert(!!selection)\n  let action = new Action()\n  const atomsToRemove = []\n  const frids = []\n\n  selection = {\n    // TODO: refactor me\n    atoms: selection.atoms || [],\n    bonds: selection.bonds || [],\n    rxnPluses: selection.rxnPluses || [],\n    rxnArrows: selection.rxnArrows || [],\n    sgroupData: selection.sgroupData || [],\n    simpleObjects: selection.simpleObjects || [],\n    texts: selection.texts || []\n  }\n\n  const actionRemoveDataSGroups = new Action()\n  restruct.molecule.sgroups.forEach((sg, id) => {\n    if (\n      selection.sgroupData.includes(id) ||\n      new Pile(selection.atoms).isSuperset(new Pile(sg.atoms))\n    )\n      actionRemoveDataSGroups.mergeWith(fromSgroupDeletion(restruct, id))\n  })\n\n  selection.atoms.forEach(aid => {\n    restruct.molecule.atomGetNeighbors(aid).forEach(nei => {\n      if (selection.bonds.indexOf(nei.bid) === -1) {\n        selection.bonds = selection.bonds.concat([nei.bid])\n      }\n    })\n  })\n\n  const actionRemoveBonds = new Action()\n  selection.bonds.forEach(bid => {\n    const frid = restruct.molecule.getBondFragment(bid)\n    if (frids.indexOf(frid) < 0) frids.push(frid)\n\n    actionRemoveBonds.mergeWith(\n      fromBondDeletion(restruct, bid, selection.atoms)\n    )\n  })\n\n  selection.atoms.forEach(aid => {\n    const frid3 = restruct.molecule.atoms.get(aid).fragment\n    if (frids.indexOf(frid3) < 0) frids.push(frid3)\n\n    if (removeAtomFromSgroupIfNeeded(action, restruct, aid))\n      atomsToRemove.push(aid)\n\n    action.addOp(new AtomDelete(aid))\n  })\n\n  removeSgroupIfNeeded(action, restruct, atomsToRemove)\n\n  selection.rxnArrows.forEach(id => {\n    action.addOp(new RxnArrowDelete(id))\n  })\n\n  selection.rxnPluses.forEach(id => {\n    action.addOp(new RxnPlusDelete(id))\n  })\n\n  selection.simpleObjects.forEach(id => {\n    action.addOp(new SimpleObjectDelete(id))\n  })\n\n  selection.texts.forEach(id => {\n    action.addOp(new TextDelete(id))\n  })\n\n  action = action.perform(restruct)\n  action.mergeWith(actionRemoveBonds)\n\n  const rgForRemove = frids.map(frid =>\n    RGroup.findRGroupByFragment(restruct.molecule.rgroups, frid)\n  )\n  while (frids.length > 0)\n    action = fromFragmentSplit(restruct, frids.pop(), rgForRemove).mergeWith(\n      action\n    )\n\n  action.mergeWith(actionRemoveDataSGroups)\n\n  return action\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Vec2 } from 'ketcher-core'\n\nfunction getElementsInRectangle(restruct, p0, p1) {\n  const bondList = []\n  const atomList = []\n\n  const x0 = Math.min(p0.x, p1.x)\n  const x1 = Math.max(p0.x, p1.x)\n  const y0 = Math.min(p0.y, p1.y)\n  const y1 = Math.max(p0.y, p1.y)\n\n  restruct.bonds.forEach((bond, bid) => {\n    const centre = Vec2.lc2(\n      restruct.atoms.get(bond.b.begin).a.pp,\n      0.5,\n      restruct.atoms.get(bond.b.end).a.pp,\n      0.5\n    )\n    if (centre.x > x0 && centre.x < x1 && centre.y > y0 && centre.y < y1)\n      bondList.push(bid)\n  })\n\n  restruct.atoms.forEach((atom, aid) => {\n    if (\n      atom.a.pp.x > x0 &&\n      atom.a.pp.x < x1 &&\n      atom.a.pp.y > y0 &&\n      atom.a.pp.y < y1\n    )\n      atomList.push(aid)\n  })\n\n  const rxnArrowsList = []\n  const rxnPlusesList = []\n  const simpleObjectsList = []\n\n  restruct.rxnArrows.forEach((item, id) => {\n    if (\n      item.item.pp.x > x0 &&\n      item.item.pp.x < x1 &&\n      item.item.pp.y > y0 &&\n      item.item.pp.y < y1\n    )\n      rxnArrowsList.push(id)\n  })\n\n  restruct.rxnPluses.forEach((item, id) => {\n    if (\n      item.item.pp.x > x0 &&\n      item.item.pp.x < x1 &&\n      item.item.pp.y > y0 &&\n      item.item.pp.y < y1\n    )\n      rxnPlusesList.push(id)\n  })\n\n  restruct.simpleObjects.forEach((item, id) => {\n    const referencePoints = item.getReferencePoints(true)\n    const referencePointInRectangle = referencePoints.find(\n      point => point.x > x0 && point.x < x1 && point.y > y0 && point.y < y1\n    )\n    if (referencePointInRectangle) simpleObjectsList.push(id)\n  })\n\n  const enhancedFlagList = []\n  restruct.enhancedFlags.forEach((item, id) => {\n    if (!item.pp) return\n    if (item.pp.x > x0 && item.pp.x < x1 && item.pp.y > y0 && item.pp.y < y1)\n      enhancedFlagList.push(id)\n  })\n\n  const sgroupDataList = []\n  restruct.sgroupData.forEach((item, id) => {\n    if (\n      item.sgroup.pp.x > x0 &&\n      item.sgroup.pp.x < x1 &&\n      item.sgroup.pp.y > y0 &&\n      item.sgroup.pp.y < y1\n    )\n      sgroupDataList.push(id)\n  })\n\n  const textsList = []\n  restruct.texts.forEach((item, id) => {\n    const referencePoints = item.getReferencePoints()\n    const referencePointInRectangle = referencePoints.find(point => {\n      return point.x > x0 && point.x < x1 && point.y > y0 && point.y < y1\n    })\n\n    if (referencePointInRectangle) {\n      textsList.push(id)\n    }\n  })\n\n  return {\n    atoms: atomList,\n    bonds: bondList,\n    rxnArrows: rxnArrowsList,\n    rxnPluses: rxnPlusesList,\n    enhancedFlags: enhancedFlagList,\n    sgroupData: sgroupDataList,\n    simpleObjects: simpleObjectsList,\n    texts: textsList\n  }\n}\n\nfunction getElementsInPolygon(restruct, rr) {\n  // eslint-disable-line max-statements\n  const bondList = []\n  const atomList = []\n  const r = []\n\n  for (let i = 0; i < rr.length; ++i) r[i] = new Vec2(rr[i].x, rr[i].y)\n\n  restruct.bonds.forEach((bond, bid) => {\n    const centre = Vec2.lc2(\n      restruct.atoms.get(bond.b.begin).a.pp,\n      0.5,\n      restruct.atoms.get(bond.b.end).a.pp,\n      0.5\n    )\n    if (isPointInPolygon(r, centre)) bondList.push(bid)\n  })\n\n  restruct.atoms.forEach((atom, aid) => {\n    if (isPointInPolygon(r, atom.a.pp)) atomList.push(aid)\n  })\n\n  const rxnArrowsList = []\n  const rxnPlusesList = []\n  const simpleObjectsList = []\n  const textsList = []\n\n  restruct.rxnArrows.forEach((item, id) => {\n    if (isPointInPolygon(r, item.item.pp)) rxnArrowsList.push(id)\n  })\n\n  restruct.rxnPluses.forEach((item, id) => {\n    if (isPointInPolygon(r, item.item.pp)) rxnPlusesList.push(id)\n  })\n\n  restruct.simpleObjects.forEach((item, id) => {\n    const referencePoints = item.getReferencePoints(true)\n    const referencePointInPolygon = referencePoints.find(point =>\n      isPointInPolygon(r, point)\n    )\n    if (referencePointInPolygon) simpleObjectsList.push(id)\n  })\n\n  restruct.texts.forEach((item, id) => {\n    const referencePoints = item.getReferencePoints()\n    const referencePointInPolygon = referencePoints.find(point =>\n      isPointInPolygon(r, point)\n    )\n\n    if (referencePointInPolygon) {\n      textsList.push(id)\n    }\n  })\n\n  const enhancedFlagList = []\n  restruct.enhancedFlags.forEach((item, id) => {\n    if (item.pp && isPointInPolygon(r, item.pp)) enhancedFlagList.push(id)\n  })\n\n  const sgroupDataList = []\n  restruct.sgroupData.forEach((item, id) => {\n    if (isPointInPolygon(r, item.sgroup.pp)) sgroupDataList.push(id)\n  })\n\n  return {\n    atoms: atomList,\n    bonds: bondList,\n    rxnArrows: rxnArrowsList,\n    rxnPluses: rxnPlusesList,\n    enhancedFlags: enhancedFlagList,\n    sgroupData: sgroupDataList,\n    simpleObjects: simpleObjectsList,\n    texts: textsList\n  }\n}\n\n// TODO: test me see testPolygon from\n// 'Remove unused methods from render' commit\nfunction isPointInPolygon(r, p) {\n  // eslint-disable-line max-statements\n  var d = new Vec2(0, 1)\n  var n = d.rotate(Math.PI / 2)\n  var v0 = Vec2.diff(r[r.length - 1], p)\n  var n0 = Vec2.dot(n, v0)\n  var d0 = Vec2.dot(d, v0)\n  var w0 = null\n  var counter = 0\n  var eps = 1e-5\n  var flag1 = false\n  var flag0 = false\n\n  for (var i = 0; i < r.length; ++i) {\n    var v1 = Vec2.diff(r[i], p)\n    var w1 = Vec2.diff(v1, v0)\n    var n1 = Vec2.dot(n, v1)\n    var d1 = Vec2.dot(d, v1)\n    flag1 = false\n    if (n1 * n0 < 0) {\n      if (d1 * d0 > -eps) {\n        if (d0 > -eps) flag1 = true\n        /* eslint-disable no-mixed-operators*/\n      } else if (\n        (Math.abs(n0) * Math.abs(d1) - Math.abs(n1) * Math.abs(d0)) * d1 >\n        0\n      ) {\n        /* eslint-enable no-mixed-operators*/\n        flag1 = true\n      }\n    }\n    if (flag1 && flag0 && Vec2.dot(w1, n) * Vec2.dot(w0, n) >= 0) flag1 = false\n    if (flag1) counter++\n    v0 = v1\n    n0 = n1\n    d0 = d1\n    w0 = w1\n    flag0 = flag1\n  }\n  return counter % 2 !== 0\n}\n\nexport default {\n  inRectangle: getElementsInRectangle,\n  inPolygon: getElementsInPolygon\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { AtomAdd, FragmentAdd } from '../operations'\n\nimport Action from '../shared/action'\nimport { Vec2 } from 'ketcher-core'\nimport { atomGetAttr } from './utils'\nimport { fromBondAddition } from './bond'\n\nexport function fromChain(restruct, p0, v, nSect, atomId) {\n  // eslint-disable-line max-params\n  const dx = Math.cos(Math.PI / 6)\n  const dy = Math.sin(Math.PI / 6)\n\n  let action = new Action()\n\n  const frid =\n    atomId !== null\n      ? atomGetAttr(restruct, atomId, 'fragment')\n      : action.addOp(new FragmentAdd().perform(restruct)).frid\n\n  const chainItems = {\n    atoms: [],\n    bonds: []\n  }\n\n  let id0 =\n    atomId !== null\n      ? atomId\n      : action.addOp(\n          new AtomAdd({ label: 'C', fragment: frid }, p0).perform(restruct)\n        ).data.aid\n\n  chainItems.atoms.push(id0)\n  action.operations.reverse()\n\n  for (let i = 0; i < nSect; i++) {\n    const pos = new Vec2(dx * (i + 1), i & 1 ? 0 : dy).rotate(v).add(p0)\n\n    const ret = fromBondAddition(restruct, {}, id0, {}, pos)\n    action = ret[0].mergeWith(action)\n    id0 = ret[2]\n    chainItems.bonds.push(ret[3])\n    chainItems.atoms.push(id0)\n  }\n\n  return [action, chainItems]\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Scale } from 'ketcher-core'\nimport draw from '../../../render/draw'\nimport locate from './locate'\n\nfunction LassoHelper(mode, editor, fragment) {\n  this.mode = mode\n  this.fragment = fragment\n  this.editor = editor\n}\n\nLassoHelper.prototype.getSelection = function () {\n  const rnd = this.editor.render\n\n  if (this.mode === 0) return locate.inPolygon(rnd.ctab, this.points)\n\n  if (this.mode === 1)\n    return locate.inRectangle(rnd.ctab, this.points[0], this.points[1])\n\n  throw new Error('Selector mode unknown') // eslint-disable-line no-else-return\n}\n\nLassoHelper.prototype.begin = function (event) {\n  const rnd = this.editor.render\n  this.points = [rnd.page2obj(event)]\n  if (this.mode === 1) this.points.push(this.points[0])\n}\n\nLassoHelper.prototype.running = function () {\n  return !!this.points\n}\n\nLassoHelper.prototype.addPoint = function (event) {\n  if (!this.points) return null\n\n  const rnd = this.editor.render\n\n  if (this.mode === 0) this.points.push(rnd.page2obj(event))\n  else if (this.mode === 1) this.points = [this.points[0], rnd.page2obj(event)]\n\n  this.update()\n  return this.getSelection()\n}\n\nLassoHelper.prototype.update = function () {\n  if (this.selection) {\n    this.selection.remove()\n    this.selection = null\n  }\n\n  if (this.points && this.points.length > 1) {\n    const rnd = this.editor.render\n    const dp = this.points.map(p =>\n      Scale.obj2scaled(p, rnd.options).add(rnd.options.offset)\n    )\n    this.selection =\n      this.mode === 0\n        ? draw.selectionPolygon(rnd.paper, dp, rnd.options)\n        : draw.selectionRectangle(rnd.paper, dp[0], dp[1], rnd.options)\n  }\n}\n\nLassoHelper.prototype.end = function () {\n  const ret = this.getSelection()\n  this.points = null\n  this.update(null)\n  return ret\n}\n\nexport default LassoHelper\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport {\n  SimpleObjectAdd,\n  SimpleObjectDelete,\n  SimpleObjectResize\n} from '../operations'\n\nimport Action from '../shared/action'\n\nexport function fromSimpleObjectDeletion(restruct, id) {\n  const action = new Action()\n  action.addOp(new SimpleObjectDelete(id))\n  return action.perform(restruct)\n}\n\nexport function fromSimpleObjectAddition(restruct, pos, mode, toCircle) {\n  var action = new Action()\n  action.addOp(new SimpleObjectAdd(pos, mode, toCircle))\n  return action.perform(restruct)\n}\n\nexport function fromSimpleObjectResizing(\n  restruct,\n  id,\n  d,\n  current,\n  anchor,\n  toCircle\n) {\n  var action = new Action()\n  action.addOp(new SimpleObjectResize(id, d, current, anchor, false, toCircle))\n  return action.perform(restruct)\n}\n","import { TextCreate, TextDelete, TextUpdate } from '../operations'\n\nimport Action from '../shared/action'\nimport Restruct from '../../render/restruct'\nimport { Vec2 } from 'ketcher-core'\n\nexport function fromTextCreation(\n  restruct: Restruct,\n  content: string,\n  position: Vec2\n) {\n  const action = new Action()\n  action.addOp(new TextCreate(content, position))\n  return action.perform(restruct)\n}\n\nexport function fromTextUpdating(\n  restruct: Restruct,\n  id: number,\n  content: string\n) {\n  const action = new Action()\n  action.addOp(new TextUpdate(id, content))\n  return action.perform(restruct)\n}\n\nexport function fromTextDeletion(restruct: Restruct, id: number) {\n  const action = new Action()\n\n  action.addOp(new TextDelete(id))\n\n  return action.perform(restruct)\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { fromArrowDeletion, fromPlusDeletion } from '../actions/reaction'\nimport {\n  fromFragmentDeletion,\n  fromOneAtomDeletion,\n  fromOneBondDeletion\n} from '../actions/erase'\n\nimport LassoHelper from './helper/lasso'\nimport { fromSgroupDeletion } from '../actions/sgroup'\nimport { fromSimpleObjectDeletion } from '../actions/simpleobject'\nimport { fromTextDeletion } from '../actions/text'\n\nfunction EraserTool(editor, mode) {\n  if (!(this instanceof EraserTool)) {\n    if (!editor.selection()) return new EraserTool(editor, mode)\n\n    const action = fromFragmentDeletion(editor.render.ctab, editor.selection())\n    editor.update(action)\n    editor.selection(null)\n    return null\n  }\n\n  this.editor = editor\n\n  this.maps = [\n    'atoms',\n    'bonds',\n    'rxnArrows',\n    'rxnPluses',\n    'sgroups',\n    'sgroupData',\n    'simpleObjects',\n    'texts'\n  ]\n  this.lassoHelper = new LassoHelper(mode || 0, editor)\n}\n\nEraserTool.prototype.mousedown = function (event) {\n  const ci = this.editor.findItem(event, this.maps)\n  if (!ci)\n    //  ci.type == 'Canvas'\n    this.lassoHelper.begin(event)\n}\n\nEraserTool.prototype.mousemove = function (event) {\n  if (this.lassoHelper.running())\n    this.editor.selection(this.lassoHelper.addPoint(event))\n  else this.editor.hover(this.editor.findItem(event, this.maps))\n}\n\nEraserTool.prototype.mouseup = function (event) {\n  // eslint-disable-line max-statements\n  const rnd = this.editor.render\n\n  if (this.lassoHelper.running()) {\n    // TODO it catches more events than needed, to be re-factored\n    this.editor.update(\n      fromFragmentDeletion(rnd.ctab, this.lassoHelper.end(event))\n    )\n    this.editor.selection(null)\n  }\n}\n\nEraserTool.prototype.click = function (event) {\n  const restruct = this.editor.render.ctab\n  const ci = this.editor.findItem(event, this.maps)\n\n  if (!ci) return // ci.type == 'Canvas'\n\n  this.editor.hover(null)\n  if (ci.map === 'atoms') {\n    this.editor.update(fromOneAtomDeletion(restruct, ci.id))\n  } else if (ci.map === 'bonds') {\n    this.editor.update(fromOneBondDeletion(restruct, ci.id))\n  } else if (ci.map === 'sgroups' || ci.map === 'sgroupData') {\n    this.editor.update(fromSgroupDeletion(restruct, ci.id))\n  } else if (ci.map === 'rxnArrows') {\n    this.editor.update(fromArrowDeletion(restruct, ci.id))\n  } else if (ci.map === 'rxnPluses') {\n    this.editor.update(fromPlusDeletion(restruct, ci.id))\n  } else if (ci.map === 'simpleObjects') {\n    this.editor.update(fromSimpleObjectDeletion(restruct, ci.id))\n  } else if (ci.map === 'texts') {\n    this.editor.update(fromTextDeletion(restruct, ci.id))\n  } else {\n    // TODO re-factoring needed - should be \"map-independent\"\n    console.error(\n      'EraserTool: unable to delete the object ' + ci.map + '[' + ci.id + ']'\n    )\n    return\n  }\n  this.editor.selection(null)\n}\n\nEraserTool.prototype.mouseleave = EraserTool.prototype.mouseup\n\nEraserTool.prototype.cancel = function () {\n  if (this.lassoHelper.running()) this.lassoHelper.end()\n  this.editor.selection(null)\n}\n\nexport default EraserTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  AtomAdd,\n  BondAdd,\n  FragmentAdd,\n  FragmentAddStereoAtom,\n  RGroupFragment,\n  RxnArrowAdd,\n  RxnPlusAdd,\n  SimpleObjectAdd,\n  TextCreate\n} from '../operations'\nimport { fromRGroupAttrs, fromUpdateIfThen } from './rgroup'\n\nimport Action from '../shared/action'\nimport { Vec2 } from 'ketcher-core'\nimport { fromSgroupAddition } from './sgroup'\n\nexport function fromPaste(restruct, pstruct, point, angle = 0) {\n  const xy0 = getStructCenter(pstruct)\n  const offset = Vec2.diff(point, xy0)\n\n  const action = new Action()\n\n  const aidMap = new Map()\n  const fridMap = new Map()\n\n  const pasteItems = {\n    // only atoms and bonds now\n    atoms: [],\n    bonds: []\n  }\n\n  pstruct.atoms.forEach((atom, aid) => {\n    if (!fridMap.has(atom.fragment))\n      fridMap.set(\n        atom.fragment,\n        action.addOp(new FragmentAdd().perform(restruct)).frid\n      )\n\n    const tmpAtom = Object.assign(atom.clone(), {\n      fragment: fridMap.get(atom.fragment)\n    })\n    const operation = new AtomAdd(\n      tmpAtom,\n      Vec2.diff(atom.pp, xy0).rotate(angle).add(point)\n    ).perform(restruct)\n    action.addOp(operation)\n    aidMap.set(aid, operation.data.aid)\n\n    pasteItems.atoms.push(operation.data.aid)\n  })\n\n  pstruct.frags.forEach((frag, frid) => {\n    if (!frag) return\n    frag.stereoAtoms.forEach(aid =>\n      action.addOp(\n        new FragmentAddStereoAtom(fridMap.get(frid), aidMap.get(aid)).perform(\n          restruct\n        )\n      )\n    )\n  })\n\n  pstruct.bonds.forEach(bond => {\n    const operation = new BondAdd(\n      aidMap.get(bond.begin),\n      aidMap.get(bond.end),\n      bond\n    ).perform(restruct)\n    action.addOp(operation)\n\n    pasteItems.bonds.push(operation.data.bid)\n  })\n\n  pstruct.sgroups.forEach(sg => {\n    const newsgid = restruct.molecule.sgroups.newId()\n    const sgAtoms = sg.atoms.map(aid => aidMap.get(aid))\n    const sgAction = fromSgroupAddition(\n      restruct,\n      sg.type,\n      sgAtoms,\n      sg.data,\n      newsgid,\n      sg.pp ? sg.pp.add(offset) : null\n    )\n    sgAction.operations.reverse().forEach(oper => {\n      action.addOp(oper)\n    })\n  })\n\n  pstruct.rxnArrows.forEach(rxnArrow => {\n    action.addOp(\n      new RxnArrowAdd(rxnArrow.mode, rxnArrow.pp.add(offset)).perform(restruct)\n    )\n  })\n\n  pstruct.rxnPluses.forEach(plus => {\n    action.addOp(new RxnPlusAdd(plus.pp.add(offset)).perform(restruct))\n  })\n\n  pstruct.simpleObjects.forEach(simpleObject => {\n    action.addOp(\n      new SimpleObjectAdd(\n        simpleObject.pos.map(p => p.add(offset)),\n        simpleObject.mode\n      ).perform(restruct)\n    )\n  })\n\n  pstruct.texts.forEach(text => {\n    action.addOp(\n      new TextCreate(text.content, text.position.add(offset)).perform(restruct)\n    )\n  })\n\n  pstruct.rgroups.forEach((rg, rgid) => {\n    rg.frags.forEach((frag, frid) => {\n      action.addOp(\n        new RGroupFragment(rgid, fridMap.get(frid)).perform(restruct)\n      )\n    })\n    const ifThen = pstruct.rgroups.get(rgid).ifthen\n    const newRgId = pstruct.rgroups.get(ifThen) ? ifThen : 0\n    action\n      .mergeWith(fromRGroupAttrs(restruct, rgid, rg.getAttrs()))\n      .mergeWith(fromUpdateIfThen(restruct, newRgId, rg.ifthen))\n  })\n\n  action.operations.reverse()\n  return [action, pasteItems]\n}\n\nfunction getStructCenter(struct) {\n  if (struct.atoms.size > 0) {\n    let xmin = 1e50\n    let ymin = xmin\n    let xmax = -xmin\n    let ymax = -ymin\n\n    struct.atoms.forEach(atom => {\n      xmin = Math.min(xmin, atom.pp.x)\n      ymin = Math.min(ymin, atom.pp.y)\n      xmax = Math.max(xmax, atom.pp.x)\n      ymax = Math.max(ymax, atom.pp.y)\n    })\n    return new Vec2((xmin + xmax) / 2, (ymin + ymax) / 2) // TODO: check\n  }\n  if (struct.rxnArrows.size > 0) return struct.rxnArrows.get(0).pp\n  if (struct.rxnPluses.size > 0) return struct.rxnPluses.get(0).pp\n  if (struct.simpleObjects.size > 0) return struct.simpleObjects.get(0).center()\n  if (struct.texts.size > 0) return struct.texts.get(0).position\n\n  return null\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  fromItemsFuse,\n  getHoverToFuse,\n  getItemsToFuse\n} from '../actions/closely-fusing'\n\nimport { fromPaste } from '../actions/paste'\n\nfunction PasteTool(editor, struct) {\n  if (!(this instanceof PasteTool)) return new PasteTool(editor, struct)\n\n  this.editor = editor\n  this.editor.selection(null)\n  this.struct = struct\n\n  const rnd = editor.render\n  const point = editor.lastEvent ? rnd.page2obj(editor.lastEvent) : null\n\n  const [action, pasteItems] = fromPaste(rnd.ctab, this.struct, point)\n  this.action = action\n  this.editor.update(this.action, true)\n\n  this.mergeItems = getItemsToFuse(this.editor, pasteItems)\n  this.editor.hover(getHoverToFuse(this.mergeItems), this)\n}\n\nPasteTool.prototype.mousemove = function (event) {\n  const rnd = this.editor.render\n\n  if (this.action) this.action.perform(rnd.ctab)\n\n  const [action, pasteItems] = fromPaste(\n    rnd.ctab,\n    this.struct,\n    rnd.page2obj(event)\n  )\n  this.action = action\n  this.editor.update(this.action, true)\n\n  this.mergeItems = getItemsToFuse(this.editor, pasteItems)\n  this.editor.hover(getHoverToFuse(this.mergeItems))\n}\n\nPasteTool.prototype.mouseup = function () {\n  const editor = this.editor\n  const restruct = editor.render.ctab\n\n  editor.selection(null)\n\n  this.action = this.action\n    ? fromItemsFuse(restruct, this.mergeItems).mergeWith(this.action)\n    : fromItemsFuse(restruct, this.mergeItems)\n\n  editor.hover(null)\n\n  if (this.action) {\n    const action = this.action\n    delete this.action\n    this.editor.update(action)\n  }\n}\n\nPasteTool.prototype.cancel = function () {\n  const rnd = this.editor.render\n  this.editor.hover(null)\n  if (this.action) {\n    this.action.perform(rnd.ctab) // revert the action\n    delete this.action\n    rnd.update()\n  }\n}\nPasteTool.prototype.mouseleave = PasteTool.prototype.cancel\n\nexport default PasteTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { fromAtomAddition, fromAtomsAttrs } from '../actions/atom'\n\nimport { Atom } from 'ketcher-core'\n\nfunction RGroupAtomTool(editor) {\n  if (!(this instanceof RGroupAtomTool)) {\n    // TODO: map atoms with labels\n    editor.selection(null)\n    return new RGroupAtomTool(editor)\n  }\n\n  this.editor = editor\n}\n\nRGroupAtomTool.prototype.mousemove = function (event) {\n  this.editor.hover(this.editor.findItem(event, ['atoms']))\n}\n\nRGroupAtomTool.prototype.click = function (event) {\n  const rnd = this.editor.render\n  const ci = this.editor.findItem(event, ['atoms'])\n\n  if (!ci) {\n    //  ci.type == 'Canvas'\n    this.editor.hover(null)\n    propsDialog(this.editor, null, rnd.page2obj(event))\n    return true\n  } else if (ci.map === 'atoms') {\n    this.editor.hover(null)\n    propsDialog(this.editor, ci.id)\n    return true\n  }\n  return true\n}\n\nfunction propsDialog(editor, id, pos) {\n  const struct = editor.render.ctab.molecule\n  const atom = id || id === 0 ? struct.atoms.get(id) : null\n  const rglabel = atom ? atom.rglabel : 0\n  const label = atom ? atom.label : 'R#'\n\n  const res = editor.event.elementEdit.dispatch({\n    label: 'R#',\n    rglabel,\n    fragId: atom ? atom.fragment : null\n  })\n\n  Promise.resolve(res)\n    .then(elem => {\n      // TODO review: using Atom.attrlist as a source of default property values\n      elem = Object.assign({}, Atom.attrlist, elem)\n\n      if (!id && id !== 0 && elem.rglabel) {\n        editor.update(fromAtomAddition(editor.render.ctab, pos, elem))\n      } else if (rglabel !== elem.rglabel) {\n        elem.aam = atom.aam // WTF??\n        elem.attpnt = atom.attpnt\n\n        if (!elem.rglabel && label !== 'R#') elem.label = label\n\n        editor.update(fromAtomsAttrs(editor.render.ctab, id, elem))\n      }\n    })\n    .catch(() => null) // w/o changes\n}\n\nexport default RGroupAtomTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  fromRGroupAttrs,\n  fromRGroupFragment,\n  fromUpdateIfThen\n} from '../actions/rgroup'\n\nimport { RGroup } from 'ketcher-core'\n\nfunction RGroupFragmentTool(editor) {\n  if (!(this instanceof RGroupFragmentTool)) {\n    // TODO: check if it's a fragments already\n    editor.selection(null)\n    return new RGroupFragmentTool(editor)\n  }\n\n  this.editor = editor\n}\n\nRGroupFragmentTool.prototype.mousemove = function (event) {\n  this.editor.hover(this.editor.findItem(event, ['frags', 'rgroups']))\n}\n\nRGroupFragmentTool.prototype.click = function (event) {\n  const editor = this.editor\n  const struct = editor.render.ctab.molecule\n  const ci = editor.findItem(event, ['frags', 'rgroups'])\n\n  if (!ci) return true\n\n  this.editor.hover(null)\n\n  const label =\n    ci.map === 'rgroups'\n      ? ci.id\n      : RGroup.findRGroupByFragment(struct.rgroups, ci.id)\n\n  const rg = Object.assign(\n    { label },\n    ci.map === 'frags' ? { fragId: ci.id } : struct.rgroups.get(ci.id)\n  )\n\n  const res = editor.event.rgroupEdit.dispatch(rg)\n\n  Promise.resolve(res)\n    .then(newRg => {\n      const restruct = editor.render.ctab\n\n      let action = null\n      if (ci.map !== 'rgroups') {\n        const rgidOld = RGroup.findRGroupByFragment(\n          restruct.molecule.rgroups,\n          ci.id\n        )\n\n        action = fromRGroupFragment(restruct, newRg.label, ci.id).mergeWith(\n          fromUpdateIfThen(restruct, newRg.label, rgidOld)\n        )\n      } else {\n        action = fromRGroupAttrs(restruct, ci.id, newRg)\n      }\n\n      editor.update(action)\n    })\n    .catch(() => null) // w/o changes\n\n  return true\n}\n\nRGroupFragmentTool.prototype.cancel = function () {\n  this.editor.hover(null)\n}\n\nexport default RGroupFragmentTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport Action from '../shared/action'\nimport { fromArrowAddition } from '../actions/reaction'\nimport { fromMultipleMove } from '../actions/fragment'\n\nfunction ReactionArrowTool(editor, mode) {\n  if (!(this instanceof ReactionArrowTool))\n    return new ReactionArrowTool(editor, mode)\n\n  this.mode = mode\n  this.editor = editor\n  this.editor.selection(null)\n}\n\nReactionArrowTool.prototype.mousedown = function (event) {\n  var rnd = this.editor.render\n  var ci = this.editor.findItem(event, ['rxnArrows'])\n  if (ci && ci.map === 'rxnArrows') {\n    this.editor.hover(null)\n    this.editor.selection({ rxnArrows: [ci.id] })\n    this.dragCtx = {\n      xy0: rnd.page2obj(event),\n      action: new Action()\n    }\n  }\n}\n\nReactionArrowTool.prototype.mousemove = function (event) {\n  var rnd = this.editor.render\n  if ('dragCtx' in this) {\n    if (this.dragCtx.action) this.dragCtx.action.perform(rnd.ctab)\n\n    this.dragCtx.action = fromMultipleMove(\n      rnd.ctab,\n      this.editor.selection() || {},\n      rnd.page2obj(event).sub(this.dragCtx.xy0)\n    )\n    this.editor.update(this.dragCtx.action, true)\n  } else {\n    this.editor.hover(this.editor.findItem(event, ['rxnArrows']))\n  }\n}\n\nReactionArrowTool.prototype.mouseup = function (event) {\n  if (this.dragCtx) {\n    this.editor.update(this.dragCtx.action) // TODO investigate, subsequent undo/redo fails\n    delete this.dragCtx\n  } else {\n    const rnd = this.editor.render\n    this.editor.update(\n      fromArrowAddition(rnd.ctab, rnd.page2obj(event), this.mode)\n    )\n  }\n}\n\nexport default ReactionArrowTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport Action from '../shared/action'\nimport { Scale } from 'ketcher-core'\nimport draw from '../../render/draw'\nimport { fromAtomsAttrs } from '../actions/atom'\n\nfunction ReactionMapTool(editor) {\n  if (!(this instanceof ReactionMapTool)) return new ReactionMapTool(editor)\n\n  this.editor = editor\n  this.editor.selection(null)\n}\n\nReactionMapTool.prototype.mousedown = function (event) {\n  const rnd = this.editor.render\n  this.rcs = rnd.ctab.molecule.getComponents()\n\n  const ci = this.editor.findItem(event, ['atoms'])\n  if (ci && ci.map === 'atoms') {\n    this.editor.hover(null)\n    this.dragCtx = {\n      item: ci,\n      xy0: rnd.page2obj(event)\n    }\n  }\n}\nReactionMapTool.prototype.mousemove = function (event) {\n  var rnd = this.editor.render\n  if ('dragCtx' in this) {\n    var ci = this.editor.findItem(event, ['atoms'], this.dragCtx.item)\n    var atoms = rnd.ctab.molecule.atoms\n    if (\n      ci &&\n      ci.map === 'atoms' &&\n      isValidMap(this.rcs, this.dragCtx.item.id, ci.id)\n    ) {\n      this.editor.hover(ci)\n      this.updateLine(atoms.get(this.dragCtx.item.id).pp, atoms.get(ci.id).pp)\n    } else {\n      this.editor.hover(null)\n      this.updateLine(atoms.get(this.dragCtx.item.id).pp, rnd.page2obj(event))\n    }\n  } else {\n    this.editor.hover(this.editor.findItem(event, ['atoms']))\n  }\n}\n\nReactionMapTool.prototype.updateLine = function (p1, p2) {\n  if (this.line) {\n    this.line.remove()\n    this.line = null\n  }\n  if (p1 && p2) {\n    var rnd = this.editor.render\n    this.line = draw.selectionLine(\n      rnd.paper,\n      Scale.obj2scaled(p1, rnd.options).add(rnd.options.offset),\n      Scale.obj2scaled(p2, rnd.options).add(rnd.options.offset),\n      rnd.options\n    )\n  }\n}\n\nReactionMapTool.prototype.mouseup = function (event) {\n  // eslint-disable-line max-statements\n  if ('dragCtx' in this) {\n    var rnd = this.editor.render\n    var ci = this.editor.findItem(event, ['atoms'], this.dragCtx.item)\n    if (\n      ci &&\n      ci.map === 'atoms' &&\n      isValidMap(this.rcs, this.dragCtx.item.id, ci.id)\n    ) {\n      var action = new Action()\n      var atoms = rnd.ctab.molecule.atoms\n      var atom1 = atoms.get(this.dragCtx.item.id)\n      var atom2 = atoms.get(ci.id)\n      var aam1 = atom1.aam\n      var aam2 = atom2.aam\n      if (!aam1 || aam1 !== aam2) {\n        if ((aam1 && aam1 !== aam2) || (!aam1 && aam2)) {\n          // eslint-disable-line no-mixed-operators\n          atoms.forEach((atom, aid) => {\n            if (\n              aid !== this.dragCtx.item.id &&\n              ((aam1 && atom.aam === aam1) || (aam2 && atom.aam === aam2))\n            )\n              action.mergeWith(fromAtomsAttrs(rnd.ctab, aid, { aam: 0 }))\n          })\n        }\n        if (aam1) {\n          action.mergeWith(fromAtomsAttrs(rnd.ctab, ci.id, { aam: aam1 }))\n        } else {\n          var aam = 0\n          atoms.forEach(atom => {\n            aam = Math.max(aam, atom.aam || 0)\n          })\n          action.mergeWith(\n            fromAtomsAttrs(rnd.ctab, this.dragCtx.item.id, { aam: aam + 1 })\n          )\n          action.mergeWith(fromAtomsAttrs(rnd.ctab, ci.id, { aam: aam + 1 }))\n        }\n        this.editor.update(action)\n      }\n    }\n    this.updateLine(null)\n    delete this.dragCtx\n  }\n  this.editor.hover(null)\n}\n\nfunction isValidMap(rcs, aid1, aid2) {\n  var t1\n  var t2\n  for (var ri = 0; (!t1 || !t2) && ri < rcs.reactants.length; ri++) {\n    var ro = Array.from(rcs.reactants[ri])\n    if (!t1 && ro.indexOf(aid1) >= 0) t1 = 'r'\n    if (!t2 && ro.indexOf(aid2) >= 0) t2 = 'r'\n  }\n  for (var pi = 0; (!t1 || !t2) && pi < rcs.products.length; pi++) {\n    var po = Array.from(rcs.products[pi])\n    if (!t1 && po.indexOf(aid1) >= 0) t1 = 'p'\n    if (!t2 && po.indexOf(aid2) >= 0) t2 = 'p'\n  }\n  return t1 && t2 && t1 !== t2\n}\n\nexport default ReactionMapTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { fromMultipleMove } from '../actions/fragment'\nimport { fromPlusAddition } from '../actions/reaction'\n\nfunction ReactionPlusTool(editor) {\n  if (!(this instanceof ReactionPlusTool)) return new ReactionPlusTool(editor)\n\n  this.editor = editor\n  this.editor.selection(null)\n}\n\nReactionPlusTool.prototype.mousedown = function (event) {\n  var rnd = this.editor.render\n  var ci = this.editor.findItem(event, ['rxnPluses'])\n  if (ci && ci.map === 'rxnPluses') {\n    this.editor.hover(null)\n    this.editor.selection({ rxnPluses: [ci.id] })\n    this.dragCtx = { xy0: rnd.page2obj(event) }\n  }\n}\n\nReactionPlusTool.prototype.mousemove = function (event) {\n  var rnd = this.editor.render\n  if ('dragCtx' in this) {\n    if (this.dragCtx.action) this.dragCtx.action.perform(rnd.ctab)\n    this.dragCtx.action = fromMultipleMove(\n      rnd.ctab,\n      this.editor.selection() || {},\n      rnd.page2obj(event).sub(this.dragCtx.xy0)\n    )\n    this.editor.update(this.dragCtx.action, true)\n  } else {\n    this.editor.hover(this.editor.findItem(event, ['rxnPluses']))\n  }\n}\n\nReactionPlusTool.prototype.mouseup = function () {\n  if (!this.dragCtx) return true\n\n  if (this.dragCtx.action) {\n    this.editor.update(this.dragCtx.action) // TODO investigate, subsequent undo/redo fails\n  }\n\n  delete this.dragCtx\n  return true\n}\n\nReactionPlusTool.prototype.click = function (event) {\n  const rnd = this.editor.render\n  const ci = this.editor.findItem(event, ['rxnPluses'])\n  if (!ci) {\n    this.editor.update(fromPlusAddition(rnd.ctab, rnd.page2obj(event)))\n  }\n}\n\nexport default ReactionPlusTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport Action from '../shared/action'\nimport { fromAtomsAttrs } from '../actions/atom'\n\nfunction ReactionUnmapTool(editor) {\n  if (!(this instanceof ReactionUnmapTool)) return new ReactionUnmapTool(editor)\n\n  this.editor = editor\n  this.editor.selection(null)\n}\nReactionUnmapTool.prototype.mousemove = function (event) {\n  var ci = this.editor.findItem(event, ['atoms'])\n  if (ci && ci.map === 'atoms')\n    this.editor.hover(\n      this.editor.render.ctab.molecule.atoms.get(ci.id).aam ? ci : null\n    )\n  else this.editor.hover(null)\n}\nReactionUnmapTool.prototype.mouseup = function (event) {\n  var ci = this.editor.findItem(event, ['atoms'])\n  var atoms = this.editor.render.ctab.molecule.atoms\n  if (ci && ci.map === 'atoms' && atoms.get(ci.id).aam) {\n    var action = new Action()\n    var aam = atoms.get(ci.id).aam\n    atoms.forEach((atom, aid) => {\n      if (atom.aam === aam)\n        action.mergeWith(\n          fromAtomsAttrs(this.editor.render.ctab, aid, { aam: 0 })\n        )\n    })\n    this.editor.update(action)\n  }\n  this.editor.hover(null)\n}\n\nexport default ReactionUnmapTool\n","import {\n  AtomMove,\n  BondAttr,\n  EnhancedFlagMove,\n  RxnArrowMove,\n  RxnPlusMove,\n  SGroupDataMove\n} from '../operations'\n\nimport { Fragment } from 'ketcher-core'\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Bond, Pile, Vec2 } from 'ketcher-core'\nimport { getRelSgroupsBySelection, structSelection } from './utils'\n\nimport Action from '../shared/action'\nimport utils from '../shared/utils'\n\nexport function fromFlip(restruct, selection, dir, center) {\n  // eslint-disable-line max-statements\n  const struct = restruct.molecule\n\n  const action = new Action()\n\n  if (!selection) selection = structSelection(struct)\n\n  if (!selection.atoms) return action.perform(restruct)\n\n  const fids = selection.atoms.reduce((acc, aid) => {\n    const atom = struct.atoms.get(aid)\n\n    if (!acc[atom.fragment]) acc[atom.fragment] = []\n\n    acc[atom.fragment].push(aid)\n    return acc\n  }, {})\n\n  const isFragFound = Object.keys(fids).find(frag => {\n    frag = parseInt(frag, 10)\n    return !struct.getFragmentIds(frag).equals(new Pile(fids[frag]))\n  })\n\n  if (isFragFound) return action // empty action\n\n  Object.keys(fids).forEach(frag => {\n    const fragment = new Pile(fids[frag])\n\n    const bbox = struct.getCoordBoundingBox(fragment)\n    const calcCenter =\n      center ||\n      new Vec2((bbox.max.x + bbox.min.x) / 2, (bbox.max.y + bbox.min.y) / 2)\n\n    fragment.forEach(aid => {\n      const atom = struct.atoms.get(aid)\n      const d = flipItemByCenter(atom, calcCenter, dir)\n      action.addOp(new AtomMove(aid, d))\n    })\n\n    const sgroups = getRelSgroupsBySelection(restruct, Array.from(fragment))\n    sgroups.forEach(sg => {\n      const d = flipItemByCenter(sg, calcCenter, dir)\n      action.addOp(new SGroupDataMove(sg.id, d))\n    })\n  })\n\n  if (selection.bonds) {\n    selection.bonds.forEach(bid => {\n      const bond = struct.bonds.get(bid)\n\n      if (bond.type !== Bond.PATTERN.TYPE.SINGLE) return\n\n      if (bond.stereo === Bond.PATTERN.STEREO.UP) {\n        action.addOp(new BondAttr(bid, 'stereo', Bond.PATTERN.STEREO.DOWN))\n        return\n      }\n\n      if (bond.stereo === Bond.PATTERN.STEREO.DOWN)\n        action.addOp(new BondAttr(bid, 'stereo', Bond.PATTERN.STEREO.UP))\n    })\n  }\n\n  return action.perform(restruct)\n}\n\nfunction flipItemByCenter(item, center, dir) {\n  const d = new Vec2()\n  /* eslint-disable no-mixed-operators*/\n  if (dir === 'horizontal') {\n    d.x =\n      center.x > item.pp.x\n        ? 2 * (center.x - item.pp.x)\n        : -2 * (item.pp.x - center.x)\n  } else {\n    // 'vertical'\n    d.y =\n      center.y > item.pp.y\n        ? 2 * (center.y - item.pp.y)\n        : -2 * (item.pp.y - center.y)\n  }\n  /* eslint-enable no-mixed-operators*/\n  return d\n}\n\nexport function fromRotate(restruct, selection, center, angle) {\n  // eslint-disable-line\n  const struct = restruct.molecule\n\n  const action = new Action()\n\n  if (!selection) selection = structSelection(struct)\n\n  if (selection.atoms) {\n    selection.atoms.forEach(aid => {\n      const atom = struct.atoms.get(aid)\n      action.addOp(new AtomMove(aid, rotateDelta(atom.pp, center, angle)))\n    })\n\n    if (!selection.sgroupData) {\n      const sgroups = getRelSgroupsBySelection(restruct, selection.atoms)\n\n      sgroups.forEach(sg => {\n        action.addOp(\n          new SGroupDataMove(sg.id, rotateDelta(sg.pp, center, angle))\n        )\n      })\n    }\n  }\n\n  if (selection.rxnArrows) {\n    selection.rxnArrows.forEach(aid => {\n      var arrow = struct.rxnArrows.get(aid)\n      action.addOp(new RxnArrowMove(aid, rotateDelta(arrow.pp, center, angle)))\n    })\n  }\n\n  if (selection.rxnPluses) {\n    selection.rxnPluses.forEach(pid => {\n      var plus = struct.rxnPluses.get(pid)\n      action.addOp(new RxnPlusMove(pid, rotateDelta(plus.pp, center, angle)))\n    })\n  }\n\n  if (selection.sgroupData) {\n    selection.sgroupData.forEach(did => {\n      var data = struct.sgroups.get(did)\n      action.addOp(new SGroupDataMove(did, rotateDelta(data.pp, center, angle)))\n    })\n  }\n\n  const stereoFlags =\n    selection.enhancedFlags || Array.from(restruct.enhancedFlags.keys())\n  if (stereoFlags) {\n    stereoFlags.forEach(flagId => {\n      const frId = flagId\n      const frag = restruct.molecule.frags.get(frId)\n      action.addOp(\n        new EnhancedFlagMove(\n          flagId,\n          rotateDelta(\n            frag.stereoFlagPosition ||\n              Fragment.getDefaultStereoFlagPosition(restruct.molecule, frId),\n            center,\n            angle\n          )\n        )\n      )\n    })\n  }\n\n  return action.perform(restruct)\n}\n\nexport function fromBondAlign(restruct, bid, dir) {\n  const struct = restruct.molecule\n  const bond = struct.bonds.get(bid)\n  const begin = struct.atoms.get(bond.begin)\n  const end = struct.atoms.get(bond.end)\n\n  const center = begin.pp.add(end.pp).scaled(0.5)\n  let angle = utils.calcAngle(begin.pp, end.pp)\n  const atoms = Array.from(struct.getFragmentIds(begin.fragment))\n\n  // TODO: choose minimal angle\n  angle = dir === 'horizontal' ? -angle : Math.PI / 2 - angle\n\n  if (angle === 0 || Math.abs(angle) === Math.PI)\n    return fromFlip(restruct, { atoms }, dir, center)\n\n  return fromRotate(restruct, { atoms }, center, angle)\n}\n\nfunction rotateDelta(v, center, angle) {\n  var v1 = v.sub(center)\n  v1 = v1.rotate(angle)\n  v1.add_(center) // eslint-disable-line no-underscore-dangle\n  return v1.sub(v)\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { fromBondAlign, fromFlip, fromRotate } from '../actions/rotate'\nimport {\n  fromItemsFuse,\n  getHoverToFuse,\n  getItemsToFuse\n} from '../actions/closely-fusing'\n\nimport { Vec2 } from 'ketcher-core'\nimport utils from '../shared/utils'\n\nfunction RotateTool(editor, dir) {\n  if (!(this instanceof RotateTool)) {\n    if (!dir) return new RotateTool(editor)\n\n    const restruct = editor.render.ctab\n    const selection = editor.selection()\n    const singleBond =\n      selection &&\n      selection.bonds &&\n      Object.keys(selection).length === 1 &&\n      selection.bonds.length === 1\n\n    const action = !singleBond\n      ? fromFlip(restruct, selection, dir)\n      : fromBondAlign(restruct, selection.bonds[0], dir)\n    editor.update(action)\n    return null\n  }\n\n  this.editor = editor\n\n  if (!editor.selection() || !editor.selection().atoms)\n    // otherwise, clear selection\n    this.editor.selection(null)\n}\n\nRotateTool.prototype.mousedown = function (event) {\n  var xy0 = new Vec2()\n  var selection = this.editor.selection()\n  var rnd = this.editor.render\n  var struct = rnd.ctab.molecule\n\n  if (selection && selection.atoms) {\n    console.assert(selection.atoms.length > 0)\n\n    var rotId = null\n    var rotAll = false\n\n    selection.atoms.forEach(aid => {\n      var atom = struct.atoms.get(aid)\n\n      xy0.add_(atom.pp) // eslint-disable-line no-underscore-dangle\n\n      if (rotAll) return\n\n      atom.neighbors.find(nei => {\n        var hb = struct.halfBonds.get(nei)\n\n        if (selection.atoms.indexOf(hb.end) === -1) {\n          if (hb.loop >= 0) {\n            var neiAtom = struct.atoms.get(aid)\n            if (\n              !neiAtom.neighbors.find(neiNei => {\n                var neiHb = struct.halfBonds.get(neiNei)\n                return (\n                  neiHb.loop >= 0 && selection.atoms.indexOf(neiHb.end) !== -1\n                )\n              })\n            ) {\n              rotAll = true\n              return true\n            }\n          }\n          if (rotId == null) {\n            rotId = aid\n          } else if (rotId !== aid) {\n            rotAll = true\n            return true\n          }\n        }\n        return false\n      })\n    })\n\n    if (!rotAll && rotId !== null) xy0 = struct.atoms.get(rotId).pp\n    else xy0 = xy0.scaled(1 / selection.atoms.length)\n  } else if (struct.atoms?.size) {\n    struct.atoms.forEach(atom => {\n      xy0.add_(atom.pp)\n    }) // eslint-disable-line no-underscore-dangle, max-len\n    // poor man struct center (without sdata, etc)\n    xy0 = xy0.scaled(1 / struct.atoms.size)\n  } else {\n    xy0 = rnd.page2obj(event)\n  }\n  this.dragCtx = {\n    xy0,\n    angle1: utils.calcAngle(xy0, rnd.page2obj(event))\n  }\n  return true\n}\n\nRotateTool.prototype.mousemove = function (event) {\n  // eslint-disable-line max-statements\n  if (!this.dragCtx) return true\n\n  const rnd = this.editor.render\n  const dragCtx = this.dragCtx\n\n  const pos = rnd.page2obj(event)\n  let angle = utils.calcAngle(dragCtx.xy0, pos) - dragCtx.angle1\n  if (!event.ctrlKey) angle = utils.fracAngle(angle)\n\n  const degrees = utils.degrees(angle)\n\n  if ('angle' in dragCtx && dragCtx.angle === degrees) return true\n  if ('action' in dragCtx) dragCtx.action.perform(rnd.ctab)\n\n  dragCtx.angle = degrees\n  dragCtx.action = fromRotate(\n    rnd.ctab,\n    this.editor.selection(),\n    dragCtx.xy0,\n    angle\n  )\n\n  this.editor.event.message.dispatch({ info: degrees + 'º' })\n\n  const expSel = this.editor.explicitSelected()\n  dragCtx.mergeItems = getItemsToFuse(this.editor, expSel)\n  this.editor.hover(getHoverToFuse(dragCtx.mergeItems))\n\n  this.editor.update(dragCtx.action, true)\n  return true\n}\n\nRotateTool.prototype.mouseup = function () {\n  if (!this.dragCtx) return true\n  const dragCtx = this.dragCtx\n  const restruct = this.editor.render.ctab\n\n  const action = dragCtx.action\n    ? fromItemsFuse(restruct, dragCtx.mergeItems).mergeWith(dragCtx.action)\n    : fromItemsFuse(restruct, dragCtx.mergeItems)\n  delete this.dragCtx\n\n  this.editor.update(action)\n  this.editor.hover(null)\n  if (dragCtx.mergeItems) this.editor.selection(null)\n  this.editor.event.message.dispatch({\n    info: false\n  })\n  return true\n}\n\nRotateTool.prototype.cancel = RotateTool.prototype.mouseup\nRotateTool.prototype.mouseleave = RotateTool.prototype.mouseup\n\nexport default RotateTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  RxnArrowAdd,\n  RxnArrowDelete,\n  RxnPlusAdd,\n  RxnPlusDelete\n} from '../operations'\n\nimport Action from '../shared/action'\n\nexport function fromArrowAddition(restruct, pos, mode) {\n  var action = new Action()\n  action.addOp(new RxnArrowAdd(mode, pos).perform(restruct))\n  return action\n}\n\nexport function fromArrowDeletion(restruct, id) {\n  var action = new Action()\n  action.addOp(new RxnArrowDelete(id))\n  return action.perform(restruct)\n}\n\nexport function fromPlusAddition(restruct, pos) {\n  var action = new Action()\n  action.addOp(new RxnPlusAdd(pos).perform(restruct))\n  return action\n}\n\nexport function fromPlusDeletion(restruct, id) {\n  var action = new Action()\n  action.addOp(new RxnPlusDelete(id))\n  return action.perform(restruct)\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  fromSeveralSgroupAddition,\n  fromSgroupAction,\n  fromSgroupDeletion\n} from '../actions/sgroup'\n\nimport LassoHelper from './helper/lasso'\nimport { Pile } from 'ketcher-core'\nimport { SgContexts } from '../shared/constants'\nimport { checkOverlapping } from 'ketcher-core'\nimport { isEqual } from 'lodash/fp'\n\nconst searchMaps = ['atoms', 'bonds', 'sgroups', 'sgroupData']\n\nfunction SGroupTool(editor, type) {\n  if (!(this instanceof SGroupTool)) {\n    var selection = editor.selection() || {}\n    if (!selection.atoms && !selection.bonds)\n      return new SGroupTool(editor, type)\n\n    var sgroups = editor.render.ctab.molecule.sgroups\n    var selectedAtoms = editor.selection().atoms\n\n    var id = sgroups.find((_, sgroup) => isEqual(sgroup.atoms, selectedAtoms))\n\n    sgroupDialog(editor, id !== undefined ? id : null, type)\n    return null\n  }\n\n  this.editor = editor\n  this.type = type\n\n  this.lassoHelper = new LassoHelper(1, editor)\n  this.editor.selection(null)\n}\n\nSGroupTool.prototype.mousedown = function (event) {\n  var ci = this.editor.findItem(event, searchMaps)\n  if (!ci)\n    //  ci.type == 'Canvas'\n    this.lassoHelper.begin(event)\n}\n\nSGroupTool.prototype.mousemove = function (event) {\n  if (this.lassoHelper.running(event))\n    this.editor.selection(this.lassoHelper.addPoint(event))\n  else this.editor.hover(this.editor.findItem(event, searchMaps))\n}\n\nSGroupTool.prototype.mouseleave = function (event) {\n  if (this.lassoHelper.running(event)) this.lassoHelper.end(event)\n}\n\nSGroupTool.prototype.mouseup = function (event) {\n  var id = null // id of an existing group, if we're editing one\n  var selection = null // atoms to include in a newly created group\n  if (this.lassoHelper.running(event)) {\n    // TODO it catches more events than needed, to be re-factored\n    selection = this.lassoHelper.end(event)\n  } else {\n    var ci = this.editor.findItem(event, searchMaps)\n    if (!ci)\n      // ci.type == 'Canvas'\n      return\n    this.editor.hover(null)\n\n    if (ci.map === 'atoms') {\n      // if we click the SGroup tool on a single atom or bond, make a group out of those\n      selection = { atoms: [ci.id] }\n    } else if (ci.map === 'bonds') {\n      var bond = this.editor.render.ctab.bonds.get(ci.id)\n      selection = { atoms: [bond.b.begin, bond.b.end] }\n    } else if (ci.map === 'sgroups' || ci.map === 'sgroupData') {\n      id = ci.id\n    } else {\n      return\n    }\n  }\n\n  // TODO: handle click on an existing group?\n  if (id !== null || (selection && selection.atoms))\n    sgroupDialog(this.editor, id, this.type)\n}\n\nSGroupTool.prototype.cancel = function () {\n  if (this.lassoHelper.running()) this.lassoHelper.end()\n  this.editor.selection(null)\n}\n\nexport function sgroupDialog(editor, id, defaultType) {\n  const restruct = editor.render.ctab\n  const struct = restruct.molecule\n  const selection = editor.selection() || {}\n  const sg = id !== null ? struct.sgroups.get(id) : null\n  const type = sg ? sg.type : defaultType\n  const eventName = type === 'DAT' ? 'sdataEdit' : 'sgroupEdit'\n\n  if (!selection.atoms && !selection.bonds && !sg) {\n    console.info('There is no selection or sgroup')\n    return\n  }\n\n  let attrs = null\n  if (sg) {\n    attrs = sg.getAttrs()\n    attrs.context = getContextBySgroup(restruct, sg.atoms)\n  } else {\n    attrs = {\n      context: getContextBySelection(restruct, selection)\n    }\n  }\n\n  const res = editor.event[eventName].dispatch({\n    type,\n    attrs\n  })\n\n  Promise.resolve(res)\n    .then(newSg => {\n      // TODO: check before signal\n      if (\n        newSg.type !== 'DAT' && // when data s-group separates\n        checkOverlapping(struct, selection.atoms || [])\n      ) {\n        editor.event.message.dispatch({\n          error: 'Partial S-group overlapping is not allowed.'\n        })\n      } else {\n        if (\n          !sg &&\n          newSg.type !== 'DAT' &&\n          (!selection.atoms || selection.atoms.length === 0)\n        )\n          return\n\n        const isDataSg = sg && sg.getAttrs().context === newSg.attrs.context\n\n        if (isDataSg) {\n          const action = fromSeveralSgroupAddition(\n            restruct,\n            newSg.type,\n            sg.atoms,\n            newSg.attrs\n          ).mergeWith(fromSgroupDeletion(restruct, id))\n\n          editor.update(action)\n          editor.selection(selection)\n          return\n        }\n\n        const result = fromContextType(id, editor, newSg, selection)\n        editor.update(result.action)\n        editor.selection(null)\n      }\n    })\n    .catch(() => null)\n}\n\nfunction getContextBySgroup(restruct, sgAtoms) {\n  const struct = restruct.molecule\n\n  if (sgAtoms.length === 1) return SgContexts.Atom\n\n  if (manyComponentsSelected(restruct, sgAtoms)) return SgContexts.Multifragment\n\n  if (singleComponentSelected(restruct, sgAtoms)) return SgContexts.Fragment\n\n  const atomSet = new Pile(sgAtoms)\n\n  const sgBonds = Array.from(struct.bonds.values()).filter(\n    bond => atomSet.has(bond.begin) && atomSet.has(bond.end)\n  )\n\n  return anyChainedBonds(sgBonds) ? SgContexts.Group : SgContexts.Bond\n}\n\nfunction getContextBySelection(restruct, selection) {\n  const struct = restruct.molecule\n\n  if (selection.atoms && !selection.bonds) return SgContexts.Atom\n\n  const bonds = selection.bonds.map(bondid => struct.bonds.get(bondid))\n\n  if (!anyChainedBonds(bonds)) return SgContexts.Bond\n\n  selection.atoms = selection.atoms || []\n\n  const atomSet = new Pile(selection.atoms)\n  const allBondsSelected = bonds.every(\n    bond => atomSet.has(bond.begin) && atomSet.has(bond.end)\n  )\n\n  if (singleComponentSelected(restruct, selection.atoms) && allBondsSelected)\n    return SgContexts.Fragment\n\n  return manyComponentsSelected(restruct, selection.atoms)\n    ? SgContexts.Multifragment\n    : SgContexts.Group\n}\n\nfunction fromContextType(id, editor, newSg, currSelection) {\n  const restruct = editor.render.ctab\n  const sg = restruct.molecule.sgroups.get(id)\n  const sourceAtoms = (sg && sg.atoms) || currSelection.atoms || []\n  const context = newSg.attrs.context\n\n  const result = fromSgroupAction(\n    context,\n    restruct,\n    newSg,\n    sourceAtoms,\n    currSelection\n  )\n\n  result.selection = result.selection || currSelection\n\n  if (id !== null && id !== undefined)\n    result.action = result.action.mergeWith(fromSgroupDeletion(restruct, id))\n\n  editor.selection(result.selection)\n\n  return result\n}\n\nfunction anyChainedBonds(bonds) {\n  if (bonds.length === 0) return true\n\n  for (let i = 0; i < bonds.length; ++i) {\n    const fixedBond = bonds[i]\n    for (let j = 0; j < bonds.length; ++j) {\n      if (i === j) continue\n\n      const bond = bonds[j]\n\n      if (fixedBond.end === bond.begin || fixedBond.end === bond.end)\n        return true\n    }\n  }\n\n  return false\n}\n\nfunction singleComponentSelected(restruct, atoms) {\n  return countOfSelectedComponents(restruct, atoms) === 1\n}\n\nfunction manyComponentsSelected(restruct, atoms) {\n  return countOfSelectedComponents(restruct, atoms) > 1\n}\n\nfunction countOfSelectedComponents(restruct, atoms) {\n  const atomSet = new Pile(atoms)\n\n  return Array.from(restruct.connectedComponents.values()).reduce(\n    (acc, component) => acc + (atomSet.isSuperset(component) ? 1 : 0),\n    0\n  )\n}\n\nexport default SGroupTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  fromItemsFuse,\n  getHoverToFuse,\n  getItemsToFuse\n} from '../actions/closely-fusing'\nimport { fromTextDeletion, fromTextUpdating } from '../actions/text'\n\nimport LassoHelper from './helper/lasso'\nimport { SGroup } from 'ketcher-core'\nimport { atomLongtapEvent } from './atom'\nimport { fromAtomsAttrs } from '../actions/atom'\nimport { fromBondsAttrs } from '../actions/bond'\nimport { fromMultipleMove } from '../actions/fragment'\nimport { sgroupDialog } from './sgroup'\nimport utils from '../shared/utils'\nimport { xor } from 'lodash/fp'\n\nfunction SelectTool(editor, mode) {\n  if (!(this instanceof SelectTool)) return new SelectTool(editor, mode)\n\n  this.editor = editor\n  this.lassoHelper = new LassoHelper(\n    mode === 'lasso' ? 0 : 1,\n    editor,\n    mode === 'fragment'\n  )\n}\n\nSelectTool.prototype.mousedown = function (event) {\n  // eslint-disable-line max-statements\n  const rnd = this.editor.render\n  const ctab = rnd.ctab\n  const struct = ctab.molecule\n\n  this.editor.hover(null) // TODO review hovering for touch devicess\n\n  const selectFragment = this.lassoHelper.fragment || event.ctrlKey\n  const ci = this.editor.findItem(\n    event,\n    selectFragment\n      ? [\n          'frags',\n          'sgroups',\n          'sgroupData',\n          'rgroups',\n          'rxnArrows',\n          'rxnPluses',\n          'enhancedFlags',\n          'simpleObjects',\n          'texts'\n        ]\n      : [\n          'atoms',\n          'bonds',\n          'sgroups',\n          'sgroupData',\n          'rgroups',\n          'rxnArrows',\n          'rxnPluses',\n          'enhancedFlags',\n          'simpleObjects',\n          'texts'\n        ]\n  )\n\n  this.dragCtx = {\n    item: ci,\n    xy0: rnd.page2obj(event)\n  }\n\n  if (!ci || ci.map === 'atoms') atomLongtapEvent(this, rnd)\n\n  if (!ci) {\n    //  ci.type == 'Canvas'\n    delete this.dragCtx.item\n    if (!this.lassoHelper.fragment) this.lassoHelper.begin(event)\n    return true\n  }\n\n  let sel = closestToSel(ci)\n  const selection = this.editor.selection()\n  if (ci.map === 'frags') {\n    const frag = ctab.frags.get(ci.id)\n    sel = {\n      atoms: frag.fragGetAtoms(ctab, ci.id),\n      bonds: frag.fragGetBonds(ctab, ci.id)\n    }\n  } else if (ci.map === 'sgroups') {\n    const sgroup = ctab.sgroups.get(ci.id).item\n    sel = {\n      atoms: SGroup.getAtoms(struct, sgroup),\n      bonds: SGroup.getBonds(struct, sgroup)\n    }\n  } else if (ci.map === 'rgroups') {\n    const rgroup = ctab.rgroups.get(ci.id)\n    sel = {\n      atoms: rgroup.getAtoms(rnd),\n      bonds: rgroup.getBonds(rnd)\n    }\n  } else if (ci.map === 'sgroupData') {\n    if (isSelected(selection, ci)) return true\n  }\n\n  if (!event.shiftKey)\n    this.editor.selection(isSelected(selection, ci) ? selection : sel)\n  else this.editor.selection(selMerge(sel, selection, true))\n  return true\n}\n\nSelectTool.prototype.mousemove = function (event) {\n  const editor = this.editor\n  const rnd = editor.render\n  const restruct = editor.render.ctab\n  const dragCtx = this.dragCtx\n  if (dragCtx && dragCtx.stopTapping) dragCtx.stopTapping()\n  if (dragCtx && dragCtx.item) {\n    const atoms = restruct.molecule.atoms\n    const selection = editor.selection()\n    const shouldDisplayDegree =\n      dragCtx.item.map === 'atoms' &&\n      atoms.get(dragCtx.item.id).neighbors.length === 1 &&\n      selection.atoms.length === 1 &&\n      !selection.bonds\n    if (shouldDisplayDegree) {\n      // moving selected objects\n      const pos = rnd.page2obj(event)\n      const angle = utils.calcAngle(dragCtx.xy0, pos)\n      const degrees = utils.degrees(angle)\n      this.editor.event.message.dispatch({ info: degrees + 'º' })\n    }\n    if (dragCtx.action) {\n      dragCtx.action.perform(restruct)\n      // redraw the elements in unshifted position, lest the have different offset\n      editor.update(dragCtx.action, true)\n    }\n\n    const expSel = editor.explicitSelected()\n    dragCtx.action = fromMultipleMove(\n      restruct,\n      expSel,\n      editor.render.page2obj(event).sub(dragCtx.xy0)\n    )\n\n    dragCtx.mergeItems = getItemsToFuse(editor, expSel)\n    editor.hover(getHoverToFuse(dragCtx.mergeItems))\n\n    editor.update(dragCtx.action, true)\n    return true\n  }\n\n  if (this.lassoHelper.running()) {\n    const sel = this.lassoHelper.addPoint(event)\n    editor.selection(\n      !event.shiftKey ? sel : selMerge(sel, editor.selection(), false)\n    )\n    return true\n  }\n\n  const maps =\n    this.lassoHelper.fragment || event.ctrlKey\n      ? [\n          'frags',\n          'sgroups',\n          'sgroupData',\n          'rgroups',\n          'rxnArrows',\n          'rxnPluses',\n          'enhancedFlags',\n          'simpleObjects',\n          'texts'\n        ]\n      : [\n          'atoms',\n          'bonds',\n          'sgroups',\n          'sgroupData',\n          'rgroups',\n          'rxnArrows',\n          'rxnPluses',\n          'enhancedFlags',\n          'simpleObjects',\n          'texts'\n        ]\n\n  editor.hover(editor.findItem(event, maps))\n\n  return true\n}\n\nSelectTool.prototype.mouseup = function (event) {\n  // eslint-disable-line max-statements\n  const editor = this.editor\n  const restruct = editor.render.ctab\n  const dragCtx = this.dragCtx\n\n  if (dragCtx && dragCtx.stopTapping) dragCtx.stopTapping()\n\n  if (dragCtx && dragCtx.item) {\n    dragCtx.action = dragCtx.action\n      ? fromItemsFuse(restruct, dragCtx.mergeItems).mergeWith(dragCtx.action)\n      : fromItemsFuse(restruct, dragCtx.mergeItems)\n\n    editor.hover(null)\n    if (dragCtx.mergeItems) editor.selection(null)\n    if (dragCtx.action.operations.length !== 0) editor.update(dragCtx.action)\n\n    delete this.dragCtx\n  } else if (this.lassoHelper.running()) {\n    // TODO it catches more events than needed, to be re-factored\n    const sel = this.lassoHelper.end()\n    editor.selection(!event.shiftKey ? sel : selMerge(sel, editor.selection()))\n  } else if (this.lassoHelper.fragment) {\n    if (!event.shiftKey) editor.selection(null)\n  }\n  this.editor.event.message.dispatch({\n    info: false\n  })\n  return true\n}\n\nSelectTool.prototype.dblclick = function (event) {\n  // eslint-disable-line max-statements\n  var editor = this.editor\n  var rnd = this.editor.render\n  var ci = this.editor.findItem(event, [\n    'atoms',\n    'bonds',\n    'sgroups',\n    'sgroupData',\n    'texts'\n  ])\n  if (!ci) return true\n\n  var struct = rnd.ctab.molecule\n  if (ci.map === 'atoms') {\n    this.editor.selection(closestToSel(ci))\n    var atom = struct.atoms.get(ci.id)\n    var ra = editor.event.elementEdit.dispatch(atom)\n    Promise.resolve(ra)\n      .then(newatom => {\n        // TODO: deep compare to not produce dummy, e.g.\n        // atom.label != attrs.label || !atom.atomList.equals(attrs.atomList)\n        editor.update(fromAtomsAttrs(rnd.ctab, ci.id, newatom))\n      })\n      .catch(() => null) // w/o changes\n  } else if (ci.map === 'bonds') {\n    this.editor.selection(closestToSel(ci))\n    var bond = rnd.ctab.bonds.get(ci.id).b\n    var rb = editor.event.bondEdit.dispatch(bond)\n    Promise.resolve(rb)\n      .then(newbond => {\n        editor.update(fromBondsAttrs(rnd.ctab, ci.id, newbond))\n      })\n      .catch(() => null) // w/o changes\n  } else if (ci.map === 'sgroups' || ci.map === 'sgroupData') {\n    this.editor.selection(closestToSel(ci))\n    sgroupDialog(this.editor, ci.id)\n  } else if (ci.map === 'texts') {\n    this.editor.selection(closestToSel(ci))\n    const text = struct.texts.get(ci.id)\n    const dialog = editor.event.elementEdit.dispatch({ ...text, type: 'text' })\n\n    dialog\n      .then(({ content }) => {\n        if (!content) {\n          editor.update(fromTextDeletion(editor.render.ctab, ci.id))\n        } else if (content !== text.content) {\n          editor.update(fromTextUpdating(editor.render.ctab, ci.id, content))\n        }\n      })\n      .catch(() => null)\n  }\n  return true\n}\n\nSelectTool.prototype.cancel = function () {\n  if (this.dragCtx && this.dragCtx.stopTapping) this.dragCtx.stopTapping()\n\n  if (this.dragCtx && this.dragCtx.action) {\n    var action = this.dragCtx.action\n    this.editor.update(action)\n  }\n  if (this.lassoHelper.running()) this.editor.selection(this.lassoHelper.end())\n\n  delete this.dragCtx\n\n  this.editor.hover(null)\n}\nSelectTool.prototype.mouseleave = SelectTool.prototype.cancel\n\nfunction closestToSel(ci) {\n  const res = {}\n  res[ci.map] = [ci.id]\n  return res\n}\n\n// TODO: deep-merge?\nfunction selMerge(selection, add, reversible) {\n  if (add) {\n    Object.keys(add).forEach(item => {\n      if (!selection[item]) selection[item] = add[item].slice()\n      else selection[item] = uniqArray(selection[item], add[item], reversible)\n    })\n  }\n  return selection\n}\n\nfunction isSelected(selection, item) {\n  return (\n    selection && selection[item.map] && selection[item.map].includes(item.id)\n  )\n}\n\nfunction uniqArray(dest, add, reversible) {\n  return add.reduce((res, item) => {\n    if (reversible) dest = xor(dest, [item])\n    else if (!dest.includes(item)) dest.push(item)\n    return dest\n  }, [])\n}\n\nexport default SelectTool\n","import {\n  fromSimpleObjectAddition,\n  fromSimpleObjectDeletion,\n  fromSimpleObjectResizing\n} from '../actions/simpleobject'\n\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { fromMultipleMove } from '../actions/fragment'\n\nfunction SimpleObjectTool(editor, mode) {\n  if (!(this instanceof SimpleObjectTool))\n    return new SimpleObjectTool(editor, mode)\n\n  this.mode = mode\n  this.editor = editor\n  this.editor.selection(null)\n}\n\nSimpleObjectTool.prototype.mousedown = function (event) {\n  var rnd = this.editor.render\n  const p0 = rnd.page2obj(event)\n  this.dragCtx = { p0 }\n\n  var ci = this.editor.findItem(event, ['simpleObjects'])\n  if (ci && ci.map === 'simpleObjects') {\n    this.editor.hover(null)\n    this.editor.selection({ simpleObjects: [ci.id] })\n    this.dragCtx.ci = ci\n  } else {\n    this.dragCtx.isNew = true\n    this.editor.selection(null)\n  }\n}\n\nSimpleObjectTool.prototype.mousemove = function (event) {\n  var rnd = this.editor.render\n  if (this.dragCtx) {\n    const current = rnd.page2obj(event)\n    const diff = current.sub(this.dragCtx.p0)\n    this.dragCtx.previous = current\n    if (this.dragCtx.ci) {\n      if (this.dragCtx.action) this.dragCtx.action.perform(rnd.ctab)\n      if (!this.dragCtx.ci.ref) {\n        this.dragCtx.action = fromMultipleMove(\n          rnd.ctab,\n          this.editor.selection() || {},\n          diff\n        )\n      } else {\n        this.dragCtx.action = fromSimpleObjectResizing(\n          rnd.ctab,\n          this.dragCtx.ci.id,\n          diff,\n          current,\n          this.dragCtx.ci.ref,\n          event.shiftKey\n        )\n      }\n      this.editor.update(this.dragCtx.action, true)\n    } else {\n      if (!this.dragCtx.action) {\n        const action = fromSimpleObjectAddition(\n          rnd.ctab,\n          [this.dragCtx.p0, this.dragCtx.p0],\n          this.mode\n        )\n        //TODO: need to rework  actions/operations logic\n        const addOperation = action.operations[0]\n        const itemId = addOperation.data.id\n        this.dragCtx.itemId = itemId\n        this.dragCtx.action = action\n        this.editor.update(this.dragCtx.action, true)\n      } else {\n        this.dragCtx.action.perform(rnd.ctab)\n      }\n\n      this.dragCtx.action = fromSimpleObjectResizing(\n        rnd.ctab,\n        this.dragCtx.itemId,\n        diff,\n        current,\n        null,\n        event.shiftKey\n      )\n      this.editor.update(this.dragCtx.action, true)\n    }\n  } else {\n    const items = this.editor.findItem(event, ['simpleObjects'])\n    this.editor.hover(items)\n  }\n}\n\nSimpleObjectTool.prototype.mouseup = function (event) {\n  if (!this.dragCtx) return true\n\n  if (this.dragCtx.action) {\n    if (this.dragCtx.isNew) {\n      const rnd = this.editor.render\n      this.editor.update(\n        fromSimpleObjectDeletion(rnd.ctab, this.dragCtx.itemId),\n        true\n      )\n      this.dragCtx.action = fromSimpleObjectAddition(\n        rnd.ctab,\n        [this.dragCtx.p0, this.dragCtx.previous],\n        this.mode,\n        event.shiftKey\n      )\n    }\n    this.editor.update(this.dragCtx.action)\n  }\n\n  delete this.dragCtx\n  return true\n}\n\nexport default SimpleObjectTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Bond, MolSerializer } from 'ketcher-core'\n\nimport Action from '../shared/action'\nimport { BondAttr } from '../operations'\n\n/**\n * @param restruct { ReStruct }\n * @param events { Array<PipelineSubscription> }\n * @param bid { number }\n * @param template {{\n * \t\tmolecule: Struct,\n * \t\tbid: number\n *  }}\n * @param simpleFusing { Function }\n * @returns { Promise }\n */\nexport function fromAromaticTemplateOnBond(\n  restruct,\n  template,\n  bid,\n  events,\n  simpleFusing\n) {\n  const tmpl = template.molecule\n  const struct = restruct.molecule\n\n  const frid = struct.getBondFragment(bid)\n  const beforeMerge = getFragmentWithBondMap(struct, frid)\n  let afterMerge = null\n  let pasteItems = null\n\n  let action = new Action()\n\n  if (true) {\n    action = simpleFusing(restruct, template, bid)\n    return Promise.resolve(action)\n  }\n\n  const molSerialzer = new MolSerializer()\n\n  return Promise.all([\n    events.aromatizeStruct\n      .dispatch(beforeMerge.frag)\n      .then(res => molSerialzer.deserialize(res.struct)),\n    events.aromatizeStruct\n      .dispatch(tmpl)\n      .then(res => molSerialzer.deserialize(res.struct))\n  ])\n    .then(([astruct, atmpl]) => {\n      // aromatize restruct fragment\n      const aromatizeAction = fromAromatize(\n        restruct,\n        astruct,\n        beforeMerge.bondMap\n      )\n      // merge template with fragment\n      const aromTemplate = { bid: template.bid, molecule: atmpl }\n      const templateFusingAction = simpleFusing(restruct, aromTemplate, bid)\n      pasteItems = templateFusingAction[1]\n\n      action = templateFusingAction[0].mergeWith(aromatizeAction)\n\n      afterMerge = getFragmentWithBondMap(restruct.molecule, frid)\n\n      return events.dearomatizeStruct\n        .dispatch(afterMerge.frag)\n        .then(res => molSerialzer.deserialize(res.struct))\n    })\n    .then(destruct => {\n      destruct.bonds.forEach(bond => {\n        if (bond.type === Bond.PATTERN.TYPE.AROMATIC)\n          throw Error('Bad dearomatize')\n      })\n\n      // dearomatize restruct fragment\n      const dearomatizeAction = fromDearomatize(\n        restruct,\n        destruct,\n        afterMerge.bondMap\n      )\n      action = dearomatizeAction.mergeWith(action)\n\n      return [action, pasteItems]\n    })\n    .catch(err => {\n      console.info(err.message)\n      action.perform(restruct) // revert actions if error\n\n      return simpleFusing(restruct, template, bid)\n    })\n}\n\nfunction fromAromatize(restruct, astruct, bondMap) {\n  const action = new Action()\n\n  astruct.bonds.forEach((bond, bid) => {\n    if (bond.type !== Bond.PATTERN.TYPE.AROMATIC) return\n    action.addOp(\n      new BondAttr(\n        bondMap.get(bid),\n        'type',\n        Bond.PATTERN.TYPE.AROMATIC\n      ).perform(restruct)\n    )\n  })\n\n  return action\n}\n\n/**\n * @param restruct { ReStruct }\n * @param dastruct { ReStruct }\n * @param bondMap { Map<number, number> }\n * @returns { Action }\n */\nfunction fromDearomatize(restruct, dastruct, bondMap) {\n  const action = new Action()\n\n  dastruct.bonds.forEach((bond, bid) => {\n    action.addOp(\n      new BondAttr(bondMap.get(bid), 'type', bond.type).perform(restruct)\n    )\n  })\n\n  return action\n}\n\n/* UTILS */\n\nfunction canBeAromatized(struct) {\n  // TODO correct this checking && move to chem.Struct ??\n  if (struct.loops.size === 0) struct.prepareLoopStructure()\n\n  const hasAromLoop = struct.loops.find((id, loop) => loop.aromatic)\n  if (struct.loops.size === 0 || hasAromLoop) return false\n\n  const correctDblBonds = struct.loops.find(\n    (id, loop) => loop.dblBonds === loop.hbs.length / 2\n  )\n\n  return correctDblBonds !== undefined\n}\n\n/**\n * @param struct { Struct }\n * @param frid { number }\n * @returns {{\n * \t\tfrag: Struct,\n * \t\tbondMap: Map<number, number>\n *  }}\n */\nfunction getFragmentWithBondMap(struct, frid) {\n  const atomSet = struct.getFragmentIds(frid)\n  const atomsInStruct = Array.from(atomSet)\n\n  const frag = struct.clone(atomSet)\n  const bondMap = new Map()\n  frag.bonds.forEach((bond, bid) => {\n    bondMap.set(\n      bid,\n      struct.findBondId(atomsInStruct[bond.begin], atomsInStruct[bond.end])\n    )\n  })\n\n  return { frag, bondMap }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Atom, Vec2 } from 'ketcher-core'\nimport { AtomAdd, BondAdd, CalcImplicitH } from '../operations'\nimport { atomForNewBond, atomGetAttr } from './utils'\nimport { fromAtomsAttrs, mergeSgroups } from './atom'\nimport { fromBondAddition, fromBondStereoUpdate, fromBondsAttrs } from './bond'\n\nimport Action from '../shared/action'\nimport closest from '../shared/closest'\nimport { fromAromaticTemplateOnBond } from './aromatic-fusing'\nimport { fromPaste } from './paste'\nimport utils from '../shared/utils'\n\nexport function fromTemplateOnCanvas(restruct, template, pos, angle) {\n  const [action, pasteItems] = fromPaste(\n    restruct,\n    template.molecule,\n    pos,\n    angle\n  )\n\n  action.addOp(new CalcImplicitH(pasteItems.atoms).perform(restruct))\n\n  return [action, pasteItems]\n}\n\nfunction extraBondAction(restruct, aid, angle) {\n  let action = new Action()\n  const frid = atomGetAttr(restruct, aid, 'fragment')\n  let additionalAtom = null\n\n  if (angle === null) {\n    const middleAtom = atomForNewBond(restruct, aid)\n    const actionRes = fromBondAddition(\n      restruct,\n      { type: 1 },\n      aid,\n      middleAtom.atom,\n      middleAtom.pos.get_xy0()\n    )\n    action = actionRes[0]\n    action.operations.reverse()\n    additionalAtom = actionRes[2]\n  } else {\n    const operation = new AtomAdd(\n      { label: 'C', fragment: frid },\n      new Vec2(1, 0)\n        .rotate(angle)\n        .add(restruct.molecule.atoms.get(aid).pp)\n        .get_xy0()\n    ).perform(restruct)\n\n    action.addOp(operation)\n    action.addOp(\n      new BondAdd(aid, operation.data.aid, { type: 1 }).perform(restruct)\n    )\n\n    additionalAtom = operation.data.aid\n  }\n\n  return { action, aid1: additionalAtom }\n}\n\nexport function fromTemplateOnAtom(restruct, template, aid, angle, extraBond) {\n  let action = new Action()\n\n  const tmpl = template.molecule\n  const struct = restruct.molecule\n\n  let atom = struct.atoms.get(aid) // aid - the atom that was clicked on\n  let aid1 = aid // aid1 - the atom on the other end of the extra bond || aid\n\n  let delta = null\n\n  if (extraBond) {\n    // create extra bond after click on atom\n    const extraRes = extraBondAction(restruct, aid, angle)\n    action = extraRes.action\n    aid1 = extraRes.aid1\n\n    atom = struct.atoms.get(aid1)\n    delta = utils.calcAngle(struct.atoms.get(aid).pp, atom.pp) - template.angle0\n  } else {\n    if (angle === null)\n      angle = utils.calcAngle(atom.pp, atomForNewBond(restruct, aid).pos)\n    delta = angle - template.angle0\n  }\n\n  const map = new Map()\n  const xy0 = tmpl.atoms.get(template.aid).pp\n  const frid = atomGetAttr(restruct, aid, 'fragment')\n\n  /* For merge */\n  const pasteItems = {\n    // only atoms and bonds now\n    atoms: [],\n    bonds: []\n  }\n  /* ----- */\n\n  tmpl.atoms.forEach((a, id) => {\n    const attrs = Atom.getAttrHash(a)\n    attrs.fragment = frid\n\n    if (id === template.aid) {\n      action.mergeWith(fromAtomsAttrs(restruct, aid1, attrs, true))\n      map.set(id, aid1)\n      pasteItems.atoms.push(aid1)\n    } else {\n      const v = Vec2.diff(a.pp, xy0).rotate(delta).add(atom.pp)\n\n      const operation = new AtomAdd(attrs, v.get_xy0()).perform(restruct)\n      action.addOp(operation)\n      map.set(id, operation.data.aid)\n      pasteItems.atoms.push(operation.data.aid)\n    }\n  })\n  mergeSgroups(action, restruct, pasteItems.atoms, aid)\n\n  tmpl.bonds.forEach(bond => {\n    const operation = new BondAdd(\n      map.get(bond.begin),\n      map.get(bond.end),\n      bond\n    ).perform(restruct)\n    action.addOp(operation)\n\n    pasteItems.bonds.push(operation.data.bid)\n  })\n\n  action.operations.reverse()\n\n  action.addOp(new CalcImplicitH(pasteItems.atoms).perform(restruct))\n  action.mergeWith(\n    fromBondStereoUpdate(\n      restruct,\n      restruct.molecule.bonds.get(pasteItems.bonds[0])\n    )\n  )\n\n  return [action, pasteItems]\n}\n\nexport function fromTemplateOnBondAction(\n  restruct,\n  template,\n  bid,\n  events,\n  flip,\n  force\n) {\n  if (!force) return fromTemplateOnBond(restruct, template, bid, flip)\n\n  const simpleFusing = (restruct, template, bid) =>\n    fromTemplateOnBond(restruct, template, bid, flip) // eslint-disable-line\n  /* aromatic merge (Promise)*/\n  return fromAromaticTemplateOnBond(\n    restruct,\n    template,\n    bid,\n    events,\n    simpleFusing\n  )\n}\n\nfunction fromTemplateOnBond(restruct, template, bid, flip) {\n  // TODO: refactor function !!\n  const action = new Action()\n\n  const tmpl = template.molecule\n  const struct = restruct.molecule\n\n  const bond = struct.bonds.get(bid)\n  const tmplBond = tmpl.bonds.get(template.bid)\n\n  const tmplBegin = tmpl.atoms.get(flip ? tmplBond.end : tmplBond.begin)\n\n  const atomsMap = new Map([\n    [tmplBond.begin, flip ? bond.end : bond.begin],\n    [tmplBond.end, flip ? bond.begin : bond.end]\n  ])\n\n  // calc angle\n  const bondAtoms = {\n    begin: flip ? tmplBond.end : tmplBond.begin,\n    end: flip ? tmplBond.begin : tmplBond.end\n  }\n  const { angle, scale } = utils.mergeBondsParams(struct, bond, tmpl, bondAtoms)\n\n  const frid = struct.getBondFragment(bid)\n\n  /* For merge */\n  const pasteItems = {\n    // only atoms and bonds now\n    atoms: [],\n    bonds: []\n  }\n  /* ----- */\n\n  tmpl.atoms.forEach((atom, id) => {\n    const attrs = Atom.getAttrHash(atom)\n    attrs.fragment = frid\n    if (id === tmplBond.begin || id === tmplBond.end) {\n      action.mergeWith(fromAtomsAttrs(restruct, atomsMap.get(id), attrs, true))\n      return\n    }\n\n    const v = Vec2.diff(atom.pp, tmplBegin.pp)\n      .rotate(angle)\n      .scaled(scale)\n      .add(struct.atoms.get(bond.begin).pp)\n    const mergeA = closest.atom(restruct, v, null, 0.1)\n\n    if (mergeA === null) {\n      const operation = new AtomAdd(attrs, v).perform(restruct)\n      action.addOp(operation)\n      atomsMap.set(id, operation.data.aid)\n      pasteItems.atoms.push(operation.data.aid)\n    } else {\n      atomsMap.set(id, mergeA.id)\n\n      action.mergeWith(fromAtomsAttrs(restruct, atomsMap.get(id), attrs, true))\n      // TODO [RB] need to merge fragments?\n    }\n  })\n  mergeSgroups(action, restruct, pasteItems.atoms, bond.begin)\n\n  tmpl.bonds.forEach(tBond => {\n    const existId = struct.findBondId(\n      atomsMap.get(tBond.begin),\n      atomsMap.get(tBond.end)\n    )\n    if (existId === null) {\n      const operation = new BondAdd(\n        atomsMap.get(tBond.begin),\n        atomsMap.get(tBond.end),\n        tBond\n      ).perform(restruct)\n      action.addOp(operation)\n\n      pasteItems.bonds.push(operation.data.bid)\n    } else {\n      action.mergeWith(fromBondsAttrs(restruct, existId, tmplBond, true))\n    }\n  })\n\n  if (pasteItems.atoms.length) {\n    action.addOp(\n      new CalcImplicitH([bond.begin, bond.end, ...pasteItems.atoms]).perform(\n        restruct\n      )\n    )\n  }\n\n  if (pasteItems.bonds.length) {\n    action.mergeWith(\n      fromBondStereoUpdate(\n        restruct,\n        restruct.molecule.bonds.get(pasteItems.bonds[0])\n      )\n    )\n  }\n\n  action.operations.reverse()\n\n  return [action, pasteItems]\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  fromItemsFuse,\n  getHoverToFuse,\n  getItemsToFuse\n} from '../actions/closely-fusing'\nimport {\n  fromTemplateOnAtom,\n  fromTemplateOnBondAction,\n  fromTemplateOnCanvas\n} from '../actions/template'\n\nimport { Vec2 } from 'ketcher-core'\nimport utils from '../shared/utils'\n\nfunction TemplateTool(editor, tmpl) {\n  // eslint-disable-line max-statements\n  if (!(this instanceof TemplateTool)) return new TemplateTool(editor, tmpl)\n\n  this.editor = editor\n  this.editor.selection(null)\n\n  this.template = {\n    aid: parseInt(tmpl.aid) || 0,\n    bid: parseInt(tmpl.bid) || 0\n  }\n\n  const frag = tmpl.struct\n  frag.rescale()\n\n  const xy0 = new Vec2()\n  frag.atoms.forEach(atom => {\n    xy0.add_(atom.pp) // eslint-disable-line no-underscore-dangle\n  })\n\n  this.template.molecule = frag // preloaded struct\n  this.findItems = []\n  this.template.xy0 = xy0.scaled(1 / (frag.atoms.size || 1)) // template center\n\n  const atom = frag.atoms.get(this.template.aid)\n  if (atom) {\n    this.template.angle0 = utils.calcAngle(atom.pp, this.template.xy0) // center tilt\n    this.findItems.push('atoms')\n  }\n\n  const bond = frag.bonds.get(this.template.bid)\n  if (bond) {\n    // template location sign against attachment bond\n    this.template.sign = getSign(frag, bond, this.template.xy0)\n    this.findItems.push('bonds')\n  }\n}\n\nTemplateTool.prototype.mousedown = function (event) {\n  // eslint-disable-line max-statements\n  const editor = this.editor\n  const restruct = editor.render.ctab\n  this.editor.hover(null)\n\n  this.dragCtx = {\n    xy0: editor.render.page2obj(event),\n    item: editor.findItem(event, this.findItems)\n  }\n\n  const dragCtx = this.dragCtx\n  const ci = dragCtx.item\n\n  if (!ci) {\n    //  ci.type == 'Canvas'\n    delete dragCtx.item\n    return true\n  }\n\n  if (ci.map === 'bonds') {\n    // calculate fragment center\n    const molecule = restruct.molecule\n    const xy0 = new Vec2()\n    const bond = molecule.bonds.get(ci.id)\n    const frid = molecule.atoms.get(bond.begin).fragment\n    const frIds = molecule.getFragmentIds(frid)\n    let count = 0\n\n    let loop = molecule.halfBonds.get(bond.hb1).loop\n\n    if (loop < 0) loop = molecule.halfBonds.get(bond.hb2).loop\n\n    if (loop >= 0) {\n      const loopHbs = molecule.loops.get(loop).hbs\n      loopHbs.forEach(hb => {\n        xy0.add_(molecule.atoms.get(molecule.halfBonds.get(hb).begin).pp) // eslint-disable-line no-underscore-dangle, max-len\n        count++\n      })\n    } else {\n      frIds.forEach(id => {\n        xy0.add_(molecule.atoms.get(id).pp) // eslint-disable-line no-underscore-dangle\n        count++\n      })\n    }\n\n    dragCtx.v0 = xy0.scaled(1 / count)\n\n    const sign = getSign(molecule, bond, dragCtx.v0)\n\n    // calculate default template flip\n    dragCtx.sign1 = sign || 1\n    dragCtx.sign2 = this.template.sign\n  }\n\n  return true\n}\n\nTemplateTool.prototype.mousemove = function (event) {\n  // eslint-disable-line max-statements\n  const restruct = this.editor.render.ctab\n\n  if (!this.dragCtx) {\n    this.editor.hover(this.editor.findItem(event, this.findItems))\n    return true\n  }\n\n  const dragCtx = this.dragCtx\n  const ci = dragCtx.item\n  let pos0 = null\n  const pos1 = this.editor.render.page2obj(event)\n  const struct = restruct.molecule\n\n  /* moving when attached to bond */\n  if (ci && ci.map === 'bonds') {\n    const bond = struct.bonds.get(ci.id)\n    let sign = getSign(struct, bond, pos1)\n\n    if (dragCtx.sign1 * this.template.sign > 0) sign = -sign\n\n    if (sign !== dragCtx.sign2 || !dragCtx.action) {\n      if (dragCtx.action) dragCtx.action.perform(restruct) // undo previous action\n\n      dragCtx.sign2 = sign\n      let [action, pasteItems] = fromTemplateOnBondAction(\n        restruct,\n        this.template,\n        ci.id,\n        this.editor.event,\n        dragCtx.sign1 * dragCtx.sign2 > 0,\n        false\n      )\n\n      dragCtx.action = action\n      this.editor.update(dragCtx.action, true)\n\n      dragCtx.mergeItems = getItemsToFuse(this.editor, pasteItems)\n      this.editor.hover(getHoverToFuse(dragCtx.mergeItems))\n    }\n    return true\n  }\n  /* end */\n\n  let extraBond = null\n  // calc initial pos and is extra bond needed\n  if (!ci) {\n    //  ci.type == 'Canvas'\n    pos0 = dragCtx.xy0\n  } else if (ci.map === 'atoms') {\n    pos0 = struct.atoms.get(ci.id).pp\n    extraBond = Vec2.dist(pos0, pos1) > 1\n  }\n\n  // calc angle\n  let angle = utils.calcAngle(pos0, pos1)\n  if (!event.ctrlKey) angle = utils.fracAngle(angle)\n  const degrees = utils.degrees(angle)\n  this.editor.event.message.dispatch({ info: degrees + 'º' })\n\n  // check if anything changed since last time\n  if (\n    dragCtx.hasOwnProperty('angle') &&\n    dragCtx.angle === degrees && // eslint-disable-line no-prototype-builtins\n    (!dragCtx.hasOwnProperty('extra_bond') || dragCtx.extra_bond === extraBond)\n  )\n    // eslint-disable-line no-prototype-builtins\n    return true\n\n  // undo previous action\n  if (dragCtx.action) dragCtx.action.perform(restruct)\n\n  // create new action\n  dragCtx.angle = degrees\n  let action = null\n  let pasteItems\n\n  if (!ci) {\n    // ci.type == 'Canvas'\n    ;[action, pasteItems] = fromTemplateOnCanvas(\n      restruct,\n      this.template,\n      pos0,\n      angle\n    )\n  } else if (ci.map === 'atoms') {\n    ;[action, pasteItems] = fromTemplateOnAtom(\n      restruct,\n      this.template,\n      ci.id,\n      angle,\n      extraBond\n    )\n    dragCtx.extra_bond = extraBond\n  }\n  dragCtx.action = action\n\n  this.editor.update(dragCtx.action, true)\n\n  dragCtx.mergeItems = getItemsToFuse(this.editor, pasteItems)\n  this.editor.hover(getHoverToFuse(dragCtx.mergeItems))\n\n  return true\n}\n\nTemplateTool.prototype.mouseup = function (event) {\n  // eslint-disable-line max-statements\n  const dragCtx = this.dragCtx\n  if (!dragCtx) return true\n  delete this.dragCtx\n\n  const restruct = this.editor.render.ctab\n  const struct = restruct.molecule\n  const ci = dragCtx.item\n\n  /* after moving around bond */\n  if (dragCtx.action && ci && ci.map === 'bonds') {\n    dragCtx.action.perform(restruct) // revert drag action\n    fromTemplateOnBondAction(\n      restruct,\n      this.template,\n      ci.id,\n      this.editor.event,\n      dragCtx.sign1 * dragCtx.sign2 > 0,\n      true\n    ).then(([action, pasteItems]) => {\n      const mergeItems = getItemsToFuse(this.editor, pasteItems)\n      action = fromItemsFuse(restruct, mergeItems).mergeWith(action)\n      this.editor.update(action)\n    })\n    return true\n  }\n  /* end */\n\n  let action\n  let pasteItems = null\n\n  if (!dragCtx.action) {\n    if (!ci) {\n      //  ci.type == 'Canvas'\n      ;[action, pasteItems] = fromTemplateOnCanvas(\n        restruct,\n        this.template,\n        dragCtx.xy0,\n        0\n      )\n      dragCtx.action = action\n    } else if (ci.map === 'atoms') {\n      const degree = restruct.atoms.get(ci.id).a.neighbors.length\n      let angle\n      let extraBond\n\n      if (degree > 1) {\n        // common case\n        angle = null\n        extraBond = true\n      } else if (degree === 1) {\n        // on chain end\n        const atom = struct.atoms.get(ci.id)\n        const neiId = struct.halfBonds.get(atom.neighbors[0]).end\n        const nei = struct.atoms.get(neiId)\n\n        angle = event.ctrlKey\n          ? utils.calcAngle(nei.pp, atom.pp)\n          : utils.fracAngle(utils.calcAngle(nei.pp, atom.pp))\n        extraBond = false\n      } else {\n        // on single atom\n        angle = 0\n        extraBond = false\n      }\n\n      ;[action, pasteItems] = fromTemplateOnAtom(\n        restruct,\n        this.template,\n        ci.id,\n        angle,\n        extraBond\n      )\n      dragCtx.action = action\n    } else if (ci.map === 'bonds') {\n      fromTemplateOnBondAction(\n        restruct,\n        this.template,\n        ci.id,\n        this.editor.event,\n        dragCtx.sign1 * dragCtx.sign2 > 0,\n        true\n      ).then(([action, pasteItems]) => {\n        // eslint-disable-line no-shadow\n        const mergeItems = getItemsToFuse(this.editor, pasteItems)\n        action = fromItemsFuse(restruct, mergeItems).mergeWith(action)\n        this.editor.update(action)\n      })\n\n      return true\n    }\n  }\n\n  this.editor.selection(null)\n\n  if (!dragCtx.mergeItems && pasteItems)\n    dragCtx.mergeItems = getItemsToFuse(this.editor, pasteItems)\n  dragCtx.action = dragCtx.action\n    ? fromItemsFuse(restruct, dragCtx.mergeItems).mergeWith(dragCtx.action)\n    : fromItemsFuse(restruct, dragCtx.mergeItems)\n\n  this.editor.hover(null)\n  const completeAction = dragCtx.action\n  if (completeAction && !completeAction.isDummy())\n    this.editor.update(completeAction)\n  this.editor.event.message.dispatch({\n    info: false\n  })\n\n  return true\n}\n\nTemplateTool.prototype.cancel = TemplateTool.prototype.mouseup\nTemplateTool.prototype.mouseleave = TemplateTool.prototype.mouseup\n\nfunction getSign(molecule, bond, v) {\n  const begin = molecule.atoms.get(bond.begin).pp\n  const end = molecule.atoms.get(bond.end).pp\n\n  const sign = Vec2.cross(Vec2.diff(begin, end), Vec2.diff(v, end))\n\n  if (sign > 0) return 1\n  if (sign < 0) return -1\n  return 0\n}\n\nexport default TemplateTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Text, Vec2 } from 'ketcher-core'\nimport {\n  fromTextCreation,\n  fromTextDeletion,\n  fromTextUpdating\n} from '../actions/text'\n\nimport Action from '../shared/action'\nimport { fromMultipleMove } from '../actions/fragment'\n\ninterface Result {\n  content: string\n}\n\nclass TextTool {\n  editor: any\n  dragCtx: any\n\n  constructor(editor) {\n    this.editor = editor\n    this.editor.selection(null)\n  }\n\n  mousedown(event) {\n    const render = this.editor.render\n    const ci = this.editor.findItem(event, ['texts'])\n\n    this.editor.selection(null)\n\n    if (ci && ci.map === 'texts') {\n      this.editor.hover(null)\n      this.editor.selection({ texts: [ci.id] })\n      this.dragCtx = {\n        xy0: render.page2obj(event),\n        action: new Action()\n      }\n    }\n  }\n\n  mousemove(event) {\n    const render = this.editor.render\n\n    if (this.dragCtx) {\n      if (this.dragCtx.action) {\n        this.dragCtx.action.perform(render.ctab)\n      }\n\n      this.dragCtx.action = fromMultipleMove(\n        render.ctab,\n        this.editor.selection() || {},\n        render.page2obj(event).sub(this.dragCtx.xy0)\n      )\n      this.editor.update(this.dragCtx.action, true)\n    } else {\n      this.editor.hover(this.editor.findItem(event, ['texts']))\n    }\n  }\n\n  mouseup() {\n    if (this.dragCtx) {\n      this.editor.update(this.dragCtx.action)\n      delete this.dragCtx\n    }\n    return true\n  }\n\n  click(event) {\n    const render = this.editor.render\n    const ci = this.editor.findItem(event, ['texts'])\n    this.editor.hover(null)\n\n    if (!ci) {\n      propsDialog(this.editor, null, render.page2obj(event))\n    }\n\n    return true\n  }\n\n  dblclick(event) {\n    const ci = this.editor.findItem(event, ['texts'])\n    this.editor.hover(null)\n\n    if (ci.map === 'texts') {\n      propsDialog(this.editor, ci.id, ci.position)\n    }\n\n    return true\n  }\n}\n\nfunction propsDialog(editor: any, id: number | null, position: Vec2) {\n  const struct = editor.render.ctab.molecule\n  const text: Text | null = id || id === 0 ? struct.texts.get(id) : null\n  const origilContent = text ? text.content : ''\n\n  const res = editor.event.elementEdit.dispatch({\n    content: origilContent,\n    id,\n    position,\n    type: 'text'\n  })\n\n  res\n    .then(({ content }: Result) => {\n      if (!id && id !== 0 && content) {\n        editor.update(fromTextCreation(editor.render.ctab, content, position))\n      } else if (!content) {\n        editor.update(fromTextDeletion(editor.render.ctab, id!))\n      } else if (content !== origilContent) {\n        editor.update(fromTextUpdating(editor.render.ctab, id!, content))\n      }\n    })\n    .catch(() => null)\n}\n\nexport default function TextToolWrapper(editor) {\n  return new TextTool(editor)\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport APointTool from './apoint'\nimport AtomTool from './atom'\nimport AttachTool from './attach'\nimport BondTool from './bond'\nimport ChainTool from './chain'\nimport ChargeTool from './charge'\nimport EnhancedStereoTool from './enhanced-stereo'\nimport EraserTool from './eraser'\nimport PasteTool from './paste'\nimport RGroupAtomTool from './rgroupatom'\nimport RGroupFragmentTool from './rgroupfragment'\nimport ReactionArrowTool from './reactionarrow'\nimport ReactionMapTool from './reactionmap'\nimport ReactionPlusTool from './reactionplus'\nimport ReactionUnmapTool from './reactionunmap'\nimport RotateTool from './rotate'\nimport SGroupTool from './sgroup'\nimport SelectTool from './select'\nimport SimpleObjectTool from './simpleobject'\nimport TemplateTool from './template'\nimport TextToolWrapper from './text'\n\nconst tools = {\n  rgroupatom: RGroupAtomTool,\n  select: SelectTool,\n  sgroup: SGroupTool,\n  eraser: EraserTool,\n  atom: AtomTool,\n  bond: BondTool,\n  chain: ChainTool,\n  template: TemplateTool,\n  charge: ChargeTool,\n  rgroupfragment: RGroupFragmentTool,\n  apoint: APointTool,\n  attach: AttachTool,\n  reactionarrow: ReactionArrowTool,\n  reactionplus: ReactionPlusTool,\n  reactionmap: ReactionMapTool,\n  reactionunmap: ReactionUnmapTool,\n  paste: PasteTool,\n  rotate: RotateTool,\n  enhancedStereo: EnhancedStereoTool,\n  simpleobject: SimpleObjectTool,\n  text: TextToolWrapper\n}\n\nexport default tools\n","import { fromAtomsAttrs } from '../actions/atom'\nimport { fromStereoFlagUpdate } from '../actions/fragment'\nimport { findStereoAtoms } from '../actions/utils'\nimport Editor from '../Editor'\nimport Action from '../shared/action'\n\nfunction EnhancedStereoTool(\n  this: typeof EnhancedStereoTool,\n  editor: Editor\n): null | void {\n  if (!(this instanceof EnhancedStereoTool)) {\n    const selection = editor.selection()\n\n    const stereoAtoms = findStereoAtoms(\n      editor.struct(),\n      selection\n        ? selection.atoms || []\n        : Array.from(editor.struct().atoms.keys())\n    )\n\n    if (stereoAtoms.length === 0) return null\n\n    changeAtomsStereoAction(editor, stereoAtoms).then(\n      action => action && editor.update(action)\n    )\n  }\n}\n\nfunction changeAtomsStereoAction(\n  editor: Editor,\n  stereoAtoms: number[]\n): Promise<Action> {\n  const struct = editor.struct()\n  const restruct = editor.render.ctab\n  const stereoLabels = stereoAtoms.map(stereoAtom => {\n    const atom = struct.atoms.get(stereoAtom)\n    return atom && atom.stereoLabel\n  })\n  const hasAnotherLabel = stereoLabels.some(\n    stereoLabel => stereoLabel !== stereoLabels[0]\n  )\n  const res = editor.event.enhancedStereoEdit.dispatch({\n    stereoLabel: hasAnotherLabel ? null : stereoLabels[0]\n  })\n  return res.then(stereoLabel => {\n    if (!stereoLabel) return null\n    const action = stereoAtoms.reduce(\n      (acc, stereoAtom) => {\n        return acc.mergeWith(\n          fromStereoFlagUpdate(restruct, struct.atoms.get(stereoAtom)?.fragment)\n        )\n      },\n      fromAtomsAttrs(\n        restruct,\n        stereoAtoms,\n        {\n          stereoLabel\n        },\n        false\n      )\n    )\n    action.operations.reverse()\n    return action\n  })\n}\n\nexport default EnhancedStereoTool\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport {\n  DOMSubscription,\n  PipelineSubscription,\n  Subscription\n} from 'subscription'\nimport { Pile, Struct, Vec2 } from 'ketcher-core'\nimport { customOnChangeHandler, elementOffset } from './utils'\nimport { fromDescriptorsAlign, fromNewCanvas } from './actions/basic'\n\nimport Action from './shared/action'\nimport Render from '../render'\nimport closest from './shared/closest'\nimport toolMap from './tool'\n\nconst SCALE = 40\nconst HISTORY_SIZE = 32 // put me to options\n\nconst structObjects = [\n  'atoms',\n  'bonds',\n  'frags',\n  'sgroups',\n  'sgroupData',\n  'rgroups',\n  'rxnArrows',\n  'rxnPluses',\n  'enhancedFlags',\n  'simpleObjects',\n  'texts'\n]\n\nconst highlightTargets = [\n  'atoms',\n  'bonds',\n  'rxnArrows',\n  'rxnPluses',\n  'frags',\n  'merge',\n  'rgroups',\n  'sgroups',\n  'sgroupData',\n  'enhancedFlags',\n  'simpleObjects',\n  'texts'\n]\n\nfunction selectStereoFlagsIfNecessary(\n  atoms: any,\n  expAtoms: number[]\n): number[] {\n  const atomsOfFragments = {}\n  atoms.forEach((atom, atomId) => {\n    atomsOfFragments[atom.fragment]\n      ? atomsOfFragments[atom.fragment].push(atomId)\n      : (atomsOfFragments[atom.fragment] = [atomId])\n  })\n\n  let stereoFlags: number[] = []\n\n  Object.keys(atomsOfFragments).forEach(fragId => {\n    let shouldSelSFlag: boolean = true\n    atomsOfFragments[fragId].forEach(atomId => {\n      if (!expAtoms.includes(atomId)) shouldSelSFlag = false\n    })\n    shouldSelSFlag && stereoFlags.push(Number(fragId))\n  })\n  return stereoFlags\n}\n\ninterface Selection {\n  atoms?: Array<number>\n  bonds?: Array<number>\n  enhancedFlags?: Array<number>\n  rxnPluses?: Array<number>\n  rxnArrows?: Array<number>\n}\nclass Editor {\n  render: Render\n  _selection: Selection | null\n  _tool: any\n  historyStack: any\n  historyPtr: any\n  event: {\n    message: Subscription\n    elementEdit: PipelineSubscription\n    bondEdit: PipelineSubscription\n    rgroupEdit: PipelineSubscription\n    sgroupEdit: PipelineSubscription\n    sdataEdit: PipelineSubscription\n    quickEdit: PipelineSubscription\n    attachEdit: PipelineSubscription\n    change: Subscription\n    selectionChange: PipelineSubscription\n    aromatizeStruct: PipelineSubscription\n    dearomatizeStruct: PipelineSubscription\n    enhancedStereoEdit: PipelineSubscription\n  }\n  lastEvent: any\n\n  constructor(clientArea, options) {\n    this.render = new Render(\n      clientArea,\n      Object.assign(\n        {\n          scale: SCALE\n        },\n        options\n      )\n    )\n\n    this._selection = null // eslint-disable-line\n    this._tool = null // eslint-disable-line\n    this.historyStack = []\n    this.historyPtr = 0\n\n    this.event = {\n      message: new Subscription(),\n      elementEdit: new PipelineSubscription(),\n      bondEdit: new PipelineSubscription(),\n      rgroupEdit: new PipelineSubscription(),\n      sgroupEdit: new PipelineSubscription(),\n      sdataEdit: new PipelineSubscription(),\n      quickEdit: new PipelineSubscription(),\n      attachEdit: new PipelineSubscription(),\n      change: new Subscription(),\n      selectionChange: new PipelineSubscription(),\n      aromatizeStruct: new PipelineSubscription(),\n      dearomatizeStruct: new PipelineSubscription(),\n      // TODO: correct\n      enhancedStereoEdit: new PipelineSubscription()\n    }\n\n    domEventSetup(this, clientArea)\n  }\n\n  tool(name?: any, opts?: any) {\n    /* eslint-disable no-underscore-dangle */\n    if (arguments.length === 0) {\n      return this._tool\n    }\n\n    if (this._tool && this._tool.cancel) {\n      this._tool.cancel()\n    }\n\n    const tool = toolMap[name](this, opts)\n    if (!tool) {\n      return null\n    }\n\n    this._tool = tool\n    return this._tool\n    /* eslint-enable no-underscore-dangle */\n  }\n\n  clear() {\n    this.struct(undefined)\n  }\n\n  struct(value?: Struct): Struct {\n    if (arguments.length === 0) {\n      return this.render.ctab.molecule\n    }\n\n    this.selection(null)\n    const struct = value || new Struct()\n    const action = fromNewCanvas(this.render.ctab, struct)\n    this.update(action)\n\n    const structCenter = getStructCenter(this.render.ctab)\n    recoordinate(this, structCenter)\n    return this.render.ctab.molecule\n  }\n\n  options(value?: any) {\n    if (arguments.length === 0) {\n      return this.render.options\n    }\n\n    const struct = this.render.ctab.molecule\n    const zoom = this.render.options.zoom\n    this.render.clientArea.innerHTML = ''\n\n    this.render = new Render(\n      this.render.clientArea,\n      Object.assign({ scale: SCALE }, value)\n    )\n    this.render.setMolecule(struct) // TODO: reuse this.struct here?\n    this.render.setZoom(zoom)\n    this.render.update()\n    return this.render.options\n  }\n\n  zoom(value?: any) {\n    if (arguments.length === 0) {\n      return this.render.options.zoom\n    }\n\n    this.render.setZoom(value)\n\n    const selection = this.selection()\n    const structCenter = getStructCenter(this.render.ctab, selection)\n    recoordinate(this, structCenter)\n\n    this.render.update()\n    return this.render.options.zoom\n  }\n\n  selection(ci?: any) {\n    if (arguments.length === 0) {\n      return this._selection // eslint-disable-line\n    }\n\n    let restruct = this.render.ctab\n\n    this._selection = null // eslint-disable-line\n    if (ci === 'all') {\n      // TODO: better way will be this.struct()\n      ci = structObjects.reduce((res, key) => {\n        res[key] = Array.from(restruct[key].keys())\n        return res\n      }, {})\n    }\n\n    if (ci === 'descriptors') {\n      restruct = this.render.ctab\n      ci = { sgroupData: Array.from(restruct['sgroupData'].keys()) }\n    }\n\n    if (ci) {\n      let res: Selection = {}\n\n      Object.keys(ci).forEach(key => {\n        if (ci[key].length > 0)\n          // TODO: deep merge\n          res[key] = ci[key].slice()\n      })\n\n      if (Object.keys(res).length !== 0) {\n        this._selection = res // eslint-disable-line\n      }\n      const stereoFlags = selectStereoFlagsIfNecessary(\n        this.struct().atoms,\n        this.explicitSelected().atoms\n      )\n      if (stereoFlags.length !== 0) {\n        this._selection && this._selection.enhancedFlags\n          ? (this._selection.enhancedFlags = Array.from(\n              new Set([...this._selection.enhancedFlags, ...stereoFlags])\n            ))\n          : (res.enhancedFlags = stereoFlags)\n      }\n    }\n\n    this.render.ctab.setSelection(this._selection) // eslint-disable-line\n    this.event.selectionChange.dispatch(this._selection) // eslint-disable-line\n\n    this.render.update()\n    return this._selection // eslint-disable-line\n  }\n\n  hover(ci: any, newTool?: any) {\n    const tool = newTool || this._tool // eslint-disable-line\n\n    if (\n      'ci' in tool &&\n      (!ci || tool.ci.map !== ci.map || tool.ci.id !== ci.id)\n    ) {\n      this.highlight(tool.ci, false)\n      delete tool.ci\n    }\n\n    if (ci && this.highlight(ci, true)) tool.ci = ci\n  }\n\n  highlight(ci: any, visible: any) {\n    if (highlightTargets.indexOf(ci.map) === -1) {\n      return false\n    }\n\n    const render = this.render\n    let item: any = null\n\n    if (ci.map === 'merge') {\n      Object.keys(ci.items).forEach(mp => {\n        ci.items[mp].forEach(dstId => {\n          item = render.ctab[mp].get(dstId)!\n\n          if (item) {\n            item.setHighlight(visible, render)\n          }\n        })\n      })\n\n      return true\n    }\n\n    item = (render.ctab[ci.map] as Map<any, any>).get(ci.id)\n    if (!item) {\n      return true // TODO: fix, attempt to highlight a deleted item\n    }\n\n    if (\n      (ci.map === 'sgroups' && item.item.type === 'DAT') ||\n      ci.map === 'sgroupData'\n    ) {\n      // set highlight for both the group and the data item\n      const item1 = render.ctab.sgroups.get(ci.id)\n      if (item1) {\n        item1.setHighlight(visible, render)\n      }\n\n      const item2 = render.ctab.sgroupData.get(ci.id)\n      if (item2) {\n        item2.setHighlight(visible, render)\n      }\n    } else {\n      item.setHighlight(visible, render)\n    }\n    return true\n  }\n\n  update(action: Action | true, ignoreHistory?) {\n    if (action === true) {\n      this.render.update(true) // force\n    } else {\n      if (!ignoreHistory && !action.isDummy()) {\n        this.historyStack.splice(this.historyPtr, HISTORY_SIZE + 1, action)\n        if (this.historyStack.length > HISTORY_SIZE) {\n          this.historyStack.shift()\n        }\n        this.historyPtr = this.historyStack.length\n        this.event.change.dispatch(action) // TODO: stoppable here\n      }\n      this.render.update()\n    }\n  }\n\n  historySize() {\n    return {\n      undo: this.historyPtr,\n      redo: this.historyStack.length - this.historyPtr\n    }\n  }\n\n  undo() {\n    if (this.historyPtr === 0) {\n      throw new Error('Undo stack is empty')\n    }\n    if (this.tool() && this.tool().cancel) {\n      this.tool().cancel()\n    }\n\n    this.selection(null)\n\n    if (this._tool instanceof toolMap['paste']) {\n      this.event.change.dispatch()\n      return\n    }\n\n    this.historyPtr--\n    const stack = this.historyStack[this.historyPtr]\n    const action = stack.perform(this.render.ctab)\n\n    this.historyStack[this.historyPtr] = action\n    this.event.change.dispatch(action)\n    this.render.update()\n  }\n\n  redo() {\n    if (this.historyPtr === this.historyStack.length) {\n      throw new Error('Redo stack is empty')\n    }\n\n    if (this.tool() && this.tool().cancel) {\n      this.tool().cancel()\n    }\n\n    this.selection(null)\n    if (this._tool instanceof toolMap['paste']) {\n      this.event.change.dispatch()\n      return\n    }\n\n    const action = this.historyStack[this.historyPtr].perform(this.render.ctab)\n    this.historyStack[this.historyPtr] = action\n    this.historyPtr++\n    this.event.change.dispatch(action)\n    this.render.update()\n  }\n\n  subscribe(eventName: any, handler: any) {\n    let subscriber = {\n      handler: handler\n    }\n\n    switch (eventName) {\n      case 'change':\n        const subscribeFuncWrapper = action =>\n          customOnChangeHandler(action, handler)\n        subscriber.handler = subscribeFuncWrapper\n        this.event[eventName].add(subscribeFuncWrapper)\n        break\n\n      default:\n        this.event[eventName].add(handler)\n    }\n\n    return subscriber\n  }\n\n  unsubscribe(eventName: any, subscriber: any) {\n    //Only for event type - subscription\n    this.event[eventName].remove(subscriber.handler)\n  }\n\n  findItem(event: any, maps: any, skip: any) {\n    // todo: remove global\n    const pos = (global as any)._ui_editor\n      ? new Vec2(this.render.page2obj(event)) // eslint-disable-line\n      : new Vec2(event.pageX, event.pageY).sub(\n          elementOffset(this.render.clientArea)\n        )\n\n    return closest.item(this.render.ctab, pos, maps, skip, this.render.options)\n  }\n\n  findMerge(srcItems: any, maps: any) {\n    return closest.merge(this.render.ctab, srcItems, maps, this.render.options)\n  }\n\n  explicitSelected() {\n    const selection = this.selection() || {}\n    const res = structObjects.reduce((acc, key) => {\n      acc[key] = selection[key] ? selection[key].slice() : []\n      return acc\n    }, {} as any)\n\n    const struct = this.render.ctab.molecule\n\n    // \"auto-select\" the atoms for the bonds in selection\n    if (res.bonds) {\n      res.bonds.forEach(bid => {\n        const bond = struct.bonds.get(bid)!\n        res.atoms = res.atoms || []\n        if (res.atoms.indexOf(bond.begin) < 0) {\n          res.atoms.push(bond.begin)\n        }\n\n        if (res.atoms.indexOf(bond.end) < 0) {\n          res.atoms.push(bond.end)\n        }\n      })\n    }\n\n    // \"auto-select\" the bonds with both atoms selected\n    if (res.atoms && res.bonds) {\n      struct.bonds.forEach((bond, bid) => {\n        if (\n          res.bonds.indexOf(bid) >= 0 &&\n          res.atoms.indexOf(bond.begin) >= 0 &&\n          res.atoms.indexOf(bond.end) >= 0\n        ) {\n          res.bonds = res.bonds || []\n          res.bonds.push(bid)\n        }\n      })\n    }\n\n    return res\n  }\n\n  structSelected() {\n    const struct = this.render.ctab.molecule\n    const selection = this.explicitSelected()\n    const dst = struct.clone(\n      new Pile(selection.atoms),\n      new Pile(selection.bonds),\n      true,\n      null,\n      new Pile(selection.simpleObjects),\n      new Pile(selection.texts)\n    )\n\n    // Copy by its own as Struct.clone doesn't support\n    // arrows/pluses id sets\n    struct.rxnArrows.forEach((item, id) => {\n      if (selection.rxnArrows.indexOf(id) !== -1)\n        dst.rxnArrows.add(item.clone())\n    })\n    struct.rxnPluses.forEach((item, id) => {\n      if (selection.rxnPluses.indexOf(id) !== -1)\n        dst.rxnPluses.add(item.clone())\n    })\n\n    dst.isReaction = struct.isReaction && struct.isRxn()\n\n    return dst\n  }\n\n  alignDescriptors() {\n    this.selection(null)\n    const action = fromDescriptorsAlign(this.render.ctab)\n    this.update(action)\n    this.render.update(true)\n  }\n}\n\nfunction isMouseRight(event) {\n  return (\n    (event.which && event.which === 3) || (event.button && event.button === 2)\n  )\n}\n\nfunction domEventSetup(editor: Editor, clientArea) {\n  // TODO: addEventListener('resize', ...);\n  ;[\n    'click',\n    'dblclick',\n    'mousedown',\n    'mousemove',\n    'mouseup',\n    'mouseleave'\n  ].forEach(eventName => {\n    editor.event[eventName] = new DOMSubscription()\n    const subs = editor.event[eventName]\n    clientArea.addEventListener(eventName, subs.dispatch.bind(subs))\n\n    subs.add(event => {\n      if (eventName !== 'mouseup' && eventName !== 'mouseleave') {\n        // to complete drag actions\n        if (\n          isMouseRight(event) ||\n          !event.target ||\n          event.target.nodeName === 'DIV'\n        ) {\n          // click on scroll\n          editor.hover(null)\n          return true\n        }\n      }\n      const EditorTool = editor.tool()\n      editor.lastEvent = event\n      if (EditorTool && eventName in EditorTool) {\n        EditorTool[eventName](event)\n      }\n      return true\n    }, -1)\n  })\n}\n\nfunction recoordinate(editor: Editor, rp /* , vp*/) {\n  // rp is a point in scaled coordinates, which will be positioned\n  // vp is the point where the reference point should now be (in view coordinates)\n  //    or the center if not set\n  console.assert(rp, 'Reference point not specified')\n  editor.render.setScrollOffset(0, 0)\n}\n\nfunction getStructCenter(restruct, selection?) {\n  const bb = restruct.getVBoxObj(selection || {})\n  return Vec2.lc2(bb.p0, 0.5, bb.p1, 0.5)\n}\n\nexport { Editor }\nexport default Editor\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { OperationType } from '../operations'\n\ntype Data = {\n  operation: any\n  id?: number\n  label?: string\n  position?: {\n    x: number\n    y: number\n  }\n  attribute?: any\n  from?: any\n  to?: any\n  atomId?: any\n  fragId?: any\n  sGroupId?: any\n  type?: any\n  mode?: any\n}\n\nexport function customOnChangeHandler(action, handler) {\n  const data: Data[] = []\n\n  action.operations.reverse().forEach(operation => {\n    const op = operation._inverted\n    switch (op.type) {\n      case OperationType.ATOM_ADD:\n      case OperationType.ATOM_DELETE:\n        data.push({\n          operation: op.type,\n          id: op.data.aid,\n          label: op.data.atom.label ? op.data.atom.label : '',\n          position: {\n            x: +op.data.pos.x.toFixed(2),\n            y: +op.data.pos.y.toFixed(2)\n          }\n        })\n        break\n\n      case OperationType.ATOM_ATTR:\n        data.push({\n          operation: operation.type,\n          id: operation.data.aid,\n          attribute: operation.data.attribute,\n          from: operation.data.value,\n          to: operation.data2.value\n        })\n        break\n\n      case OperationType.ATOM_MOVE:\n        data.push({\n          operation: op.type,\n          id: op.data.aid,\n          position: {\n            x: +op.data.d.x.toFixed(2),\n            y: +op.data.d.y.toFixed(2)\n          }\n        })\n        break\n\n      case OperationType.BOND_ADD:\n      case OperationType.BOND_DELETE:\n        data.push({\n          operation: op.type,\n          id: op.data.bid\n        })\n        break\n\n      case OperationType.FRAGMENT_ADD:\n      case OperationType.FRAGMENT_DELETE:\n        data.push({\n          operation: op.type,\n          id: op.frid\n        })\n        break\n\n      case OperationType.FRAGMENT_ADD_STEREO_ATOM:\n      case OperationType.FRAGMENT_DELETE_STEREO_ATOM:\n        data.push({\n          operation: op.type,\n          atomId: op.data.aid,\n          fragId: op.data.frid\n        })\n        break\n\n      case OperationType.S_GROUP_ATOM_ADD:\n      case OperationType.S_GROUP_ATOM_REMOVE:\n        data.push({\n          operation: op.type,\n          atomId: op.data.aid,\n          sGroupId: op.data.sgid\n        })\n        break\n\n      case OperationType.S_GROUP_CREATE:\n      case OperationType.S_GROUP_DELETE:\n        data.push({\n          operation: op.type,\n          type: op.data.type,\n          sGroupId: op.data.sgid\n        })\n        break\n\n      case OperationType.RXN_ARROW_ADD:\n      case OperationType.RXN_ARROW_DELETE:\n        data.push({\n          operation: op.type,\n          id: op.data.arid,\n          position: {\n            x: +op.data.pos.x.toFixed(2),\n            y: +op.data.pos.y.toFixed(2)\n          }\n        })\n        break\n\n      case OperationType.RXN_ARROW_MOVE:\n        data.push({\n          operation: op.type,\n          id: op.data.id,\n          position: {\n            x: +op.data.d.x.toFixed(2),\n            y: +op.data.d.y.toFixed(2)\n          }\n        })\n        break\n\n      case OperationType.R_GROUP_FRAGMENT:\n        data.push({\n          operation: operation.type,\n          id: op.frid\n        })\n        break\n\n      case OperationType.SIMPLE_OBJECT_ADD:\n      case OperationType.SIMPLE_OBJECT_DELETE:\n        data.push({\n          operation: op.type,\n          id: op.data.id,\n          mode: op.data.mode\n        })\n        break\n\n      case OperationType.SIMPLE_OBJECT_RESIZE:\n        data.push({\n          operation: op.type,\n          id: op.data.id\n        })\n        break\n\n      case OperationType.SIMPLE_OBJECT_MOVE:\n        data.push({\n          operation: operation.type,\n          id: operation.data.id,\n          position: {\n            x: +operation.data.d.x.toFixed(2),\n            y: +operation.data.d.y.toFixed(2)\n          }\n        })\n        break\n\n      default:\n        data.push({\n          operation: op.type\n        })\n    }\n  })\n\n  return handler(data)\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\n// TODO: find DOM shorthand\nimport { Vec2 } from 'ketcher-core'\n\nexport function elementOffset(element) {\n  let top = 0\n  let left = 0\n  do {\n    top += element.offsetTop || 0\n    left += element.offsetLeft || 0\n    element = element.offsetParent\n  } while (element)\n\n  return new Vec2(left, top)\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { ReactElement } from 'react'\n\nimport classes from './Spinner.module.less'\n\nfunction Spinner(): ReactElement {\n  return <div className={classes.spinner} />\n}\n\nexport default Spinner\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { upperFirst } from 'lodash/fp'\nimport React, { Component, createRef } from 'react'\nimport Editor from '../../../../editor'\nimport Spinner from '../Spinner'\n\nimport classes from './StructEditor.module.less'\nimport clsx from 'clsx'\n\n//TODO: need to update component after making refactoring of store\nfunction setupEditor(editor, props, oldProps = {}) {\n  const { struct, tool, toolOpts, options } = props\n\n  if (struct !== oldProps.struct) editor.struct(struct)\n\n  if (tool !== oldProps.tool || toolOpts !== oldProps.toolOpts) {\n    editor.tool(tool, toolOpts)\n    if (toolOpts !== oldProps.toolOpts) {\n      editor.event.message.dispatch({ info: JSON.stringify(toolOpts) })\n    }\n  }\n\n  if (oldProps.options && options !== oldProps.options) editor.options(options)\n\n  Object.keys(editor.event).forEach(name => {\n    const eventName = `on${upperFirst(name)}`\n\n    if (props[eventName] !== oldProps[eventName]) {\n      if (oldProps[eventName]) editor.event[name].remove(oldProps[eventName])\n\n      if (props[eventName]) editor.event[name].add(props[eventName])\n    }\n  })\n}\n\nfunction removeEditorHandlers(editor, props) {\n  Object.keys(editor.event).forEach(name => {\n    const eventName = `on${upperFirst(name)}`\n\n    if (props[eventName]) editor.event[name].remove(props[eventName])\n  })\n}\n\nclass StructEditor extends Component {\n  constructor(props) {\n    super(props)\n    this.editorRef = createRef()\n    this.logRef = createRef()\n  }\n\n  shouldComponentUpdate(nextProps) {\n    return this.props.indigoVerification !== nextProps.indigoVerification\n  }\n\n  componentWillReceiveProps(props) {\n    setupEditor(this.editor, props, this.props)\n  }\n\n  componentDidMount() {\n    this.editor = new Editor(this.editorRef.current, {\n      ...this.props.options\n    })\n    setupEditor(this.editor, this.props)\n    if (this.props.onInit) this.props.onInit(this.editor)\n\n    this.editor.event.message.add(msg => {\n      const el = this.logRef.current\n      if (msg.info) {\n        el.innerHTML = msg.info\n        el.classList.add(classes.visible)\n      } else {\n        el.classList.remove(classes.visible)\n      }\n    })\n  }\n\n  componentWillUnmount() {\n    removeEditorHandlers(this.editor, this.props)\n  }\n\n  render() {\n    const {\n      Tag = 'div',\n      struct,\n      tool,\n      toolOpts,\n      options,\n      onInit,\n      onSelectionChange,\n      onElementEdit,\n      onEnhancedStereoEdit,\n      onQuickEdit,\n      onBondEdit,\n      onRgroupEdit,\n      onSgroupEdit,\n      onSdataEdit,\n      onMessage,\n      onAromatizeStruct,\n      onDearomatizeStruct,\n      onAttachEdit,\n      indigoVerification,\n      onCipChange,\n      className,\n      ...props\n    } = this.props\n\n    return (\n      <Tag\n        onMouseDown={event => event.preventDefault()}\n        className={clsx(classes.canvas, className)}\n        {...props}>\n        <div\n          ref={this.editorRef}\n          className={clsx(classes.intermediateCanvas, className)}\n          onMouseDown={event => event.preventDefault()}>\n          {/* svg here */}\n        </div>\n        <div className={classes.measureLog} ref={this.logRef} />\n        {indigoVerification && (\n          <div className={classes.spinnerOverlay}>\n            <Spinner />\n          </div>\n        )}\n      </Tag>\n    )\n  }\n}\n\nexport default StructEditor\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { connect } from 'react-redux'\nimport initEditor from '../state/editor'\nimport { StructEditor } from './components'\n\nconst Editor = connect(\n  state => ({\n    options: state.options.settings,\n    indigoVerification: state.requestsStatuses.indigoVerification\n  }),\n  dispatch => dispatch(initEditor)\n)(StructEditor)\n\nexport default Editor\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport { connect } from 'react-redux'\nimport Logo from './logo.svg'\nimport { Dialog } from '../../../../components'\n\nimport classes from './About.module.less'\n\nfunction AboutDialog(props) {\n  const indigoInfo = props.indigoVersion && props.indigoVersion.split('.r') // Indigo version and build info\n\n  return (\n    <Dialog\n      title=\"About\"\n      className={classes.about}\n      params={props}\n      buttons={['Close']}>\n      <a\n        href=\"http://lifescience.opensource.epam.com/ketcher/\"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\">\n        <Logo />\n      </a>\n      <dl>\n        <dt>\n          <a\n            href=\"http://lifescience.opensource.epam.com/ketcher/help.html\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\">\n            Ketcher\n          </a>\n        </dt>\n        <dd>\n          version\n          <var>{props.version}</var>\n        </dd>\n        <dd>\n          build at <time>{props.buildDate}</time>\n        </dd>\n        {props.indigoVersion ? (\n          <div>\n            <dt>\n              <a\n                href=\"http://lifescience.opensource.epam.com/indigo/\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\">\n                Indigo Toolkit\n              </a>\n            </dt>\n            <dd>\n              version\n              <var>{indigoInfo[0]}</var>\n            </dd>\n            <dd>\n              build #<var>{indigoInfo[1]}</var>\n            </dd>\n          </div>\n        ) : (\n          <dd>standalone</dd>\n        )}\n        <dt>\n          <a\n            href=\"http://lifescience.opensource.epam.com/\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\">\n            EPAM Life Sciences\n          </a>\n        </dt>\n        <dd>\n          <a\n            href=\"http://lifescience.opensource.epam.com/ketcher/#feedback\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\">\n            Feedback\n          </a>\n        </dd>\n      </dl>\n    </Dialog>\n  )\n}\n\nconst mapStateToProps = state => ({ ...state.options.app })\n\nconst About = connect(mapStateToProps)(AboutDialog)\n\nexport default About\n","import React from 'react'\nimport SettingsContext from './../contexts/settingsContext'\n\nexport function useSettingsContext() {\n  return React.useContext(SettingsContext)\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { RefCallback, RefObject, useMemo, useState } from 'react'\n\nimport { throttle } from 'lodash'\nimport useResizeObserver from 'use-resize-observer/polyfilled'\n\nconst throttleMilliseconds = 100\n\ntype Size = {\n  width: number | undefined\n  height: number | undefined\n}\n\ntype Options<THTMLElement extends HTMLElement> = {\n  ref?: RefObject<THTMLElement> | THTMLElement | null | undefined\n}\n\ntype HookResponse<THTMLElement extends HTMLElement> = {\n  ref: RefCallback<THTMLElement>\n  width: number | undefined\n  height: number | undefined\n}\n\nfunction useThrottleResizeObserver<THTMLElement extends HTMLElement>(\n  options: Options<THTMLElement> = {}\n): HookResponse<THTMLElement> {\n  const [size, setSize] = useState<Size>({\n    height: undefined,\n    width: undefined\n  })\n\n  const onResize = useMemo(() => throttle(setSize, throttleMilliseconds), [])\n\n  const { ref } = useResizeObserver<THTMLElement>({ onResize, ...options })\n  return { ref, ...size }\n}\n\nexport { useThrottleResizeObserver as useResizeObserver }\n","import React from 'react'\nimport FormContext from './../contexts/formContext'\n\nexport function useFormContext() {\n  return React.useContext(FormContext)\n}\n","import React from 'react'\nimport AppContext from '../contexts/appContext'\n\nexport const useAppContext = () => React.useContext(AppContext)\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { Component } from 'react'\n\nimport { omit } from 'lodash/fp'\n\nfunction GenericInput({\n  schema,\n  value = '',\n  onChange,\n  type = 'text',\n  ...props\n}) {\n  return (\n    <input\n      type={type}\n      value={value}\n      onInput={onChange}\n      onChange={onChange}\n      {...props}\n    />\n  )\n}\n\nGenericInput.val = function (ev, schema) {\n  const input = ev.target\n  const isNumber =\n    input.type === 'number' ||\n    input.type === 'range' ||\n    (schema && (schema.type === 'number' || schema.type === 'integer'))\n  const value = isNumber ? input.value.replace(/,/g, '.') : input.value\n\n  return isNumber && !isNaN(value - 0) ? value - 0 : value // eslint-disable-line\n}\n\nfunction TextArea({ schema, value, onChange, ...rest }) {\n  return <textarea value={value} onInput={onChange} {...rest} />\n}\n\nTextArea.val = ev => ev.target.value\n\nfunction CheckBox({ schema, value = '', onChange, ...rest }) {\n  return (\n    <input\n      type=\"checkbox\"\n      checked={value}\n      onClick={onChange}\n      onChange={onChange}\n      {...rest}\n    />\n  )\n}\n\nCheckBox.val = function (ev) {\n  ev.stopPropagation()\n  return !!ev.target.checked\n}\n\nfunction Select({\n  schema,\n  value,\n  name,\n  onSelect,\n  className,\n  multiple = false\n}) {\n  return (\n    <select\n      onChange={onSelect}\n      value={value}\n      name={name}\n      multiple={multiple}\n      className={className}>\n      {enumSchema(schema, (title, val) => (\n        <option key={val} value={val}>\n          {title}\n        </option>\n      ))}\n    </select>\n  )\n}\n\nSelect.val = function (ev, schema) {\n  const select = ev.target\n  if (!select.multiple) return enumSchema(schema, select.selectedIndex)\n\n  return [].reduce.call(\n    select.options,\n    (res, o, i) => (!o.selected ? res : [enumSchema(schema, i), ...res]),\n    []\n  )\n}\n\nfunction FieldSet({\n  schema,\n  value,\n  selected,\n  onSelect,\n  type = 'radio',\n  ...rest\n}) {\n  return (\n    <fieldset onClick={onSelect} className=\"radio\">\n      {enumSchema(schema, (title, val) => (\n        <li key={title}>\n          <label>\n            <input\n              type={type}\n              defaultChecked={selected(val, value)}\n              value={typeof val !== 'object' && val}\n              {...rest}\n            />\n            {title}\n          </label>\n        </li>\n      ))}\n    </fieldset>\n  )\n}\n\nFieldSet.val = function (ev, schema) {\n  const input = ev.target\n  if (ev.target.tagName !== 'INPUT') {\n    ev.stopPropagation()\n    return undefined\n  }\n  // Hm.. looks like premature optimization\n  //      should we inline this?\n  const fieldset = input.parentNode.parentNode.parentNode\n  const result = [].reduce.call(\n    fieldset.querySelectorAll('input'),\n    (res, inp, i) => (!inp.checked ? res : [enumSchema(schema, i), ...res]),\n    []\n  )\n  return input.type === 'radio' ? result[0] : result\n}\n\nfunction enumSchema(schema, cbOrIndex) {\n  const isTypeValue = Array.isArray(schema)\n  if (!isTypeValue && schema.items) schema = schema.items\n\n  if (typeof cbOrIndex === 'function') {\n    return (isTypeValue ? schema : schema.enum).map((item, i) => {\n      const title = isTypeValue\n        ? item.title\n        : schema.enumNames && schema.enumNames[i]\n      return cbOrIndex(\n        title !== undefined ? title : item,\n        item && item.value !== undefined ? item.value : item\n      )\n    })\n  }\n\n  if (!isTypeValue) return schema.enum[cbOrIndex]\n\n  const res = schema[cbOrIndex]\n  return res.value !== undefined ? res.value : res\n}\n\nfunction inputCtrl(component, schema, onChange) {\n  let props = {}\n  if (schema) {\n    // TODO: infer maxLength, min, max, step, etc\n    if (schema.type === 'number' || schema.type === 'integer')\n      props = { type: 'text' }\n  }\n\n  return {\n    onChange: ev => {\n      const val = !component.val ? ev : component.val(ev, schema)\n      onChange(val)\n    },\n    ...props\n  }\n}\n\nfunction singleSelectCtrl(component, schema, onChange) {\n  return {\n    selected: (testVal, value) => value === testVal,\n    onSelect: ev => {\n      const val = !component.val ? ev : component.val(ev, schema)\n      if (val !== undefined) onChange(val)\n    }\n  }\n}\n\nfunction multipleSelectCtrl(component, schema, onChange) {\n  return {\n    multiple: true,\n    selected: (testVal, values) => values && values.indexOf(testVal) >= 0,\n    onSelect: (ev, values) => {\n      if (component.val) {\n        const val = component.val(ev, schema)\n        if (val !== undefined) onChange(val)\n      } else {\n        const i = values ? values.indexOf(ev) : -1\n        if (i < 0) onChange(values ? [ev, ...values] : [ev])\n        else onChange([...values.slice(0, i), ...values.slice(i + 1)])\n      }\n    }\n  }\n}\n\nfunction ctrlMap(component, { schema, multiple, onChange }) {\n  if (\n    !schema ||\n    (!schema.enum && !schema.items && !Array.isArray(schema)) ||\n    schema.type === 'string'\n  )\n    return inputCtrl(component, schema, onChange)\n\n  if (multiple || schema.type === 'array')\n    return multipleSelectCtrl(component, schema, onChange)\n\n  return singleSelectCtrl(component, schema, onChange)\n}\n\nfunction componentMap({ schema, type, multiple }) {\n  if (!schema || (!schema.enum && !schema.items && !Array.isArray(schema))) {\n    if (type === 'checkbox' || (schema && schema.type === 'boolean'))\n      return CheckBox\n\n    return type === 'textarea' ? TextArea : GenericInput\n  }\n  if (multiple || schema.type === 'array')\n    return type === 'checkbox' ? FieldSet : Select\n\n  return type === 'radio' ? FieldSet : Select\n}\n\nfunction shallowCompare(a, b) {\n  for (const key in a) {\n    if (!(key in b)) return true\n  }\n  for (const key in b) {\n    if (a[key] !== b[key]) return true\n  }\n  return false\n}\n\nexport default class Input extends Component {\n  constructor(props) {\n    super(props)\n    const { component } = this.props\n    this.component = component || componentMap(props)\n    this.ctrl = ctrlMap(this.component, props)\n  }\n\n  shouldComponentUpdate({ children, onChange, style, ...nextProps }) {\n    const oldProps = omit(this.props, ['children', 'onChange', 'style'])\n    return shallowCompare(oldProps, nextProps)\n  }\n\n  render() {\n    const { children, onChange, ...props } = this.props\n    const Component = this.component\n    return <Component {...this.ctrl} {...props} />\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { Component } from 'react'\n\nimport { FormContext } from './../../../../contexts'\nimport Input from './input'\nimport clsx from 'clsx'\nimport { connect } from 'react-redux'\nimport jsonschema from 'jsonschema'\nimport { updateFormState } from '../../state/modal/form'\nimport { useFormContext } from './../../../../hooks'\n\nclass Form extends Component {\n  constructor(props) {\n    super(props)\n    const { onUpdate, schema, init } = this.props\n\n    this.schema = propSchema(schema, props)\n\n    if (init) {\n      const { valid, errors } = this.schema.serialize(init)\n      const errs = getErrorsObj(errors)\n      const initialState = { ...init, init: true }\n      onUpdate(initialState, valid, errs)\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    const { schema, result, customValid, ...rest } = this.props\n    if (schema.key && schema.key !== prevProps.schema.key) {\n      this.schema = propSchema(schema, rest)\n      this.schema.serialize(result) // hack: valid first state\n      this.updateState(result)\n    }\n  }\n\n  updateState(newState) {\n    const { onUpdate } = this.props\n    const { instance, valid, errors } = this.schema.serialize(newState)\n    const errs = getErrorsObj(errors)\n    onUpdate(instance, valid, errs)\n  }\n\n  field(name, onChange) {\n    const { result, errors } = this.props\n    const value = result[name]\n    const self = this\n    return {\n      dataError: errors && errors[name],\n      value,\n      onChange(val) {\n        const newState = Object.assign({}, self.props.result, { [name]: val })\n        self.updateState(newState)\n        if (onChange) onChange(val)\n      }\n    }\n  }\n\n  render() {\n    const { schema, children } = this.props\n\n    return (\n      <form>\n        <FormContext.Provider value={{ schema, stateStore: this }}>\n          {children}\n        </FormContext.Provider>\n      </form>\n    )\n  }\n}\n\nexport default connect(null, dispatch => ({\n  onUpdate: (result, valid, errors) => {\n    dispatch(updateFormState({ result, valid, errors }))\n  }\n}))(Form)\n\nfunction Label({ labelPos, title, children, ...props }) {\n  return (\n    <label {...props}>\n      {title && labelPos !== 'after' ? `${title}:` : ''}\n      {children}\n      {title && labelPos === 'after' ? title : ''}\n    </label>\n  )\n}\n\nfunction Field(props) {\n  const { name, onChange, component, labelPos, ...rest } = props\n  const { schema, stateStore } = useFormContext()\n  const desc = rest.schema || schema.properties[name]\n  const { dataError, ...fieldOpts } = stateStore.field(name, onChange)\n  const Component = component\n  const formField = component ? (\n    <Component name={name} schema={desc} {...fieldOpts} {...rest} />\n  ) : (\n    <Input name={name} schema={desc} {...fieldOpts} {...rest} />\n  )\n\n  if (labelPos === false) return formField\n  return (\n    <Label\n      className={clsx({ 'data-error': dataError })}\n      error={dataError}\n      title={rest.title || desc.title}\n      labelPos={labelPos}>\n      {formField}\n    </Label>\n  )\n}\n\nconst SelectOneOf = props => {\n  const { title, name, schema, ...prop } = props\n\n  const selectDesc = {\n    title,\n    enum: [],\n    enumNames: []\n  }\n\n  Object.keys(schema).forEach(item => {\n    selectDesc.enum.push(item)\n    selectDesc.enumNames.push(schema[item].title || item)\n  })\n\n  return <Field name={name} schema={selectDesc} {...prop} />\n}\n\n//\n\nfunction propSchema(schema, { customValid, serialize = {}, deserialize = {} }) {\n  const validator = new jsonschema.Validator()\n\n  if (customValid) {\n    schema = Object.assign({}, schema) // copy\n    schema.properties = Object.keys(customValid).reduce((res, prop) => {\n      validator.customFormats[prop] = customValid[prop]\n      res[prop] = { format: prop, ...res[prop] }\n      return res\n    }, schema.properties)\n  }\n\n  return {\n    key: schema.key || '',\n    serialize: inst =>\n      validator.validate(inst, schema, {\n        rewrite: serializeRewrite.bind(null, serialize)\n      }),\n    deserialize: inst =>\n      validator.validate(inst, schema, {\n        rewrite: deserializeRewrite.bind(null, deserialize)\n      })\n  }\n}\n\nfunction serializeRewrite(serializeMap, instance, schema) {\n  const res = {}\n  if (typeof instance !== 'object' || !schema.properties) {\n    return instance !== undefined ? instance : schema.default\n  }\n\n  Object.keys(schema.properties).forEach(p => {\n    if (p in instance) res[p] = instance[serializeMap[p]] || instance[p]\n  })\n\n  return res\n}\n\nfunction deserializeRewrite(deserializeMap, instance) {\n  return instance\n}\n\nfunction getInvalidMessage(item) {\n  if (!item.schema.invalidMessage) return item.message\n  return typeof item.schema.invalidMessage === 'function'\n    ? item.schema.invalidMessage(item.instance)\n    : item.schema.invalidMessage\n}\n\nfunction getErrorsObj(errors) {\n  const errs = {}\n  let field\n\n  errors.forEach(item => {\n    field = item.property.split('.')[1]\n    if (!errs[field]) errs[field] = getInvalidMessage(item)\n  })\n\n  return errs\n}\n\nexport { Field, SelectOneOf }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { Component, ReactNode } from 'react'\nimport clsx from 'clsx'\nimport { xor } from 'lodash/fp'\n\nimport classes from './Accordion.module.less'\n\ninterface AccordionProps {\n  className: string\n  multiple: boolean\n  active: Array<number>\n}\n\ninterface AccordionState {\n  active: Array<number>\n}\n\ninterface GroupProps {\n  caption: string\n  children: ReactNode\n}\n\ninterface ExtendedGroupProps extends GroupProps {\n  isActive: (index: Array<number>) => boolean\n  onActive: (index: Array<number>) => void\n  index: Array<number>\n}\n\nclass Accordion extends Component<AccordionProps, AccordionState> {\n  constructor(props: AccordionProps) {\n    super(props)\n    this.state = {\n      active: props.active || []\n    }\n  }\n  onActive(index: number): void {\n    const { multiple = true } = this.props\n\n    if (!multiple) this.setState({ active: [index] })\n    else\n      this.setState(prevState => ({ active: xor(prevState.active, [index]) }))\n  }\n\n  groupIsActive(index: number): boolean {\n    return this.state.active.includes(index)\n  }\n\n  static Group(props: GroupProps) {\n    const {\n      caption,\n      isActive,\n      onActive,\n      index,\n      children\n    } = props as ExtendedGroupProps\n\n    return (\n      <li\n        className={clsx(classes.accordion_tab, {\n          [classes.hidden]: !isActive(index)\n        })}>\n        <a // eslint-disable-line\n          onClick={() => onActive(index)}>\n          {caption}\n        </a>\n        {children}\n      </li>\n    )\n  }\n  render() {\n    const { children, ...props } = this.props\n    const childrenWithProps = React.Children.map(\n      this.props.children,\n      (child, index) => {\n        // checking isValidElement is the safe way and avoids a typescript error too\n        const props = {\n          isActive: this.groupIsActive.bind(this),\n          onActive: this.onActive.bind(this),\n          index\n        }\n        if (React.isValidElement(child)) {\n          return React.cloneElement(child, props)\n        }\n        return child\n      }\n    )\n    return <ul {...props}>{childrenWithProps}</ul>\n  }\n}\n\nexport default Accordion\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport { saveAs } from 'file-saver'\nimport { useAppContext } from '../../../../hooks'\n\nconst SaveButton = props => {\n  const noop = () => null\n  const {\n    server,\n    filename = 'unnamed',\n    outputFormat,\n    data,\n    type,\n    mode = 'saveFile',\n    onSave = noop,\n    onError = noop\n  } = props\n  const { getKetcherInstance } = useAppContext()\n\n  const save = event => {\n    event.preventDefault()\n    switch (mode) {\n      case 'saveImage':\n        saveImage()\n        break\n      case 'saveFile':\n      default:\n        saveFile()\n    }\n  }\n\n  const saveFile = () => {\n    if (data) {\n      try {\n        fileSaver(server).then(saver => {\n          saver(data, filename, type)\n          onSave()\n        })\n      } catch (error) {\n        onError(error)\n      }\n    }\n  }\n\n  const saveImage = () => {\n    const ketcherInstance = getKetcherInstance()\n    ketcherInstance\n      .generateImageAsync(data, { outputFormat })\n      .then(blob => {\n        saveAs(blob, `${filename}.${outputFormat}`)\n        onSave()\n      })\n      .catch(error => {\n        onError(error)\n      })\n  }\n\n  return (\n    <button\n      onClick={event => {\n        save(event)\n      }}\n      {...props}>\n      {props.children}\n    </button>\n  )\n}\n\nconst fileSaver = server => {\n  return new Promise((resolve, reject) => {\n    if (global.Blob && saveAs) {\n      resolve((data, fn, type) => {\n        const blob = new Blob([data], { type }) // eslint-disable-line no-undef\n        saveAs(blob, fn)\n      })\n    } else if (server) {\n      resolve(\n        server.then(() => {\n          throw Error(\"Server doesn't still support echo method\")\n        })\n      )\n    } else {\n      reject(new Error('Your browser does not support opening files locally'))\n    }\n  })\n}\n\nexport default SaveButton\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { Component } from 'react'\n\nclass OpenButton extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {}\n    if (props.server) {\n      fileOpener(props.server).then(opener => {\n        this.setState({ opener })\n      })\n    }\n  }\n\n  open(ev) {\n    const files = ev.target.files\n    const noop = () => null\n    const { onLoad = noop, onError = noop } = this.props\n\n    if (this.state.opener && files.length)\n      this.state.opener(files[0]).then(onLoad, onError)\n    else if (files.length) onLoad(files[0])\n    ev.target.value = null\n    ev.preventDefault()\n  }\n\n  render() {\n    const {\n      children,\n      type,\n      server,\n      className = 'open-button',\n      ...props\n    } = this.props\n\n    return (\n      <button onClick={() => this.btn.click()} className={className} {...props}>\n        <input\n          onChange={ev => this.open(ev)}\n          accept={type}\n          type=\"file\"\n          ref={el => {\n            this.btn = el\n          }}\n        />\n        {children}\n      </button>\n    )\n  }\n}\n\nfunction fileOpener(server) {\n  return new Promise((resolve, reject) => {\n    // TODO: refactor return\n    if (global.FileReader) {\n      resolve(throughFileReader)\n    } else if (global.ActiveXObject) {\n      try {\n        const fso = new ActiveXObject('Scripting.FileSystemObject') // eslint-disable-line no-undef\n        resolve(file => Promise.resolve(throughFileSystemObject(fso, file)))\n      } catch (e) {\n        reject(e)\n      }\n    } else if (server) {\n      resolve(\n        server.then(() => {\n          throw Error(\"Server doesn't still support echo method\")\n          // return resolve(throughForm2IframePosting);\n        })\n      )\n    } else {\n      reject(new Error('Your browser does not support opening files locally'))\n    }\n  })\n}\n\nfunction throughFileReader(file) {\n  return new Promise((resolve, reject) => {\n    const rd = new FileReader() // eslint-disable-line no-undef\n\n    rd.onload = () => {\n      const content = rd.result\n      if (file.msClose) file.msClose()\n      resolve(content)\n    }\n\n    rd.onerror = event => {\n      reject(event)\n    }\n\n    rd.readAsText(file, 'UTF-8')\n  })\n}\n\nfunction throughFileSystemObject(fso, file) {\n  // IE9 and below\n  const fd = fso.OpenTextFile(file.name, 1)\n  const content = fd.ReadAll()\n  fd.Close()\n  return content\n}\n\nexport default OpenButton\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React, { Component } from 'react'\n\nimport Input from './input'\n\nclass MeasureInput extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      cust: props.value || props.schema.default,\n      meas: 'px'\n    }\n\n    this.calcValue = this.calcValue.bind(this)\n    this.handleChange = this.handleChange.bind(this)\n    this.handleMeasChange = this.handleMeasChange.bind(this)\n  }\n\n  handleChange(value) {\n    const convValue = convertValue(value, this.state.meas, 'px')\n    this.state.cust = value\n    this.props.onChange(convValue)\n  }\n\n  handleMeasChange(m) {\n    this.setState(state => ({\n      meas: m,\n      cust: convertValue(state.cust, state.meas, m)\n    }))\n  }\n\n  calcValue() {\n    this.setState(state => ({\n      cust: convertValue(this.props.value, 'px', state.meas)\n    }))\n  }\n\n  render() {\n    const { meas, cust } = this.state\n    const { schema, value, onChange, ...props } = this.props\n\n    if (meas === 'px' && cust.toFixed() - 0 !== value)\n      this.setState({ meas: 'px', cust: value }) // Hack: Set init value (RESET)\n\n    return (\n      <div style={{ display: 'inline-flex' }} {...props}>\n        <Input\n          schema={schema}\n          step={meas === 'px' || meas === 'pt' ? '1' : '0.001'}\n          style={{ width: '75%' }}\n          value={cust}\n          onChange={this.handleChange}\n          onBlur={this.calcValue}\n        />\n        <Input\n          schema={{ enum: ['cm', 'px', 'pt', 'inch'] }}\n          style={{ width: '25%' }}\n          value={meas}\n          onChange={this.handleMeasChange}\n        />\n      </div>\n    )\n  }\n}\n\nconst measureMap = {\n  px: 1,\n  cm: 37.795278,\n  pt: 1.333333,\n  inch: 96\n}\n\nfunction convertValue(value, measureFrom, measureTo) {\n  if ((!value && value !== 0) || isNaN(value)) return null // eslint-disable-line\n\n  return measureTo === 'px' || measureTo === 'pt'\n    ? ((value * measureMap[measureFrom]) / measureMap[measureTo]).toFixed() - 0\n    : ((value * measureMap[measureFrom]) / measureMap[measureTo]).toFixed(3) - 0\n}\n\nexport default MeasureInput\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { useCallback, useState, useEffect } from 'react'\nimport FontFaceObserver from 'font-face-observer'\n\nconst commonFonts = [\n  'Arial',\n  'Arial Black',\n  'Comic Sans MS',\n  'Courier New',\n  'Georgia',\n  'Impact',\n  'Charcoal',\n  'Lucida Console',\n  'Monaco',\n  'Palatino Linotype',\n  'Book Antiqua',\n  'Palatino',\n  'Tahoma',\n  'Geneva',\n  'Times New Roman',\n  'Times',\n  'Verdana',\n  'Symbol',\n  'MS Serif',\n  'MS Sans Serif',\n  'New York',\n  'Droid Sans',\n  'Droid Serif',\n  'Droid Sans Mono',\n  'Roboto'\n]\n\nfunction checkInSystem() {\n  const availableFontsPromises = commonFonts.map(fontName => {\n    const observer = new FontFaceObserver(fontName)\n    return observer.check().then(\n      () => fontName,\n      () => null\n    )\n  })\n\n  return Promise.all(availableFontsPromises)\n}\n\nfunction SystemFonts(props) {\n  const [availableFonts, setAvailableFonts] = useState(null)\n  const { value, onChange } = props\n  const onChangeCallback = useCallback(\n    e => {\n      onChange(e.target.value)\n    },\n    [onChange]\n  )\n\n  useEffect(() => {\n    let mounted = true\n    checkInSystem().then(results => {\n      const fonts = results\n        .filter(i => i !== null)\n        .map(font => {\n          return { value: `30px ${font}`, label: font }\n        })\n      if (mounted) {\n        setAvailableFonts(fonts)\n      }\n    })\n\n    return () => (mounted = false)\n  }, [])\n\n  return (\n    <select\n      disabled={availableFonts == null}\n      value={value}\n      onChange={onChangeCallback}>\n      {availableFonts?.map(({ value, label }) => (\n        <option key={value} value={value}>\n          {label}\n        </option>\n      ))}\n    </select>\n  )\n}\n\nexport default SystemFonts\n","import Input from './input'\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\n\nfunction SelectCheckbox({ schema, ...props }) {\n  let currentSchema = schema\n  if (schema.type === 'boolean') {\n    currentSchema = {\n      title: schema.title,\n      enum: [true, false],\n      enumNames: ['on', 'off'],\n      default: schema.default\n    }\n  }\n\n  return <Input schema={currentSchema} {...props} />\n}\n\nexport default SelectCheckbox\n","import React, { useCallback, useState } from 'react'\nimport { CompactPicker } from 'react-color'\n\ninterface ColorPickerProps {\n  value: string\n  name: string\n  schema: any\n  type?: string\n}\n\ninterface ColorPickerCallProps {\n  onChange: (value: string) => void\n}\n\ntype Props = ColorPickerProps & ColorPickerCallProps\n\nconst ColorPicker = (props: Props) => {\n  const [isOpen, setIsOpen] = useState(false)\n  const { onChange, value } = props\n\n  const handleChange = useCallback(\n    color => {\n      onChange(color.hex)\n    },\n    [onChange]\n  )\n  const handleClick = () => {\n    setIsOpen(isOpen => !isOpen)\n  }\n  const handleClose = () => {\n    setIsOpen(false)\n  }\n\n  return (\n    <div className=\"color-picker-input\">\n      <div\n        className=\"color-picker-btn\"\n        onClick={handleClick}\n        data-testid=\"color-picker-btn\">\n        {props.value}\n        <span\n          className=\"color-picker-preview\"\n          data-testid=\"color-picker-preview\"\n          style={{ backgroundColor: value }}\n        />\n      </div>\n      <div className=\"color-picker-wrap\">\n        {isOpen ? (\n          <>\n            <div\n              className=\"color-picker-overlay\"\n              onClick={handleClose}\n              data-testid=\"color-picker-overlay\"\n            />\n            <CompactPicker\n              className=\"color-picker\"\n              color={value}\n              onChange={handleChange}\n            />\n          </>\n        ) : null}\n      </div>\n    </div>\n  )\n}\n\nexport default ColorPicker\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport { connect } from 'react-redux'\nimport {\n  updateFormState,\n  setDefaultSettings\n} from '../../../../../state/modal/form'\nimport { saveSettings } from '../../../../../state/options'\n\nimport settingsSchema from '../../../../../data/schema/options-schema'\nimport { storage } from '../../../../../storage-ext'\n\nimport Form, { Field } from '../../../../../component/form/form'\nimport { Dialog } from '../../../../components'\nimport Accordion from './components/Accordion'\nimport SaveButton from '../../../../../component/view/savebutton'\nimport OpenButton from '../../../../../component/view/openbutton'\n\nimport MeasureInput from '../../../../../component/form/measure-input'\nimport SystemFonts from '../../../../../component/form/systemfonts'\nimport SelectCheckbox from '../../../../../component/form/select-checkbox'\nimport ColorPicker from '../../../../../component/form/colorPicker/ColorPicker'\n\nimport classes from './Settings.module.less'\nimport { BaseCallProps, BaseProps } from '../../../modal.types'\nimport { StructService } from 'ketcher-core'\n\ninterface SettingsProps extends BaseProps {\n  initState: any\n  appOpts: {\n    version: string\n    buildDate: string\n    buildNumber: string\n    indigoVersion: string\n    imagoVersions: Array<string>\n    server: boolean\n    templates: boolean\n  }\n  server: StructService\n}\n\ninterface SettingsCallProps extends BaseCallProps {\n  onOpenFile: (any) => void\n  onReset: () => void\n}\n\ntype Props = SettingsProps & SettingsCallProps\n\nconst SettingsDialog = (props: Props) => {\n  const {\n    initState,\n    formState,\n    server,\n    onOpenFile,\n    onReset,\n    appOpts,\n    ...prop\n  } = props\n\n  return (\n    <Dialog\n      title=\"Settings\"\n      className={classes.settings}\n      result={() => formState.result}\n      valid={() => formState.valid}\n      params={prop}\n      buttons={[\n        <OpenButton key=\"settings\" server={server} onLoad={onOpenFile}>\n          Open From File…\n        </OpenButton>,\n        <SaveButton\n          key=\"ketcher-settings\"\n          data={JSON.stringify(formState.result)}\n          filename=\"ketcher-settings\">\n          Save To File…\n        </SaveButton>,\n        <button key=\"settings-button\" onClick={onReset}>\n          Reset\n        </button>,\n        'Cancel',\n        'OK'\n      ]}>\n      <Form schema={settingsSchema} init={initState} {...formState}>\n        <Accordion className={classes.accordion} multiple={false} active={[0]}>\n          <Accordion.Group caption=\"General\">\n            <fieldset className={classes.general}>\n              <Field name=\"resetToSelect\" />\n              <Field name=\"rotationStep\" />\n              <Field name=\"showValenceWarnings\" component={SelectCheckbox} />\n              <Field name=\"atomColoring\" component={SelectCheckbox} />\n              <Field name=\"font\" component={SystemFonts} />\n              <Field name=\"fontsz\" component={MeasureInput} />\n              <Field name=\"fontszsub\" component={MeasureInput} />\n            </fieldset>\n          </Accordion.Group>\n          <Accordion.Group caption=\"Stereochemistry\">\n            <fieldset className={classes.stereochemistry}>\n              <Field name=\"showStereoFlags\" component={SelectCheckbox} />\n              <Field name=\"stereoLabelStyle\" />\n              <Field name=\"colorOfAbsoluteCenters\" component={ColorPicker} />\n              <Field name=\"colorOfAndCenters\" component={ColorPicker} />\n              <Field name=\"colorOfOrCenters\" component={ColorPicker} />\n              <Field name=\"colorStereogenicCenters\" />\n              <Field name=\"absFlagLabel\" />\n              <Field name=\"andFlagLabel\" />\n              <Field name=\"orFlagLabel\" />\n              <Field name=\"mixedFlagLabel\" />\n            </fieldset>\n          </Accordion.Group>\n          <Accordion.Group caption=\"Atoms\">\n            <fieldset>\n              <Field name=\"carbonExplicitly\" component={SelectCheckbox} />\n              <Field name=\"showCharge\" component={SelectCheckbox} />\n              <Field name=\"showValence\" component={SelectCheckbox} />\n              <Field name=\"showHydrogenLabels\" component={SelectCheckbox} />\n            </fieldset>\n          </Accordion.Group>\n          <Accordion.Group caption=\"Bonds\">\n            <fieldset>\n              <Field name=\"aromaticCircle\" component={SelectCheckbox} />\n              <Field name=\"doubleBondWidth\" component={MeasureInput} />\n              <Field name=\"bondThickness\" component={MeasureInput} />\n              <Field name=\"stereoBondWidth\" component={MeasureInput} />\n            </fieldset>\n          </Accordion.Group>\n          <Accordion.Group caption=\"Server\">\n            <fieldset className={classes.server} disabled={!appOpts.server}>\n              <Field name=\"smart-layout\" component={SelectCheckbox} />\n              <Field\n                name=\"ignore-stereochemistry-errors\"\n                component={SelectCheckbox}\n              />\n              <Field\n                name=\"mass-skip-error-on-pseudoatoms\"\n                component={SelectCheckbox}\n              />\n              <Field\n                name=\"gross-formula-add-rsites\"\n                component={SelectCheckbox}\n              />\n              <Field\n                name=\"gross-formula-add-isotopes\"\n                component={SelectCheckbox}\n              />\n            </fieldset>\n          </Accordion.Group>\n          <Accordion.Group caption=\"3D Viewer\">\n            <fieldset className={classes.viewer} disabled={!window['Miew']}>\n              <Field name=\"miewMode\" />\n              <Field name=\"miewTheme\" />\n              <Field name=\"miewAtomLabel\" />\n            </fieldset>\n          </Accordion.Group>\n          <Accordion.Group caption=\"Options for debugging\">\n            <fieldset>\n              <Field name=\"showAtomIds\" component={SelectCheckbox} />\n              <Field name=\"showBondIds\" component={SelectCheckbox} />\n              <Field name=\"showHalfBondIds\" component={SelectCheckbox} />\n              <Field name=\"showLoopIds\" component={SelectCheckbox} />\n            </fieldset>\n          </Accordion.Group>\n        </Accordion>\n        {!storage.isAvailable() ? (\n          <div className={classes.warning}>{storage.warningMessage}</div>\n        ) : null}\n      </Form>\n    </Dialog>\n  )\n}\n\nconst mapStateToProps = state => ({\n  server: state.options.app.server ? state.server : null,\n  appOpts: state.options.app,\n  initState: state.options.settings,\n  formState: state.modal.form\n})\n\nconst mapDispatchToProps = (dispatch, ownProps) => ({\n  onOpenFile: newOpts => {\n    try {\n      dispatch(updateFormState({ result: JSON.parse(newOpts) }))\n    } catch (ex) {\n      console.info('Bad file')\n    }\n  },\n  onReset: () => dispatch(setDefaultSettings()),\n  onOk: res => {\n    dispatch(saveSettings(res))\n    ownProps.onOk(res)\n  }\n})\n\nconst Settings = connect(mapStateToProps, mapDispatchToProps)(SettingsDialog)\n\nexport default Settings\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { Component } from 'react'\nimport clsx from 'clsx'\n\nimport classes from './Tabs.module.less'\n\nclass Tabs extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {}\n    this.state.tabIndex = props.tabIndex || 0\n    this.props.changeTab(this.state.tabIndex)\n  }\n\n  //TODO: refactor the component\n  changeTab(ev, index) {\n    this.setState({ tabIndex: index })\n    if (this.props.changeTab) this.props.changeTab(index)\n  }\n\n  render() {\n    const { tabs, contentClassName, className, tabIndex } = this.props\n    const tabPanel = tabs[this.state.tabIndex]\n    const Component = tabPanel?.component\n    const componentProps = tabPanel?.props\n    return (\n      <div>\n        <ul className={className} tabIndex={tabIndex}>\n          <li className={classes.tabs}>\n            {tabs.map((tabPanel, index) => (\n              <a // eslint-disable-line\n                key={index}\n                className={clsx({\n                  [classes.active]: this.state.tabIndex === index\n                })}\n                onClick={ev => this.changeTab(ev, index)}>\n                {tabPanel.caption}\n              </a>\n            ))}\n          </li>\n        </ul>\n        {tabPanel && (\n          <div className={contentClassName}>\n            <Component {...componentProps} />\n          </div>\n        )}\n      </div>\n    )\n  }\n}\n\nexport default Tabs\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\n\nfunction ErrorsCheck(props) {\n  const { moleculeErrors, checkSchema } = props\n  const moleculeErrorsTypes = Object.keys(moleculeErrors)\n\n  const getOptionName = option => {\n    const { items } = checkSchema.properties.checkOptions\n    const nameIndex = items.enum.indexOf(option)\n    return items.enumNames[nameIndex]\n  }\n\n  return (\n    <fieldset>\n      {moleculeErrorsTypes.length === 0 ? (\n        <dt>No errors found</dt>\n      ) : (\n        moleculeErrorsTypes.map(type => (\n          <div>\n            <dt>{getOptionName(type)} warning:</dt>\n            <dd>{moleculeErrors[type]}</dd>\n          </div>\n        ))\n      )}\n    </fieldset>\n  )\n}\n\nexport default ErrorsCheck\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport { connect } from 'react-redux'\n\nimport { Dialog } from '../../../../components'\nimport Tabs from '../../../../../component/view/Tabs'\nimport Form, { Field } from '../../../../../component/form/form'\nimport { check } from '../../../../../state/server'\nimport { checkOpts } from '../../../../../state/options'\nimport ErrorsCheck from './components'\n\nimport style from './Check.module.less'\n\nconst checkSchema = {\n  title: 'Check',\n  type: 'object',\n  properties: {\n    checkOptions: {\n      type: 'array',\n      items: {\n        type: 'string',\n        enum: [\n          'valence',\n          'radicals',\n          'pseudoatoms',\n          'stereo',\n          'query',\n          'overlapping_atoms',\n          'overlapping_bonds',\n          'rgroups',\n          'chiral',\n          '3d',\n          'chiral_flag'\n        ],\n        enumNames: [\n          'Valence',\n          'Radical',\n          'Pseudoatom',\n          'Stereochemistry',\n          'Query',\n          'Overlapping Atoms',\n          'Overlapping Bonds',\n          'R-Groups',\n          'Chirality',\n          '3D Structure',\n          'Chiral flag'\n        ]\n      }\n    }\n  }\n}\n\nfunction CheckDialog(props) {\n  const { formState, checkState, onCheck, ...prop } = props\n  const { result = checkState, moleculeErrors } = formState\n  const tabs = [\n    {\n      caption: 'Check',\n      component: ErrorsCheck,\n      props: { moleculeErrors, checkSchema }\n    },\n    {\n      caption: 'Settings',\n      component: Field,\n      props: {\n        name: 'checkOptions',\n        multiple: true,\n        type: 'checkbox',\n        labelPos: false\n      }\n    }\n  ]\n\n  return (\n    <Dialog\n      title=\"Structure Check\"\n      className={style.check}\n      result={() => result}\n      params={prop}>\n      <Form schema={checkSchema} init={checkState} {...formState}>\n        <Tabs\n          className={style.tabs}\n          captions={tabs}\n          changeTab={i => (i === 0 ? onCheck(result.checkOptions) : null)}\n          tabs={tabs}>\n          <ErrorsCheck\n            moleculeErrors={moleculeErrors}\n            checkSchema={checkSchema}\n          />\n          <Field\n            name=\"checkOptions\"\n            multiple\n            type=\"checkbox\"\n            labelPos={false}\n          />\n        </Tabs>\n      </Form>\n    </Dialog>\n  )\n}\n\nconst mapStateToProps = state => ({\n  formState: state.modal.form,\n  checkState: state.options.check\n})\n\nconst mapDispatchToProps = (dispatch, ownProps) => ({\n  onCheck: opts => dispatch(check(opts)).catch(ownProps.onCancel),\n  onOk: res => {\n    dispatch(checkOpts(res))\n    ownProps.onOk(res)\n  }\n})\n\nconst Check = connect(mapStateToProps, mapDispatchToProps)(CheckDialog)\n\nexport default Check\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport styles from './FormulaInput.module.less'\n\nconst formulaRegexp = /\\b(\\d*)([A-Z][a-z]{0,3}#?)(\\d*)\\s*\\b/g\nconst errorRegexp = /error:.*/g\n\nfunction formulaInputMarkdown(content) {\n  const onKeyDown = e => {\n    if (e.keyCode === 8) {\n      e.preventDefault()\n      return false\n    }\n  }\n  return (\n    <div\n      className={styles.chem_input}\n      onKeyPress={e => e.preventDefault()}\n      onPaste={e => e.preventDefault()}\n      onKeyDown={onKeyDown}\n      contentEditable={true}\n      suppressContentEditableWarning={true}>\n      {content}\n    </div>\n  )\n}\n\nfunction FormulaInput({ value }) {\n  if (errorRegexp.test(value)) return formulaInputMarkdown(value)\n\n  const content = []\n  let cnd\n  let pos = 0\n\n  while ((cnd = formulaRegexp.exec(value)) !== null) {\n    if (cnd[1].length > 0)\n      content.push(<sup key={content.length}>{cnd[1]}</sup>)\n    content.push(value.substring(pos, cnd.index) + cnd[2])\n    if (cnd[3].length > 0)\n      content.push(<sub key={content.length}>{cnd[3]}</sub>)\n    pos = cnd.index + cnd[0].length\n  }\n\n  if (pos === 0) content.push(value)\n  else content.push(value.substring(pos, value.length))\n\n  return formulaInputMarkdown(content)\n}\n\nexport default FormulaInput\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\n\nfunction FrozenInput({ value }) {\n  return (\n    <input\n      type=\"text\"\n      spellCheck={false}\n      value={value}\n      onChange={event => event.preventDefault()}\n    />\n  )\n}\n\nexport default FrozenInput\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { range } from 'lodash/fp'\nimport React, { Component } from 'react'\nimport { connect } from 'react-redux'\n\nimport { Dialog } from '../../../../components'\nimport Input from '../../../../../component/form/input'\n\nimport { changeRound } from '../../../../../state/options'\nimport { analyse } from '../../../../../state/server'\nimport { FrozenInput, FormulaInput } from './components'\n\nimport classes from './Analyse.module.less'\n\nfunction roundOff(value, round) {\n  if (typeof value === 'number') return value.toFixed(round)\n  return value.replace(/[0-9]*\\.[0-9]+/g, str => (+str).toFixed(round))\n}\n\nclass AnalyseDialog extends Component {\n  constructor(props) {\n    super(props)\n    props.onAnalyse().catch(e => {\n      // error could possibly be an invalid state of molecule.\n      // TODO: handling such cases described in #251\n      alert(e)\n      props.onCancel()\n    })\n  }\n\n  render() {\n    const {\n      values,\n      round,\n      loading,\n      onAnalyse,\n      onChangeRound,\n      ...props\n    } = this.props\n    return (\n      <Dialog\n        title=\"Calculated Values\"\n        className={classes.analyse}\n        buttons={['Close']}\n        params={props}>\n        <ul>\n          {[\n            {\n              name: 'Chemical Formula',\n              key: 'gross',\n              withSelector: false\n            },\n            {\n              name: 'Molecular Weight',\n              key: 'molecular-weight',\n              round: 'roundWeight',\n              withSelector: true\n            },\n            {\n              name: 'Exact Mass',\n              key: 'monoisotopic-mass',\n              round: 'roundMass',\n              withSelector: true\n            },\n            {\n              name: 'Elemental Analysis',\n              key: 'mass-composition',\n              round: 'roundElAnalysis',\n              withSelector: false\n            }\n          ].map(item => (\n            <li key={item.key}>\n              <label>{item.name}:</label>\n              {item.key === 'gross' ? (\n                <FormulaInput\n                  value={values && !loading ? values[item.key] : ''}\n                />\n              ) : (\n                <FrozenInput\n                  value={\n                    values && !loading\n                      ? roundOff(values[item.key], round[item.round])\n                      : 0\n                  }\n                />\n              )}\n              {item.withSelector ? (\n                <Input\n                  schema={{\n                    enum: range(0, 8),\n                    enumNames: range(0, 8).map(i => `${i} decimal places`)\n                  }}\n                  value={round[item.round]}\n                  onChange={val => onChangeRound(item.round, val)}\n                />\n              ) : null}\n            </li>\n          ))}\n        </ul>\n      </Dialog>\n    )\n  }\n}\n\nconst mapStateToProps = state => ({\n  values: state.options.analyse.values,\n  loading: state.options.analyse.loading,\n  round: {\n    roundWeight: state.options.analyse.roundWeight,\n    roundMass: state.options.analyse.roundMass,\n    roundElAnalysis: state.options.analyse.roundElAnalysis\n  }\n})\n\nconst mapDispatchToProps = dispatch => ({\n  onAnalyse: () => dispatch(analyse()),\n  onChangeRound: (roundName, val) => dispatch(changeRound(roundName, val))\n})\n\nconst Analyse = connect(mapStateToProps, mapDispatchToProps)(AnalyseDialog)\n\nexport default Analyse\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { MolSerializer, Struct } from 'ketcher-core'\nimport React, { Component, createRef } from 'react'\n\nimport Render from '../../render'\n\nfunction renderStruct(el, struct, options = {}) {\n  if (el) {\n    if (struct?.prerender) {\n      // Should it sit here?\n      el.innerHTML = struct.prerender\n    } else if (struct) {\n      console.info('render!', el.clientWidth, el.clientWidth)\n      const rnd = new Render(el, {\n        autoScale: true,\n        ...options\n      })\n      rnd.setMolecule(struct)\n      rnd.update()\n      // console.info('render!');//, el.innerHTML);\n      // struct.prerender = el.innerHTML;\n    }\n  }\n}\n\nclass StructRender extends Component {\n  constructor(props) {\n    super(props)\n    this.tagRef = createRef()\n  }\n\n  shouldComponentUpdate() {\n    return false\n  }\n\n  componentDidMount() {\n    const el = this.tagRef.current\n    const { struct, options } = this.props\n    let parsedStruct\n    if (!(struct instanceof Struct)) {\n      try {\n        const molSerialzer = new MolSerializer()\n        parsedStruct = molSerialzer.deserialize(struct)\n      } catch (e) {\n        //TODO: add error handler call\n        //legacy message: Could not parse structure\n        parsedStruct = null\n      }\n    } else {\n      parsedStruct = struct\n    }\n    renderStruct(el, parsedStruct, options)\n  }\n\n  render() {\n    const { struct, Tag = 'div', ...props } = this.props\n    return (\n      <Tag ref={this.tagRef} /* ref=\"el\" */ {...props}>\n        {struct ? null : 'No molecule'}\n      </Tag>\n    )\n  }\n}\n\nexport default StructRender\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\n\nfunction Spin({ ...props }) {\n  return <div className=\"ket-spinner\" {...props} />\n}\n\nexport default Spin\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { useState, useCallback } from 'react'\nimport { connect } from 'react-redux'\nimport { range } from 'lodash/fp'\n\nimport {\n  changeImage,\n  shouldFragment,\n  changeVersion\n} from '../../../../../state/options'\nimport { load } from '../../../../../state'\nimport { recognize } from '../../../../../state/server'\n\nimport { Dialog } from '../../../../components'\nimport Input from '../../../../../component/form/input'\nimport StructRender from '../../../../../component/structrender'\nimport OpenButton from '../../../../../component/view/openbutton'\nimport Spin from '../../../../../component/view/spin'\n\nimport classes from './Recognize.module.less'\n\nfunction isImage(file) {\n  return file?.type?.includes('image')\n}\n\nfunction RecognizeDialog(prop) {\n  const {\n    file,\n    structStr,\n    fragment,\n    version,\n    imagoVersions,\n    ...partProps\n  } = prop\n  const {\n    onRecognize,\n    isFragment,\n    onImage,\n    onChangeImago,\n    ...props\n  } = partProps\n  const [canPreviewImage, setCanPreviewImage] = useState(true)\n  const result = () =>\n    structStr && !(structStr instanceof Promise)\n      ? { structStr, fragment }\n      : null\n\n  const clearFile = useCallback(() => {\n    onImage(null)\n    return true\n  }, [onImage])\n\n  return (\n    <Dialog\n      title=\"Import From Image\"\n      className={classes.recognize}\n      params={props}\n      result={() => result(structStr, fragment)}\n      buttons={[\n        <OpenButton key=\"choose\" onLoad={onImage} type=\"image/*\">\n          Choose file…\n        </OpenButton>,\n        <span key=\"open-file\" className={classes.open_filename}>\n          {file ? file.name : null}\n        </span>,\n        file && (\n          <button\n            key=\"recognize\"\n            onClick={() => onRecognize(file, version)}\n            disabled={structStr && typeof structStr !== 'string'}>\n            Recognize\n          </button>\n        ),\n        'Cancel',\n        'OK'\n      ]}>\n      <label className={classes.change_version}>\n        Imago version:\n        <Input\n          schema={{\n            enum: imagoVersions,\n            enumNames: range(1, imagoVersions.length + 1).map(\n              i => `Version ${i}`\n            )\n          }}\n          value={version}\n          onChange={onChangeImago}\n        />\n      </label>\n      <div className={classes.picture}>\n        {file && isImage(file) && canPreviewImage && (\n          <img\n            alt=\"\"\n            id=\"pic\"\n            src={url(file) || ''}\n            onError={() => {\n              setCanPreviewImage(false)\n            }}\n          />\n        )}\n        {file && isImage(file) && !canPreviewImage && (\n          <div>\n            Preview of '{file.type}' MIME type does not supported by current\n            browser\n          </div>\n        )}\n        {(!file || (!isImage(file) && clearFile())) && (\n          <div>Please choose image</div>\n        )}\n      </div>\n      <div className={classes.output}>\n        {structStr &&\n          // in Edge 38: instanceof Promise always `false`\n          (structStr instanceof Promise || typeof structStr !== 'string' ? (\n            <Spin />\n          ) : (\n            <StructRender className={classes.struct} struct={structStr} />\n          ))}\n      </div>\n      <label>\n        <Input type=\"checkbox\" value={fragment} onChange={isFragment} />\n        Load as a fragment\n      </label>\n    </Dialog>\n  )\n}\n\nfunction url(file) {\n  if (!file) return null\n  const URL = window.URL || window.webkitURL\n  return URL ? URL.createObjectURL(file) : 'No preview'\n}\n\nconst mapStateToProps = state => ({\n  imagoVersions: state.options.app.imagoVersions,\n  file: state.options.recognize.file,\n  structStr: state.options.recognize.structStr,\n  fragment: state.options.recognize.fragment,\n  version: state.options.recognize.version || state.options.app.imagoVersions[0]\n})\n\nconst mapDispatchToProps = (dispatch, ownProps) => ({\n  isFragment: v => dispatch(shouldFragment(v)),\n  onImage: file => dispatch(changeImage(file)),\n  onRecognize: (file, ver) => dispatch(recognize(file, ver)),\n  onChangeImago: ver => dispatch(changeVersion(ver)),\n  onOk: res => {\n    dispatch(\n      load(res.structStr, {\n        rescale: true,\n        fragment: res.fragment\n      })\n    )\n    ownProps.onOk(res)\n  }\n})\n\nconst Recognize = connect(mapStateToProps, mapDispatchToProps)(RecognizeDialog)\n\nexport default Recognize\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { Component } from 'react'\n\nimport { Dialog } from '../../../../components'\nimport { FormatterFactory } from 'ketcher-core'\nimport { MIEW_OPTIONS } from '../../../../../data/schema/options-schema'\nimport classes from './Miew.module.less'\nimport { connect } from 'react-redux'\nimport { load } from '../../../../../state'\nimport { pick } from 'lodash/fp'\n\n/* OPTIONS for MIEW */\nconst BACKGROUND_COLOR = {\n  dark: '0x202020',\n  light: '0xcccccc'\n}\n\nconst MIEW_TX_TYPES = {\n  no: null,\n  bright: {\n    colorer: 'EL'\n  },\n  blackAndWhite: {\n    colorer: ['UN', { color: 0xffffff }],\n    bg: '0x000'\n  },\n  black: {\n    colorer: ['UN', { color: 0x000000 }]\n  }\n}\n\nconst TXoptions = userOpts => {\n  const type = userOpts.miewAtomLabel\n  if (MIEW_TX_TYPES[type] === null) return null\n  return {\n    colorer: MIEW_TX_TYPES[type].colorer,\n    selector: 'not elem C',\n    mode: [\n      'TX',\n      {\n        bg: MIEW_TX_TYPES[type].bg || BACKGROUND_COLOR[userOpts.miewTheme],\n        showBg: true,\n        template: '{{elem}}'\n      }\n    ]\n  }\n}\n\nfunction createMiewOptions(userOpts) {\n  const options = {\n    settings: {\n      bg: { color: Number(BACKGROUND_COLOR[userOpts.miewTheme]) },\n      autoPreset: false,\n      editing: true,\n      inversePanning: true\n    },\n    reps: [\n      {\n        mode: userOpts.miewMode\n      }\n    ]\n  }\n\n  const textMode = TXoptions(userOpts)\n  if (textMode) options.reps.push(textMode)\n\n  return options\n}\n/* ---------------- */\nconst CHANGING_WARNING =\n  'Stereocenters can be changed after the strong 3D rotation'\n\nclass MiewDialog extends Component {\n  componentDidMount() {\n    const { struct, server, miewOpts } = this.props\n    const Miew = window.Miew\n\n    this.viewer = new Miew({\n      container: this.miewContainer\n    })\n\n    if (this.viewer.init()) this.viewer.run()\n\n    const factory = new FormatterFactory(server)\n    const service = factory.create('cml')\n\n    service\n      .getStructureFromStructAsync(struct)\n      .then(res =>\n        this.viewer.load(res, { sourceType: 'immediate', fileType: 'cml' })\n      )\n      .then(() => this.viewer.setOptions(miewOpts))\n      .catch(ex => console.error(ex.message))\n  }\n\n  exportCML() {\n    const cmlStruct = this.viewer.exportCML()\n    this.props.onExportCML(cmlStruct)\n  }\n\n  render() {\n    const { miewOpts, server, struct, ...prop } = this.props\n\n    return (\n      <Dialog\n        title=\"Miew\"\n        params={prop}\n        buttons={[\n          <div key=\"warning\" className={classes.warning}>\n            {CHANGING_WARNING}\n          </div>,\n          'Close',\n          <button key=\"apply\" onClick={() => this.exportCML()}>\n            Apply\n          </button>\n        ]}>\n        <div className={classes.dialog_body}>\n          <div\n            ref={el => {\n              this.miewContainer = el\n            }}\n            className=\"miew-container\"\n            style={{ width: '1024px', height: '600px', position: 'relative' }}\n          />\n        </div>\n      </Dialog>\n    )\n  }\n}\n\nconst mapStateToProps = state => ({\n  miewOpts: createMiewOptions(pick(MIEW_OPTIONS, state.options.settings)),\n  server: state.options.app.server ? state.server : null,\n  struct: state.editor.struct()\n})\n\nconst mapDispatchToProps = (dispatch, ownProps) => ({\n  onExportCML: cmlStruct => {\n    dispatch(load(cmlStruct))\n    ownProps.onOk()\n  }\n})\n\nconst Miew = connect(mapStateToProps, mapDispatchToProps)(MiewDialog)\n\nexport default Miew\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\nimport { capitalize } from 'lodash/fp'\n\nimport { Elements } from 'ketcher-core'\n\ninterface ElementNumberProps {\n  label: string\n}\n\ntype Props = ElementNumberProps\n\nconst ElementNumber = (props: Props) => {\n  const { label } = props\n  const value = Elements.get(capitalize(label))?.number || ''\n\n  return (\n    <label>\n      Number:\n      <input type=\"text\" readOnly value={value} />\n    </label>\n  )\n}\n\nexport default ElementNumber\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { ComponentType } from 'react'\nimport { connect } from 'react-redux'\n\nimport Atom, { AtomProps } from './Atom'\nimport { BaseProps } from '../../../modal.types'\n\ntype StateProps = Pick<BaseProps, 'formState'>\ntype OwnProps = Omit<AtomProps, 'formState'>\n\nconst mapStateToProps = (state): StateProps => ({ formState: state.modal.form })\n\nconst AtomContainer: ComponentType<OwnProps> = connect(mapStateToProps)(Atom)\nexport default AtomContainer\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { BaseCallProps, BaseProps } from '../../../modal.types'\nimport Form, { Field } from '../../../../../component/form/form'\nimport React, { FC, useCallback, useState } from 'react'\n\nimport { Dialog } from '../../../../components'\nimport ElementNumber from './ElementNumber'\nimport { Elements } from 'ketcher-core'\nimport { atom as atomSchema } from '../../../../../data/schema/struct-schema'\nimport { capitalize } from 'lodash/fp'\nimport classes from './Atom.module.less'\n\ninterface AtomProps extends BaseProps {\n  alias: string\n  charge: string\n  exactChangeFlag: boolean\n  explicitValence: number\n  hCount: number\n  invRet: number\n  isotope: number\n  label: string\n  radical: number\n  ringBondCount: number\n  stereoParity: number\n  substitutionCount: number\n  unsaturatedAtom: boolean\n}\n\ntype Props = AtomProps & BaseCallProps\n\nconst Atom: FC<Props> = props => {\n  const { formState, stereoParity, ...rest } = props\n  const [currentLabel, setCurrentLabel] = useState<string>(rest.label)\n\n  const onLabelChangeCallback = useCallback(newValue => {\n    setCurrentLabel(newValue)\n  }, [])\n\n  return (\n    <Dialog\n      title=\"Atom Properties\"\n      className={classes.atomProps}\n      result={() => formState.result}\n      valid={() => formState.valid}\n      params={rest}>\n      <Form\n        schema={atomSchema}\n        customValid={{\n          label: label => atomValid(label),\n          charge: charge => chargeValid(charge)\n        }}\n        init={rest}\n        {...formState}>\n        <fieldset className={classes.main}>\n          <Field name=\"label\" onChange={onLabelChangeCallback} autoFocus />\n          <Field name=\"alias\" />\n          <ElementNumber label={currentLabel} />\n          <Field name=\"charge\" maxLength=\"5\" />\n          <Field name=\"explicitValence\" />\n          <Field name=\"isotope\" />\n          <Field name=\"radical\" />\n        </fieldset>\n        <fieldset className={classes.query}>\n          <legend>Query specific</legend>\n          <Field name=\"ringBondCount\" />\n          <Field name=\"hCount\" />\n          <Field name=\"substitutionCount\" />\n          <Field name=\"unsaturatedAtom\" />\n        </fieldset>\n        <fieldset className={classes.reaction}>\n          <legend>Reaction flags</legend>\n          <Field name=\"invRet\" />\n          <Field name=\"exactChangeFlag\" />\n        </fieldset>\n      </Form>\n    </Dialog>\n  )\n}\n\nfunction atomValid(label) {\n  return label && !!Elements.get(capitalize(label))\n}\n\nfunction chargeValid(charge) {\n  const result = atomSchema.properties.charge.pattern.exec(charge)\n  return result && (result[1] === '' || result[3] === '')\n}\n\nexport type { AtomProps }\nexport default Atom\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\n\nimport { bond as bondSchema } from '../../../../../data/schema/struct-schema'\nimport Form, { Field } from '../../../../../component/form/form'\nimport { Dialog } from '../../../../components'\nimport { BaseProps, BaseCallProps } from '../../../modal.types'\n\nimport classes from './Bond.module.less'\n\ninterface BondProps extends BaseProps {\n  center: number\n  topology: number\n  type: string\n}\n\ntype Props = BondProps & BaseCallProps\n\nconst Bond = (props: Props) => {\n  const { formState, ...rest } = props\n  return (\n    <Dialog\n      title=\"Bond Properties\"\n      className={classes.bond}\n      result={() => formState.result}\n      valid={() => formState.valid}\n      params={rest}>\n      <Form schema={bondSchema} init={rest} {...formState}>\n        <Field name=\"type\" />\n        <Field name=\"topology\" />\n        <Field name=\"center\" />\n      </Form>\n    </Dialog>\n  )\n}\n\nexport type { BondProps }\nexport default Bond\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { ComponentType } from 'react'\nimport { connect } from 'react-redux'\n\nimport Bond, { BondProps } from './Bond'\nimport { BaseProps } from '../../../modal.types'\n\ntype StateProps = Pick<BaseProps, 'formState'>\ntype OwnProps = Omit<BondProps, 'formState'>\n\nconst mapStateToProps = (state): StateProps => ({ formState: state.modal.form })\n\nconst BondContainer: ComponentType<OwnProps> = connect(mapStateToProps)(Bond)\nexport default BondContainer\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\n\nimport { attachmentPoints as attachmentPointsSchema } from '../../../../../data/schema/struct-schema'\nimport Form, { Field } from '../../../../../component/form/form'\nimport { Dialog } from '../../../../components'\nimport { BaseProps, BaseCallProps } from '../../../modal.types'\n\nimport classes from './Attach.module.less'\n\ninterface AttachPointsProps extends BaseProps {\n  primary: boolean\n  secondary: boolean\n}\n\ntype Props = AttachPointsProps & BaseCallProps\n\nconst AttachPoints = (props: Props) => {\n  const { formState, ...rest } = props\n  return (\n    <Dialog\n      title=\"Attachment Points\"\n      className={classes.attachPoints}\n      result={() => formState.result}\n      valid={() => formState.valid}\n      params={rest}>\n      <Form schema={attachmentPointsSchema} init={rest} {...formState}>\n        <Field name=\"primary\" />\n        <Field name=\"secondary\" />\n      </Form>\n    </Dialog>\n  )\n}\n\nexport type { AttachPointsProps }\nexport default AttachPoints\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { ComponentType } from 'react'\nimport { connect } from 'react-redux'\n\nimport AttachPoints, { AttachPointsProps } from './Attach'\nimport { BaseProps } from '../../../modal.types'\n\ntype StateProps = Pick<BaseProps, 'formState'>\ntype OwnProps = Omit<AttachPointsProps, 'formState'>\n\nconst mapStateToProps = (state): StateProps => ({ formState: state.modal.form })\n\nconst AttachPointsContainer: ComponentType<OwnProps> = connect(mapStateToProps)(\n  AttachPoints\n)\nexport default AttachPointsContainer\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\n\nimport Form, { Field } from '../../../../../component/form/form'\nimport { Dialog } from '../../../../components'\nimport { BaseProps, BaseCallProps } from '../../../modal.types'\n\nimport classes from './Automap.module.less'\n\ntype Props = BaseProps & BaseCallProps\n\nexport const automapSchema = {\n  title: 'Reaction Auto-Mapping',\n  type: 'object',\n  required: ['mode'],\n  properties: {\n    mode: {\n      title: 'Mode',\n      enum: ['discard', 'keep', 'alter', 'clear'],\n      enumNames: ['Discard', 'Keep', 'Alter', 'Clear'],\n      default: 'discard'\n    }\n  }\n}\n\nconst Automap = (props: Props) => {\n  const { formState, ...rest } = props\n  return (\n    <Dialog\n      title=\"Reaction Auto-Mapping\"\n      className={classes.automap}\n      result={() => formState.result}\n      valid={() => formState.valid}\n      params={rest}>\n      <Form schema={automapSchema} {...formState}>\n        <Field name=\"mode\" />\n      </Form>\n    </Dialog>\n  )\n}\n\nexport default Automap\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { ComponentType } from 'react'\nimport { connect } from 'react-redux'\n\nimport Automap from './Automap'\nimport { automap } from '../../../../../state/server'\nimport { BaseProps, BaseCallProps } from '../../../modal.types'\n\ntype StateProps = Pick<BaseProps, 'formState'>\ntype DispatchProps = Pick<BaseCallProps, 'onOk'>\ntype OwnProps = Omit<BaseProps, 'formState'>\n\nconst mapStateToProps = (state): StateProps => ({ formState: state.modal.form })\n\nconst mapDispatchToProps = (dispatch, ownProps): DispatchProps => ({\n  onOk: result => {\n    dispatch(automap(result))\n    ownProps.onOk(result)\n  }\n})\n\nconst AutomapContainer: ComponentType<OwnProps> = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Automap)\nexport default AutomapContainer\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\n\nimport { useFormContext } from '../../../../../../../../../hooks'\nimport { Field } from '../../../../../../../component/form/form'\nimport { RgroupLogicProps } from '../../RgroupLogic'\n\nimport classes from './IfThenSelect.module.less'\n\ntype Props = Pick<RgroupLogicProps, 'label' | 'rgroupLabels'>\n\nconst IfThenSelect = (props: Props) => {\n  const PROP_NAME = 'ifthen'\n  const { rgroupLabels, label } = props\n  const { schema } = useFormContext() as any\n  const desc = {\n    title: schema.properties[PROP_NAME].title,\n    enum: [0],\n    enumNames: ['Always']\n  }\n\n  rgroupLabels.forEach(rgroupLabel => {\n    if (label !== rgroupLabel) {\n      desc.enum.push(rgroupLabel)\n      desc.enumNames.push(`IF R${label} THEN R${rgroupLabel}`)\n    }\n  })\n\n  return <Field schema={desc} className={classes.field} {...props} />\n}\n\nexport default IfThenSelect\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { ComponentType } from 'react'\nimport { connect } from 'react-redux'\n\nimport RgroupLogic, { RgroupLogicProps } from './RgroupLogic'\nimport { BaseProps } from '../../../modal.types'\n\ntype StateProps = Pick<BaseProps, 'formState'>\ntype OwnProps = Omit<RgroupLogicProps, 'formState'>\n\nconst mapStateToProps = (state): StateProps => ({ formState: state.modal.form })\n\nconst RgroupLogicContainer: ComponentType<OwnProps> = connect(mapStateToProps)(\n  RgroupLogic\n)\nexport default RgroupLogicContainer\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\n\nimport { rgroupLogic as rgroupSchema } from '../../../../../data/schema/struct-schema'\nimport Form, { Field } from '../../../../../component/form/form'\nimport { Dialog } from '../../../../components'\nimport IfThenSelect from './components'\nimport { BaseProps, BaseCallProps } from '../../../modal.types'\n\nimport classes from './RgroupLogic.module.less'\n\ninterface RgroupLogicProps extends BaseProps {\n  frags: Set<number>\n  ifthen: number\n  label: number\n  range: string\n  resth: boolean\n  rgroupLabels: Array<number>\n}\n\ntype Props = RgroupLogicProps & BaseCallProps\n\nconst RgroupLogic = (props: Props) => {\n  const { formState, label, rgroupLabels, ...rest } = props\n  return (\n    <Dialog\n      title=\"R-Group Logic\"\n      className={classes.rgroupLogic}\n      result={() => formState.result}\n      valid={() => formState.valid}\n      params={rest}>\n      <Form\n        schema={rgroupSchema}\n        customValid={{ range: r => rangeConv(r) }}\n        init={rest}\n        {...formState}>\n        <Field name=\"range\" />\n        <Field name=\"resth\" />\n        <IfThenSelect label={label} rgroupLabels={rgroupLabels} />\n      </Form>\n    </Dialog>\n  )\n}\n\nfunction rangeConv(range) {\n  // structConv\n  const res = range\n    .replace(/\\s*/g, '')\n    .replace(/,+/g, ',')\n    .replace(/^,/, '')\n    .replace(/,$/, '')\n\n  return res\n    .split(',')\n    .every(s => s.match(/^[>,<=]?[0-9]+$/g) || s.match(/^[0-9]+-[0-9]+$/g))\n}\n\nexport type { RgroupLogicProps }\nexport default RgroupLogic\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { ComponentType } from 'react'\nimport { connect } from 'react-redux'\n\nimport { exec } from '../../../../../component/cliparea'\nimport { load } from '../../../../../state'\nimport Open, { OpenProps } from './Open'\nimport { BaseCallProps } from '../../../modal.types'\n\ntype StateProps = OpenProps\ntype DispatchProps = Pick<BaseCallProps, 'onOk'>\n\nconst mapStateToProps = (state): StateProps => ({ server: state.server })\n\nconst mapDispatchToProps = (dispatch, ownProps): DispatchProps => ({\n  onOk: result => {\n    if (result.fragment) exec('copy')\n    dispatch(\n      load(result.structStr, {\n        badHeaderRecover: true,\n        fragment: result.fragment\n      })\n    )\n    ownProps.onOk(result)\n  }\n})\n\nconst OpenContainer: ComponentType = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Open)\nexport default OpenContainer\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React, { FC, useState } from 'react'\n\nimport { formatProperties } from 'ketcher-core'\nimport { Dialog } from '../../../../components'\nimport OpenButton from '../../../../../component/view/openbutton'\nimport ClipArea from '../../../../../component/cliparea'\nimport { BaseProps, BaseCallProps } from '../../../modal.types'\n\nimport classes from './Open.module.less'\n\ninterface OpenProps {\n  server: any\n}\n\ntype Props = OpenProps & Pick<BaseProps, 'className'> & BaseCallProps\n\nconst Open: FC<Props> = props => {\n  const [structStr, setStructStr] = useState<string>('')\n  const [fragment, setFragment] = useState<boolean>(false)\n  const { server, ...rest } = props\n\n  const result = () => {\n    return structStr ? { structStr, fragment } : null\n  }\n\n  const structAcceptMimes = () => {\n    return Object.keys(formatProperties)\n      .reduce(\n        (res, key) =>\n          res.concat(\n            formatProperties[key].mime,\n            ...formatProperties[key].extensions\n          ),\n        []\n      )\n      .join(',')\n  }\n\n  return (\n    <Dialog\n      title=\"Open Structure\"\n      className={classes.open}\n      result={result}\n      params={rest}\n      buttons={[\n        <OpenButton\n          key={structAcceptMimes().toString()}\n          server={server}\n          type={structAcceptMimes()}\n          onLoad={setStructStr}>\n          Open From File…\n        </OpenButton>,\n        'Cancel',\n        'OK'\n      ]}>\n      <textarea\n        value={structStr}\n        onChange={event => setStructStr(event.target.value)}\n      />\n      <label>\n        <input\n          type=\"checkbox\"\n          checked={fragment}\n          onChange={event => setFragment(event.target.checked)}\n        />\n        Load as a fragment and copy to the Clipboard\n      </label>\n      <ClipArea\n        focused={() => true}\n        onCopy={() => ({ 'text/plain': structStr })}\n      />\n    </Dialog>\n  )\n}\n\nexport type { OpenProps }\nexport default Open\n","import React from 'react'\n\nimport classes from './Save.module.less'\n\nconst SaveImageTab = ({ changeImageFormat }) => {\n  const formats = [\n    { extension: 'svg', text: 'SVG Document' },\n    { extension: 'png', text: 'PNG Image' }\n  ]\n\n  const renderOptions = formats => {\n    return formats.map(format => {\n      const { extension, text } = format\n      return (\n        <option key={extension} value={extension}>\n          {text}\n        </option>\n      )\n    })\n  }\n\n  const handleChange = ({ target }) => {\n    changeImageFormat(target.value)\n  }\n\n  return (\n    <div className={classes.saveImageContainer}>\n      <label>\n        Image Format: &nbsp;\n        <select onChange={handleChange}>{renderOptions(formats)}</select>\n      </label>\n    </div>\n  )\n}\n\nexport default SaveImageTab\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport * as structFormat from '../../../../../data/convert/structConverter'\n\nimport Form, { Field } from '../../../../../component/form/form'\nimport {\n  FormatterFactory,\n  formatProperties,\n  getPropertiesByFormat\n} from 'ketcher-core'\nimport React, { Component, createRef } from 'react'\n\nimport { Dialog } from '../../../../components'\nimport SaveButton from '../../../../../component/view/savebutton'\nimport SaveImageTab from './SaveImageTab'\nimport Tabs from '../../../../../component/view/Tabs'\nimport { check } from '../../../../../state/server'\nimport classes from './Save.module.less'\nimport { connect } from 'react-redux'\nimport { saveUserTmpl } from '../../../../../state/templates'\nimport { updateFormState } from '../../../../../state/modal/form'\n\nconst saveSchema = {\n  title: 'Save',\n  type: 'object',\n  properties: {\n    filename: {\n      title: 'Filename',\n      type: 'string',\n      maxLength: 128,\n      pattern: /^[^.<>:?\"*|/\\\\][^<>:?\"*|/\\\\]*$/,\n      invalidMessage: res => {\n        if (!res) return 'Filename should contain at least one character'\n        if (res.length > 128) return 'Filename is too long'\n        return \"A filename cannot contain characters: \\\\ / : * ? \\\" < > | and cannot start with '.'\"\n      }\n    },\n    format: {\n      title: 'Format',\n      enum: Object.keys(formatProperties),\n      enumNames: Object.keys(formatProperties).map(\n        format => formatProperties[format].name\n      )\n    }\n  }\n}\n\nclass SaveDialog extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      disableControls: false,\n      imageFormat: 'svg',\n      tabIndex: 0\n    }\n    this.isRxn = this.props.struct.hasRxnArrow()\n    this.textAreaRef = createRef()\n    const formats = [this.isRxn ? 'rxn' : 'mol', 'smiles', 'graph']\n    if (this.props.server)\n      formats.push(\n        this.isRxn ? 'rxnV3000' : 'molV3000',\n        'smilesExt',\n        'smarts',\n        'inChI',\n        'inChIAuxInfo',\n        'cml'\n      )\n\n    this.saveSchema = saveSchema\n    this.saveSchema.properties.format = Object.assign(\n      this.saveSchema.properties.format,\n      {\n        enum: formats,\n        enumNames: formats.map(format => getPropertiesByFormat(format).name)\n      }\n    )\n\n    this.changeType(this.isRxn ? 'rxn' : 'mol').then(res =>\n      res instanceof Error ? props.onCancel() : null\n    )\n  }\n\n  componentDidMount() {\n    const { checkOptions } = this.props.checkState\n    this.props.onCheck(checkOptions)\n  }\n\n  showStructWarningMessage = format => {\n    const { errors } = this.props.formState\n    return format !== 'mol' && Object.keys(errors).length > 0\n  }\n\n  changeType = type => {\n    this.setState({ disableControls: true })\n\n    const { struct, server, options, formState } = this.props\n\n    const factory = new FormatterFactory(server)\n\n    const service = factory.create(type, options)\n\n    return service\n      .getStructureFromStructAsync(struct)\n      .then(\n        structStr => {\n          this.setState({ structStr })\n          setTimeout(() => {\n            if (this.textAreaRef.current) {\n              this.textAreaRef.current.select()\n            }\n          }, 10) // TODO: remove hack\n        },\n        e => {\n          //TODO: add error handler call\n          alert(e.message)\n          this.props.onResetForm(formState)\n          return e\n        }\n      )\n      .finally(() => {\n        this.setState({ disableControls: false })\n      })\n  }\n\n  getWarnings = format => {\n    const { struct, moleculeErrors } = this.props\n    const warnings = []\n    const structWarning =\n      'Structure contains errors, please check the data, otherwise you ' +\n      'can lose some properties or the whole structure after saving in this format.'\n    const saveWarning = structFormat.couldBeSaved(struct, format)\n    const isStructInvalid = this.showStructWarningMessage(format)\n\n    if (isStructInvalid) {\n      warnings.push(structWarning)\n    }\n    if (saveWarning) {\n      warnings.push(saveWarning)\n    }\n\n    if (moleculeErrors) {\n      warnings.push(...Object.values(moleculeErrors))\n    }\n    return warnings\n  }\n\n  changeTab = tabIndex => {\n    this.setState({ tabIndex })\n  }\n\n  changeImageFormat = imageFormat => {\n    this.setState({ imageFormat })\n  }\n\n  renderSaveFile = () => {\n    const formState = Object.assign({}, this.props.formState)\n    delete formState.moleculeErrors\n    const { filename, format } = formState.result\n    const warnings = this.getWarnings(format)\n    const { structStr } = this.state\n    return (\n      <div className={classes.formContainer}>\n        <Form\n          schema={this.saveSchema}\n          init={{\n            filename,\n            format: this.isRxn ? 'rxn' : 'mol'\n          }}\n          {...formState}>\n          <Field name=\"filename\" />\n          <Field name=\"format\" onChange={this.changeType} />\n        </Form>\n        <textarea value={structStr} readOnly ref={this.textAreaRef} />\n        {warnings.length ? (\n          <div className={classes.warnings}>\n            {warnings.map(warning => (\n              <div className={classes.warningsContainer}>\n                <div className={classes.warning} />\n                <div className={classes.warningsArr}>{warning}</div>\n              </div>\n            ))}\n          </div>\n        ) : null}\n      </div>\n    )\n  }\n\n  getButtons = () => {\n    const { disableControls, imageFormat, structStr, tabIndex } = this.state\n    const formState = this.props.formState\n    const { filename, format } = formState.result\n    const isCleanStruct = this.props.struct.isBlank()\n    const buttons = [\n      [\n        <SaveButton\n          className=\"save-button\"\n          mode=\"saveFile\"\n          data={structStr}\n          filename={filename + getPropertiesByFormat(format).extensions[0]}\n          key=\"save-file-button\"\n          type={format.mime}\n          server={this.props.server}\n          onSave={this.props.onOk}\n          disabled={disableControls || !formState.valid || isCleanStruct}>\n          Save To File\n        </SaveButton>,\n        <button\n          className=\"save-button\"\n          key=\"save-tmpl\"\n          disabled={disableControls || isCleanStruct}\n          onClick={() => this.props.onTmplSave(this.props.struct)}>\n          Save to Templates...\n        </button>,\n        'Close'\n      ],\n      [\n        <SaveButton\n          className=\"save-button\"\n          mode=\"saveImage\"\n          data={structStr}\n          filename={filename}\n          outputFormat={imageFormat}\n          key=\"save-image-button\"\n          type=\"image/svg+xml\"\n          onSave={this.props.onOk}\n          disabled={\n            disableControls ||\n            !formState.valid ||\n            isCleanStruct ||\n            !this.props.server\n          }>\n          Save As Image\n        </SaveButton>,\n        'Close'\n      ]\n    ]\n    return buttons[tabIndex]\n  }\n\n  render() {\n    const tabs = [\n      {\n        caption: 'Structure',\n        component: this.renderSaveFile\n      },\n      {\n        caption: 'Image',\n        component: SaveImageTab,\n        props: {\n          changeImageFormat: this.changeImageFormat\n        }\n      }\n    ]\n\n    return (\n      <Dialog\n        title=\"Save Structure\"\n        className={classes.save}\n        params={this.props}\n        buttons={this.getButtons()}>\n        <Tabs\n          tabs={tabs}\n          changeTab={tab => {\n            this.changeTab(tab)\n          }}\n        />\n      </Dialog>\n    )\n  }\n}\n\nconst mapStateToProps = state => ({\n  server: state.options.app.server ? state.server : null,\n  struct: state.editor.struct(),\n  options: state.options.getServerSettings(),\n  formState: state.modal.form,\n  moleculeErrors: state.modal.form.moleculeErrors,\n  checkState: state.options.check\n})\n\nconst mapDispatchToProps = dispatch => ({\n  onCheck: checkOptions => dispatch(check(checkOptions)),\n  onTmplSave: struct => dispatch(saveUserTmpl(struct)),\n  onResetForm: prevState => dispatch(updateFormState(prevState))\n})\n\nconst Save = connect(mapStateToProps, mapDispatchToProps)(SaveDialog)\n\nexport default Save\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport {\n  StereoFlag,\n  Struct,\n  SupportedFormat,\n  getPropertiesByFormat,\n  RxnArrowMode\n} from 'ketcher-core'\n\nexport function couldBeSaved(\n  struct: Struct,\n  format: SupportedFormat\n): string | null {\n  let warnings: Array<string> = []\n  const formatName: string = getPropertiesByFormat(format).name\n\n  const rxnArrowsSize = struct.rxnArrows.size\n  const hasRxnArrow = struct.hasRxnArrow()\n\n  if (format !== 'graph') {\n    if (hasRxnArrow) {\n      const arrayOfArrows = Array.from(struct.rxnArrows.values())\n      const rxnArrowMode: RxnArrowMode = arrayOfArrows[0].mode\n       if (rxnArrowMode !== RxnArrowMode.simple) {\n        warnings.push(\n          `The ${formatName} format does not support drawn elements: the reaction ${rxnArrowMode} arrow will be replaced with the reaction arrow`\n        )\n      }\n    }\n\n    // TODO: find better solution for case when Arrows > 1 \n    if (rxnArrowsSize > 1) {\n      warnings.push(\n        `The ${formatName} format does not support drawn elements: reaction arrows will be lost.`\n      )\n    }\n  }\n\n  if (\n    ([\n      'inChI',\n      'inChIAuxInfo',\n      'smiles',\n      'smilesExt'\n    ] as SupportedFormat[]).includes(format)\n  ) {\n    if (struct.rgroups.size !== 0)\n      warnings.push(\n        `In ${formatName} the structure will be saved without R-group fragments`\n      )\n\n    struct = struct.clone() // need this: .getScaffold()\n    // @ts-ignore\n    const isRg = struct.atoms.find((ind, atom) => atom.label === 'R#')\n    if (isRg !== null)\n      warnings.push(\n        `In ${formatName} the structure will be saved without R-group members`\n      )\n\n    const isSg = struct.sgroups.find(\n      // @ts-ignore\n      (ind, sg) =>\n        sg.type !== 'MUL' && !/^INDIGO_.+_DESC$/i.test(sg.data.fieldName)\n    )\n    if (isSg !== null)\n      warnings.push(\n        `In ${formatName} the structure will be saved without S-groups`\n      )\n  }\n\n  if (\n    ([\n      'smiles',\n      'smilesExt',\n      'smarts',\n      'inChI',\n      'inChIAuxInfo',\n      'cml'\n    ] as SupportedFormat[]).includes(format)\n  ) {\n    // @ts-ignore\n    const isVal = struct.atoms.find((ind, atom) => atom.explicitValence >= 0)\n    if (isVal !== null)\n      warnings.push(`In ${formatName} valence is not supported`)\n  }\n\n  if (\n    (['mol', 'rxn'] as SupportedFormat[]).includes(format) &&\n    Array.from(struct.frags.values()).some(fr => {\n      if (fr?.enhancedStereoFlag) {\n        return fr.enhancedStereoFlag !== StereoFlag.Abs\n      }\n      return false\n    })\n  ) {\n    warnings.push(\n      `Structure contains enhanced stereochemistry features. Information will be partly lost.`\n    )\n  }\n\n  if (warnings.length !== 0) return warnings.join('\\n')\n\n  return null\n}\n","import Form, { Field } from '../../component/form/form'\nimport { StereoLabel, Struct } from 'ketcher-core'\n\nimport { Dialog } from '../../views/components'\nimport React from 'react'\nimport { connect } from 'react-redux'\nimport { range } from 'lodash'\n\ninterface EnhancedStereoResult {\n  andNumber: number\n  orNumber: number\n  type: StereoLabel\n}\n\ninterface EnhancedStereoFormState {\n  result: EnhancedStereoResult\n  valid: boolean\n  errors: string[]\n}\n\ninterface EnhancedStereoProps {\n  className: string\n  init: EnhancedStereoResult & { init?: true }\n  formState: EnhancedStereoFormState\n  struct: Struct\n}\n\ninterface EnhancedStereoCallProps {\n  onCancel: () => void\n  onOk: (res: any) => void\n}\n\ntype Props = EnhancedStereoProps & EnhancedStereoCallProps\n\nconst EnhancedStereo: React.FC<Props> = props => {\n  const { struct, formState, init, ...rest } = props\n  const { result, valid } = formState\n\n  const stereoLabels: Array<string> = findStereLabels(\n    struct,\n    Array.from(struct.atoms.keys())\n  )\n\n  const maxAnd: number = maxOfAnds(stereoLabels)\n  const maxOr: number = maxOfOrs(stereoLabels)\n\n  const enhancedStereoSchema = {\n    title: 'Enhanced Stereo',\n    type: 'object',\n    properties: {\n      type: {\n        type: 'string'\n      },\n      andNumber: {\n        type: 'integer'\n      },\n      orNumber: {\n        type: 'integer'\n      }\n    }\n  }\n\n  return (\n    <Dialog\n      title=\"Enhanced Stereochemistry\"\n      className=\"enhanced-stereo\"\n      params={rest}\n      result={() => result}\n      valid={() => valid}\n      buttons={['Cancel', 'OK']}>\n      <Form schema={enhancedStereoSchema} init={init} {...formState}>\n        <fieldset>\n          <label className=\"stereo-label-item\">\n            <Field\n              name=\"type\"\n              labelPos={false}\n              type=\"radio\"\n              value={StereoLabel.Abs}\n              checked={result.type === StereoLabel.Abs}\n            />\n            ABS\n          </label>\n          {maxAnd !== 0 && (\n            <label className=\"stereo-label-item\">\n              <Field\n                name=\"type\"\n                labelPos={false}\n                type=\"radio\"\n                value={StereoLabel.And}\n                checked={result.type === StereoLabel.And}\n              />\n              Add to AND\n              <Field\n                name=\"andNumber\"\n                schema={range(1, maxAnd + 1)}\n                type=\"text\"\n                className=\"label-group-select\"\n              />\n              Group\n            </label>\n          )}\n          {maxOr !== 0 && (\n            <label className=\"stereo-label-item\">\n              <Field\n                name=\"type\"\n                labelPos={false}\n                type=\"radio\"\n                value={StereoLabel.Or}\n                checked={result.type === StereoLabel.Or}\n              />\n              Add to OR\n              <Field\n                name=\"orNumber\"\n                schema={range(1, maxOr + 1)}\n                type=\"text\"\n                className=\"label-group-select\"\n              />\n              Group\n            </label>\n          )}\n          <label className=\"stereo-label-item\">\n            <Field\n              name=\"type\"\n              labelPos={false}\n              type=\"radio\"\n              value={`&${maxAnd + 1}`}\n            />\n            Create new AND Group\n          </label>\n          <label className=\"stereo-label-item\">\n            <Field\n              name=\"type\"\n              labelPos={false}\n              type=\"radio\"\n              value={`or${maxOr + 1}`}\n            />\n            Create new OR Group\n          </label>\n        </fieldset>\n      </Form>\n    </Dialog>\n  )\n}\n\n// TODO: Move the function below to Struct class\nfunction findStereLabels(struct, aids): Array<string> {\n  const stereoIds = aids.filter(\n    aid => struct.atoms.get(aid).stereoLabel !== null\n  )\n  return stereoIds.map(aid => struct.atoms.get(aid).stereoLabel)\n}\n\nfunction maxOfAnds(stereLabels): number {\n  const numbers = stereLabels.map(label => {\n    return label.match(/&/) ? +label.match(/\\d+/)?.join() : 0\n  })\n  return Math.max(...numbers)\n}\n\nfunction maxOfOrs(stereLabels): number {\n  const numbers = stereLabels.map(label => {\n    return label.match(/or/) ? +label.match(/\\d+/)?.join() : 0\n  })\n  return Math.max(...numbers)\n}\n\nexport default connect(state => ({\n  formState: state.modal.form || { result: {}, valid: false },\n  struct: state.editor.struct()\n}))(EnhancedStereo)\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport Form, { Field } from '../../component/form/form'\n\nimport { Dialog } from '../../views/components'\nimport { Elements } from 'ketcher-core'\nimport React from 'react'\nimport { capitalize } from 'lodash/fp'\nimport { connect } from 'react-redux'\nimport { labelEdit as labelEditSchema } from '../../data/schema/struct-schema'\n\nfunction serialize(lc) {\n  const charge = Math.abs(lc.charge)\n  const radical = ['', ':', '.', '^^'][lc.radical] || ''\n  let sign = ''\n  if (charge) sign = lc.charge < 0 ? '-' : '+'\n  return (\n    (lc.isotope || '') + lc.label + radical + (charge > 1 ? charge : '') + sign\n  )\n}\n\nfunction deserialize(value) {\n  const match = value.match(/^(\\d+)?([a-z*]{1,3})(\\.|:|\\^\\^)?(\\d+[-+]|[-+])?$/i) // TODO: radical on last place\n  if (match) {\n    const label = match[2] === '*' ? 'A' : capitalize(match[2])\n    let charge = 0\n    let isotope = 0\n    let radical = 0\n\n    if (match[1]) isotope = parseInt(match[1])\n\n    if (match[3]) radical = { ':': 1, '.': 2, '^^': 3 }[match[3]]\n\n    if (match[4]) {\n      charge = parseInt(match[4])\n      if (isNaN(charge))\n        // eslint-disable-line\n        charge = 1\n      if (match[4].endsWith('-')) charge = -charge\n    }\n    // Not consistant\n    if (\n      label === 'A' ||\n      label === 'Q' ||\n      label === 'X' ||\n      label === 'M' ||\n      Elements.get(label)\n    )\n      return { label, charge, isotope, radical }\n  }\n  return null\n}\n\nfunction LabelEdit(props) {\n  const init = { label: props.letter || serialize(props) }\n  const { formState, ...prop } = props\n  const { result, valid } = formState\n  return (\n    <Dialog\n      title=\"Label Edit\"\n      className=\"labeledit\"\n      valid={() => valid}\n      result={() => deserialize(result.label)}\n      params={prop}>\n      <Form\n        schema={labelEditSchema}\n        customValid={{ label: l => deserialize(l) }}\n        init={init}\n        {...formState}>\n        <Field name=\"label\" maxLength=\"20\" size=\"10\" autoFocus />\n      </Form>\n    </Dialog>\n  )\n}\n\nexport default connect(store => ({ formState: store.modal.form }))(LabelEdit)\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport { range } from 'lodash/fp'\n\nconst PERIODIC_TABLE_COLUMNS = 19\n\nfunction Header() {\n  return (\n    <tbody>\n      <tr>\n        {range(0, PERIODIC_TABLE_COLUMNS).map(index => (\n          <th key={index}>{index || ''}</th>\n        ))}\n      </tr>\n    </tbody>\n  )\n}\n\nexport default Header\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport { ElementColor } from 'ketcher-core'\n\nfunction Atom({ el, shortcut, className, ...props }) {\n  return (\n    <button\n      title={shortcut ? `${el.title} (${shortcut})` : el.title}\n      className={className}\n      style={{ color: ElementColor[el.label] }}\n      value={el.number}\n      {...props}>\n      <span>{el.label}</span>\n    </button>\n  )\n}\n\nexport default Atom\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport Atom from '../../../../../../../component/view/Atom'\nimport clsx from 'clsx'\n\nfunction MainRow({\n  row,\n  caption,\n  refer,\n  onSelect,\n  currentEvents,\n  atomClassNames,\n  className\n}) {\n  return (\n    <tbody>\n      <tr>\n        <th>{caption}</th>\n        {row.map((element, index) =>\n          typeof element !== 'number' ? ( // eslint-disable-line\n            <td key={index}>\n              <Atom\n                el={element}\n                className={clsx(...atomClassNames(element))}\n                onClick={() => onSelect(element.label)}\n                {...currentEvents(element)}\n              />\n            </td>\n          ) : refer(element) ? (\n            <td key={index} className={className}>\n              {refer(element)}\n            </td>\n          ) : (\n            <td key={index} colSpan={element} />\n          )\n        )}\n      </tr>\n    </tbody>\n  )\n}\n\nexport default MainRow\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport Atom from '../../../../../../../component/view/Atom'\nimport clsx from 'clsx'\n\nfunction OutinerRow({\n  row,\n  caption,\n  onSelect,\n  currentEvents,\n  atomClassNames,\n  className\n}) {\n  return (\n    <tbody>\n      <tr>\n        <th colSpan=\"3\" className={className}>\n          {caption}\n        </th>\n        {row.map(element => (\n          <td key={element.label}>\n            <Atom\n              el={element}\n              className={clsx(...atomClassNames(element))}\n              onClick={() => onSelect(element.label)}\n              {...currentEvents(element)}\n            />\n          </td>\n        ))}\n        <td />\n      </tr>\n    </tbody>\n  )\n}\n\nexport default OutinerRow\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { Component } from 'react'\nimport { Elements } from 'ketcher-core'\nimport { Header, MainRow, OutinerRow } from './components'\n\nimport styles from './ElementsTable.module.less'\n\nconst metalPrefix = [\n  'alkali',\n  'alkaline-earth',\n  'transition',\n  'post-transition'\n] // 'lanthanide', 'actinide'\nconst atomClassNames = {\n  metal: 'metal',\n  unknownProps: 'unknown-props',\n  unknownState: 'unknown-state',\n  button: 'button',\n  selected: 'selected'\n}\nconst beforeSpan = {\n  He: 16,\n  B: 10,\n  Al: 10,\n  Hf: 1,\n  Rf: 1\n}\nconst ACTINIDE = 'actinide'\nconst LANTHANIDE = 'lanthanide'\nconst main = rowPartition(\n  Elements.filter(\n    item => item && item.type !== ACTINIDE && item.type !== LANTHANIDE\n  )\n)\nconst lanthanides = Elements.filter(item => item && item.type === LANTHANIDE)\nconst actinides = Elements.filter(item => item && item.type === ACTINIDE)\n\nfunction rowPartition(elements) {\n  return elements.reduce((result, item) => {\n    const row = result[item.period - 1]\n    if (!row) {\n      result.push([item])\n    } else {\n      if (beforeSpan[item.label]) row.push(beforeSpan[item.label])\n      row.push(item)\n    }\n    return result\n  }, [])\n}\n\nclass ElementsTable extends Component {\n  // eslint-disable-line\n  shouldComponentUpdate(nextProps) {\n    return nextProps.value !== this.props.value\n  }\n\n  getAtomClassNames = item => {\n    const { selected } = this.props\n\n    const type = metalPrefix.includes(item.type)\n      ? `${item.type} ${atomClassNames.metal}`\n      : item.type || atomClassNames.unknownProps\n\n    const classes = [\n      ...type.split(' '),\n      item.state || atomClassNames.unknownState,\n      item.origin,\n      atomClassNames.button,\n      selected(item.label) && atomClassNames.selected\n    ]\n\n    return classes.map(className => {\n      return styles[className]\n    })\n  }\n\n  render() {\n    const { currentEvents, onSelect } = this.props\n    const callbacks = { currentEvents, onSelect }\n    return (\n      <table\n        className={styles.table}\n        summary=\"Periodic table of the chemical elements\">\n        <Header />\n        {main.map((row, index) => (\n          <MainRow\n            atomClassNames={this.getAtomClassNames}\n            className={styles.main_row}\n            key={index}\n            row={row}\n            caption={index + 1}\n            refer={element => element === 1 && (index === 5 ? '*' : '**')}\n            {...callbacks}\n          />\n        ))}\n        <OutinerRow\n          atomClassNames={this.getAtomClassNames}\n          className={styles.outiner_row}\n          row={lanthanides}\n          caption=\"*\"\n          {...callbacks}\n        />\n        <OutinerRow\n          atomClassNames={this.getAtomClassNames}\n          className={styles.outiner_row}\n          row={actinides}\n          caption=\"**\"\n          {...callbacks}\n        />\n      </table>\n    )\n  }\n}\n\nexport default ElementsTable\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport { ElementColor } from 'ketcher-core'\nimport clsx from 'clsx'\n\nimport classes from './AtomInfo.module.less'\n\nfunction AtomInfo({ el, isInfo }) {\n  const numberStyle = {\n    color: ElementColor[el.label] || 'black',\n    fontSize: '1.2em'\n  }\n  const elemStyle = {\n    color: ElementColor[el.label] || 'black',\n    fontWeight: 'bold',\n    fontSize: '2em'\n  }\n  return (\n    <div className={clsx(classes.ket_atom_info, !isInfo && classes.none)}>\n      <div style={numberStyle}>{el.number}</div>\n      <span style={elemStyle}>{el.label}</span>\n      <br />\n      {el.title}\n      <br />\n      {el.mass}\n    </div>\n  )\n}\n\nexport default AtomInfo\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\n\nimport classes from './TypeChoice.module.less'\n\nconst typeSchema = [\n  { title: 'Single', value: 'atom' },\n  { title: 'List', value: 'list' },\n  { title: 'Not List', value: 'not-list' }\n]\n\nfunction TypeChoice({ value, onChange, ...props }) {\n  return (\n    <fieldset className={classes.fieldset}>\n      {typeSchema.map(type => (\n        <label key={type.title}>\n          <input\n            type=\"radio\"\n            value={type.value}\n            checked={type.value === value}\n            onChange={() => onChange(type.value)}\n            {...props}\n          />\n          {type.title}\n        </label>\n      ))}\n    </fieldset>\n  )\n}\n\nexport default TypeChoice\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport clsx from 'clsx'\n\nimport classes from './GenSet.module.less'\n\nfunction GenSet({ labels, caption = '', selected, onSelect, ...props }) {\n  return (\n    <fieldset {...props}>\n      {labels.map((label, index) => (\n        <button\n          key={index}\n          onClick={() => onSelect(label)}\n          className={clsx(\n            {\n              [classes.selected]: selected(label)\n            },\n            classes.button\n          )}>\n          {label}\n        </button>\n      ))}\n      {caption ? <legend>{caption}</legend> : null}\n    </fieldset>\n  )\n}\n\nexport default GenSet\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport GenSet from './components'\nimport clsx from 'clsx'\n\nimport classes from './GenGroup.module.less'\n\nconst viewSchema = {\n  atom: {\n    caption: 'Atom Generics',\n    order: ['any', 'no-carbon', 'metal', 'halogen']\n  },\n  group: {\n    caption: 'Group Generics',\n    order: ['acyclic', 'cyclic']\n  },\n  special: {\n    caption: 'Special Nodes',\n    order: []\n  },\n  'group/acyclic': {\n    caption: 'Acyclic',\n    order: ['carbo', 'hetero']\n  },\n  'group/cyclic': {\n    caption: 'Cyclic',\n    order: ['no-carbon', 'carbo', 'hetero']\n  },\n  'group/acyclic/carbo': {\n    caption: 'Carbo',\n    order: ['alkynyl', 'alkyl', 'alkenyl']\n  },\n  'group/acyclic/hetero': {\n    caption: 'Hetero',\n    order: ['alkoxy']\n  },\n  'group/cyclic/carbo': {\n    caption: 'Carbo',\n    order: ['aryl', 'cycloalkyl', 'cycloalkenyl']\n  },\n  'group/cyclic/hetero': {\n    caption: 'Hetero',\n    order: ['aryl']\n  },\n  'atom/any': 'any atom',\n  'atom/no-carbon': 'except C or H',\n  'atom/metal': 'any metal',\n  'atom/halogen': 'any halogen',\n  'group/cyclic/no-carbon': 'no carbon',\n  'group/cyclic/hetero/aryl': 'hetero aryl'\n}\n\nfunction GenGroup({ gen, name, path, selected, onSelect }) {\n  const group = gen[name]\n  const pk = path ? `${path}/${name}` : name\n  const schema = viewSchema[pk]\n\n  return schema && schema.caption ? (\n    <fieldset className={clsx(classes[name], classes.fieldset)}>\n      <legend>{schema.caption}</legend>\n      {group.labels ? (\n        <GenSet\n          labels={group.labels}\n          selected={selected}\n          onSelect={onSelect}\n          className={classes.subgroup}\n        />\n      ) : null}\n      {schema.order.map((\n        child, // TODO:order = Object.keys ifndef\n        index\n      ) => (\n        <GenGroup\n          key={index}\n          gen={group}\n          name={child}\n          path={pk}\n          selected={selected}\n          onSelect={onSelect}\n        />\n      ))}\n    </fieldset>\n  ) : (\n    <GenSet\n      labels={group.labels}\n      caption={schema || name}\n      className={classes[name]}\n      selected={selected}\n      onSelect={onSelect}\n    />\n  )\n}\n\nexport default GenGroup\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport { Generics } from 'ketcher-core'\nimport GenGroup from './components'\n\nimport classes from './GenericGroups.module.less'\n\nfunction GenericGroups({ selected, onSelect, className, ...props }) {\n  return (\n    <div summary=\"Generic Groups\" className={classes[className]} {...props}>\n      <div className={classes.col}>\n        <GenGroup\n          gen={Generics}\n          name=\"atom\"\n          selected={selected}\n          onSelect={onSelect}\n        />\n        <GenGroup\n          gen={Generics}\n          name=\"special\"\n          selected={selected}\n          onSelect={onSelect}\n        />\n      </div>\n      <div className={classes.col}>\n        <GenGroup\n          gen={Generics}\n          name=\"group\"\n          selected={selected}\n          onSelect={onSelect}\n        />\n      </div>\n    </div>\n  )\n}\n\nexport default GenericGroups\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { xor } from 'lodash/fp'\n\nimport React, { Component } from 'react'\nimport { connect } from 'react-redux'\n\nimport { Elements } from 'ketcher-core'\n\nimport { Dialog } from '../../../components'\nimport Tabs from '../../../../component/view/Tabs'\n\nimport { fromElement, toElement } from '../../../../data/convert/structconv'\nimport { onAction } from '../../../../state'\nimport { addAtoms } from '../../../../state/toolbar'\n\nimport {\n  ElementsTable,\n  AtomInfo,\n  TypeChoice,\n  GenericGroups\n} from './components'\n\nimport classes from './PeriodTable.module.less'\n\nclass Table extends Component {\n  constructor(props) {\n    super(props)\n    const genType = !this.props.pseudo ? null : 'gen'\n    this.state = {\n      type: props.type || genType || 'atom',\n      value: props.values || props.label || null,\n      current: Elements.get(2),\n      isInfo: false\n    }\n    this.firstType = true\n  }\n\n  changeType = type => {\n    if (this.firstType) {\n      this.firstType = false\n      return\n    }\n    const prevChoice =\n      this.state.type === 'list' || this.state.type === 'not-list'\n    const currentChoice = type === 'list' || type === 'not-list'\n    if (prevChoice && currentChoice) {\n      this.setState({ type })\n    } else {\n      this.setState({\n        type,\n        value: type === 'atom' || type === 'gen' ? null : []\n      })\n    }\n  }\n\n  changeTabType = event => {\n    const type = event === 0 ? 'atom' : 'gen'\n    this.changeType(type)\n  }\n\n  selected = label => {\n    const { type, value } = this.state\n    return type === 'atom' || type === 'gen'\n      ? value === label\n      : value.includes(label)\n  }\n\n  onSelect = label => {\n    const { type, value } = this.state\n    this.setState({\n      value: type === 'atom' || type === 'gen' ? label : xor([label], value)\n    })\n  }\n\n  result = () => {\n    const { type, value } = this.state\n    if (!value || !value.length) {\n      return null\n    }\n    if (type === 'atom') {\n      return { label: value, pseudo: null }\n    } else if (type === 'gen') {\n      return { type, label: value, pseudo: value }\n    }\n    return { type, values: value }\n  }\n\n  currentEvents = element => {\n    return {\n      onMouseEnter: () => this.setState({ current: element, isInfo: true }),\n      onMouseLeave: () => this.setState({ isInfo: false })\n    }\n  }\n\n  periodicTable = value => {\n    const { type, current, isInfo } = this.state\n    return (\n      <div className={classes.period_table}>\n        <AtomInfo el={current} isInfo={isInfo} />\n        <ElementsTable\n          value={value}\n          currentEvents={this.currentEvents}\n          selected={this.selected}\n          onSelect={this.onSelect}\n        />\n        <TypeChoice value={type} onChange={this.changeType} />\n      </div>\n    )\n  }\n\n  render() {\n    const { type, value } = this.state\n    const tabs = [\n      {\n        caption: 'Table',\n        component: this.periodicTable,\n        props: { value }\n      },\n      {\n        caption: 'Extended',\n        component: GenericGroups,\n        props: {\n          className: 'generic-groups',\n          selected: this.selected,\n          onSelect: this.onSelect\n        }\n      }\n    ]\n\n    return (\n      <Dialog\n        title=\"Periodic table\"\n        className={classes.elements_table}\n        params={this.props}\n        result={this.result}>\n        <Tabs\n          className={classes.tabs}\n          contentClassName={classes.tabs_content}\n          captions={tabs}\n          tabIndex={type !== 'gen' ? 0 : 1}\n          changeTab={this.changeTabType}\n          tabs={tabs}\n        />\n      </Dialog>\n    )\n  }\n}\n\nfunction mapSelectionToProps(editor) {\n  const selection = editor.selection()\n\n  if (\n    selection &&\n    Object.keys(selection).length === 1 &&\n    selection.atoms &&\n    Object.keys(selection.atoms).length === 1\n  ) {\n    const struct = editor.struct()\n    const atom = struct.atoms.get(selection.atoms[0])\n    return { ...fromElement(atom) }\n  }\n\n  return {}\n}\n\nconst mapStateToProps = (state, ownProps) => {\n  if (ownProps.values || ownProps.label) {\n    return {}\n  }\n  return mapSelectionToProps(state.editor)\n}\n\nconst mapDispatchToProps = (dispatch, ownProps) => {\n  return {\n    onOk: result => {\n      if (!result.type || result.type === 'atom') {\n        dispatch(addAtoms(result.label))\n      }\n      dispatch(onAction({ tool: 'atom', opts: toElement(result) }))\n      ownProps.onOk(result)\n    }\n  }\n}\n\nconst PeriodTable = connect(mapStateToProps, mapDispatchToProps)(Table)\n\nexport default PeriodTable\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\nimport { xor } from 'lodash/fp'\n\nfunction oneOrMore(multipl, values, item) {\n  if (multipl) return xor(values, [item])\n  return xor(values, values.concat([item]))\n}\n\nfunction ButtonList({ value, onChange, schema, disabledIds, multiple }) {\n  let className\n  return (\n    <ul>\n      {schema.items.enum.map((item, i) => {\n        className = value.includes(item) ? 'selected' : ''\n        return (\n          <li key={item}>\n            <button\n              disabled={disabledIds.includes(item)}\n              type=\"button\"\n              className={className}\n              onClick={() => onChange(oneOrMore(multiple, value, item))}>\n              {schema.items.enumNames[i]}\n            </button>\n          </li>\n        )\n      })}\n    </ul>\n  )\n}\n\nexport default ButtonList\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport Form, { Field } from '../../component/form/form'\n\nimport ButtonList from '../../component/form/buttonlist'\nimport { Dialog } from '../../views/components'\nimport React from 'react'\nimport { connect } from 'react-redux'\nimport { rgroupSchema } from '../../data/schema/struct-schema'\n\nfunction RGroup({ disabledIds, values, formState, type, ...props }) {\n  return (\n    <Dialog\n      title=\"R-Group\"\n      className=\"rgroup\"\n      params={props}\n      result={() => formState.result}>\n      <Form schema={rgroupSchema} init={{ values }} {...formState}>\n        <Field\n          name=\"values\"\n          multiple={type === 'atom'}\n          labelPos={false}\n          component={ButtonList}\n          disabledIds={disabledIds}\n        />\n      </Form>\n    </Dialog>\n  )\n}\n\nexport default connect(store => ({ formState: store.modal.form }))(RGroup)\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { Component } from 'react'\n\nclass ComboBox extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      suggestsHidden: true\n    }\n\n    this.click = this.click.bind(this)\n    this.blur = this.blur.bind(this)\n    this.updateInput = this.updateInput.bind(this)\n  }\n\n  updateInput(event) {\n    const value = event.target.value || event.target.textContent\n    this.setState({ suggestsHidden: true })\n    this.props.onChange(value)\n  }\n\n  click() {\n    this.setState({ suggestsHidden: false })\n  }\n\n  blur() {\n    this.setState({ suggestsHidden: true })\n  }\n\n  render() {\n    const { value, type = 'text', schema } = this.props\n    const suggestList = schema.enumNames\n      .filter(item => item !== value)\n      .map(item => (\n        <li key={item} onMouseDown={this.updateInput}>\n          {item}\n        </li>\n      ))\n    const suggestListStyles = {\n      display: this.state.suggestsHidden ? 'none' : 'block'\n    }\n    return (\n      <div>\n        <input\n          type={type}\n          value={value}\n          onClick={this.click}\n          onBlur={this.blur}\n          onChange={this.updateInput}\n          autoComplete=\"off\"\n        />\n        {suggestList.length !== 0 ? (\n          <ul className=\"suggestList\" style={suggestListStyles}>\n            {suggestList}\n          </ul>\n        ) : (\n          ''\n        )}\n      </div>\n    )\n  }\n}\n\nexport default ComboBox\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport Form, { Field, SelectOneOf } from '../../component/form/form'\nimport {\n  getSdataDefault,\n  sdataCustomSchema,\n  sdataSchema\n} from '../../data/schema/sdata-schema'\n\nimport ComboBox from '../../component/form/combobox'\nimport { Dialog } from '../../views/components'\nimport React from 'react'\nimport { connect } from 'react-redux'\n\nfunction SelectInput({ title, name, schema, ...prop }) {\n  const inputSelect = Object.keys(schema).reduce(\n    (acc, item) => {\n      acc.enum.push(item)\n      acc.enumNames.push(schema[item].title || item)\n      return acc\n    },\n    {\n      title,\n      type: 'string',\n      default: '',\n      minLength: 1,\n      enum: [],\n      enumNames: []\n    }\n  )\n\n  return (\n    <Field name={name} schema={inputSelect} component={ComboBox} {...prop} />\n  )\n}\n\nfunction SData({\n  context,\n  fieldName,\n  fieldValue,\n  type,\n  radiobuttons,\n  formState,\n  ...prop\n}) {\n  const { result, valid } = formState\n\n  const init = {\n    context,\n    fieldName: fieldName || getSdataDefault(context),\n    type,\n    radiobuttons\n  }\n\n  init.fieldValue = fieldValue || getSdataDefault(context, init.fieldName)\n\n  const formSchema =\n    sdataSchema[result.context][result.fieldName] || sdataCustomSchema\n\n  const serialize = {\n    context: result.context.trim(),\n    fieldName: result.fieldName.trim(),\n    fieldValue:\n      typeof result.fieldValue === 'string'\n        ? result.fieldValue.trim()\n        : result.fieldValue\n  }\n\n  return (\n    <Dialog\n      title=\"S-Group Properties\"\n      className=\"sgroup\"\n      result={() => result}\n      valid={() => valid}\n      params={prop}>\n      <Form\n        serialize={serialize}\n        schema={formSchema}\n        init={init}\n        {...formState}>\n        <SelectOneOf title=\"Context\" name=\"context\" schema={sdataSchema} />\n        <fieldset className=\"data\">\n          <SelectInput\n            title=\"Field name\"\n            name=\"fieldName\"\n            schema={sdataSchema[result.context]}\n          />\n          {content(formSchema, result.context, result.fieldName)}\n        </fieldset>\n      </Form>\n    </Dialog>\n  )\n}\n\nconst content = (schema, context, fieldName) =>\n  Object.keys(schema.properties)\n    .filter(\n      prop => prop !== 'type' && prop !== 'context' && prop !== 'fieldName'\n    )\n    .map(prop =>\n      prop === 'radiobuttons' ? (\n        <Field\n          name={prop}\n          type=\"radio\"\n          key={`${context}-${fieldName}-${prop}-radio`}\n        />\n      ) : (\n        <Field\n          name={prop}\n          type=\"textarea\"\n          multiple\n          size=\"10\"\n          key={`${context}-${fieldName}-${prop}-select`}\n        />\n      )\n    )\n\nexport default connect(store => ({ formState: store.modal.form }))(SData)\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport Form, { Field, SelectOneOf } from '../../component/form/form'\n\nimport { Dialog } from '../../views/components'\nimport React from 'react'\nimport { connect } from 'react-redux'\nimport { sgroupMap as schemes } from '../../data/schema/struct-schema'\n\nfunction Sgroup({ formState, ...prop }) {\n  const { result, valid } = formState\n\n  const type = result.type\n\n  return (\n    <Dialog\n      title=\"S-Group Properties\"\n      className=\"sgroup\"\n      result={() => result}\n      valid={() => valid}\n      params={prop}>\n      <Form schema={schemes[type]} init={prop} {...formState}>\n        <SelectOneOf title=\"Type\" name=\"type\" schema={schemes} />\n        <fieldset className={type === 'DAT' ? 'data' : 'base'}>\n          {content(type)}\n        </fieldset>\n      </Form>\n    </Dialog>\n  )\n}\n\nconst content = type =>\n  Object.keys(schemes[type].properties)\n    .filter(prop => prop !== 'type')\n    .map(prop => {\n      const props = {}\n      if (prop === 'name') props.maxLength = 15\n      if (prop === 'fieldName') props.maxLength = 30\n      if (prop === 'fieldValue') props.type = 'textarea'\n      if (prop === 'radiobuttons') props.type = 'radio'\n\n      return <Field name={prop} key={`${type}-${prop}`} {...props} />\n    })\n\nexport default connect(store => ({ formState: store.modal.form }))(Sgroup)\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { Component } from 'react'\nimport { connect } from 'react-redux'\n\nimport Input from '../../component/form/input'\nimport { StructEditor, Dialog } from '../../views/components'\nimport { storage } from '../../storage-ext'\n\nimport { initAttach, setAttachPoints, setTmplName } from '../../state/templates'\n\nconst EDITOR_STYLES = {\n  selectionStyle: { fill: '#47b3ec', stroke: 'none' },\n  highlightStyle: { stroke: '#1a7090', 'stroke-width': 1.2 },\n  highlightStyleSimpleObject: { 'stroke-opacity': 0.3 }\n}\n\nclass Attach extends Component {\n  constructor({ onInit, ...props }) {\n    super()\n    this.tmpl = initTmpl(props.tmpl)\n    onInit(this.tmpl.struct.name, this.tmpl.props)\n    this.onResult = this.onResult.bind(this)\n  }\n\n  onResult() {\n    const { name, atomid, bondid } = this.props\n    return name &&\n      (name !== this.tmpl.struct.name ||\n        atomid !== this.tmpl.props.atomid ||\n        bondid !== this.tmpl.props.bondid)\n      ? { name, attach: { atomid, bondid } }\n      : null\n  }\n\n  render() {\n    const {\n      name,\n      atomid,\n      bondid,\n      onNameEdit,\n      onAttachEdit,\n      ...prop\n    } = this.props\n    const struct = this.tmpl.struct\n    const options = Object.assign(EDITOR_STYLES, { scale: getScale(struct) })\n\n    return (\n      <Dialog\n        title=\"Template Edit\"\n        className=\"attach\"\n        result={this.onResult}\n        params={prop}>\n        <label>\n          Template name:\n          <Input value={name} onChange={onNameEdit} placeholder=\"tmpl\" />\n        </label>\n        <label>Choose attachment atom and bond:</label>\n        <StructEditor\n          className=\"editor\"\n          struct={struct}\n          onAttachEdit={onAttachEdit}\n          tool=\"attach\"\n          toolOpts={{ atomid, bondid }}\n          options={options}\n        />\n        {!storage.isAvailable() ? (\n          <div className=\"warning\">{storage.warningMessage}</div>\n        ) : null}\n      </Dialog>\n    )\n  }\n}\n\nexport default connect(\n  store => ({ ...store.templates.attach }),\n  dispatch => ({\n    onInit: (name, ap) => dispatch(initAttach(name, ap)),\n    onAttachEdit: ap => dispatch(setAttachPoints(ap)),\n    onNameEdit: name => dispatch(setTmplName(name))\n  })\n)(Attach)\n\nfunction initTmpl(tmpl) {\n  const normTmpl = {\n    struct: structNormalization(tmpl.struct),\n    props: {\n      atomid: +tmpl.props.atomid || 0,\n      bondid: +tmpl.props.bondid || 0\n    }\n  }\n  normTmpl.struct.name = tmpl.struct.name\n  return normTmpl\n}\n\nfunction structNormalization(struct) {\n  const normStruct = struct.clone()\n  const cbb = normStruct.getCoordBoundingBox()\n\n  normStruct.atoms.forEach(atom => {\n    atom.pp = atom.pp.sub(cbb.min)\n  })\n\n  normStruct.sgroups.forEach(sg => {\n    sg.pp = sg.pp ? sg.pp.sub(cbb.min) : cbb.min\n  })\n\n  normStruct.rxnArrows.forEach(rxnArrow => {\n    rxnArrow.pp = rxnArrow.pp.sub(cbb.min)\n  })\n\n  normStruct.rxnPluses.forEach(rxnPlus => {\n    rxnPlus.pp = rxnPlus.pp.sub(cbb.min)\n  })\n\n  return normStruct\n}\n\nfunction getScale(struct) {\n  const cbb = struct.getCoordBoundingBox()\n  const VIEW_SIZE = 220\n  let scale = VIEW_SIZE / Math.max(cbb.max.y - cbb.min.y, cbb.max.x - cbb.min.x)\n\n  if (scale < 35) scale = 35\n  if (scale > 60) scale = 60\n  return scale\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { AutoSizer, List } from 'react-virtualized'\n\nimport React from 'react'\nimport { Struct } from 'ketcher-core'\nimport StructRender from '../../component/structrender'\n\ninterface TemplateTableProps {\n  templates: Array<Template>\n  selected: Template\n  onSelect: (tmpl: Template) => void\n  onDelete: (tmpl: Template) => void\n  onAttach: (tmpl: Template) => void\n}\n\nexport interface Template {\n  struct: Struct\n  props: {\n    atomid: number\n    bondid: number\n    group: string\n    prerender: string\n  }\n}\n\nconst GREEK_SIMBOLS = {\n  Alpha: 'A',\n  alpha: 'α',\n  Beta: 'B',\n  beta: 'β',\n  Gamma: 'Г',\n  gamma: 'γ'\n}\n\nconst greekRe = new RegExp(\n  '\\\\b' + Object.keys(GREEK_SIMBOLS).join('\\\\b|\\\\b') + '\\\\b',\n  'g'\n)\n\nexport function greekify(str: string): string {\n  return str.replace(greekRe, sym => GREEK_SIMBOLS[sym])\n}\n\nfunction tmplName(tmpl: Template, i: number): string {\n  console.assert(tmpl.props && tmpl.props.group, 'No group')\n  return tmpl.struct.name || `${tmpl.props.group} template ${i + 1}`\n}\n\nconst RenderTmpl: React.FC<{\n  tmpl: Template\n  className: string\n  onClick: () => void\n}> = ({ tmpl, ...props }) => {\n  return tmpl.props && tmpl.props.prerender ? (\n    <svg {...props}>\n      <use xlinkHref={tmpl.props.prerender} />\n    </svg>\n  ) : (\n    <StructRender\n      struct={tmpl.struct}\n      options={{ autoScaleMargin: 15 }}\n      {...props}\n    />\n  )\n}\n\nconst TemplateTable: React.FC<TemplateTableProps> = props => {\n  const { templates, selected, onSelect, onDelete, onAttach } = props\n  const ITEMS_COUNT = templates ? templates.length : 0\n  const ITEM_SIZE = { width: 178, height: 120 }\n  const tmplStyles = {\n    width: `${ITEM_SIZE.width}px`,\n    height: `${ITEM_SIZE.height}px`\n  }\n\n  return (\n    <div className=\"table\" style={{ minWidth: ITEM_SIZE.width }}>\n      <AutoSizer>\n        {({ height, width }) => {\n          const itemsPerRow = Math.floor(width / ITEM_SIZE.width)\n          const rowCount = Math.ceil(ITEMS_COUNT / itemsPerRow)\n\n          return (\n            <List\n              className=\"table-content\"\n              width={width}\n              height={height}\n              rowCount={rowCount}\n              rowHeight={ITEM_SIZE.height}\n              rowRenderer={({ index, key, style }) => {\n                const fromIndex = index * itemsPerRow\n                const toIndex = Math.min(fromIndex + itemsPerRow, ITEMS_COUNT)\n                const items = templates.slice(fromIndex, toIndex)\n\n                return (\n                  <div className=\"tr\" key={key} style={style}>\n                    {items.map((tmpl, i) => (\n                      <div\n                        className={tmpl === selected ? 'td selected' : 'td'}\n                        title={greekify(tmplName(tmpl, i))}\n                        key={i}\n                        style={tmplStyles}>\n                        <RenderTmpl\n                          tmpl={tmpl}\n                          className=\"struct\"\n                          onClick={() => onSelect(tmpl)}\n                        />\n                        <div className=\"btn-container\">\n                          {tmpl.props.group === 'User Templates' && (\n                            <button\n                              className=\"delete-button\"\n                              onClick={() => onDelete(tmpl)}>\n                              Delete\n                            </button>\n                          )}\n                          <button\n                            className=\"attach-button\"\n                            onClick={() => onAttach(tmpl)}>\n                            Edit\n                          </button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )\n              }}\n            />\n          )\n        }}\n      </AutoSizer>\n    </div>\n  )\n}\n\nexport default TemplateTable\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\n\nfunction SelectList({\n  schema,\n  value,\n  onSelect,\n  splitIndexes,\n  selected,\n  component,\n  ...props\n}) {\n  return (\n    <ul {...props}>\n      {schema.enum.map((opt, index) => (\n        <li\n          key={opt}\n          onClick={() => onSelect(opt, index)}\n          className={\n            (opt === value ? 'selected ' : '') +\n            (isSplitIndex(index, splitIndexes) ? 'split' : '')\n          }>\n          {schema.enumNames ? schema.enumNames[index] : opt}\n        </li>\n      ))}\n    </ul>\n  )\n}\n\nfunction isSplitIndex(index, splitIndexes) {\n  return index > 0 && splitIndexes && splitIndexes.includes(index)\n}\n\nexport default SelectList\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { RefCallback } from 'react'\nimport TemplateTable, { Template, greekify } from './TemplateTable'\nimport { filter as _filter, escapeRegExp, flow, omit, reduce } from 'lodash/fp'\nimport {\n  changeFilter,\n  changeGroup,\n  deleteTmpl,\n  editTmpl,\n  selectTmpl\n} from '../../state/templates'\n\nimport { Dialog } from '../../views/components'\nimport Input from '../../component/form/input'\nimport SaveButton from '../../component/view/savebutton'\nimport { SdfSerializer } from 'ketcher-core'\nimport SelectList from '../../component/form/select'\nimport { Struct } from 'ketcher-core'\nimport clsx from 'clsx'\nimport { connect } from 'react-redux'\nimport { createSelector } from 'reselect'\nimport { onAction } from '../../state'\nimport styles from './template-lib.module.less'\nimport { useResizeObserver } from '../../../../hooks'\n\ninterface TemplateLibProps {\n  filter: string\n  group: string\n  lib: Array<Template>\n  selected: Template\n}\n\ninterface TemplateLibCallProps {\n  onAttach: (tmpl: Template) => void\n  onCancel: () => void\n  onChangeGroup: (group: string) => void\n  onDelete: (tmpl: Template) => void\n  onFilter: (filter: string) => void\n  onOk: (res: any) => void\n  onSelect: (res: any) => void\n}\n\ntype Props = TemplateLibProps & TemplateLibCallProps\n\nexport interface Result {\n  struct: Struct\n  aid: number | null\n  bid: number | null\n}\n\nconst filterLibSelector = createSelector(\n  (props: Props) => props.lib,\n  (props: Props) => props.filter,\n  filterLib\n)\n\nfunction filterLib(lib, filter) {\n  console.warn('Filter', filter)\n  const re = new RegExp(escapeRegExp(greekify(filter)), 'i')\n  return flow(\n    _filter(\n      (item: any) =>\n        !filter ||\n        re.test(greekify(item.struct.name)) ||\n        re.test(greekify(item.props.group))\n    ),\n    reduce((res, item) => {\n      if (!res[item.props.group]) res[item.props.group] = [item]\n      else res[item.props.group].push(item)\n      return res\n    }, {})\n  )(lib)\n}\n\nconst TemplateLib: React.FC<Props> = props => {\n  const { filter, onFilter, onChangeGroup, ...rest } = props\n  const CONTAINER_MIN_WIDTH = 310\n  let group = props.group\n  const lib = filterLibSelector(props)\n  group = lib[group] ? group : Object.keys(lib)[0]\n  const {\n    ref,\n    width\n  }: {\n    ref: RefCallback<HTMLDivElement>\n    width: number | undefined\n  } = useResizeObserver<HTMLDivElement>()\n\n  const result = (): Result | null => {\n    const tmpl = props.selected\n    console.assert(!tmpl || tmpl.props, 'Incorrect SDF parse')\n    return tmpl\n      ? {\n          struct: tmpl.struct,\n          aid: parseInt(String(tmpl.props.atomid)) || null,\n          bid: parseInt(String(tmpl.props.bondid)) || null\n        }\n      : null\n  }\n\n  const sdfSerializer = new SdfSerializer()\n  const data = sdfSerializer.serialize(props.lib)\n\n  const select = (tmpl: Template): void => {\n    if (tmpl === props.selected) props.onOk(result())\n    else props.onSelect(tmpl)\n  }\n\n  return (\n    <Dialog\n      title=\"Template Library\"\n      className=\"template-lib\"\n      params={omit(['group'], rest)}\n      result={() => result()}\n      buttons={[\n        <SaveButton key=\"save-to-SDF\" data={data} filename=\"ketcher-tmpls.sdf\">\n          Save To SDF…\n        </SaveButton>,\n        'Cancel',\n        'OK'\n      ]}>\n      <div className={styles.dialog_body}>\n        <label>\n          Filter:\n          <Input\n            type=\"search\"\n            value={filter}\n            onChange={value => onFilter(value)}\n          />\n        </label>\n        <div\n          className={clsx('table-group-wrap', {\n            'single-col-layout': width && width < CONTAINER_MIN_WIDTH\n          })}\n          ref={ref}>\n          <Input\n            className=\"groups\"\n            component={SelectList}\n            splitIndexes={[Object.keys(lib).indexOf('User Templates')]}\n            value={group}\n            onChange={g => onChangeGroup(g)}\n            schema={{\n              enum: Object.keys(lib),\n              enumNames: Object.keys(lib).map(g => greekify(g))\n            }}\n          />\n          <TemplateTable\n            templates={lib[group]}\n            onSelect={select}\n            selected={props.selected}\n            onDelete={props.onDelete}\n            onAttach={props.onAttach}\n          />\n        </div>\n      </div>\n    </Dialog>\n  )\n}\n\nexport default connect(\n  store => ({ ...omit(['attach'], store.templates) }),\n  (dispatch, props) => ({\n    onFilter: filter => dispatch(changeFilter(filter)),\n    onSelect: tmpl => dispatch(selectTmpl(tmpl)),\n    onChangeGroup: group => dispatch(changeGroup(group)),\n    onAttach: tmpl => dispatch(editTmpl(tmpl)),\n    onDelete: tmpl => dispatch(deleteTmpl(tmpl)),\n    onOk: res => {\n      dispatch(onAction({ tool: 'template', opts: res }))\n      props.onOk(res)\n    }\n  })\n)(TemplateLib)\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport AboutIcon from './files/about.svg'\nimport AnalyseIcon from './files/analyse.svg'\nimport AromIcon from './files/arom.svg'\nimport BondAnyIcon from './files/bond-any.svg'\nimport BondAromaticIcon from './files/bond-aromatic.svg'\nimport BondCrossedIcon from './files/bond-crossed.svg'\nimport BondDative from './files/bond-dative.svg'\nimport BondDoubleAromaticIcon from './files/bond-doublearomatic.svg'\nimport BondDoubleIcon from './files/bond-double.svg'\nimport BondDownIcon from './files/bond-down.svg'\nimport BondHydrogenIcon from './files/bond-hydrogen.svg'\nimport BondSingleAromaticIcon from './files/bond-singlearomatic.svg'\nimport BondSingleDoubleIcon from './files/bond-singledouble.svg'\nimport BondSingleIcon from './files/bond-single.svg'\nimport BondTripleIcon from './files/bond-triple.svg'\nimport BondUpIcon from './files/bond-up.svg'\nimport BondUpdownIcon from './files/bond-updown.svg'\nimport ChainIcon from './files/chain.svg'\nimport ChargeMinusIcon from './files/charge-minus.svg'\nimport ChargePlusIcon from './files/charge-plus.svg'\nimport CheckIcon from './files/check.svg'\nimport ChiralFlagIcon from './files/chiral-flag.svg'\nimport CipIcon from './files/cip.svg'\nimport CleanIcon from './files/clean.svg'\nimport CopyIcon from './files/copy.svg'\nimport CutIcon from './files/cut.svg'\nimport DearomIcon from './files/dearom.svg'\nimport DropdownIcon from './files/dropdown.svg'\nimport EnhancedStereoIcon from './files/enhanced-stereo.svg'\nimport EraseIcon from './files/erase.svg'\nimport GenericGroupsIcon from './files/generic-groups.svg'\nimport HelpIcon from './files/help.svg'\nimport LayoutIcon from './files/layout.svg'\nimport LogoIcon from './files/logo.svg'\nimport MiewIcon from './files/miew.svg'\nimport NewIcon from './files/new.svg'\nimport OpenIcon from './files/open.svg'\nimport PasteIcon from './files/paste.svg'\nimport PeriodTableIcon from './files/period-table.svg'\nimport ReactionArrowEquilibriumIcon from './files/reaction-arrow-equilibrium.svg'\nimport ReactionArrowIcon from './files/reaction-arrow.svg'\nimport ReactionAutomapIcon from './files/reaction-automap.svg'\nimport ReactionMapIcon from './files/reaction-map.svg'\nimport ReactionPlusIcon from './files/reaction-plus.svg'\nimport ReactionUnmapIcon from './files/reaction-unmap.svg'\nimport RecognizeIcon from './files/recognize.svg'\nimport RedoIcon from './files/redo.svg'\nimport RgroupAttpointsIcon from './files/rgroup-attpoints.svg'\nimport RgroupFragmentIcon from './files/rgroup-fragment.svg'\nimport RgroupLabelIcon from './files/rgroup-label.svg'\nimport SaveIcon from './files/save.svg'\nimport SelectFragmentIcon from './files/select-fragment.svg'\nimport SelectLassoIcon from './files/select-lasso.svg'\nimport SelectRectangleIcon from './files/select-rectangle.svg'\nimport SettingsIcon from './files/settings.svg'\nimport SgroupDataIcon from './files/sgroup-data.svg'\nimport SgroupIcon from './files/sgroup.svg'\nimport ShapeEllipseIcon from './files/shape-ellipse.svg'\nimport ShapeLineIcon from './files/shape-line.svg'\nimport ShapePolylineIcon from './files/shape-polyline.svg'\nimport ShapeRectangleIcon from './files/shape-rectangle.svg'\nimport Template0Icon from './files/template-0.svg'\nimport Template1Icon from './files/template-1.svg'\nimport Template2Icon from './files/template-2.svg'\nimport Template3Icon from './files/template-3.svg'\nimport Template4Icon from './files/template-4.svg'\nimport Template5Icon from './files/template-5.svg'\nimport Template6Icon from './files/template-6.svg'\nimport Template7Icon from './files/template-7.svg'\nimport TemplateLibIcon from './files/template-lib.svg'\nimport TextBold from './files/text-bold.svg'\nimport TextIcon from './files/text.svg'\nimport TextItalic from './files/text-italic.svg'\nimport TextSubscript from './files/text-subscript.svg'\nimport TextSuperscript from './files/text-superscript.svg'\nimport TransformRotateIcon from './files/transform-rotate.svg'\nimport TransfromFlipHIcon from './files/transform-flip-h.svg'\nimport TransfromFlipVIcon from './files/transform-flip-v.svg'\nimport UndoIcon from './files/undo.svg'\nimport ZoomInIcon from './files/zoom-in.svg'\nimport ZoomOutIcon from './files/zoom-out.svg'\n\nconst icons = {\n  about: AboutIcon,\n  analyse: AnalyseIcon,\n  arom: AromIcon,\n  'bond-any': BondAnyIcon,\n  'bond-aromatic': BondAromaticIcon,\n  'bond-crossed': BondCrossedIcon,\n  'bond-hydrogen': BondHydrogenIcon,\n  'bond-dative': BondDative,\n  'bond-double': BondDoubleIcon,\n  'bond-doublearomatic': BondDoubleAromaticIcon,\n  'bond-down': BondDownIcon,\n  'bond-single': BondSingleIcon,\n  'bond-singlearomatic': BondSingleAromaticIcon,\n  'bond-singledouble': BondSingleDoubleIcon,\n  'bond-triple': BondTripleIcon,\n  'bond-up': BondUpIcon,\n  'bond-updown': BondUpdownIcon,\n  chain: ChainIcon,\n  'charge-minus': ChargeMinusIcon,\n  'charge-plus': ChargePlusIcon,\n  check: CheckIcon,\n  'chiral-flag': ChiralFlagIcon,\n  cip: CipIcon,\n  clean: CleanIcon,\n  copy: CopyIcon,\n  cut: CutIcon,\n  dearom: DearomIcon,\n  dropdown: DropdownIcon,\n  'enhanced-stereo': EnhancedStereoIcon,\n  erase: EraseIcon,\n  'generic-groups': GenericGroupsIcon,\n  help: HelpIcon,\n  layout: LayoutIcon,\n  logo: LogoIcon,\n  miew: MiewIcon,\n  new: NewIcon,\n  open: OpenIcon,\n  paste: PasteIcon,\n  'period-table': PeriodTableIcon,\n  'reaction-arrow': ReactionArrowIcon,\n  'reaction-arrow-equilibrium': ReactionArrowEquilibriumIcon,\n  'reaction-automap': ReactionAutomapIcon,\n  'reaction-map': ReactionMapIcon,\n  'reaction-plus': ReactionPlusIcon,\n  'reaction-unmap': ReactionUnmapIcon,\n  recognize: RecognizeIcon,\n  redo: RedoIcon,\n  'rgroup-attpoints': RgroupAttpointsIcon,\n  'rgroup-fragment': RgroupFragmentIcon,\n  'rgroup-label': RgroupLabelIcon,\n  save: SaveIcon,\n  'select-fragment': SelectFragmentIcon,\n  'select-lasso': SelectLassoIcon,\n  'select-rectangle': SelectRectangleIcon,\n  settings: SettingsIcon,\n  'sgroup-data': SgroupDataIcon,\n  sgroup: SgroupIcon,\n  'template-0': Template0Icon,\n  'template-1': Template1Icon,\n  'template-2': Template2Icon,\n  'template-3': Template3Icon,\n  'template-4': Template4Icon,\n  'template-5': Template5Icon,\n  'template-6': Template6Icon,\n  'template-7': Template7Icon,\n  'template-lib': TemplateLibIcon,\n  text: TextIcon,\n  'text-bold': TextBold,\n  'text-italic': TextItalic,\n  'text-subscript': TextSubscript,\n  'text-superscript': TextSuperscript,\n  'transform-flip-h': TransfromFlipHIcon,\n  'transform-flip-v': TransfromFlipVIcon,\n  'transform-rotate': TransformRotateIcon,\n  undo: UndoIcon,\n  'zoom-in': ZoomInIcon,\n  'zoom-out': ZoomOutIcon,\n  'shape-ellipse': ShapeEllipseIcon,\n  'shape-rectangle': ShapeRectangleIcon,\n  'shape-polyline': ShapePolylineIcon,\n  'shape-line': ShapeLineIcon\n}\n\nfunction emptyIcon() {\n  return null\n}\n\nexport default function findIconByName(name) {\n  if (name && icons.hasOwnProperty(name)) {\n    const component = icons[name]\n    return component\n  } else {\n    return emptyIcon\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React from 'react'\nimport findIconByName from './../../../../icons'\n\nfunction Icon({ name, ...props }) {\n  const Component = findIconByName(name)\n  return <Component {...props} />\n}\nexport default Icon\n","import Icon from '../../../../../component/view/icon'\nimport React from 'react'\nimport { TextCommand } from 'ketcher-core'\nimport clsx from 'clsx'\nimport styles from './TextButton.module.less'\n\ninterface TextButtonProps {\n  button: { command: TextCommand; name: string }\n  active: boolean\n}\n\ninterface TextButtonPropsCallProps {\n  toggleStyle: (command: TextCommand) => void\n}\n\ntype Props = TextButtonProps & TextButtonPropsCallProps\n\nexport const TextButton = (props: Props) => {\n  const toggleStyle = (\n    event: React.MouseEvent<HTMLButtonElement, MouseEvent>,\n    command: TextCommand\n  ) => {\n    event.preventDefault()\n    props.toggleStyle(command)\n  }\n\n  return (\n    <button\n      className={clsx(styles.textButton, { [styles.isActive]: props.active })}\n      title={props.button.command.toLowerCase()}\n      onMouseDown={event => {\n        toggleStyle(event, props.button.command)\n      }}>\n      <Icon name={props.button.name} />\n    </button>\n  )\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport 'draft-js/dist/Draft.css'\n\nimport {\n  DraftStyleMap,\n  Editor,\n  EditorState,\n  RawDraftContentState,\n  RichUtils,\n  convertFromRaw,\n  convertToRaw,\n  getDefaultKeyBinding\n} from 'draft-js'\nimport React, { useCallback, useState } from 'react'\n\nimport { Dialog } from '../../../components'\nimport { DialogParams } from '../../../components/Dialog/Dialog'\nimport { TextButton } from './TextButton'\nimport { TextCommand } from 'ketcher-core'\nimport { connect } from 'react-redux'\nimport styles from './Text.module.less'\n\ninterface TextProps extends DialogParams {\n  formState: any\n  id?: any\n  content: string\n  position?: string\n}\n\nconst buttons: Array<{ command: TextCommand; name: string }> = [\n  {\n    command: TextCommand.Bold,\n    name: 'text-bold'\n  },\n  {\n    command: TextCommand.Italic,\n    name: 'text-italic'\n  },\n  {\n    command: TextCommand.Subscript,\n    name: 'text-subscript'\n  },\n  {\n    command: TextCommand.Superscript,\n    name: 'text-superscript'\n  }\n]\n\nconst Text = (props: TextProps) => {\n  const { formState, position, id } = props\n  const rawContentState: RawDraftContentState | null = props.content\n    ? (JSON.parse(props.content) as RawDraftContentState)\n    : null\n  const [editorState, setEditorState] = useState<EditorState>(\n    EditorState.moveFocusToEnd(\n      EditorState.createWithContent(\n        convertFromRaw(rawContentState || { blocks: [], entityMap: {} })\n      )\n    )\n  )\n\n  const result = () => {\n    const content = editorState.getCurrentContent()\n    return {\n      content: content.hasText() ? JSON.stringify(convertToRaw(content)) : '',\n      position,\n      id\n    }\n  }\n\n  const keyBindingFn = (e: any): string | null => {\n    if (e.keyCode === 13) {\n      e.stopPropagation()\n    }\n\n    return getDefaultKeyBinding(e)\n  }\n\n  const onContentChange = (state: EditorState): void => {\n    setEditorState(state)\n  }\n\n  const currentStyle = editorState.getCurrentInlineStyle()\n\n  const toggleStyle = useCallback(\n    (command: TextCommand): void => {\n      let newEditorState: EditorState = editorState\n      switch (command) {\n        case TextCommand.Subscript: {\n          if (currentStyle.has(TextCommand.Superscript)) {\n            newEditorState = RichUtils.toggleInlineStyle(\n              newEditorState,\n              TextCommand.Superscript\n            )\n          }\n          break\n        }\n        case TextCommand.Superscript: {\n          if (currentStyle.has(TextCommand.Subscript)) {\n            newEditorState = RichUtils.toggleInlineStyle(\n              newEditorState,\n              TextCommand.Subscript\n            )\n          }\n          break\n        }\n      }\n      newEditorState = RichUtils.toggleInlineStyle(newEditorState, command)\n\n      setEditorState(newEditorState)\n    },\n    [currentStyle, editorState]\n  )\n\n  const customStyleMap: DraftStyleMap = {\n    SUBSCRIPT: { fontSize: '0.8em', verticalAlign: 'sub' },\n    SUPERSCRIPT: { fontSize: '0.8em', verticalAlign: 'super' }\n  }\n\n  return (\n    <Dialog\n      className=\"textEditor\"\n      title=\"Text editor\"\n      params={props}\n      result={result}\n      valid={() => formState.form.valid}>\n      <ul className={styles.controlPanel}>\n        {buttons.map(button => {\n          return (\n            <TextButton\n              button={button}\n              key={button.name}\n              active={currentStyle.has(button.command)}\n              toggleStyle={toggleStyle}\n            />\n          )\n        })}\n      </ul>\n      <div className={styles.textEditorInput}>\n        <Editor\n          keyBindingFn={keyBindingFn}\n          editorState={editorState}\n          onChange={onContentChange}\n          customStyleMap={customStyleMap}\n        />\n      </div>\n    </Dialog>\n  )\n}\n\nexport default connect(store => ({ formState: store.modal }))(Text)\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { About, Help, Settings } from '../views/modal/components/meta'\nimport {\n  Analyse,\n  Check,\n  Miew,\n  Recognize\n} from '../views/modal/components/process'\n// schemify dialogs\nimport {\n  Atom,\n  AttachPoints,\n  Automap,\n  Bond,\n  RgroupLogic\n} from '../views/modal/components/toolbox'\nimport { Open, Save } from '../views/modal/components/document'\n\nimport EnhancedStereo from './toolbox/enhancedStereo'\nimport LabelEdit from './toolbox/labeledit'\nimport PeriodTable from '../views/modal/components/PeriodTable'\nimport Rgroup from './toolbox/rgroup'\nimport Sdata from './toolbox/sdata'\nimport Sgroup from './toolbox/sgroup'\nimport TemplateAttach from './template/template-attach'\nimport TemplatesLib from './template/TemplateLib'\nimport Text from '../views/modal/components/Text'\n\nexport default {\n  open: Open,\n  analyse: Analyse,\n  recognize: Recognize,\n  'period-table': PeriodTable,\n  rgroup: Rgroup,\n  attach: TemplateAttach,\n  templates: TemplatesLib,\n  about: About,\n  help: Help,\n  miew: Miew,\n  atomProps: Atom,\n  attachmentPoints: AttachPoints,\n  automap: Automap,\n  bondProps: Bond,\n  check: Check,\n  enhancedStereo: EnhancedStereo,\n  labelEdit: LabelEdit,\n  rgroupLogic: RgroupLogic,\n  save: Save,\n  settings: Settings,\n  sgroup: Sgroup,\n  sdata: Sdata,\n  text: Text\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { useEffect, useState, useCallback } from 'react'\nimport Markdown from 'react-markdown'\nimport gfm from 'remark-gfm'\nimport { useSettingsContext } from '../../../../../../../hooks'\nimport { Dialog } from '../../../../components'\nimport classes from './Help.module.less'\n\nfunction Help(props) {\n  const [content, setContent] = useState(null)\n  const { staticResourcesUrl } = useSettingsContext()\n  useEffect(() => {\n    const init = async () => {\n      fetch(`${staticResourcesUrl}/docs/help.md`)\n        .then(response => response.text())\n        .then(text => setContent(text))\n    }\n    init()\n  }, [staticResourcesUrl])\n\n  const transfromImageUri = useCallback(\n    uri => `${staticResourcesUrl}/docs/${uri}`,\n    [staticResourcesUrl]\n  )\n\n  return (\n    content && (\n      <Dialog title=\"Help\" params={props} buttons={['Close']}>\n        {content && (\n          <div className={classes.dialog_body}>\n            <Markdown plugins={[gfm]} transformImageUri={transfromImageUri}>\n              {content}\n            </Markdown>\n          </div>\n        )}\n      </Dialog>\n    )\n  )\n}\n\nexport default Help\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nconst mediaSizes = {\n  smallWidth: 600,\n  smallHeight: 600\n}\n\nexport default mediaSizes\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { Modal, ModalProps } from './Modal'\n\nimport { BaseCallProps } from './modal.types'\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { omit } from 'lodash/fp'\n\ntype StateProps = Pick<ModalProps, 'modal'>\n\nconst mapStateToProps = (state): StateProps => ({\n  modal: state.modal\n})\n\nconst mapDispatchToProps = (dispatch: Dispatch): BaseCallProps => ({\n  onOk: _result => {\n    dispatch({ type: 'MODAL_CLOSE' })\n  },\n  onCancel: () => {\n    dispatch({ type: 'MODAL_CLOSE' })\n  }\n})\n\nconst mergeProps = (\n  stateProps: StateProps,\n  dispatchProps: BaseCallProps\n): ModalProps => {\n  const prop = stateProps.modal && stateProps.modal.prop\n  const initProps = prop ? omit(['onResult', 'onCancel'], prop) : {}\n  return {\n    modal: stateProps.modal,\n    ...initProps,\n    onOk: result => {\n      if (prop && prop.onResult) prop.onResult(result)\n      dispatchProps.onOk(result)\n    },\n    onCancel: () => {\n      if (prop && prop.onCancel) prop.onCancel()\n      dispatchProps.onCancel()\n    }\n  }\n}\n\nconst ModalContainer = connect(\n  mapStateToProps,\n  mapDispatchToProps,\n  mergeProps\n)(Modal)\n\nexport default ModalContainer\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { useRef } from 'react'\nimport useResizeObserver from 'use-resize-observer/polyfilled'\nimport clsx from 'clsx'\n\nimport modals from '../../dialog'\nimport mediaSizes from './mediaSizes'\nimport { BaseCallProps } from './modal.types'\n\nimport classes from './Modal.module.less'\n\ninterface ModalProps extends BaseCallProps {\n  modal: {\n    name: string\n    form: any\n    prop: any\n  }\n}\n\ntype Props = ModalProps & BaseCallProps\n\nfunction Modal(props: Props) {\n  const { modal, ...rest } = props\n  const containerRef = useRef<HTMLDivElement>(null)\n  const { height, width } = useResizeObserver<HTMLDivElement>({\n    ref: containerRef\n  })\n\n  if (!modal) return null\n\n  const Component = modals[modal.name]\n\n  if (!Component)\n    throw new Error(`There is no modal window named ${modal.name}`)\n\n  return (\n    <div className={classes.modalOverlay} ref={containerRef}>\n      <Component\n        className={clsx({\n          [classes.smallScreen]:\n            (height && height <= mediaSizes.smallHeight) ||\n            (width && width <= mediaSizes.smallWidth)\n        })}\n        {...rest}\n      />\n    </div>\n  )\n}\n\nexport type { ModalProps }\nexport { Modal }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nconst isMac = /Mac/.test(navigator.platform) // eslint-disable-line no-undef\nconst shortcutAliasMap = {\n  Escape: 'Esc',\n  Delete: 'Del',\n  Mod: isMac ? '⌘' : 'Ctrl'\n}\n\nexport function shortcutStr(shortcut?: string | string[]) {\n  if (!shortcut) {\n    return ''\n  }\n\n  const shortcutKey = Array.isArray(shortcut) ? shortcut[0] : shortcut\n  return shortcutKey.replace(\n    /(\\b[a-z]\\b$|Mod|Escape|Delete)/g,\n    key => shortcutAliasMap[key] || key.toUpperCase()\n  )\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\nimport clsx from 'clsx'\n\nimport { UiAction, UiActionAction } from '../../../../action'\nimport Icon from '../../../../component/view/icon'\nimport { shortcutStr } from '../../shortcutStr'\n\nimport classes from './ActionButton.module.less'\n\ninterface ActionButtonProps {\n  name: string\n  action?: UiAction\n  status?: {\n    disabled?: boolean\n    hidden?: boolean\n  }\n  selected?: boolean\n  disableableButtons: string[]\n  indigoVerification: boolean\n  className?: string\n}\n\ninterface ActionButtonCallProps {\n  onAction: (action: UiActionAction) => void\n}\n\ntype Props = ActionButtonProps & ActionButtonCallProps\n\nconst ActionButton = (props: Props) => {\n  const {\n    name,\n    action,\n    status = {},\n    selected = false,\n    disableableButtons,\n    indigoVerification,\n    className,\n    onAction\n  } = props\n\n  if (status.hidden) {\n    return null\n  }\n\n  const shortcut = shortcutStr(action?.shortcut)\n  const disabled =\n    status.disabled || (indigoVerification && disableableButtons.includes(name))\n\n  const handleClick = event => {\n    if (action?.action) {\n      onAction(action.action)\n    }\n    event.stopPropagation()\n  }\n\n  return (\n    <button\n      disabled={disabled}\n      onClick={handleClick}\n      title={shortcut ? `${action?.title} (${shortcut})` : action?.title}\n      className={clsx(\n        classes.button,\n        {\n          [classes.selected]: selected\n        },\n        className\n      )}>\n      <Icon name={name} />\n      <kbd>{shortcut}</kbd>\n    </button>\n  )\n}\n\nexport type { ActionButtonProps, ActionButtonCallProps }\nexport { ActionButton }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { Component, CSSProperties } from 'react'\nimport ReactDOM from 'react-dom'\n\nconst CLASSNAME_SEPARATOR = ' '\n\ninterface PortalProps {\n  isOpen: boolean\n  className?: string\n  style?: CSSProperties\n}\n\ntype Props = PortalProps\n\nclass Portal extends Component<Props> {\n  private readonly element: HTMLDivElement\n  private isElementInDom: boolean\n\n  constructor(props) {\n    super(props)\n    this.element = document.createElement('div')\n    this.isElementInDom = false\n  }\n\n  componentDidMount() {\n    if (!this.isElementInDom && this.props.isOpen) {\n      this.addElementInDOM()\n    }\n\n    const { className, style } = this.props\n    if (className) {\n      this.addClassName(className)\n    }\n    if (style) {\n      this.updateStyle(style)\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.isElementInDom) {\n      this.removeElementFromDOM()\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<Props>) {\n    const { isOpen, className, style } = this.props\n    if (className !== prevProps.className) {\n      this.removeClassNames(prevProps.className)\n      this.addClassName(className)\n    }\n\n    if (style !== prevProps.style) {\n      this.updateStyle(style, prevProps.style)\n    }\n\n    if (isOpen === prevProps.isOpen) {\n      return\n    }\n\n    if (isOpen && !this.isElementInDom) {\n      this.addElementInDOM()\n    } else if (this.isElementInDom) {\n      this.removeElementFromDOM()\n    }\n  }\n\n  private addElementInDOM() {\n    document.querySelector('body')?.appendChild(this.element)\n    this.isElementInDom = true\n  }\n\n  private removeElementFromDOM() {\n    document.querySelector('body')?.removeChild(this.element)\n    this.isElementInDom = false\n  }\n\n  private removeClassNames(classNames?: string) {\n    if (!classNames) {\n      return\n    }\n\n    classNames.split(CLASSNAME_SEPARATOR).forEach(className => {\n      this.element.classList.remove(className)\n    })\n  }\n\n  private addClassName(classNames?: string) {\n    if (!classNames) {\n      return\n    }\n\n    classNames.split(CLASSNAME_SEPARATOR).forEach(className => {\n      this.element.classList.add(className)\n    })\n  }\n\n  private updateStyle(style?: CSSProperties, prevStyle?: CSSProperties) {\n    if (prevStyle) {\n      Object.keys(prevStyle).forEach(property => {\n        this.element.style[property] = ''\n      }, this)\n    }\n\n    if (!style) {\n      return\n    }\n\n    Object.keys(style).forEach(property => {\n      this.element.style[property] = style[property]\n    }, this)\n  }\n\n  render() {\n    const { children } = this.props\n    return ReactDOM.createPortal(children, this.element)\n  }\n}\n\nexport { Portal }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\nimport action from '../../../../../../action'\nimport { ActionButton } from '../../../ActionButton'\nimport { MultiToolCallProps, MultiToolProps } from '../variants.types'\n\ninterface DefaultMultiToolProps extends MultiToolProps {}\ninterface DefaultMultiToolCallProps extends MultiToolCallProps {}\n\ntype Props = DefaultMultiToolProps & DefaultMultiToolCallProps\n\nconst DefaultMultiTool = (props: Props) => {\n  const {\n    options,\n    status,\n    disableableButtons,\n    indigoVerification,\n    onAction\n  } = props\n\n  return (\n    <>\n      {options.map(toolbarItem => {\n        const currentStatus = status[toolbarItem.id]\n        return (\n          <ActionButton\n            key={toolbarItem.id}\n            name={toolbarItem.id}\n            action={action[toolbarItem.id]}\n            // @ts-ignore\n            status={currentStatus}\n            selected={!!currentStatus?.selected}\n            disableableButtons={disableableButtons}\n            indigoVerification={indigoVerification}\n            onAction={onAction}\n          />\n        )\n      })}\n    </>\n  )\n}\n\nexport type { DefaultMultiToolProps, DefaultMultiToolCallProps }\nexport { DefaultMultiTool }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\nimport action from '../../../../../../action'\nimport { ActionButton } from '../../../ActionButton'\nimport { MultiToolCallProps, MultiToolProps } from '../variants.types'\n\nimport classes from './GroupedMultiTool.module.less'\n\ninterface GroupedMultiToolProps extends MultiToolProps {}\ninterface GroupedMultiToolCallProps extends MultiToolCallProps {}\n\ntype Props = GroupedMultiToolProps & GroupedMultiToolCallProps\n\nconst GroupedMultiTool = (props: Props) => {\n  const {\n    groups,\n    options,\n    status,\n    disableableButtons,\n    indigoVerification,\n    onAction\n  } = props\n\n  if (!groups) {\n    return null\n  }\n\n  return (\n    <>\n      {groups.map(descriptor => (\n        <div className={classes.group} key={descriptor.start}>\n          {options.slice(descriptor.start, descriptor.end).map(toolbarItem => {\n            const currentStatus = status[toolbarItem.id]\n            return (\n              <ActionButton\n                key={toolbarItem.id}\n                name={toolbarItem.id}\n                action={action[toolbarItem.id]}\n                // @ts-ignore\n                status={currentStatus}\n                selected={!!currentStatus?.selected}\n                disableableButtons={disableableButtons}\n                indigoVerification={indigoVerification}\n                onAction={onAction}\n              />\n            )\n          })}\n        </div>\n      ))}\n    </>\n  )\n}\n\nexport type { GroupedMultiToolProps, GroupedMultiToolCallProps }\nexport { GroupedMultiTool }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport clsx from 'clsx'\nimport React, { useRef } from 'react'\n\nimport action, { UiAction, UiActionAction } from '../../../../action'\nimport Icon from '../../../../component/view/icon'\nimport { Portal } from '../../../../Portal'\nimport { ToolbarItem, ToolbarItemVariant } from '../../toolbar.types'\nimport {\n  ActionButton,\n  ActionButtonCallProps,\n  ActionButtonProps\n} from '../ActionButton'\nimport { usePortalOpening } from './usePortalOpening'\nimport { usePortalStyle } from './usePortalStyle'\nimport { chooseMultiTool } from './variants/chooseMultiTool'\nimport { GroupDescriptor, MultiToolVariant } from './variants/variants.types'\n\nimport classes from './ToolbarMultiToolItem.module.less'\n\ninterface ToolbarMultiToolItemProps {\n  id: ToolbarItemVariant\n  options: ToolbarItem[]\n  groups?: GroupDescriptor[]\n  variant?: MultiToolVariant\n  status: {\n    [key in string]?: UiAction\n  }\n  opened: string | null\n  disableableButtons: string[]\n  indigoVerification: boolean\n  className?: string\n}\n\ninterface ToolbarMultiToolItemCallProps {\n  onAction: (action: UiActionAction) => void\n  onOpen: (menuName: string, isSelected: boolean) => void\n}\n\ntype Props = ToolbarMultiToolItemProps & ToolbarMultiToolItemCallProps\n\nconst ToolbarMultiToolItem = (props: Props) => {\n  const {\n    id,\n    options,\n    groups,\n    variant,\n    status,\n    opened,\n    indigoVerification,\n    disableableButtons,\n    className,\n    onAction,\n    onOpen\n  } = props\n\n  const ref = useRef<HTMLDivElement>(null)\n  const [isOpen] = usePortalOpening([id, opened, options])\n  const [portalStyle] = usePortalStyle([ref, isOpen])\n\n  let selected = false\n  let currentId = id\n\n  const selectedTool = options.find(\n    toolbarItem => status[toolbarItem.id]?.selected\n  )\n  if (selectedTool) {\n    currentId = selectedTool.id\n    selected = true\n  }\n\n  const currentStatus = status[currentId]\n  // todo: #type find out real type, possible GetActionState is no acceptable here\n  // and check this type convert is redundant\n  selected = selected || Boolean(currentStatus?.selected)\n\n  if (!currentStatus && options.length) {\n    currentId = options[0].id\n  }\n\n  const actionButtonProps: Omit<\n    ActionButtonProps & ActionButtonCallProps,\n    'name' | 'status' | 'action'\n  > = {\n    disableableButtons,\n    indigoVerification,\n    onAction\n  }\n\n  const onOpenOptions = () => {\n    // todo: same as #type above\n    onOpen(id, Boolean(currentStatus?.selected))\n  }\n\n  const [Component, portalClassName] = chooseMultiTool(variant)\n\n  return (\n    <div ref={ref} className={classes.root}>\n      <ActionButton\n        {...actionButtonProps}\n        className={className}\n        name={currentId}\n        action={action[currentId]}\n        // @ts-ignore\n        status={currentStatus}\n        selected={selected}\n      />\n      <Icon className={classes.icon} name=\"dropdown\" onClick={onOpenOptions} />\n\n      {isOpen ? (\n        <Portal\n          isOpen={isOpen}\n          className={clsx(classes.portal, portalClassName)}\n          style={portalStyle}>\n          <Component\n            options={options}\n            groups={groups}\n            status={status}\n            disableableButtons={disableableButtons}\n            indigoVerification={indigoVerification}\n            onAction={onAction}\n          />\n        </Portal>\n      ) : null}\n    </div>\n  )\n}\n\nexport type { ToolbarMultiToolItemProps, ToolbarMultiToolItemCallProps }\nexport { ToolbarMultiToolItem }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { useEffect, useState } from 'react'\nimport { ToolbarItem } from '../../toolbar.types'\n\ntype HookParams = [string, string | null, ToolbarItem[]]\n\nfunction usePortalOpening([id, opened, options]: HookParams): [boolean] {\n  const [isOpen, setIsOpen] = useState<boolean>(false)\n\n  useEffect(() => {\n    const currentId = (options.length && options![0].id) || ''\n    const newState = opened === id || opened === currentId\n    setIsOpen(newState)\n  }, [opened, options])\n\n  return [isOpen]\n}\n\nexport { usePortalOpening }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { CSSProperties, RefObject, useEffect, useState } from 'react'\n\ntype HookParams = [RefObject<HTMLDivElement>, boolean]\n\nfunction usePortalStyle([ref, isOpen]: HookParams): [CSSProperties] {\n  const [portalStyle, setPortalStyle] = useState<CSSProperties>({})\n\n  useEffect(() => {\n    if (!ref.current) {\n      return\n    }\n\n    const rect = ref.current.getBoundingClientRect()\n    // if content is bigger than page height and user scrolled document, we should correct portal position\n    const scrollOffset = document.scrollingElement?.scrollTop || 0\n    const top = rect.top + scrollOffset\n\n    const spaceBetween = 4\n    const left = rect.left + rect.width + spaceBetween\n\n    setPortalStyle({ top: `${top}px`, left: `${left}px` })\n  }, [ref, ref.current, isOpen])\n\n  return [portalStyle]\n}\n\nexport { usePortalStyle }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { ComponentType } from 'react'\nimport {\n  MultiToolCallProps,\n  MultiToolProps,\n  MultiToolVariant\n} from './variants.types'\n\nimport { DefaultMultiTool, classes as defaultClasses } from './DefaultMultiTool'\nimport { GroupedMultiTool } from './GroupedMultiTool'\n\nexport function chooseMultiTool(\n  variant: MultiToolVariant = 'default'\n): [ComponentType<MultiToolProps & MultiToolCallProps>, string?] {\n  switch (variant) {\n    case 'default':\n      return [DefaultMultiTool, defaultClasses.default]\n\n    case 'grouped':\n      return [GroupedMultiTool]\n\n    default:\n      throw new Error(`Unsupported variant ${variant}`)\n  }\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\nimport action, { UiAction, UiActionAction } from '../../../action'\nimport { ToolbarItem } from '../toolbar.types'\nimport { ActionButton } from './ActionButton'\nimport { ToolbarMultiToolItem } from './ToolbarMultiToolItem'\n\ninterface ToolbarGroupItemProps extends ToolbarItem {\n  status: {\n    [key in string]?: UiAction\n  }\n  opened: string | null\n  disableableButtons: string[]\n  indigoVerification: boolean\n  className?: string\n}\n\ninterface ToolbarGroupItemCallProps {\n  onAction: (action: UiActionAction) => void\n  onOpen: (menuName: string, isSelected: boolean) => void\n}\n\ntype Props = ToolbarGroupItemProps & ToolbarGroupItemCallProps\n\nconst ToolbarGroupItem = (props: Props) => {\n  const {\n    id,\n    options,\n    status,\n    className,\n    opened,\n    indigoVerification,\n    disableableButtons,\n    onAction,\n    onOpen\n  } = props\n\n  if (!options?.length) {\n    return (\n      <ActionButton\n        className={className}\n        name={id}\n        action={action[id]}\n        // @ts-ignore\n        status={status[id]}\n        selected={!!status[id]?.selected}\n        indigoVerification={indigoVerification}\n        disableableButtons={disableableButtons}\n        onAction={onAction}\n      />\n    )\n  }\n\n  return (\n    <ToolbarMultiToolItem\n      className={className}\n      id={id}\n      options={options}\n      status={status}\n      opened={opened}\n      disableableButtons={disableableButtons}\n      indigoVerification={indigoVerification}\n      onAction={onAction}\n      onOpen={onOpen}\n    />\n  )\n}\n\nexport type { ToolbarGroupItemProps, ToolbarGroupItemCallProps }\nexport { ToolbarGroupItem }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\n\nimport action, { UiAction, UiActionAction } from '../../../../action'\nimport templates from '../../../../data/templates'\nimport { ActionButton } from '../../ToolbarGroupItem/ActionButton'\n\ninterface TemplatesListProps {\n  active?: {\n    tool?: string\n    opts: {\n      struct: any\n    }\n  }\n  disableableButtons: string[]\n  indigoVerification: boolean\n}\n\ninterface TemplatesListCallProps {\n  onAction: (action: UiActionAction) => void\n}\n\ntype Props = TemplatesListProps & TemplatesListCallProps\n\nconst TemplatesList = (props: Props) => {\n  const { active, disableableButtons, indigoVerification, onAction } = props\n\n  const isTemplate = active && active.tool === 'template'\n\n  const makeAction = (struct, index): UiAction => ({\n    shortcut: action[`template-${index}`].shortcut,\n    action: { tool: 'template', opts: { struct } },\n    title: struct.name\n  })\n\n  return (\n    <>\n      {templates.map((struct, index) => (\n        <ActionButton\n          key={`template-${index}`}\n          name={`template-${index}`}\n          action={makeAction(struct, index)}\n          onAction={onAction}\n          selected={isTemplate && active && active.opts.struct === struct}\n          status={action[`template-${index}`]}\n          disableableButtons={disableableButtons}\n          indigoVerification={indigoVerification}\n        />\n      ))}\n    </>\n  )\n}\n\nexport type { TemplatesListProps, TemplatesListCallProps }\nexport { TemplatesList }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport clsx from 'clsx'\nimport React, { FC } from 'react'\n\nimport {\n  ToolbarGroupItem,\n  ToolbarGroupItemCallProps,\n  ToolbarGroupItemProps\n} from '../ToolbarGroupItem'\nimport classes from './BottomToolbar.module.less'\nimport { TemplatesList } from './TemplatesList'\n\nconst Group: FC<{ className?: string }> = ({ children, className }) => (\n  <div className={clsx(classes.group, className)}>{children}</div>\n)\n\ninterface BottomToolbarProps\n  extends Omit<ToolbarGroupItemProps, 'id' | 'options'> {\n  className?: string\n  active?: {\n    opts: any\n    tool: string\n  }\n}\n\ninterface BottomToolbarCallProps extends ToolbarGroupItemCallProps {}\n\ntype Props = BottomToolbarProps & BottomToolbarCallProps\n\nconst BottomToolbar = (props: Props) => {\n  const { className, ...rest } = props\n  const { active, disableableButtons, indigoVerification, onAction } = rest\n\n  return (\n    <div className={clsx(classes.root, className)}>\n      <Group>\n        <TemplatesList\n          active={active}\n          indigoVerification={indigoVerification}\n          disableableButtons={disableableButtons}\n          onAction={onAction}\n        />\n      </Group>\n\n      <Group>\n        <ToolbarGroupItem id=\"template-lib\" {...rest} />\n      </Group>\n    </div>\n  )\n}\n\nexport type { BottomToolbarProps, BottomToolbarCallProps }\nexport { BottomToolbar }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport { ComponentType } from 'react'\nimport { connect } from 'react-redux'\nimport { Dispatch } from 'redux'\n\nimport { onAction } from '../../../state'\nimport {\n  BottomToolbar,\n  BottomToolbarProps,\n  BottomToolbarCallProps\n} from './BottomToolbar'\n\ntype StateProps = Omit<BottomToolbarProps, 'className'>\ntype OwnProps = Pick<BottomToolbarProps, 'className'>\n\nconst mapStateToProps = (state): StateProps => ({\n  active: state.actionState && state.actionState.activeTool,\n  status: state.actionState || {},\n  opened: state.toolbar.opened,\n  indigoVerification: state.requestsStatuses.indigoVerification,\n  disableableButtons: []\n})\n\nconst mapDispatchToProps = (dispatch: Dispatch): BottomToolbarCallProps => ({\n  onAction: action => dispatch(onAction(action)),\n  onOpen: (menuName, isSelected) =>\n    dispatch({\n      type: 'OPENED',\n      data: { menuName, isSelected }\n    })\n})\n\nconst BottomToolbarContainer: ComponentType<OwnProps> = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(BottomToolbar)\n\nexport { BottomToolbarContainer }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nconst mediaSizes = {\n  topSeparatorsShowingWidth: 1080,\n  zoomShowingWidth: 780,\n  infoShowingWidth: 790,\n  reactionSeparatorShowingHeight: 851,\n  bondCollapsableHeight: 620,\n  rGroupCollapsableHeight: 850,\n  shapeCollapsableHeight: 850,\n  transformCollapsableHeight: 720\n}\n\nexport { mediaSizes }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { ToolbarItem, ToolbarItemVariant } from '../../toolbar.types'\n\nfunction makeItems(ids: ToolbarItemVariant[]): ToolbarItem[] {\n  return ids.map(id => ({ id }))\n}\n\nexport { makeItems }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { GroupDescriptor } from '../../ToolbarGroupItem/ToolbarMultiToolItem/variants/variants.types'\nimport { makeItems } from '../../ToolbarGroupItem/utils'\nimport { ToolbarItem } from '../../toolbar.types'\n\nconst bondCommon: ToolbarItem[] = makeItems([\n  'bond-single',\n  'bond-double',\n  'bond-triple'\n])\nconst bondStereo: ToolbarItem[] = makeItems([\n  'bond-up',\n  'bond-down',\n  'bond-updown',\n  'bond-crossed'\n])\nconst bondQuery: ToolbarItem[] = makeItems([\n  'bond-any',\n  'bond-aromatic',\n  'bond-singledouble',\n  'bond-singlearomatic',\n  'bond-doublearomatic'\n])\nconst bondSpecial: ToolbarItem[] = makeItems(['bond-dative', 'bond-hydrogen'])\n\nconst groups = [bondCommon, bondStereo, bondQuery, bondSpecial]\nconst groupOptions = groups.flat()\nconst groupDescriptors = groups.reduce((accum, group, index) => {\n  const start = accum[index - 1]?.end || 0\n\n  accum.push({\n    start: start,\n    end: start + group.length\n  })\n\n  return accum\n}, [] as GroupDescriptor[])\n\nexport {\n  bondCommon,\n  bondStereo,\n  bondQuery,\n  bondSpecial,\n  groupOptions,\n  groupDescriptors\n}\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\nimport { mediaSizes } from '../../mediaSizes'\nimport {\n  ToolbarGroupItemCallProps,\n  ToolbarGroupItemProps\n} from '../../ToolbarGroupItem'\nimport { ToolbarMultiToolItem } from '../../ToolbarGroupItem/ToolbarMultiToolItem'\nimport {\n  bondCommon,\n  bondStereo,\n  bondQuery,\n  bondSpecial,\n  groupOptions,\n  groupDescriptors\n} from './options'\n\ninterface BondProps extends Omit<ToolbarGroupItemProps, 'id' | 'options'> {\n  height?: number\n}\ninterface BondCallProps extends ToolbarGroupItemCallProps {}\n\ntype Props = BondProps & BondCallProps\n\nconst Bond = (props: Props) => {\n  const { height, ...rest } = props\n\n  if (height && height <= mediaSizes.bondCollapsableHeight) {\n    return (\n      <ToolbarMultiToolItem\n        id=\"bond-common\"\n        options={groupOptions}\n        variant=\"grouped\"\n        groups={groupDescriptors}\n        {...rest}\n      />\n    )\n  }\n\n  return (\n    <>\n      <ToolbarMultiToolItem id=\"bond-common\" options={bondCommon} {...rest} />\n      <ToolbarMultiToolItem id=\"bond-stereo\" options={bondStereo} {...rest} />\n      <ToolbarMultiToolItem id=\"bond-query\" options={bondQuery} {...rest} />\n      <ToolbarMultiToolItem id=\"bond-special\" options={bondSpecial} {...rest} />\n    </>\n  )\n}\n\nexport type { BondProps, BondCallProps }\nexport { Bond }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\nimport { mediaSizes } from '../../mediaSizes'\nimport {\n  ToolbarGroupItem,\n  ToolbarGroupItemCallProps,\n  ToolbarGroupItemProps\n} from '../../ToolbarGroupItem'\nimport { makeItems } from '../../ToolbarGroupItem/utils'\n\nconst rGroupOptions = makeItems([\n  'rgroup-label',\n  'rgroup-fragment',\n  'rgroup-attpoints'\n])\n\ninterface RGroupProps extends Omit<ToolbarGroupItemProps, 'id' | 'options'> {\n  height?: number\n}\ninterface RGroupCallProps extends ToolbarGroupItemCallProps {}\n\ntype Props = RGroupProps & RGroupCallProps\n\nconst RGroup = (props: Props) => {\n  const { height, ...rest } = props\n\n  if (height && height <= mediaSizes.rGroupCollapsableHeight) {\n    return (\n      <ToolbarGroupItem id=\"rgroup-label\" options={rGroupOptions} {...rest} />\n    )\n  }\n\n  return (\n    <>\n      <ToolbarGroupItem id=\"rgroup-label\" {...rest} />\n      <ToolbarGroupItem id=\"rgroup-fragment\" {...rest} />\n      <ToolbarGroupItem id=\"rgroup-attpoints\" {...rest} />\n    </>\n  )\n}\n\nexport type { RGroupProps, RGroupCallProps }\nexport { RGroup }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\nimport { mediaSizes } from '../../mediaSizes'\nimport {\n  ToolbarGroupItem,\n  ToolbarGroupItemCallProps,\n  ToolbarGroupItemProps\n} from '../../ToolbarGroupItem'\nimport { makeItems } from '../../ToolbarGroupItem/utils'\n\nconst shapeOptions = makeItems([\n  'shape-ellipse',\n  'shape-rectangle',\n  'shape-line'\n])\n\ninterface ShapeProps extends Omit<ToolbarGroupItemProps, 'id' | 'options'> {\n  height?: number\n}\ninterface ShapeCallProps extends ToolbarGroupItemCallProps {}\n\ntype Props = ShapeProps & ShapeCallProps\n\nconst Shape = (props: Props) => {\n  const { height, ...rest } = props\n\n  if (height && height <= mediaSizes.shapeCollapsableHeight) {\n    return (\n      <ToolbarGroupItem id=\"shape-ellipse\" options={shapeOptions} {...rest} />\n    )\n  }\n\n  return (\n    <>\n      <ToolbarGroupItem id=\"shape-ellipse\" {...rest} />\n      <ToolbarGroupItem id=\"shape-rectangle\" {...rest} />\n      <ToolbarGroupItem id=\"shape-line\" {...rest} />\n    </>\n  )\n}\n\nexport type { ShapeProps, ShapeCallProps }\nexport { Shape }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\nimport { mediaSizes } from '../../mediaSizes'\nimport {\n  ToolbarGroupItem,\n  ToolbarGroupItemCallProps,\n  ToolbarGroupItemProps\n} from '../../ToolbarGroupItem'\nimport { makeItems } from '../../ToolbarGroupItem/utils'\n\nconst transformOptions = makeItems([\n  'transform-rotate',\n  'transform-flip-h',\n  'transform-flip-v'\n])\n\ninterface TransformProps extends Omit<ToolbarGroupItemProps, 'id' | 'options'> {\n  height?: number\n}\ninterface TransformCallProps extends ToolbarGroupItemCallProps {}\n\ntype Props = TransformProps & TransformCallProps\n\nconst Transform = (props: Props) => {\n  const { height, ...rest } = props\n\n  if (height && height <= mediaSizes.transformCollapsableHeight) {\n    return (\n      <ToolbarGroupItem\n        id=\"transform-rotate\"\n        options={transformOptions}\n        {...rest}\n      />\n    )\n  }\n\n  return (\n    <>\n      <ToolbarGroupItem id=\"transform-rotate\" {...rest} />\n      <ToolbarGroupItem id=\"transform-flip-h\" {...rest} />\n      <ToolbarGroupItem id=\"transform-flip-v\" {...rest} />\n    </>\n  )\n}\n\nexport type { TransformProps, TransformCallProps }\nexport { Transform }\n","import React, { FC } from 'react'\nimport {\n  ToolbarGroupItem,\n  ToolbarGroupItemCallProps,\n  ToolbarGroupItemProps\n} from '../ToolbarGroupItem'\nimport { ToolbarItem, ToolbarItemVariant } from '../toolbar.types'\n\nimport { Bond } from './Bond'\nimport { RGroup } from './RGroup'\nimport { Shape } from './Shape'\nimport { Transform } from './Transform'\nimport classes from './LeftToolbar.module.less'\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport clsx from 'clsx'\nimport { makeItems } from '../ToolbarGroupItem/utils'\nimport { mediaSizes } from '../mediaSizes'\nimport { useResizeObserver } from '../../../../../hooks'\n\nconst Group: FC<{ className?: string }> = ({ children, className }) => (\n  <div className={clsx(classes.group, className)}>{children}</div>\n)\n\nconst selectOptions: ToolbarItem[] = makeItems([\n  'select-lasso',\n  'select-rectangle',\n  'select-fragment'\n])\nconst reactionOptions: ToolbarItem[] = makeItems([\n  'reaction-arrow',\n  'reaction-arrow-equilibrium',\n  'reaction-plus',\n  'reaction-automap',\n  'reaction-map',\n  'reaction-unmap'\n])\n\ninterface LeftToolbarProps\n  extends Omit<ToolbarGroupItemProps, 'id' | 'options'> {\n  className?: string\n}\n\ninterface LeftToolbarCallProps extends ToolbarGroupItemCallProps {}\n\ntype Props = LeftToolbarProps & LeftToolbarCallProps\n\nconst LeftToolbar = (props: Props) => {\n  const { className, ...rest } = props\n  const { ref, height } = useResizeObserver<HTMLDivElement>()\n\n  type ItemProps = {\n    id: ToolbarItemVariant\n    options?: ToolbarItem[]\n  }\n  const Item = ({ id, options }: ItemProps) =>\n    ToolbarGroupItem({ id, options, ...rest })\n\n  return (\n    <div className={clsx(classes.root, className)} ref={ref}>\n      <Group>\n        <Item id=\"select\" options={selectOptions} />\n        <Item id=\"erase\" />\n      </Group>\n\n      <Group>\n        <Bond {...rest} height={height} />\n        <Item id=\"chain\" />\n      </Group>\n\n      <Group>\n        <Item id=\"charge-plus\" />\n        <Item id=\"charge-minus\" />\n      </Group>\n\n      <Group>\n        <Transform {...rest} height={height} />\n      </Group>\n\n      <Group\n        className={clsx({\n          [classes.borderOff]:\n            height && height < mediaSizes.reactionSeparatorShowingHeight\n        })}>\n        <Item id=\"sgroup\" />\n        <Item id=\"sgroup-data\" />\n        <Item id=\"reaction\" options={reactionOptions} />\n      </Group>\n\n      <Group>\n        <RGroup {...rest} height={height} />\n        <Shape {...rest} height={height} />\n      </Group>\n      <Group>\n        <Item id=\"text\" />\n      </Group>\n    </div>\n  )\n}\n\nexport type { LeftToolbarProps, LeftToolbarCallProps }\nexport { LeftToolbar }\n","import {\n  LeftToolbar,\n  LeftToolbarCallProps,\n  LeftToolbarProps\n} from './LeftToolbar'\n\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { ComponentType } from 'react'\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { onAction } from '../../../state'\n\ntype StateProps = Omit<LeftToolbarProps, 'className'>\ntype OwnProps = Pick<LeftToolbarProps, 'className'>\n\nconst mapStateToProps = (state): StateProps => ({\n  status: state.actionState || {},\n  opened: state.toolbar.opened,\n  indigoVerification: state.requestsStatuses.indigoVerification,\n  disableableButtons: []\n})\n\nconst mapDispatchToProps = (dispatch: Dispatch): LeftToolbarCallProps => ({\n  onAction: action => dispatch(onAction(action)),\n  onOpen: (menuName, isSelected) =>\n    dispatch({\n      type: 'OPENED',\n      data: { menuName, isSelected }\n    })\n})\n\nconst LeftToolbarContainer: ComponentType<OwnProps> = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(LeftToolbar)\n\nexport { LeftToolbarContainer }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport clsx from 'clsx'\nimport React from 'react'\n\nimport { Elements } from 'ketcher-core'\nimport { UiActionAction } from '../../../../action'\nimport { atomCuts, basicAtoms } from '../../../../action/atoms'\nimport { shortcutStr } from '../../shortcutStr'\nimport Atom from '../../../../component/view/Atom'\n\nimport classes from '../../ToolbarGroupItem/ActionButton/ActionButton.module.less'\n\ninterface AtomsListProps {\n  atoms: string[]\n  active?: {\n    tool?: string\n    opts: {\n      label: any\n    }\n  }\n}\n\ninterface AtomsListCallProps {\n  onAction: (action: UiActionAction) => void\n}\n\ntype Props = AtomsListProps & AtomsListCallProps\n\nconst AtomsList = (props: Props) => {\n  const { atoms, active, onAction } = props\n  const isAtom = active && active.tool === 'atom'\n  return (\n    <>\n      {atoms.map(label => {\n        const element = Elements.get(label)\n        const shortcut =\n          basicAtoms.indexOf(label) > -1 ? shortcutStr(atomCuts[label]) : null\n        return (\n          <Atom\n            key={label}\n            el={element}\n            shortcut={shortcut}\n            className={clsx(classes.button, {\n              [classes.selected]:\n                isAtom && active && active.opts.label === label\n            })}\n            onClick={() => onAction({ tool: 'atom', opts: { label } })}\n          />\n        )\n      })}\n    </>\n  )\n}\n\nexport type { AtomsListProps, AtomsListCallProps }\nexport { AtomsList }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport clsx from 'clsx'\nimport React, { FC } from 'react'\n\nimport { basicAtoms } from '../../../action/atoms'\nimport {\n  ToolbarGroupItem,\n  ToolbarGroupItemCallProps,\n  ToolbarGroupItemProps\n} from '../ToolbarGroupItem'\nimport { AtomsList } from './AtomsList'\nimport classes from './RightToolbar.module.less'\n\nconst Group: FC<{ className?: string }> = ({ children, className }) => (\n  <div className={clsx(classes.group, className)}>{children}</div>\n)\n\ninterface RightToolbarProps\n  extends Omit<ToolbarGroupItemProps, 'id' | 'options'> {\n  className?: string\n  active?: {\n    opts: any\n    tool: string\n  }\n  freqAtoms: any[]\n}\n\ninterface RightToolbarCallProps extends ToolbarGroupItemCallProps {}\n\ntype Props = RightToolbarProps & RightToolbarCallProps\n\nconst RightToolbar = (props: Props) => {\n  const { className, ...rest } = props\n  const { active, onAction, freqAtoms } = rest\n\n  return (\n    <div className={clsx(classes.root, className)}>\n      <Group>\n        <AtomsList atoms={basicAtoms} active={active} onAction={onAction} />\n        <AtomsList atoms={freqAtoms} active={active} onAction={onAction} />\n      </Group>\n\n      <Group>\n        <ToolbarGroupItem id=\"period-table\" {...rest} />\n      </Group>\n      <Group>\n        {process.env.ENABLE_STEREOCHEMISTRY && (\n          <ToolbarGroupItem id=\"enhanced-stereo\" {...rest} />\n        )}\n      </Group>\n    </div>\n  )\n}\n\nexport type { RightToolbarProps, RightToolbarCallProps }\nexport { RightToolbar }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { ComponentType } from 'react'\nimport { connect } from 'react-redux'\nimport { Dispatch } from 'redux'\n\nimport { onAction } from '../../../state'\nimport {\n  RightToolbar,\n  RightToolbarProps,\n  RightToolbarCallProps\n} from './RightToolbar'\n\ntype StateProps = Omit<RightToolbarProps, 'className'>\ntype OwnProps = Pick<RightToolbarProps, 'className'>\n\nconst mapStateToProps = (state): StateProps => ({\n  active: state.actionState && state.actionState.activeTool,\n  status: state.actionState || {},\n  freqAtoms: state.toolbar.freqAtoms,\n  opened: state.toolbar.opened,\n  indigoVerification: state.requestsStatuses.indigoVerification,\n  disableableButtons: []\n})\n\nconst mapDispatchToProps = (dispatch: Dispatch): RightToolbarCallProps => ({\n  onAction: action => dispatch(onAction(action)),\n  onOpen: (menuName, isSelected) =>\n    dispatch({\n      type: 'OPENED',\n      data: { menuName, isSelected }\n    })\n})\n\nconst RightToolbarContainer: ComponentType<OwnProps> = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(RightToolbar)\n\nexport { RightToolbarContainer }\nexport default RightToolbarContainer\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React from 'react'\n\nimport { UiActionAction } from '../../../../action'\nimport { zoomList } from '../../../../action/zoom'\n\nfunction toPercent(value: number): string {\n  const percentLimit = 100\n  return (value * percentLimit).toFixed()\n}\n\ninterface ZoomListProps {\n  status: {\n    zoom?: {\n      selected?: number\n    }\n  }\n}\n\ninterface ZoomListCallProps {\n  onAction: (action: UiActionAction) => void\n}\n\ntype Props = ZoomListProps & ZoomListCallProps\n\nconst ZoomList = (props: Props) => {\n  const { status = {}, onAction } = props\n  const zoom = status.zoom && status.zoom.selected // TMP\n\n  const handleChange = event => {\n    const parsedValue = parseFloat(event.target.value)\n    onAction(editor => editor.zoom(parsedValue))\n  }\n\n  return (\n    <select value={zoom} onChange={handleChange}>\n      {zoomList.map(value => (\n        <option key={value.toString()} value={value}>\n          {toPercent(value)}%\n        </option>\n      ))}\n    </select>\n  )\n}\n\nexport type { ZoomListProps, ZoomListCallProps }\nexport { ZoomList }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport clsx from 'clsx'\nimport React, { FC } from 'react'\n\nimport { useResizeObserver } from '../../../../../hooks'\nimport { mediaSizes } from '../mediaSizes'\nimport {\n  ToolbarGroupItem,\n  ToolbarGroupItemCallProps,\n  ToolbarGroupItemProps\n} from '../ToolbarGroupItem'\nimport { ToolbarItem, ToolbarItemVariant } from '../toolbar.types'\nimport classes from './TopToolbar.module.less'\nimport { ZoomList } from './ZoomList'\n\nconst Group: FC<{ className?: string }> = ({ children, className }) => (\n  <div className={clsx(classes.group, className)}>{children}</div>\n)\n\ninterface TopToolbarProps\n  extends Omit<ToolbarGroupItemProps, 'id' | 'options'> {\n  className?: string\n}\n\ninterface TopToolbarCallProps extends ToolbarGroupItemCallProps {}\n\ntype Props = TopToolbarProps & TopToolbarCallProps\n\nconst TopToolbar = (props: Props) => {\n  const { className, ...rest } = props\n  const { ref, width } = useResizeObserver<HTMLDivElement>()\n\n  type ItemProps = {\n    id: ToolbarItemVariant\n    options?: ToolbarItem[]\n    className?: string\n  }\n  const Item = ({ id, options, className }: ItemProps) =>\n    ToolbarGroupItem({ id, options, className, ...rest })\n\n  return (\n    <div\n      ref={ref}\n      className={clsx(classes.root, className, {\n        [classes.hideSeparators]:\n          width && width < mediaSizes.topSeparatorsShowingWidth\n      })}>\n      <Group>\n        <Item id=\"new\" />\n        <Item id=\"open\" />\n        <Item id=\"save\" />\n      </Group>\n\n      <Group>\n        <Item id=\"undo\" />\n        <Item id=\"redo\" />\n        <Item id=\"cut\" />\n        <Item id=\"copy\" />\n        <Item id=\"paste\" />\n      </Group>\n\n      <Group>\n        {width && width >= mediaSizes.zoomShowingWidth ? (\n          <>\n            <Item id=\"zoom-in\" />\n            <Item id=\"zoom-out\" />\n          </>\n        ) : null}\n        <ZoomList status={rest.status} onAction={rest.onAction} />\n      </Group>\n\n      <Group>\n        <Item id=\"layout\" />\n        <Item id=\"clean\" />\n        <Item id=\"arom\" />\n        <Item id=\"dearom\" />\n        <Item id=\"cip\" />\n        <Item id=\"check\" />\n        <Item id=\"analyse\" />\n      </Group>\n\n      <Group className={classes.recognize}>\n        <Item id=\"recognize\" />\n        <Item id=\"miew\" />\n      </Group>\n\n      <Group className={classes.meta}>\n        <Item id=\"settings\" />\n        {width && width >= mediaSizes.infoShowingWidth ? (\n          <>\n            <Item id=\"help\" />\n            <Item id=\"about\" />\n          </>\n        ) : null}\n      </Group>\n    </div>\n  )\n}\n\nexport type { TopToolbarProps, TopToolbarCallProps }\nexport { TopToolbar }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { ComponentType } from 'react'\nimport { connect } from 'react-redux'\nimport { Dispatch } from 'redux'\n\nimport { onAction } from '../../../state'\nimport { TopToolbar, TopToolbarProps, TopToolbarCallProps } from './TopToolbar'\n\ntype StateProps = Omit<TopToolbarProps, 'className'>\ntype OwnProps = Pick<TopToolbarProps, 'className'>\n\nconst mapStateToProps = (state): StateProps => ({\n  status: state.actionState || {},\n  opened: state.toolbar.opened,\n  indigoVerification: state.requestsStatuses.indigoVerification,\n  disableableButtons: ['layout', 'clean', 'arom', 'dearom', 'cip']\n})\n\nconst mapDispatchToProps = (dispatch: Dispatch): TopToolbarCallProps => ({\n  onAction: action => dispatch(onAction(action)),\n  onOpen: (menuName, isSelected) =>\n    dispatch({\n      type: 'OPENED',\n      data: { menuName, isSelected }\n    })\n})\n\nconst TopToolbarContainer: ComponentType<OwnProps> = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(TopToolbar)\n\nexport { TopToolbarContainer }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { connect } from 'react-redux'\nimport { Dispatch } from 'redux'\nimport { initTmplLib } from '../../state/templates'\nimport { AppHidden, AppHiddenCallProps } from './AppHidden'\n\nconst mapDispatchToProps = (dispatch: Dispatch): AppHiddenCallProps => ({\n  onInitTmpls: (cacheEl, url) => initTmplLib(dispatch, url, cacheEl)\n})\n\nconst AppHiddenContainer = connect(null, mapDispatchToProps)(AppHidden)\n\nexport { AppHiddenContainer }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport React, { useEffect, useRef } from 'react'\nimport { useSettingsContext } from '../../../../hooks'\n\ninterface AppHiddenCallProps {\n  onInitTmpls: (cacheEl, url) => void\n}\n\ntype Props = AppHiddenCallProps\n// todo: come up with better name\nconst AppHidden = (props: Props) => {\n  const { onInitTmpls } = props\n\n  const ref = useRef(null)\n  const { staticResourcesUrl } = useSettingsContext()\n\n  useEffect(() => {\n    onInitTmpls(ref.current, staticResourcesUrl)\n  }, [])\n\n  return <div style={{ display: 'none' }} ref={ref} />\n}\n\nexport type { AppHiddenCallProps }\nexport { AppHidden }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { connect } from 'react-redux'\nimport { checkServer } from '../state/server'\nimport { App, AppCallProps } from './App'\n\nconst mapDispatchToProps: AppCallProps = {\n  checkServer\n}\n\nconst AppContainer = connect(null, mapDispatchToProps)(App)\n\nexport { AppContainer }\nexport default AppContainer\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport React, { useEffect } from 'react'\n\nimport AppClipArea from '../views/AppClipArea'\nimport Editor from '../views/Editor'\nimport AppModalContainer from '../views/modal'\nimport {\n  BottomToolbarContainer,\n  LeftToolbarContainer,\n  RightToolbarContainer,\n  TopToolbarContainer\n} from '../views/toolbars'\n\nimport { AppHiddenContainer } from './AppHidden'\nimport classes from './App.module.less'\n\ninterface AppCallProps {\n  checkServer: () => void\n}\n\ntype Props = AppCallProps\n\nconst App = (props: Props) => {\n  const { checkServer } = props\n  useEffect(() => {\n    checkServer()\n  }, [])\n\n  return (\n    <div className={classes.app}>\n      <AppHiddenContainer />\n      <Editor className={classes.canvas} />\n\n      <TopToolbarContainer className={classes.top} />\n      <LeftToolbarContainer className={classes.left} />\n      <BottomToolbarContainer className={classes.bottom} />\n      <RightToolbarContainer className={classes.right} />\n\n      <AppClipArea />\n      <AppModalContainer />\n    </div>\n  )\n}\n\nexport type { AppCallProps }\nexport { App }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { StructService } from 'ketcher-core'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport { Provider } from 'react-redux'\n\nimport { SettingsContext, AppContext } from './../../../contexts'\nimport createStore, { load } from '../state'\nimport { initKeydownListener } from '../state/hotkeys'\nimport { initResize } from '../state/toolbar'\nimport { loadStruct } from '../state/shared'\n\nimport App from './App.container'\n\nfunction initApp(\n  element: HTMLDivElement | null,\n  staticResourcesUrl: string,\n  options: any,\n  server: StructService,\n  setEditor: (editor: any) => void\n) {\n  const store = createStore(options, server, setEditor)\n  store.dispatch(initKeydownListener(element))\n  store.dispatch(initResize())\n\n  ReactDOM.render(\n    <Provider store={store}>\n      <SettingsContext.Provider value={{ staticResourcesUrl }}>\n        <AppContext.Provider\n          value={{ getKetcherInstance: () => (window as any).ketcher }}>\n          <App />\n        </AppContext.Provider>\n      </SettingsContext.Provider>\n    </Provider>,\n    element\n  )\n\n  return {\n    load: (structStr, opts) => store.dispatch(load(structStr, opts)),\n    loadStruct\n  }\n}\n\nexport { initApp }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport {\n  FormatterFactory,\n  ServiceMode,\n  StructService,\n  StructServiceProvider\n} from 'ketcher-core'\nimport { Ketcher, UI as KetcherUI } from '../../ketcher'\n\nimport { ButtonsConfig } from './ButtonsConfig'\nimport { Editor } from '../../editor'\nimport createApi from '../../api'\nimport { initApp } from '../../ui'\n\nclass KetcherBuilder {\n  private structService: StructService | null\n  private editor: Editor | null\n  private serviceMode: ServiceMode | null\n  private formatterFactory: FormatterFactory | null\n  private ui: KetcherUI | null\n\n  private tempUIDataContainer: null | {\n    element: HTMLDivElement | null\n    staticResourcesUrl: string\n    buttons?: ButtonsConfig\n  }\n\n  constructor() {\n    this.structService = null\n    this.editor = null\n    this.serviceMode = null\n    this.formatterFactory = null\n    this.ui = null\n\n    this.tempUIDataContainer = null\n  }\n\n  appendApiAsync(structServiceProvider: StructServiceProvider) {\n    this.structService = createApi(structServiceProvider, {\n      'smart-layout': true,\n      'ignore-stereochemistry-errors': true,\n      'mass-skip-error-on-pseudoatoms': false,\n      'gross-formula-add-rsites': true\n    })\n\n    if (this.tempUIDataContainer) {\n      return this.appendUiAsync(\n        this.tempUIDataContainer.element,\n        this.tempUIDataContainer.staticResourcesUrl,\n        this.tempUIDataContainer.buttons\n      )\n    }\n\n    return Promise.resolve()\n  }\n\n  appendServiceMode(mode: ServiceMode) {\n    this.serviceMode = mode\n  }\n\n  async appendUiAsync(\n    element: HTMLDivElement | null,\n    staticResourcesUrl: string,\n    buttons?: ButtonsConfig\n  ): Promise<void> {\n    const { structService } = this\n\n    if (!structService) {\n      this.tempUIDataContainer = {\n        element,\n        staticResourcesUrl,\n        buttons\n      }\n\n      return Promise.resolve()\n    }\n    this.tempUIDataContainer = null\n\n    const tempRef: { ui: KetcherUI } = {\n      ui: null as any\n    }\n\n    const editor = await new Promise<Editor>(resolve => {\n      tempRef.ui = initApp(\n        element,\n        staticResourcesUrl,\n        {\n          buttons: buttons || {},\n          version: process.env.VERSION || '',\n          buildDate: process.env.BUILD_DATE || '',\n          buildNumber: process.env.BUILD_NUMBER || ''\n        },\n        structService,\n        resolve\n      )\n    })\n\n    this.editor = editor\n    this.ui = tempRef.ui\n    this.formatterFactory = new FormatterFactory(structService)\n  }\n\n  build() {\n    if (!this.serviceMode) {\n      throw new Error('You should append ServiceMode before building')\n    }\n\n    if (!this.structService) {\n      throw new Error('You should append Api before building')\n    }\n\n    if (!this.editor || !this.ui) {\n      throw new Error('You should append UI before building')\n    }\n\n    if (!this.formatterFactory) {\n      throw new Error(\n        'You should append StructureServiceFactory before building'\n      )\n    }\n\n    const ketcher = new Ketcher(\n      this.editor,\n      this.structService,\n      this.ui,\n      this.formatterFactory\n    )\n    ketcher[this.serviceMode] = true\n\n    // todo: remove\n    ;(global as any).ketcher = ketcher\n    ;(global as any)._ui_editor = this.editor\n\n    const params = new URLSearchParams(document.location.search)\n    ketcher.server.info().then(() => {\n      if (params.get('moll')) {\n        ketcher.ui.load(params.get('moll'))\n      }\n    })\n\n    return ketcher\n  }\n}\n\nexport { KetcherBuilder }\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport {\n  InfoResult,\n  StructService,\n  StructServiceOptions,\n  StructServiceProvider\n} from 'ketcher-core'\n\ntype Api = StructService & Promise<InfoResult>\n\n// todo: remove\nfunction createApi(\n  structServiceProvider: StructServiceProvider,\n  defaultOptions: StructServiceOptions\n): Api {\n  const structService = structServiceProvider.createStructService(\n    defaultOptions\n  )\n  const info = structService.info()\n\n  return Object.assign(info, {\n    info: structService.info.bind(structService),\n    convert: structService.convert.bind(structService),\n    layout: structService.layout.bind(structService),\n    clean: structService.clean.bind(structService),\n    aromatize: structService.aromatize.bind(structService),\n    dearomatize: structService.dearomatize.bind(structService),\n    calculateCip: structService.calculateCip.bind(structService),\n    automap: structService.automap.bind(structService),\n    check: structService.check.bind(structService),\n    calculate: structService.calculate.bind(structService),\n    recognize: structService.recognize.bind(structService),\n    generateImageAsBase64: structService.generateImageAsBase64.bind(\n      structService\n    )\n  })\n}\n\nexport default createApi\n","import { ButtonsConfig, KetcherBuilder } from './builders'\n\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport { StructServiceProvider } from 'ketcher-core'\n\ninterface Config {\n  element: HTMLDivElement | null\n  staticResourcesUrl: string\n  structServiceProvider: StructServiceProvider\n  buttons?: ButtonsConfig\n}\n\nasync function buildKetcherAsync({\n  element,\n  staticResourcesUrl,\n  structServiceProvider,\n  buttons\n}: Config) {\n  const builder = new KetcherBuilder()\n\n  await builder.appendApiAsync(structServiceProvider)\n  builder.appendServiceMode(structServiceProvider.mode)\n  await builder.appendUiAsync(element, staticResourcesUrl, buttons)\n\n  return builder.build()\n}\n\nexport type { Config, ButtonsConfig }\nexport default buildKetcherAsync\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nimport 'element-closest-polyfill'\nimport 'regenerator-runtime/runtime'\nimport 'url-search-params-polyfill'\nimport 'whatwg-fetch'\nimport './index.less'\nimport './Editor.module.less'\n\nimport React, { useEffect, useRef } from 'react'\nimport init, { Config } from './script'\n\nimport { Ketcher } from './script/ketcher'\nimport clsx from 'clsx'\nimport { useResizeObserver } from './hooks'\n\nconst mediaSizes = {\n  smallWidth: 1040,\n  smallHeight: 600\n}\n\ninterface EditorProps extends Omit<Config, 'element'> {\n  onInit?: (ketcher: Ketcher) => void\n}\n\nfunction Editor(props: EditorProps) {\n  const rootElRef = useRef<HTMLDivElement>(null)\n  const { onInit } = props\n  const { height, width } = useResizeObserver<HTMLDivElement>({\n    ref: rootElRef\n  })\n  useEffect(() => {\n    init({\n      ...props,\n      element: rootElRef.current\n    }).then((ketcher: Ketcher) => {\n      if (typeof onInit === 'function') {\n        onInit(ketcher)\n      }\n    })\n    // TODO: provide the list of dependencies after implementing unsubscribe function\n  }, [])\n\n  return (\n    <div\n      ref={rootElRef}\n      className={clsx('editor', {\n        small:\n          (height && height <= mediaSizes.smallHeight) ||\n          (width && width <= mediaSizes.smallWidth)\n      })}\n    />\n  )\n}\n\nexport { Editor }\n","import 'react-app-polyfill/ie11'\nimport 'react-app-polyfill/stable'\nimport './index.css'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n","function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nmodule.exports = _objectWithoutPropertiesLoose;","var objectWithoutPropertiesLoose = require(\"./objectWithoutPropertiesLoose\");\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nmodule.exports = _objectWithoutProperties;","function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nmodule.exports = _arrayWithHoles;","function _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nmodule.exports = _iterableToArrayLimit;","function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nmodule.exports = _arrayLikeToArray;","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\n\nmodule.exports = _unsupportedIterableToArray;","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableRest;","var arrayWithHoles = require(\"./arrayWithHoles\");\n\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableRest = require(\"./nonIterableRest\");\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}\n\nmodule.exports = _slicedToArray;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\nexport enum Command {\n  Info = 'info',\n  Convert = 'convert',\n  Layout = 'layout',\n  Clean = 'clean',\n  Aromatize = 'aromatize',\n  Dearomatize = 'dearomatize',\n  CalculateCip = 'calculateCip',\n  Automap = 'automap',\n  Check = 'check',\n  Calculate = 'calculate',\n  GenerateImageAsBase64 = 'generateImageAsBase64'\n}\n\nexport enum SupportedFormat {\n  Rxn = 'rxnfile',\n  Mol = 'molfile',\n  Smiles = 'smiles',\n  Smarts = 'smarts',\n  CML = 'cml',\n  InChI = 'inchi',\n  InChIAuxInfo = 'inchi-aux'\n}\n\nexport interface WithStruct {\n  struct: string\n}\n\nexport interface WithFormat {\n  format: SupportedFormat\n}\n\nexport interface WithSelection {\n  selectedAtoms: Array<number>\n}\n\nexport interface CheckCommandData extends CommandData, WithStruct {\n  types: Array<string>\n}\n\nexport interface CommandData {\n  options: CommandOptions\n}\n\nexport interface ConvertCommandData\n  extends CommandData,\n    WithStruct,\n    WithFormat {}\n\nexport interface GenerateImageCommandData extends CommandData, WithStruct {\n  outputFormat: 'png' | 'svg'\n}\n\nexport interface LayoutCommandData extends CommandData, WithStruct {}\n\nexport interface CleanCommandData\n  extends CommandData,\n    WithStruct,\n    WithSelection {}\n\nexport interface AromatizeCommandData extends CommandData, WithStruct {}\n\nexport interface DearomatizeCommandData extends CommandData, WithStruct {}\n\nexport interface CalculateCipCommandData extends CommandData, WithStruct {}\n\nexport interface CalculateCommandData\n  extends CommandData,\n    WithStruct,\n    WithSelection {\n  properties: Array<string>\n}\n\nexport interface AutomapCommandData extends CommandData, WithStruct {\n  mode: string\n}\n\nexport interface CommandOptions {\n  [key: string]: string | number | boolean\n}\n\nexport interface OutputMessage<T> {\n  hasError?: boolean\n  payload?: T\n  error?: string\n}\nexport interface InputMessage<T> {\n  type: Command\n  data: T\n}\n","function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nmodule.exports = _inherits;","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nmodule.exports = _assertThisInitialized;","var _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nvar assertThisInitialized = require(\"./assertThisInitialized\");\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}\n\nmodule.exports = _possibleConstructorReturn;","function _getPrototypeOf(o) {\n  module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nmodule.exports = _getPrototypeOf;","function _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}\n\nmodule.exports = _isNativeFunction;","function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nmodule.exports = _isNativeReflectConstruct;","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nvar isNativeReflectConstruct = require(\"./isNativeReflectConstruct\");\n\nfunction _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    module.exports = _construct = Reflect.construct;\n  } else {\n    module.exports = _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nmodule.exports = _construct;","var getPrototypeOf = require(\"./getPrototypeOf\");\n\nvar setPrototypeOf = require(\"./setPrototypeOf\");\n\nvar isNativeFunction = require(\"./isNativeFunction\");\n\nvar construct = require(\"./construct\");\n\nfunction _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  module.exports = _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return construct(Class, arguments, getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return setPrototypeOf(Wrapper, Class);\n  };\n\n  return _wrapNativeSuper(Class);\n}\n\nmodule.exports = _wrapNativeSuper;","function _classPrivateFieldSet(receiver, privateMap, value) {\n  var descriptor = privateMap.get(receiver);\n\n  if (!descriptor) {\n    throw new TypeError(\"attempted to set private field on non-instance\");\n  }\n\n  if (descriptor.set) {\n    descriptor.set.call(receiver, value);\n  } else {\n    if (!descriptor.writable) {\n      throw new TypeError(\"attempted to set read only private field\");\n    }\n\n    descriptor.value = value;\n  }\n\n  return value;\n}\n\nmodule.exports = _classPrivateFieldSet;","function _classPrivateFieldGet(receiver, privateMap) {\n  var descriptor = privateMap.get(receiver);\n\n  if (!descriptor) {\n    throw new TypeError(\"attempted to get private field on non-instance\");\n  }\n\n  if (descriptor.get) {\n    return descriptor.get.call(receiver);\n  }\n\n  return descriptor.value;\n}\n\nmodule.exports = _classPrivateFieldGet;","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}\n\nmodule.exports = _arrayWithoutHoles;","function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableSpread;","var arrayWithoutHoles = require(\"./arrayWithoutHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;","var getPrototypeOf = require(\"./getPrototypeOf\");\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nmodule.exports = _superPropBase;","var superPropBase = require(\"./superPropBase\");\n\nfunction _get(target, property, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    module.exports = _get = Reflect.get;\n  } else {\n    module.exports = _get = function _get(target, property, receiver) {\n      var base = superPropBase(target, property);\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nmodule.exports = _get;","'use strict';\n\nvar uri = require('url');\n\nvar ValidationError = exports.ValidationError = function ValidationError (message, instance, schema, path, name, argument) {\n  if(Array.isArray(path)){\n    this.path = path;\n    this.property = path.reduce(function(sum, item){\n      return sum + makeSuffix(item);\n    }, 'instance');\n  }else if(path !== undefined){\n    this.property = path;\n  }\n  if (message) {\n    this.message = message;\n  }\n  if (schema) {\n    var id = schema.$id || schema.id;\n    this.schema = id || schema;\n  }\n  if (instance !== undefined) {\n    this.instance = instance;\n  }\n  this.name = name;\n  this.argument = argument;\n  this.stack = this.toString();\n};\n\nValidationError.prototype.toString = function toString() {\n  return this.property + ' ' + this.message;\n};\n\nvar ValidatorResult = exports.ValidatorResult = function ValidatorResult(instance, schema, options, ctx) {\n  this.instance = instance;\n  this.schema = schema;\n  this.options = options;\n  this.path = ctx.path;\n  this.propertyPath = ctx.propertyPath;\n  this.errors = [];\n  this.throwError = options && options.throwError;\n  this.throwFirst = options && options.throwFirst;\n  this.throwAll = options && options.throwAll;\n  this.disableFormat = options && options.disableFormat === true;\n};\n\nValidatorResult.prototype.addError = function addError(detail) {\n  var err;\n  if (typeof detail == 'string') {\n    err = new ValidationError(detail, this.instance, this.schema, this.path);\n  } else {\n    if (!detail) throw new Error('Missing error detail');\n    if (!detail.message) throw new Error('Missing error message');\n    if (!detail.name) throw new Error('Missing validator type');\n    err = new ValidationError(detail.message, this.instance, this.schema, this.path, detail.name, detail.argument);\n  }\n\n  this.errors.push(err);\n  if (this.throwFirst) {\n    throw new ValidatorResultError(this);\n  }else if(this.throwError){\n    throw err;\n  }\n  return err;\n};\n\nValidatorResult.prototype.importErrors = function importErrors(res) {\n  if (typeof res == 'string' || (res && res.validatorType)) {\n    this.addError(res);\n  } else if (res && res.errors) {\n    Array.prototype.push.apply(this.errors, res.errors);\n  }\n};\n\nfunction stringizer (v,i){\n  return i+': '+v.toString()+'\\n';\n}\nValidatorResult.prototype.toString = function toString(res) {\n  return this.errors.map(stringizer).join('');\n};\n\nObject.defineProperty(ValidatorResult.prototype, \"valid\", { get: function() {\n  return !this.errors.length;\n} });\n\nmodule.exports.ValidatorResultError = ValidatorResultError;\nfunction ValidatorResultError(result) {\n  if(Error.captureStackTrace){\n    Error.captureStackTrace(this, ValidatorResultError);\n  }\n  this.instance = result.instance;\n  this.schema = result.schema;\n  this.options = result.options;\n  this.errors = result.errors;\n}\nValidatorResultError.prototype = new Error();\nValidatorResultError.prototype.constructor = ValidatorResultError;\nValidatorResultError.prototype.name = \"Validation Error\";\n\n/**\n * Describes a problem with a Schema which prevents validation of an instance\n * @name SchemaError\n * @constructor\n */\nvar SchemaError = exports.SchemaError = function SchemaError (msg, schema) {\n  this.message = msg;\n  this.schema = schema;\n  Error.call(this, msg);\n  Error.captureStackTrace(this, SchemaError);\n};\nSchemaError.prototype = Object.create(Error.prototype,\n  {\n    constructor: {value: SchemaError, enumerable: false},\n    name: {value: 'SchemaError', enumerable: false},\n  });\n\nvar SchemaContext = exports.SchemaContext = function SchemaContext (schema, options, path, base, schemas) {\n  this.schema = schema;\n  this.options = options;\n  if(Array.isArray(path)){\n    this.path = path;\n    this.propertyPath = path.reduce(function(sum, item){\n      return sum + makeSuffix(item);\n    }, 'instance');\n  }else{\n    this.propertyPath = path;\n  }\n  this.base = base;\n  this.schemas = schemas;\n};\n\nSchemaContext.prototype.resolve = function resolve (target) {\n  return uri.resolve(this.base, target);\n};\n\nSchemaContext.prototype.makeChild = function makeChild(schema, propertyName){\n  var path = (propertyName===undefined) ? this.path : this.path.concat([propertyName]);\n  var id = schema.$id || schema.id;\n  var base = uri.resolve(this.base, id||'');\n  var ctx = new SchemaContext(schema, this.options, path, base, Object.create(this.schemas));\n  if(id && !ctx.schemas[base]){\n    ctx.schemas[base] = schema;\n  }\n  return ctx;\n};\n\nvar FORMAT_REGEXPS = exports.FORMAT_REGEXPS = {\n  'date-time': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\\.\\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,\n  'date': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,\n  'time': /^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,\n\n  'email': /^(?:[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+\\.)*[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!\\.)){0,61}[a-zA-Z0-9]?\\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\\[(?:(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\.){3}(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\]))$/,\n  'ip-address': /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n  'ipv6': /^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/,\n\n  // TODO: A more accurate regular expression for \"uri\" goes:\n  // [A-Za-z][+\\-.0-9A-Za-z]*:((/(/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\\[(([Vv][0-9A-Fa-f]+\\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\\])?)(:\\d*)?)?)?#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(/(/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\\[(([Vv][0-9A-Fa-f]+\\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\\])?)(:\\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])|/?%[0-9A-Fa-f]{2}|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*(#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?|/(/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+(:\\d*)?|(\\[(([Vv][0-9A-Fa-f]+\\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\\])?:\\d*|\\[(([Vv][0-9A-Fa-f]+\\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\\])?)?)?\n  'uri': /^[a-zA-Z][a-zA-Z0-9+-.]*:[^\\s]*$/,\n  'uri-reference': /^(((([A-Za-z][+\\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\\-.0-9A-Za-z]*:)?\\/((%[0-9A-Fa-f]{2}|\\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\\[(([Vv][0-9A-Fa-f]+\\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\\])?)(:\\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(\\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\\[(([Vv][0-9A-Fa-f]+\\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\\])?)(:\\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(([A-Za-z][+\\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~]|[A-Za-z][+\\-.0-9A-Za-z]*[!$&-*,;=@_~])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?|([A-Za-z][+\\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\\-.0-9A-Za-z]*:)?\\/((%[0-9A-Fa-f]{2}|\\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\\[(([Vv][0-9A-Fa-f]+\\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\\])?)(:\\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|\\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+(:\\d*)?|(\\[(([Vv][0-9A-Fa-f]+\\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\\])?:\\d*|\\[(([Vv][0-9A-Fa-f]+\\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\\])?)?|[A-Za-z][+\\-.0-9A-Za-z]*:?)?$/,\n\n  'color': /^(#?([0-9A-Fa-f]{3}){1,2}\\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\\(\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*\\))|(rgb\\(\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*\\)))$/,\n\n  // hostname regex from: http://stackoverflow.com/a/1420225/5628\n  'hostname': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n  'host-name': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n\n  'alpha': /^[a-zA-Z]+$/,\n  'alphanumeric': /^[a-zA-Z0-9]+$/,\n  'utc-millisec': function (input) {\n    return (typeof input === 'string') && parseFloat(input) === parseInt(input, 10) && !isNaN(input);\n  },\n  'regex': function (input) {\n    var result = true;\n    try {\n      new RegExp(input);\n    } catch (e) {\n      result = false;\n    }\n    return result;\n  },\n  'style': /\\s*(.+?):\\s*([^;]+);?/,\n  'phone': /^\\+(?:[0-9] ?){6,14}[0-9]$/,\n};\n\nFORMAT_REGEXPS.regexp = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.pattern = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.ipv4 = FORMAT_REGEXPS['ip-address'];\n\nexports.isFormat = function isFormat (input, format, validator) {\n  if (typeof input === 'string' && FORMAT_REGEXPS[format] !== undefined) {\n    if (FORMAT_REGEXPS[format] instanceof RegExp) {\n      return FORMAT_REGEXPS[format].test(input);\n    }\n    if (typeof FORMAT_REGEXPS[format] === 'function') {\n      return FORMAT_REGEXPS[format](input);\n    }\n  } else if (validator && validator.customFormats &&\n      typeof validator.customFormats[format] === 'function') {\n    return validator.customFormats[format](input);\n  }\n  return true;\n};\n\nvar makeSuffix = exports.makeSuffix = function makeSuffix (key) {\n  key = key.toString();\n  // This function could be capable of outputting valid a ECMAScript string, but the\n  // resulting code for testing which form to use would be tens of thousands of characters long\n  // That means this will use the name form for some illegal forms\n  if (!key.match(/[.\\s\\[\\]]/) && !key.match(/^[\\d]/)) {\n    return '.' + key;\n  }\n  if (key.match(/^\\d+$/)) {\n    return '[' + key + ']';\n  }\n  return '[' + JSON.stringify(key) + ']';\n};\n\nexports.deepCompareStrict = function deepCompareStrict (a, b) {\n  if (typeof a !== typeof b) {\n    return false;\n  }\n  if (Array.isArray(a)) {\n    if (!Array.isArray(b)) {\n      return false;\n    }\n    if (a.length !== b.length) {\n      return false;\n    }\n    return a.every(function (v, i) {\n      return deepCompareStrict(a[i], b[i]);\n    });\n  }\n  if (typeof a === 'object') {\n    if (!a || !b) {\n      return a === b;\n    }\n    var aKeys = Object.keys(a);\n    var bKeys = Object.keys(b);\n    if (aKeys.length !== bKeys.length) {\n      return false;\n    }\n    return aKeys.every(function (v) {\n      return deepCompareStrict(a[v], b[v]);\n    });\n  }\n  return a === b;\n};\n\nfunction deepMerger (target, dst, e, i) {\n  if (typeof e === 'object') {\n    dst[i] = deepMerge(target[i], e);\n  } else {\n    if (target.indexOf(e) === -1) {\n      dst.push(e);\n    }\n  }\n}\n\nfunction copyist (src, dst, key) {\n  dst[key] = src[key];\n}\n\nfunction copyistWithDeepMerge (target, src, dst, key) {\n  if (typeof src[key] !== 'object' || !src[key]) {\n    dst[key] = src[key];\n  }\n  else {\n    if (!target[key]) {\n      dst[key] = src[key];\n    } else {\n      dst[key] = deepMerge(target[key], src[key]);\n    }\n  }\n}\n\nfunction deepMerge (target, src) {\n  var array = Array.isArray(src);\n  var dst = array && [] || {};\n\n  if (array) {\n    target = target || [];\n    dst = dst.concat(target);\n    src.forEach(deepMerger.bind(null, target, dst));\n  } else {\n    if (target && typeof target === 'object') {\n      Object.keys(target).forEach(copyist.bind(null, target, dst));\n    }\n    Object.keys(src).forEach(copyistWithDeepMerge.bind(null, target, src, dst));\n  }\n\n  return dst;\n}\n\nmodule.exports.deepMerge = deepMerge;\n\n/**\n * Validates instance against the provided schema\n * Implements URI+JSON Pointer encoding, e.g. \"%7e\"=\"~0\"=>\"~\", \"~1\"=\"%2f\"=>\"/\"\n * @param o\n * @param s The path to walk o along\n * @return any\n */\nexports.objectGetPath = function objectGetPath(o, s) {\n  var parts = s.split('/').slice(1);\n  var k;\n  while (typeof (k=parts.shift()) == 'string') {\n    var n = decodeURIComponent(k.replace(/~0/,'~').replace(/~1/g,'/'));\n    if (!(n in o)) return;\n    o = o[n];\n  }\n  return o;\n};\n\nfunction pathEncoder (v) {\n  return '/'+encodeURIComponent(v).replace(/~/g,'%7E');\n}\n/**\n * Accept an Array of property names and return a JSON Pointer URI fragment\n * @param Array a\n * @return {String}\n */\nexports.encodePath = function encodePointer(a){\n  // ~ must be encoded explicitly because hacks\n  // the slash is encoded by encodeURIComponent\n  return a.map(pathEncoder).join('');\n};\n\n\n/**\n * Calculate the number of decimal places a number uses\n * We need this to get correct results out of multipleOf and divisibleBy\n * when either figure is has decimal places, due to IEEE-754 float issues.\n * @param number\n * @returns {number}\n */\nexports.getDecimalPlaces = function getDecimalPlaces(number) {\n\n  var decimalPlaces = 0;\n  if (isNaN(number)) return decimalPlaces;\n\n  if (typeof number !== 'number') {\n    number = Number(number);\n  }\n\n  var parts = number.toString().split('e');\n  if (parts.length === 2) {\n    if (parts[1][0] !== '-') {\n      return decimalPlaces;\n    } else {\n      decimalPlaces = Number(parts[1].slice(1));\n    }\n  }\n\n  var decimalParts = parts[0].split('.');\n  if (decimalParts.length === 2) {\n    decimalPlaces += decimalParts[1].length;\n  }\n\n  return decimalPlaces;\n};\n\nexports.isSchema = function isSchema(val){\n  return (typeof val === 'object' && val) || (typeof val === 'boolean');\n};\n\n","'use strict';\n\nvar helpers = require('./helpers');\n\n/** @type ValidatorResult */\nvar ValidatorResult = helpers.ValidatorResult;\n/** @type SchemaError */\nvar SchemaError = helpers.SchemaError;\n\nvar attribute = {};\n\nattribute.ignoreProperties = {\n  // informative properties\n  'id': true,\n  'default': true,\n  'description': true,\n  'title': true,\n  // arguments to other properties\n  'additionalItems': true,\n  'then': true,\n  'else': true,\n  // special-handled properties\n  '$schema': true,\n  '$ref': true,\n  'extends': true,\n};\n\n/**\n * @name validators\n */\nvar validators = attribute.validators = {};\n\n/**\n * Validates whether the instance if of a certain type\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.type = function validateType (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var types = Array.isArray(schema.type) ? schema.type : [schema.type];\n  if (!types.some(this.testType.bind(this, instance, schema, options, ctx))) {\n    var list = types.map(function (v) {\n      if(!v) return;\n      var id = v.$id || v.id;\n      return id ? ('<' + id + '>') : (v+'');\n    });\n    result.addError({\n      name: 'type',\n      argument: list,\n      message: \"is not of a type(s) \" + list,\n    });\n  }\n  return result;\n};\n\nfunction testSchemaNoThrow(instance, options, ctx, callback, schema){\n  var throwError = options.throwError;\n  var throwAll = options.throwAll;\n  options.throwError = false;\n  options.throwAll = false;\n  var res = this.validateSchema(instance, schema, options, ctx);\n  options.throwError = throwError;\n  options.throwAll = throwAll;\n\n  if (!res.valid && callback instanceof Function) {\n    callback(res);\n  }\n  return res.valid;\n}\n\n/**\n * Validates whether the instance matches some of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.anyOf = function validateAnyOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  if (!Array.isArray(schema.anyOf)){\n    throw new SchemaError(\"anyOf must be an array\");\n  }\n  if (!schema.anyOf.some(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res){inner.importErrors(res);}\n    ))) {\n    var list = schema.anyOf.map(function (v, i) {\n      var id = v.$id || v.id;\n      if(id) return '<' + id + '>';\n      return(v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n    });\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'anyOf',\n      argument: list,\n      message: \"is not any of \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance matches every given schema\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.allOf = function validateAllOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.allOf)){\n    throw new SchemaError(\"allOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var self = this;\n  schema.allOf.forEach(function(v, i){\n    var valid = self.validateSchema(instance, v, options, ctx);\n    if(!valid.valid){\n      var id = v.$id || v.id;\n      var msg = id || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n      result.addError({\n        name: 'allOf',\n        argument: { id: msg, length: valid.errors.length, valid: valid },\n        message: 'does not match allOf schema ' + msg + ' with ' + valid.errors.length + ' error[s]:',\n      });\n      result.importErrors(valid);\n    }\n  });\n  return result;\n};\n\n/**\n * Validates whether the instance matches exactly one of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.oneOf = function validateOneOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.oneOf)){\n    throw new SchemaError(\"oneOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  var count = schema.oneOf.filter(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res) {inner.importErrors(res);}\n    ) ).length;\n  var list = schema.oneOf.map(function (v, i) {\n    var id = v.$id || v.id;\n    return id || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n  });\n  if (count!==1) {\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'oneOf',\n      argument: list,\n      message: \"is not exactly one from \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates \"then\" or \"else\" depending on the result of validating \"if\"\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.if = function validateIf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) return null;\n  if (!helpers.isSchema(schema.if)) throw new Error('Expected \"if\" keyword to be a schema');\n  var ifValid = testSchemaNoThrow.call(this, instance, options, ctx, null, schema.if);\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var res;\n  if(ifValid){\n    if (schema.then === undefined) return;\n    if (!helpers.isSchema(schema.then)) throw new Error('Expected \"then\" keyword to be a schema');\n    res = this.validateSchema(instance, schema.then, options, ctx.makeChild(schema.then));\n    result.importErrors(res);\n  }else{\n    if (schema.else === undefined) return;\n    if (!helpers.isSchema(schema.else)) throw new Error('Expected \"else\" keyword to be a schema');\n    res = this.validateSchema(instance, schema.else, options, ctx.makeChild(schema.else));\n    result.importErrors(res);\n  }\n  return result;\n};\n\nfunction getEnumerableProperty(object, key){\n  // Determine if `key` shows up in `for(var key in object)`\n  // First test Object.hasOwnProperty.call as an optimization: that guarantees it does\n  if(Object.hasOwnProperty.call(object, key)) return object[key];\n  // Test `key in object` as an optimization; false means it won't\n  if(!(key in object)) return;\n  while( (object = Object.getPrototypeOf(object)) ){\n    if(Object.propertyIsEnumerable.call(object, key)) return object[key];\n  }\n}\n\n/**\n * Validates propertyNames\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.propertyNames = function validatePropertyNames (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var subschema = schema.propertyNames!==undefined ? schema.propertyNames : {};\n  if(!helpers.isSchema(subschema)) throw new SchemaError('Expected \"propertyNames\" to be a schema (object or boolean)');\n\n  for (var property in instance) {\n    if(getEnumerableProperty(instance, property) !== undefined){\n      var res = this.validateSchema(property, subschema, options, ctx.makeChild(subschema));\n      result.importErrors(res);\n    }\n  }\n\n  return result;\n};\n\n/**\n * Validates properties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.properties = function validateProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var properties = schema.properties || {};\n  for (var property in properties) {\n    var subschema = properties[property];\n    if(subschema===undefined){\n      continue;\n    }else if(subschema===null){\n      throw new SchemaError('Unexpected null, expected schema in \"properties\"');\n    }\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, subschema, options, ctx);\n    }\n    var prop = getEnumerableProperty(instance, property);\n    var res = this.validateSchema(prop, subschema, options, ctx.makeChild(subschema, property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n  return result;\n};\n\n/**\n * Test a specific property within in instance against the additionalProperties schema attribute\n * This ignores properties with definitions in the properties schema attribute, but no other attributes.\n * If too many more types of property-existence tests pop up they may need their own class of tests (like `type` has)\n * @private\n * @return {boolean}\n */\nfunction testAdditionalProperty (instance, schema, options, ctx, property, result) {\n  if(!this.types.object(instance)) return;\n  if (schema.properties && schema.properties[property] !== undefined) {\n    return;\n  }\n  if (schema.additionalProperties === false) {\n    result.addError({\n      name: 'additionalProperties',\n      argument: property,\n      message: \"is not allowed to have the additional property \" + JSON.stringify(property),\n    });\n  } else {\n    var additionalProperties = schema.additionalProperties || {};\n\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, additionalProperties, options, ctx);\n    }\n\n    var res = this.validateSchema(instance[property], additionalProperties, options, ctx.makeChild(additionalProperties, property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n}\n\n/**\n * Validates patternProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.patternProperties = function validatePatternProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var patternProperties = schema.patternProperties || {};\n\n  for (var property in instance) {\n    var test = true;\n    for (var pattern in patternProperties) {\n      var subschema = patternProperties[pattern];\n      if(subschema===undefined){\n        continue;\n      }else if(subschema===null){\n        throw new SchemaError('Unexpected null, expected schema in \"patternProperties\"');\n      }\n      try {\n        var regexp = new RegExp(pattern, 'u');\n      } catch(_e) {\n        // In the event the stricter handling causes an error, fall back on the forgiving handling\n        // DEPRECATED\n        regexp = new RegExp(pattern);\n      }\n      if (!regexp.test(property)) {\n        continue;\n      }\n      test = false;\n\n      if (typeof options.preValidateProperty == 'function') {\n        options.preValidateProperty(instance, property, subschema, options, ctx);\n      }\n\n      var res = this.validateSchema(instance[property], subschema, options, ctx.makeChild(subschema, property));\n      if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n      result.importErrors(res);\n    }\n    if (test) {\n      testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n    }\n  }\n\n  return result;\n};\n\n/**\n * Validates additionalProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.additionalProperties = function validateAdditionalProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  // if patternProperties is defined then we'll test when that one is called instead\n  if (schema.patternProperties) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in instance) {\n    testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minProperties = function validateMinProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length >= schema.minProperties)) {\n    result.addError({\n      name: 'minProperties',\n      argument: schema.minProperties,\n      message: \"does not meet minimum property length of \" + schema.minProperties,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxProperties = function validateMaxProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length <= schema.maxProperties)) {\n    result.addError({\n      name: 'maxProperties',\n      argument: schema.maxProperties,\n      message: \"does not meet maximum property length of \" + schema.maxProperties,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates items when instance is an array\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.items = function validateItems (instance, schema, options, ctx) {\n  var self = this;\n  if (!this.types.array(instance)) return;\n  if (!schema.items) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  instance.every(function (value, i) {\n    var items = Array.isArray(schema.items) ? (schema.items[i] || schema.additionalItems) : schema.items;\n    if (items === undefined) {\n      return true;\n    }\n    if (items === false) {\n      result.addError({\n        name: 'items',\n        message: \"additionalItems not permitted\",\n      });\n      return false;\n    }\n    var res = self.validateSchema(value, items, options, ctx.makeChild(items, i));\n    if(res.instance !== result.instance[i]) result.instance[i] = res.instance;\n    result.importErrors(res);\n    return true;\n  });\n  return result;\n};\n\n/**\n * Validates minimum and exclusiveMinimum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minimum = function validateMinimum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (schema.exclusiveMinimum && schema.exclusiveMinimum === true) {\n    if(!(instance > schema.minimum)){\n      result.addError({\n        name: 'minimum',\n        argument: schema.minimum,\n        message: \"must be greater than \" + schema.minimum,\n      });\n    }\n  } else {\n    if(!(instance >= schema.minimum)){\n      result.addError({\n        name: 'minimum',\n        argument: schema.minimum,\n        message: \"must be greater than or equal to \" + schema.minimum,\n      });\n    }\n  }\n  return result;\n};\n\n/**\n * Validates maximum and exclusiveMaximum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maximum = function validateMaximum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (schema.exclusiveMaximum && schema.exclusiveMaximum === true) {\n    if(!(instance < schema.maximum)){\n      result.addError({\n        name: 'maximum',\n        argument: schema.maximum,\n        message: \"must be less than \" + schema.maximum,\n      });\n    }\n  } else {\n    if(!(instance <= schema.maximum)){\n      result.addError({\n        name: 'maximum',\n        argument: schema.maximum,\n        message: \"must be less than or equal to \" + schema.maximum,\n      });\n    }\n  }\n  return result;\n};\n\n/**\n * Validates the number form of exclusiveMinimum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.exclusiveMinimum = function validateExclusiveMinimum (instance, schema, options, ctx) {\n  // Support the boolean form of exclusiveMinimum, which is handled by the \"minimum\" keyword.\n  if(typeof schema.exclusiveMaximum === 'boolean') return;\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid = instance > schema.exclusiveMinimum;\n  if (!valid) {\n    result.addError({\n      name: 'exclusiveMinimum',\n      argument: schema.exclusiveMinimum,\n      message: \"must be strictly greater than \" + schema.exclusiveMinimum,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates the number form of exclusiveMaximum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.exclusiveMaximum = function validateExclusiveMaximum (instance, schema, options, ctx) {\n  // Support the boolean form of exclusiveMaximum, which is handled by the \"maximum\" keyword.\n  if(typeof schema.exclusiveMaximum === 'boolean') return;\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid = instance < schema.exclusiveMaximum;\n  if (!valid) {\n    result.addError({\n      name: 'exclusiveMaximum',\n      argument: schema.exclusiveMaximum,\n      message: \"must be strictly less than \" + schema.exclusiveMaximum,\n    });\n  }\n  return result;\n};\n\n/**\n * Perform validation for multipleOf and divisibleBy, which are essentially the same.\n * @param instance\n * @param schema\n * @param validationType\n * @param errorMessage\n * @returns {String|null}\n */\nvar validateMultipleOfOrDivisbleBy = function validateMultipleOfOrDivisbleBy (instance, schema, options, ctx, validationType, errorMessage) {\n  if (!this.types.number(instance)) return;\n\n  var validationArgument = schema[validationType];\n  if (validationArgument == 0) {\n    throw new SchemaError(validationType + \" cannot be zero\");\n  }\n\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n  var instanceDecimals = helpers.getDecimalPlaces(instance);\n  var divisorDecimals = helpers.getDecimalPlaces(validationArgument);\n\n  var maxDecimals = Math.max(instanceDecimals , divisorDecimals);\n  var multiplier = Math.pow(10, maxDecimals);\n\n  if (Math.round(instance * multiplier) % Math.round(validationArgument * multiplier) !== 0) {\n    result.addError({\n      name: validationType,\n      argument:  validationArgument,\n      message: errorMessage + JSON.stringify(validationArgument),\n    });\n  }\n\n  return result;\n};\n\n/**\n * Validates divisibleBy when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.multipleOf = function validateMultipleOf (instance, schema, options, ctx) {\n  return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"multipleOf\", \"is not a multiple of (divisible by) \");\n};\n\n/**\n * Validates multipleOf when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.divisibleBy = function validateDivisibleBy (instance, schema, options, ctx) {\n  return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"divisibleBy\", \"is not divisible by (multiple of) \");\n};\n\n/**\n * Validates whether the instance value is present.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.required = function validateRequired (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (instance === undefined && schema.required === true) {\n    // A boolean form is implemented for reverse-compatibility with schemas written against older drafts\n    result.addError({\n      name: 'required',\n      message: \"is required\",\n    });\n  } else if (this.types.object(instance) && Array.isArray(schema.required)) {\n    schema.required.forEach(function(n){\n      if(getEnumerableProperty(instance, n)===undefined){\n        result.addError({\n          name: 'required',\n          argument: n,\n          message: \"requires property \" + JSON.stringify(n),\n        });\n      }\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value matches the regular expression, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.pattern = function validatePattern (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var pattern = schema.pattern;\n  try {\n    var regexp = new RegExp(pattern, 'u');\n  } catch(_e) {\n    // In the event the stricter handling causes an error, fall back on the forgiving handling\n    // DEPRECATED\n    regexp = new RegExp(pattern);\n  }\n  if (!instance.match(regexp)) {\n    result.addError({\n      name: 'pattern',\n      argument: schema.pattern,\n      message: \"does not match pattern \" + JSON.stringify(schema.pattern.toString()),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is of a certain defined format or a custom\n * format.\n * The following formats are supported for string types:\n *   - date-time\n *   - date\n *   - time\n *   - ip-address\n *   - ipv6\n *   - uri\n *   - color\n *   - host-name\n *   - alpha\n *   - alpha-numeric\n *   - utc-millisec\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {String|null}\n */\nvalidators.format = function validateFormat (instance, schema, options, ctx) {\n  if (instance===undefined) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!result.disableFormat && !helpers.isFormat(instance, schema.format, this)) {\n    result.addError({\n      name: 'format',\n      argument: schema.format,\n      message: \"does not conform to the \" + JSON.stringify(schema.format) + \" format\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minLength = function validateMinLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length >= schema.minLength)) {\n    result.addError({\n      name: 'minLength',\n      argument: schema.minLength,\n      message: \"does not meet minimum length of \" + schema.minLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxLength = function validateMaxLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  // TODO if this was already computed in \"minLength\", use that value instead of re-computing\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length <= schema.maxLength)) {\n    result.addError({\n      name: 'maxLength',\n      argument: schema.maxLength,\n      message: \"does not meet maximum length of \" + schema.maxLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains at least a minimum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minItems = function validateMinItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length >= schema.minItems)) {\n    result.addError({\n      name: 'minItems',\n      argument: schema.minItems,\n      message: \"does not meet minimum length of \" + schema.minItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains no more than a maximum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxItems = function validateMaxItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length <= schema.maxItems)) {\n    result.addError({\n      name: 'maxItems',\n      argument: schema.maxItems,\n      message: \"does not meet maximum length of \" + schema.maxItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Deep compares arrays for duplicates\n * @param v\n * @param i\n * @param a\n * @private\n * @return {boolean}\n */\nfunction testArrays (v, i, a) {\n  var j, len = a.length;\n  for (j = i + 1, len; j < len; j++) {\n    if (helpers.deepCompareStrict(v, a[j])) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Validates whether there are no duplicates, when the instance is an Array.\n * @param instance\n * @return {String|null}\n */\nvalidators.uniqueItems = function validateUniqueItems (instance, schema, options, ctx) {\n  if (schema.uniqueItems!==true) return;\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!instance.every(testArrays)) {\n    result.addError({\n      name: 'uniqueItems',\n      message: \"contains duplicate item\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validate for the presence of dependency properties, if the instance is an object.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.dependencies = function validateDependencies (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in schema.dependencies) {\n    if (instance[property] === undefined) {\n      continue;\n    }\n    var dep = schema.dependencies[property];\n    var childContext = ctx.makeChild(dep, property);\n    if (typeof dep == 'string') {\n      dep = [dep];\n    }\n    if (Array.isArray(dep)) {\n      dep.forEach(function (prop) {\n        if (instance[prop] === undefined) {\n          result.addError({\n            // FIXME there's two different \"dependencies\" errors here with slightly different outputs\n            // Can we make these the same? Or should we create different error types?\n            name: 'dependencies',\n            argument: childContext.propertyPath,\n            message: \"property \" + prop + \" not found, required by \" + childContext.propertyPath,\n          });\n        }\n      });\n    } else {\n      var res = this.validateSchema(instance, dep, options, childContext);\n      if(result.instance !== res.instance) result.instance = res.instance;\n      if (res && res.errors.length) {\n        result.addError({\n          name: 'dependencies',\n          argument: childContext.propertyPath,\n          message: \"does not meet dependency required by \" + childContext.propertyPath,\n        });\n        result.importErrors(res);\n      }\n    }\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is one of the enumerated values.\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['enum'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema['enum'])) {\n    throw new SchemaError(\"enum expects an array\", schema);\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!schema['enum'].some(helpers.deepCompareStrict.bind(null, instance))) {\n    result.addError({\n      name: 'enum',\n      argument: schema['enum'],\n      message: \"is not one of enum values: \" + schema['enum'].map(String).join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance exactly matches a given value\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['const'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!helpers.deepCompareStrict(schema['const'], instance)) {\n    result.addError({\n      name: 'const',\n      argument: schema['const'],\n      message: \"does not exactly match expected constant: \" + schema['const'],\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance if of a prohibited type.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.not = validators.disallow = function validateNot (instance, schema, options, ctx) {\n  var self = this;\n  if(instance===undefined) return null;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var notTypes = schema.not || schema.disallow;\n  if(!notTypes) return null;\n  if(!Array.isArray(notTypes)) notTypes=[notTypes];\n  notTypes.forEach(function (type) {\n    if (self.testType(instance, schema, options, ctx, type)) {\n      var id = type && (type.$id || type.id);\n      var schemaId = id || type;\n      result.addError({\n        name: 'not',\n        argument: schemaId,\n        message: \"is of prohibited type \" + schemaId,\n      });\n    }\n  });\n  return result;\n};\n\nmodule.exports = attribute;\n","\"use strict\";\n\nvar urilib = require('url');\nvar helpers = require('./helpers');\n\nmodule.exports.SchemaScanResult = SchemaScanResult;\nfunction SchemaScanResult(found, ref){\n  this.id = found;\n  this.ref = ref;\n}\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param string uri\n * @param object schema\n * @return {Object}\n */\nmodule.exports.scan = function scan(base, schema){\n  function scanSchema(baseuri, schema){\n    if(!schema || typeof schema!='object') return;\n    // Mark all referenced schemas so we can tell later which schemas are referred to, but never defined\n    if(schema.$ref){\n      var resolvedUri = urilib.resolve(baseuri, schema.$ref);\n      ref[resolvedUri] = ref[resolvedUri] ? ref[resolvedUri]+1 : 0;\n      return;\n    }\n    var id = schema.$id || schema.id;\n    var ourBase = id ? urilib.resolve(baseuri, id) : baseuri;\n    if (ourBase) {\n      // If there's no fragment, append an empty one\n      if(ourBase.indexOf('#')<0) ourBase += '#';\n      if(found[ourBase]){\n        if(!helpers.deepCompareStrict(found[ourBase], schema)){\n          throw new Error('Schema <'+ourBase+'> already exists with different definition');\n        }\n        return found[ourBase];\n      }\n      found[ourBase] = schema;\n      // strip trailing fragment\n      if(ourBase[ourBase.length-1]=='#'){\n        found[ourBase.substring(0, ourBase.length-1)] = schema;\n      }\n    }\n    scanArray(ourBase+'/items', (Array.isArray(schema.items)?schema.items:[schema.items]));\n    scanArray(ourBase+'/extends', (Array.isArray(schema.extends)?schema.extends:[schema.extends]));\n    scanSchema(ourBase+'/additionalItems', schema.additionalItems);\n    scanObject(ourBase+'/properties', schema.properties);\n    scanSchema(ourBase+'/additionalProperties', schema.additionalProperties);\n    scanObject(ourBase+'/definitions', schema.definitions);\n    scanObject(ourBase+'/patternProperties', schema.patternProperties);\n    scanObject(ourBase+'/dependencies', schema.dependencies);\n    scanArray(ourBase+'/disallow', schema.disallow);\n    scanArray(ourBase+'/allOf', schema.allOf);\n    scanArray(ourBase+'/anyOf', schema.anyOf);\n    scanArray(ourBase+'/oneOf', schema.oneOf);\n    scanSchema(ourBase+'/not', schema.not);\n  }\n  function scanArray(baseuri, schemas){\n    if(!Array.isArray(schemas)) return;\n    for(var i=0; i<schemas.length; i++){\n      scanSchema(baseuri+'/'+i, schemas[i]);\n    }\n  }\n  function scanObject(baseuri, schemas){\n    if(!schemas || typeof schemas!='object') return;\n    for(var p in schemas){\n      scanSchema(baseuri+'/'+p, schemas[p]);\n    }\n  }\n\n  var found = {};\n  var ref = {};\n  scanSchema(base, schema);\n  return new SchemaScanResult(found, ref);\n};\n","'use strict';\n\nvar urilib = require('url');\n\nvar attribute = require('./attribute');\nvar helpers = require('./helpers');\nvar scanSchema = require('./scan').scan;\nvar ValidatorResult = helpers.ValidatorResult;\nvar ValidatorResultError = helpers.ValidatorResultError;\nvar SchemaError = helpers.SchemaError;\nvar SchemaContext = helpers.SchemaContext;\n//var anonymousBase = 'vnd.jsonschema:///';\nvar anonymousBase = '/';\n\n/**\n * Creates a new Validator object\n * @name Validator\n * @constructor\n */\nvar Validator = function Validator () {\n  // Allow a validator instance to override global custom formats or to have their\n  // own custom formats.\n  this.customFormats = Object.create(Validator.prototype.customFormats);\n  this.schemas = {};\n  this.unresolvedRefs = [];\n\n  // Use Object.create to make this extensible without Validator instances stepping on each other's toes.\n  this.types = Object.create(types);\n  this.attributes = Object.create(attribute.validators);\n};\n\n// Allow formats to be registered globally.\nValidator.prototype.customFormats = {};\n\n// Hint at the presence of a property\nValidator.prototype.schemas = null;\nValidator.prototype.types = null;\nValidator.prototype.attributes = null;\nValidator.prototype.unresolvedRefs = null;\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param schema\n * @param urn\n * @return {Object}\n */\nValidator.prototype.addSchema = function addSchema (schema, base) {\n  var self = this;\n  if (!schema) {\n    return null;\n  }\n  var scan = scanSchema(base||anonymousBase, schema);\n  var ourUri = base || schema.$id || schema.id;\n  for(var uri in scan.id){\n    this.schemas[uri] = scan.id[uri];\n  }\n  for(var uri in scan.ref){\n    // If this schema is already defined, it will be filtered out by the next step\n    this.unresolvedRefs.push(uri);\n  }\n  // Remove newly defined schemas from unresolvedRefs\n  this.unresolvedRefs = this.unresolvedRefs.filter(function(uri){\n    return typeof self.schemas[uri]==='undefined';\n  });\n  return this.schemas[ourUri];\n};\n\nValidator.prototype.addSubSchemaArray = function addSubSchemaArray(baseuri, schemas) {\n  if(!Array.isArray(schemas)) return;\n  for(var i=0; i<schemas.length; i++){\n    this.addSubSchema(baseuri, schemas[i]);\n  }\n};\n\nValidator.prototype.addSubSchemaObject = function addSubSchemaArray(baseuri, schemas) {\n  if(!schemas || typeof schemas!='object') return;\n  for(var p in schemas){\n    this.addSubSchema(baseuri, schemas[p]);\n  }\n};\n\n\n\n/**\n * Sets all the schemas of the Validator instance.\n * @param schemas\n */\nValidator.prototype.setSchemas = function setSchemas (schemas) {\n  this.schemas = schemas;\n};\n\n/**\n * Returns the schema of a certain urn\n * @param urn\n */\nValidator.prototype.getSchema = function getSchema (urn) {\n  return this.schemas[urn];\n};\n\n/**\n * Validates instance against the provided schema\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {Array}\n */\nValidator.prototype.validate = function validate (instance, schema, options, ctx) {\n  if((typeof schema !== 'boolean' && typeof schema !== 'object') || schema === null){\n    throw new SchemaError('Expected `schema` to be an object or boolean');\n  }\n  if (!options) {\n    options = {};\n  }\n  // This section indexes subschemas in the provided schema, so they don't need to be added with Validator#addSchema\n  // This will work so long as the function at uri.resolve() will resolve a relative URI to a relative URI\n  var id = schema.$id || schema.id;\n  var base = urilib.resolve(options.base||anonymousBase, id||'');\n  if(!ctx){\n    ctx = new SchemaContext(schema, options, [], base, Object.create(this.schemas));\n    if (!ctx.schemas[base]) {\n      ctx.schemas[base] = schema;\n    }\n    var found = scanSchema(base, schema);\n    for(var n in found.id){\n      var sch = found.id[n];\n      ctx.schemas[n] = sch;\n    }\n  }\n  if(options.required && instance===undefined){\n    var result = new ValidatorResult(instance, schema, options, ctx);\n    result.addError('is required, but is undefined');\n    return result;\n  }\n  var result = this.validateSchema(instance, schema, options, ctx);\n  if (!result) {\n    throw new Error('Result undefined');\n  }else if(options.throwAll && result.errors.length){\n    throw new ValidatorResultError(result);\n  }\n  return result;\n};\n\n/**\n* @param Object schema\n* @return mixed schema uri or false\n*/\nfunction shouldResolve(schema) {\n  var ref = (typeof schema === 'string') ? schema : schema.$ref;\n  if (typeof ref=='string') return ref;\n  return false;\n}\n\n/**\n * Validates an instance against the schema (the actual work horse)\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @private\n * @return {ValidatorResult}\n */\nValidator.prototype.validateSchema = function validateSchema (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n  // Support for the true/false schemas\n  if(typeof schema==='boolean') {\n    if(schema===true){\n      // `true` is always valid\n      schema = {};\n    }else if(schema===false){\n      // `false` is always invalid\n      schema = {type: []};\n    }\n  }else if(!schema){\n    // This might be a string\n    throw new Error(\"schema is undefined\");\n  }\n\n  if (schema['extends']) {\n    if (Array.isArray(schema['extends'])) {\n      var schemaobj = {schema: schema, ctx: ctx};\n      schema['extends'].forEach(this.schemaTraverser.bind(this, schemaobj));\n      schema = schemaobj.schema;\n      schemaobj.schema = null;\n      schemaobj.ctx = null;\n      schemaobj = null;\n    } else {\n      schema = helpers.deepMerge(schema, this.superResolve(schema['extends'], ctx));\n    }\n  }\n\n  // If passed a string argument, load that schema URI\n  var switchSchema = shouldResolve(schema);\n  if (switchSchema) {\n    var resolved = this.resolve(schema, switchSchema, ctx);\n    var subctx = new SchemaContext(resolved.subschema, options, ctx.path, resolved.switchSchema, ctx.schemas);\n    return this.validateSchema(instance, resolved.subschema, options, subctx);\n  }\n\n  var skipAttributes = options && options.skipAttributes || [];\n  // Validate each schema attribute against the instance\n  for (var key in schema) {\n    if (!attribute.ignoreProperties[key] && skipAttributes.indexOf(key) < 0) {\n      var validatorErr = null;\n      var validator = this.attributes[key];\n      if (validator) {\n        validatorErr = validator.call(this, instance, schema, options, ctx);\n      } else if (options.allowUnknownAttributes === false) {\n        // This represents an error with the schema itself, not an invalid instance\n        throw new SchemaError(\"Unsupported attribute: \" + key, schema);\n      }\n      if (validatorErr) {\n        result.importErrors(validatorErr);\n      }\n    }\n  }\n\n  if (typeof options.rewrite == 'function') {\n    var value = options.rewrite.call(this, instance, schema, options, ctx);\n    result.instance = value;\n  }\n  return result;\n};\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.schemaTraverser = function schemaTraverser (schemaobj, s) {\n  schemaobj.schema = helpers.deepMerge(schemaobj.schema, this.superResolve(s, schemaobj.ctx));\n};\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.superResolve = function superResolve (schema, ctx) {\n  var ref = shouldResolve(schema);\n  if(ref) {\n    return this.resolve(schema, ref, ctx).subschema;\n  }\n  return schema;\n};\n\n/**\n* @private\n* @param Object schema\n* @param Object switchSchema\n* @param SchemaContext ctx\n* @return Object resolved schemas {subschema:String, switchSchema: String}\n* @throws SchemaError\n*/\nValidator.prototype.resolve = function resolve (schema, switchSchema, ctx) {\n  switchSchema = ctx.resolve(switchSchema);\n  // First see if the schema exists under the provided URI\n  if (ctx.schemas[switchSchema]) {\n    return {subschema: ctx.schemas[switchSchema], switchSchema: switchSchema};\n  }\n  // Else try walking the property pointer\n  var parsed = urilib.parse(switchSchema);\n  var fragment = parsed && parsed.hash;\n  var document = fragment && fragment.length && switchSchema.substr(0, switchSchema.length - fragment.length);\n  if (!document || !ctx.schemas[document]) {\n    throw new SchemaError(\"no such schema <\" + switchSchema + \">\", schema);\n  }\n  var subschema = helpers.objectGetPath(ctx.schemas[document], fragment.substr(1));\n  if(subschema===undefined){\n    throw new SchemaError(\"no such schema \" + fragment + \" located in <\" + document + \">\", schema);\n  }\n  return {subschema: subschema, switchSchema: switchSchema};\n};\n\n/**\n * Tests whether the instance if of a certain type.\n * @private\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @param type\n * @return {boolean}\n */\nValidator.prototype.testType = function validateType (instance, schema, options, ctx, type) {\n  if(type===undefined){\n    return;\n  }else if(type===null){\n    throw new SchemaError('Unexpected null in \"type\" keyword');\n  }\n  if (typeof this.types[type] == 'function') {\n    return this.types[type].call(this, instance);\n  }\n  if (type && typeof type == 'object') {\n    var res = this.validateSchema(instance, type, options, ctx);\n    return res === undefined || !(res && res.errors.length);\n  }\n  // Undefined or properties not on the list are acceptable, same as not being defined\n  return true;\n};\n\nvar types = Validator.prototype.types = {};\ntypes.string = function testString (instance) {\n  return typeof instance == 'string';\n};\ntypes.number = function testNumber (instance) {\n  // isFinite returns false for NaN, Infinity, and -Infinity\n  return typeof instance == 'number' && isFinite(instance);\n};\ntypes.integer = function testInteger (instance) {\n  return (typeof instance == 'number') && instance % 1 === 0;\n};\ntypes.boolean = function testBoolean (instance) {\n  return typeof instance == 'boolean';\n};\ntypes.array = function testArray (instance) {\n  return Array.isArray(instance);\n};\ntypes['null'] = function testNull (instance) {\n  return instance === null;\n};\ntypes.date = function testDate (instance) {\n  return instance instanceof Date;\n};\ntypes.any = function testAny (instance) {\n  return true;\n};\ntypes.object = function testObject (instance) {\n  // TODO: fix this - see #15\n  return instance && (typeof instance === 'object') && !(Array.isArray(instance)) && !(instance instanceof Date);\n};\n\nmodule.exports = Validator;\n","'use strict';\n\nvar Validator = module.exports.Validator = require('./validator');\n\nmodule.exports.ValidatorResult = require('./helpers').ValidatorResult;\nmodule.exports.ValidatorResultError = require('./helpers').ValidatorResultError;\nmodule.exports.ValidationError = require('./helpers').ValidationError;\nmodule.exports.SchemaError = require('./helpers').SchemaError;\nmodule.exports.SchemaScanResult = require('./scan').SchemaScanResult;\nmodule.exports.scan = require('./scan').scan;\n\nmodule.exports.validate = function (instance, schema, options) {\n  var v = new Validator();\n  return v.validate(instance, schema, options);\n};\n","module.exports = require(\"regenerator-runtime\");\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nmodule.exports = _asyncToGenerator;","import _classCallCheck from '@babel/runtime/helpers/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/createClass';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport _inherits from '@babel/runtime/helpers/inherits';\nimport _possibleConstructorReturn from '@babel/runtime/helpers/possibleConstructorReturn';\nimport _getPrototypeOf from '@babel/runtime/helpers/getPrototypeOf';\nimport _wrapNativeSuper from '@babel/runtime/helpers/wrapNativeSuper';\nimport _classPrivateFieldSet from '@babel/runtime/helpers/classPrivateFieldSet';\nimport _classPrivateFieldGet from '@babel/runtime/helpers/classPrivateFieldGet';\nimport _slicedToArray from '@babel/runtime/helpers/slicedToArray';\nimport _toConsumableArray from '@babel/runtime/helpers/toConsumableArray';\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _get from '@babel/runtime/helpers/get';\nimport { Validator } from 'jsonschema';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _objectWithoutProperties from '@babel/runtime/helpers/objectWithoutProperties';\n\nvar ElementColor = {\n  H: '#000000',\n  He: '#89a1a1',\n  Li: '#bd77ed',\n  Be: '#8fbc00',\n  B: '#c18989',\n  C: '#000000',\n  N: '#304ff7',\n  O: '#ff0d0d',\n  F: '#78bc42',\n  Ne: '#80a2af',\n  Na: '#ab5cf2',\n  Mg: '#6fcd00',\n  Al: '#a99393',\n  Si: '#b29478',\n  P: '#ff8000',\n  S: '#c99a19',\n  Cl: '#1fd01f',\n  Ar: '#69acba',\n  K: '#8f40d4',\n  Ca: '#38e900',\n  Sc: '#999999',\n  Ti: '#979a9e',\n  V: '#99999e',\n  Cr: '#8a99c7',\n  Mn: '#9c7ac7',\n  Fe: '#e06633',\n  Co: '#d37e8e',\n  Ni: '#4ece4e',\n  Cu: '#c78033',\n  Zn: '#7d80b0',\n  Ga: '#bc8b8b',\n  Ge: '#668f8f',\n  As: '#b87ddd',\n  Se: '#e59100',\n  Br: '#a62929',\n  Kr: '#59b1c9',\n  Rb: '#702eb0',\n  Sr: '#00ff00',\n  Y: '#66afaf',\n  Zr: '#71abab',\n  Nb: '#67aeb4',\n  Mo: '#54b5b5',\n  Tc: '#3b9e9e',\n  Ru: '#248f8f',\n  Rh: '#0a7d8c',\n  Pd: '#006985',\n  Ag: '#9a9a9a',\n  Cd: '#b29764',\n  In: '#a67573',\n  Sn: '#668080',\n  Sb: '#9e63b5',\n  Te: '#d47a00',\n  I: '#940094',\n  Xe: '#429eb0',\n  Cs: '#57178f',\n  Ba: '#00c900',\n  La: '#5caed1',\n  Ce: '#9d9d7b',\n  Pr: '#8ca581',\n  Nd: '#84a984',\n  Pm: '#71b18a',\n  Sm: '#66b68e',\n  Eu: '#4ac298',\n  Gd: '#37cb9e',\n  Tb: '#28d1a4',\n  Dy: '#1bd7a8',\n  Ho: '#00e98f',\n  Er: '#00e675',\n  Tm: '#00d452',\n  Yb: '#00bf38',\n  Lu: '#00ab24',\n  Hf: '#47b3ec',\n  Ta: '#4da6ff',\n  W: '#2194d6',\n  Re: '#267dab',\n  Os: '#266696',\n  Ir: '#175487',\n  Pt: '#9898a3',\n  Au: '#c19e1c',\n  Hg: '#9797ac',\n  Tl: '#a6544d',\n  Pb: '#575961',\n  Bi: '#9e4fb5',\n  Po: '#ab5c00',\n  At: '#754f45',\n  Rn: '#428296',\n  Fr: '#420066',\n  Ra: '#007d00',\n  Ac: '#6aa2ec',\n  Th: '#00baff',\n  Pa: '#00a1ff',\n  U: '#008fff',\n  Np: '#0080ff',\n  Pu: '#006bff',\n  Am: '#545cf2',\n  Cm: '#785ce3',\n  Bk: '#8a4fe3',\n  Cf: '#a136d4',\n  Es: '#b31fd4',\n  Fm: '#000000',\n  Md: '#000000',\n  No: '#000000',\n  Lr: '#000000',\n  Rf: '#47b3ec',\n  Db: '#4da6ff',\n  Sg: '#2194d6',\n  Bh: '#267dab',\n  Hs: '#266696',\n  Mt: '#175487',\n  Ds: '#9898a3',\n  Rg: '#c19e1c',\n  Cn: '#9797ac',\n  Nh: '#000000',\n  Fl: '#000000',\n  Mc: '#000000',\n  Lv: '#000000',\n  Ts: '#000000',\n  Og: '#000000'\n};\n\nvar elementsArray = [{\n  number: 1,\n  label: 'H',\n  period: 1,\n  group: 1,\n  title: 'Hydrogen',\n  state: 'gas',\n  origin: 'primordial',\n  type: 'diatomic',\n  mass: 1.00794\n}, {\n  number: 2,\n  label: 'He',\n  period: 1,\n  group: 8,\n  title: 'Helium',\n  state: 'gas',\n  origin: 'primordial',\n  type: 'noble',\n  mass: 4.0026022\n}, {\n  number: 3,\n  label: 'Li',\n  period: 2,\n  group: 1,\n  title: 'Lithium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'alkali',\n  mass: 6.94\n}, {\n  number: 4,\n  label: 'Be',\n  period: 2,\n  group: 2,\n  title: 'Beryllium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'alkaline-earth',\n  mass: 9.01218315\n}, {\n  number: 5,\n  label: 'B',\n  period: 2,\n  group: 3,\n  title: 'Boron',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'metalloid',\n  mass: 10.81\n}, {\n  number: 6,\n  label: 'C',\n  period: 2,\n  group: 4,\n  title: 'Carbon',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'polyatomic',\n  mass: 12.011\n}, {\n  number: 7,\n  label: 'N',\n  period: 2,\n  group: 5,\n  title: 'Nitrogen',\n  state: 'gas',\n  origin: 'primordial',\n  type: 'diatomic',\n  mass: 14.007\n}, {\n  number: 8,\n  label: 'O',\n  period: 2,\n  group: 6,\n  leftH: true,\n  title: 'Oxygen',\n  state: 'gas',\n  origin: 'primordial',\n  type: 'diatomic',\n  mass: 15.999\n}, {\n  number: 9,\n  label: 'F',\n  period: 2,\n  group: 7,\n  leftH: true,\n  title: 'Fluorine',\n  state: 'gas',\n  origin: 'primordial',\n  type: 'diatomic',\n  mass: 18.9984031636\n}, {\n  number: 10,\n  label: 'Ne',\n  period: 2,\n  group: 8,\n  title: 'Neon',\n  state: 'gas',\n  origin: 'primordial',\n  type: 'noble',\n  mass: 20.17976\n}, {\n  number: 11,\n  label: 'Na',\n  period: 3,\n  group: 1,\n  title: 'Sodium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'alkali',\n  mass: 22.989769282\n}, {\n  number: 12,\n  label: 'Mg',\n  period: 3,\n  group: 2,\n  title: 'Magnesium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'alkaline-earth',\n  mass: 24.305\n}, {\n  number: 13,\n  label: 'Al',\n  period: 3,\n  group: 3,\n  title: 'Aluminium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'post-transition',\n  mass: 26.98153857\n}, {\n  number: 14,\n  label: 'Si',\n  period: 3,\n  group: 4,\n  title: 'Silicon',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'metalloid',\n  mass: 28.085\n}, {\n  number: 15,\n  label: 'P',\n  period: 3,\n  group: 5,\n  title: 'Phosphorus',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'polyatomic',\n  mass: 30.9737619985\n}, {\n  number: 16,\n  label: 'S',\n  period: 3,\n  group: 6,\n  leftH: true,\n  title: 'Sulfur',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'polyatomic',\n  mass: 32.06\n}, {\n  number: 17,\n  label: 'Cl',\n  period: 3,\n  group: 7,\n  leftH: true,\n  title: 'Chlorine',\n  state: 'gas',\n  origin: 'primordial',\n  type: 'diatomic',\n  mass: 35.45\n}, {\n  number: 18,\n  label: 'Ar',\n  period: 3,\n  group: 8,\n  title: 'Argon',\n  state: 'gas',\n  origin: 'primordial',\n  type: 'noble',\n  mass: 39.9481\n}, {\n  number: 19,\n  label: 'K',\n  period: 4,\n  group: 1,\n  title: 'Potassium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'alkali',\n  mass: 39.09831\n}, {\n  number: 20,\n  label: 'Ca',\n  period: 4,\n  group: 2,\n  title: 'Calcium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'alkaline-earth',\n  mass: 40.0784\n}, {\n  number: 21,\n  label: 'Sc',\n  period: 4,\n  group: 3,\n  title: 'Scandium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 44.9559085\n}, {\n  number: 22,\n  label: 'Ti',\n  period: 4,\n  group: 4,\n  title: 'Titanium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 47.8671\n}, {\n  number: 23,\n  label: 'V',\n  period: 4,\n  group: 5,\n  title: 'Vanadium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 50.94151\n}, {\n  number: 24,\n  label: 'Cr',\n  period: 4,\n  group: 6,\n  title: 'Chromium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 51.99616\n}, {\n  number: 25,\n  label: 'Mn',\n  period: 4,\n  group: 7,\n  title: 'Manganese',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 54.9380443\n}, {\n  number: 26,\n  label: 'Fe',\n  period: 4,\n  group: 8,\n  title: 'Iron',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 55.8452\n}, {\n  number: 27,\n  label: 'Co',\n  period: 4,\n  group: 8,\n  title: 'Cobalt',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 58.9331944\n}, {\n  number: 28,\n  label: 'Ni',\n  period: 4,\n  group: 8,\n  title: 'Nickel',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 58.69344\n}, {\n  number: 29,\n  label: 'Cu',\n  period: 4,\n  group: 1,\n  title: 'Copper',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 63.5463\n}, {\n  number: 30,\n  label: 'Zn',\n  period: 4,\n  group: 2,\n  title: 'Zinc',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 65.382\n}, {\n  number: 31,\n  label: 'Ga',\n  period: 4,\n  group: 3,\n  title: 'Gallium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'post-transition',\n  mass: 69.7231\n}, {\n  number: 32,\n  label: 'Ge',\n  period: 4,\n  group: 4,\n  title: 'Germanium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'metalloid',\n  mass: 72.6308\n}, {\n  number: 33,\n  label: 'As',\n  period: 4,\n  group: 5,\n  title: 'Arsenic',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'metalloid',\n  mass: 74.9215956\n}, {\n  number: 34,\n  label: 'Se',\n  period: 4,\n  group: 6,\n  leftH: true,\n  title: 'Selenium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'polyatomic',\n  mass: 78.9718\n}, {\n  number: 35,\n  label: 'Br',\n  period: 4,\n  group: 7,\n  leftH: true,\n  title: 'Bromine',\n  state: 'liquid',\n  origin: 'primordial',\n  type: 'diatomic',\n  mass: 79.904\n}, {\n  number: 36,\n  label: 'Kr',\n  period: 4,\n  group: 8,\n  title: 'Krypton',\n  state: 'gas',\n  origin: 'primordial',\n  type: 'noble',\n  mass: 83.7982\n}, {\n  number: 37,\n  label: 'Rb',\n  period: 5,\n  group: 1,\n  title: 'Rubidium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'alkali',\n  mass: 85.46783\n}, {\n  number: 38,\n  label: 'Sr',\n  period: 5,\n  group: 2,\n  title: 'Strontium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'alkaline-earth',\n  mass: 87.621\n}, {\n  number: 39,\n  label: 'Y',\n  period: 5,\n  group: 3,\n  title: 'Yttrium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 88.905842\n}, {\n  number: 40,\n  label: 'Zr',\n  period: 5,\n  group: 4,\n  title: 'Zirconium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 91.2242\n}, {\n  number: 41,\n  label: 'Nb',\n  period: 5,\n  group: 5,\n  title: 'Niobium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 92.906372\n}, {\n  number: 42,\n  label: 'Mo',\n  period: 5,\n  group: 6,\n  title: 'Molybdenum',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 95.951\n}, {\n  number: 43,\n  label: 'Tc',\n  period: 5,\n  group: 7,\n  title: 'Technetium',\n  state: 'solid',\n  origin: 'decay',\n  type: 'transition',\n  mass: 98\n}, {\n  number: 44,\n  label: 'Ru',\n  period: 5,\n  group: 8,\n  title: 'Ruthenium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 101.072\n}, {\n  number: 45,\n  label: 'Rh',\n  period: 5,\n  group: 8,\n  title: 'Rhodium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 102.905502\n}, {\n  number: 46,\n  label: 'Pd',\n  period: 5,\n  group: 8,\n  title: 'Palladium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 106.421\n}, {\n  number: 47,\n  label: 'Ag',\n  period: 5,\n  group: 1,\n  title: 'Silver',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 107.86822\n}, {\n  number: 48,\n  label: 'Cd',\n  period: 5,\n  group: 2,\n  title: 'Cadmium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 112.4144\n}, {\n  number: 49,\n  label: 'In',\n  period: 5,\n  group: 3,\n  title: 'Indium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'post-transition',\n  mass: 114.8181\n}, {\n  number: 50,\n  label: 'Sn',\n  period: 5,\n  group: 4,\n  title: 'Tin',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'post-transition',\n  mass: 118.7107\n}, {\n  number: 51,\n  label: 'Sb',\n  period: 5,\n  group: 5,\n  title: 'Antimony',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'metalloid',\n  mass: 121.7601\n}, {\n  number: 52,\n  label: 'Te',\n  period: 5,\n  group: 6,\n  title: 'Tellurium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'metalloid',\n  mass: 127.603\n}, {\n  number: 53,\n  label: 'I',\n  period: 5,\n  group: 7,\n  leftH: true,\n  title: 'Iodine',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'diatomic',\n  mass: 126.904473\n}, {\n  number: 54,\n  label: 'Xe',\n  period: 5,\n  group: 8,\n  title: 'Xenon',\n  state: 'gas',\n  origin: 'primordial',\n  type: 'noble',\n  mass: 131.2936\n}, {\n  number: 55,\n  label: 'Cs',\n  period: 6,\n  group: 1,\n  title: 'Caesium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'alkali',\n  mass: 132.905451966\n}, {\n  number: 56,\n  label: 'Ba',\n  period: 6,\n  group: 2,\n  title: 'Barium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'alkaline-earth',\n  mass: 137.3277\n}, {\n  number: 57,\n  label: 'La',\n  period: 6,\n  group: 3,\n  title: 'Lanthanum',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 138.905477\n}, {\n  number: 58,\n  label: 'Ce',\n  period: 6,\n  group: 3,\n  title: 'Cerium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 140.1161\n}, {\n  number: 59,\n  label: 'Pr',\n  period: 6,\n  group: 3,\n  title: 'Praseodymium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 140.907662\n}, {\n  number: 60,\n  label: 'Nd',\n  period: 6,\n  group: 3,\n  title: 'Neodymium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 144.2423\n}, {\n  number: 61,\n  label: 'Pm',\n  period: 6,\n  group: 3,\n  title: 'Promethium',\n  state: 'solid',\n  origin: 'decay',\n  type: 'lanthanide',\n  mass: 145\n}, {\n  number: 62,\n  label: 'Sm',\n  period: 6,\n  group: 3,\n  title: 'Samarium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 150.362\n}, {\n  number: 63,\n  label: 'Eu',\n  period: 6,\n  group: 3,\n  title: 'Europium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 151.9641\n}, {\n  number: 64,\n  label: 'Gd',\n  period: 6,\n  group: 3,\n  title: 'Gadolinium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 157.253\n}, {\n  number: 65,\n  label: 'Tb',\n  period: 6,\n  group: 3,\n  title: 'Terbium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 158.925352\n}, {\n  number: 66,\n  label: 'Dy',\n  period: 6,\n  group: 3,\n  title: 'Dysprosium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 162.5001\n}, {\n  number: 67,\n  label: 'Ho',\n  period: 6,\n  group: 3,\n  title: 'Holmium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 164.930332\n}, {\n  number: 68,\n  label: 'Er',\n  period: 6,\n  group: 3,\n  title: 'Erbium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 167.2593\n}, {\n  number: 69,\n  label: 'Tm',\n  period: 6,\n  group: 3,\n  title: 'Thulium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 168.934222\n}, {\n  number: 70,\n  label: 'Yb',\n  period: 6,\n  group: 3,\n  title: 'Ytterbium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 173.0451\n}, {\n  number: 71,\n  label: 'Lu',\n  period: 6,\n  group: 3,\n  title: 'Lutetium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'lanthanide',\n  mass: 174.96681\n}, {\n  number: 72,\n  label: 'Hf',\n  period: 6,\n  group: 4,\n  title: 'Hafnium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 178.492\n}, {\n  number: 73,\n  label: 'Ta',\n  period: 6,\n  group: 5,\n  title: 'Tantalum',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 180.947882\n}, {\n  number: 74,\n  label: 'W',\n  period: 6,\n  group: 6,\n  title: 'Tungsten',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 183.841\n}, {\n  number: 75,\n  label: 'Re',\n  period: 6,\n  group: 7,\n  title: 'Rhenium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 186.2071\n}, {\n  number: 76,\n  label: 'Os',\n  period: 6,\n  group: 8,\n  title: 'Osmium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 190.233\n}, {\n  number: 77,\n  label: 'Ir',\n  period: 6,\n  group: 8,\n  title: 'Iridium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 192.2173\n}, {\n  number: 78,\n  label: 'Pt',\n  period: 6,\n  group: 8,\n  title: 'Platinum',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 195.0849\n}, {\n  number: 79,\n  label: 'Au',\n  period: 6,\n  group: 1,\n  title: 'Gold',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 196.9665695\n}, {\n  number: 80,\n  label: 'Hg',\n  period: 6,\n  group: 2,\n  title: 'Mercury',\n  state: 'liquid',\n  origin: 'primordial',\n  type: 'transition',\n  mass: 200.5923\n}, {\n  number: 81,\n  label: 'Tl',\n  period: 6,\n  group: 3,\n  title: 'Thallium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'post-transition',\n  mass: 204.38\n}, {\n  number: 82,\n  label: 'Pb',\n  period: 6,\n  group: 4,\n  title: 'Lead',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'post-transition',\n  mass: 207.21\n}, {\n  number: 83,\n  label: 'Bi',\n  period: 6,\n  group: 5,\n  title: 'Bismuth',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'post-transition',\n  mass: 208.980401\n}, {\n  number: 84,\n  label: 'Po',\n  period: 6,\n  group: 6,\n  title: 'Polonium',\n  state: 'solid',\n  origin: 'decay',\n  type: 'post-transition',\n  mass: 209\n}, {\n  number: 85,\n  label: 'At',\n  period: 6,\n  group: 7,\n  title: 'Astatine',\n  state: 'solid',\n  origin: 'decay',\n  type: 'metalloid',\n  mass: 210\n}, {\n  number: 86,\n  label: 'Rn',\n  period: 6,\n  group: 8,\n  title: 'Radon',\n  state: 'gas',\n  origin: 'decay',\n  type: 'noble',\n  mass: 222\n}, {\n  number: 87,\n  label: 'Fr',\n  period: 7,\n  group: 1,\n  title: 'Francium',\n  state: 'solid',\n  origin: 'decay',\n  type: 'alkali',\n  mass: 223\n}, {\n  number: 88,\n  label: 'Ra',\n  period: 7,\n  group: 2,\n  title: 'Radium',\n  state: 'solid',\n  origin: 'decay',\n  type: 'alkaline-earth',\n  mass: 226\n}, {\n  number: 89,\n  label: 'Ac',\n  period: 7,\n  group: 3,\n  title: 'Actinium',\n  state: 'solid',\n  origin: 'decay',\n  type: 'actinide',\n  mass: 227\n}, {\n  number: 90,\n  label: 'Th',\n  period: 7,\n  group: 3,\n  title: 'Thorium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'actinide',\n  mass: 232.03774\n}, {\n  number: 91,\n  label: 'Pa',\n  period: 7,\n  group: 3,\n  title: 'Protactinium',\n  state: 'solid',\n  origin: 'decay',\n  type: 'actinide',\n  mass: 231.035882\n}, {\n  number: 92,\n  label: 'U',\n  period: 7,\n  group: 3,\n  title: 'Uranium',\n  state: 'solid',\n  origin: 'primordial',\n  type: 'actinide',\n  mass: 238.028913\n}, {\n  number: 93,\n  label: 'Np',\n  period: 7,\n  group: 3,\n  title: 'Neptunium',\n  state: 'solid',\n  origin: 'decay',\n  type: 'actinide',\n  mass: 237\n}, {\n  number: 94,\n  label: 'Pu',\n  period: 7,\n  group: 3,\n  title: 'Plutonium',\n  state: 'solid',\n  origin: 'decay',\n  type: 'actinide',\n  mass: 244\n}, {\n  number: 95,\n  label: 'Am',\n  period: 7,\n  group: 3,\n  title: 'Americium',\n  state: 'solid',\n  origin: 'synthetic',\n  type: 'actinide',\n  mass: 243\n}, {\n  number: 96,\n  label: 'Cm',\n  period: 7,\n  group: 3,\n  title: 'Curium',\n  state: 'solid',\n  origin: 'synthetic',\n  type: 'actinide',\n  mass: 247\n}, {\n  number: 97,\n  label: 'Bk',\n  period: 7,\n  group: 3,\n  title: 'Berkelium',\n  state: 'solid',\n  origin: 'synthetic',\n  type: 'actinide',\n  mass: 247\n}, {\n  number: 98,\n  label: 'Cf',\n  period: 7,\n  group: 3,\n  title: 'Californium',\n  state: 'solid',\n  origin: 'synthetic',\n  type: 'actinide',\n  mass: 251\n}, {\n  number: 99,\n  label: 'Es',\n  period: 7,\n  group: 3,\n  title: 'Einsteinium',\n  state: 'solid',\n  origin: 'synthetic',\n  type: 'actinide',\n  mass: 252\n}, {\n  number: 100,\n  label: 'Fm',\n  period: 7,\n  group: 3,\n  title: 'Fermium',\n  origin: 'synthetic',\n  type: 'actinide',\n  mass: 257\n}, {\n  number: 101,\n  label: 'Md',\n  period: 7,\n  group: 3,\n  title: 'Mendelevium',\n  origin: 'synthetic',\n  type: 'actinide',\n  mass: 258\n}, {\n  number: 102,\n  label: 'No',\n  period: 7,\n  group: 3,\n  title: 'Nobelium',\n  origin: 'synthetic',\n  type: 'actinide',\n  mass: 259\n}, {\n  number: 103,\n  label: 'Lr',\n  period: 7,\n  group: 3,\n  title: 'Lawrencium',\n  origin: 'synthetic',\n  type: 'actinide',\n  mass: 266\n}, {\n  number: 104,\n  label: 'Rf',\n  period: 7,\n  group: 4,\n  title: 'Rutherfordium',\n  origin: 'synthetic',\n  type: 'transition',\n  mass: 267\n}, {\n  number: 105,\n  label: 'Db',\n  period: 7,\n  group: 5,\n  title: 'Dubnium',\n  origin: 'synthetic',\n  type: 'transition',\n  mass: 268\n}, {\n  number: 106,\n  label: 'Sg',\n  period: 7,\n  group: 6,\n  title: 'Seaborgium',\n  origin: 'synthetic',\n  type: 'transition',\n  mass: 269\n}, {\n  number: 107,\n  label: 'Bh',\n  period: 7,\n  group: 7,\n  title: 'Bohrium',\n  origin: 'synthetic',\n  type: 'transition',\n  mass: 270\n}, {\n  number: 108,\n  label: 'Hs',\n  period: 7,\n  group: 8,\n  title: 'Hassium',\n  origin: 'synthetic',\n  type: 'transition',\n  mass: 269\n}, {\n  number: 109,\n  label: 'Mt',\n  period: 7,\n  group: 8,\n  title: 'Meitnerium',\n  origin: 'synthetic',\n  mass: 278\n}, {\n  number: 110,\n  label: 'Ds',\n  period: 7,\n  group: 8,\n  title: 'Darmstadtium',\n  origin: 'synthetic',\n  mass: 281\n}, {\n  number: 111,\n  label: 'Rg',\n  period: 7,\n  group: 1,\n  title: 'Roentgenium',\n  origin: 'synthetic',\n  mass: 282\n}, {\n  number: 112,\n  label: 'Cn',\n  period: 7,\n  group: 2,\n  title: 'Copernicium',\n  origin: 'synthetic',\n  type: 'transition',\n  mass: 285\n}, {\n  number: 113,\n  label: 'Nh',\n  period: 7,\n  group: 3,\n  title: 'Nihonium',\n  origin: 'synthetic',\n  mass: 286\n}, {\n  number: 114,\n  label: 'Fl',\n  period: 7,\n  group: 4,\n  title: 'Flerovium',\n  origin: 'synthetic',\n  type: 'post-transition',\n  mass: 289\n}, {\n  number: 115,\n  label: 'Mc',\n  period: 7,\n  group: 5,\n  title: 'Moscovium',\n  origin: 'synthetic',\n  mass: 289\n}, {\n  number: 116,\n  label: 'Lv',\n  period: 7,\n  group: 6,\n  title: 'Livermorium',\n  origin: 'synthetic',\n  mass: 293\n}, {\n  number: 117,\n  label: 'Ts',\n  period: 7,\n  group: 7,\n  title: 'Tennessine',\n  origin: 'synthetic',\n  mass: 294\n}, {\n  number: 118,\n  label: 'Og',\n  period: 7,\n  group: 8,\n  title: 'Oganesson',\n  origin: 'synthetic',\n  mass: 294\n}];\nvar elementsMap = elementsArray.reduce(function (acc, element) {\n  acc.set(element.label, element);\n  acc.set(element.number, element);\n  return acc;\n}, new Map());\nvar Elements = {\n  get: function get(key) {\n    return elementsMap.get(key);\n  },\n  filter: function filter(predicate) {\n    return elementsArray.filter(predicate);\n  }\n};\n\nvar Generics = {\n  atom: {\n    any: {\n      labels: ['A', 'AH']\n    },\n    'no-carbon': {\n      labels: ['Q', 'QH']\n    },\n    metal: {\n      labels: ['M', 'MH']\n    },\n    halogen: {\n      labels: ['X', 'XH']\n    }\n  },\n  group: {\n    labels: ['G', 'GH', 'G*', 'GH*'],\n    acyclic: {\n      labels: ['ACY', 'ACH'],\n      carbo: {\n        labels: ['ABC', 'ABH'],\n        alkynyl: {\n          labels: ['AYL', 'AYH']\n        },\n        alkyl: {\n          labels: ['ALK', 'ALH']\n        },\n        alkenyl: {\n          labels: ['AEL', 'AEH']\n        }\n      },\n      hetero: {\n        labels: ['AHC', 'AHH'],\n        alkoxy: {\n          labels: ['AOX', 'AOH']\n        }\n      }\n    },\n    cyclic: {\n      labels: ['CYC', 'CYH'],\n      'no-carbon': {\n        labels: ['CXX', 'CXH']\n      },\n      carbo: {\n        labels: ['CBC', 'CBH'],\n        aryl: {\n          labels: ['ARY', 'ARH']\n        },\n        cycloalkyl: {\n          labels: ['CAL', 'CAH']\n        },\n        cycloalkenyl: {\n          labels: ['CEL', 'CEH']\n        }\n      },\n      hetero: {\n        labels: ['CHC', 'CHH'],\n        aryl: {\n          labels: ['HAR', 'HAH']\n        }\n      }\n    }\n  },\n  special: {\n    labels: ['H+', 'D', 'T', 'R', 'Pol']\n  }\n};\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\nvar AtomList = function () {\n  function AtomList(params) {\n    _classCallCheck(this, AtomList);\n    _defineProperty(this, \"notList\", void 0);\n    _defineProperty(this, \"ids\", void 0);\n    this.notList = params.notList;\n    this.ids = params.ids;\n  }\n  _createClass(AtomList, [{\n    key: \"labelList\",\n    value: function labelList() {\n      var labels = [];\n      var _iterator = _createForOfIteratorHelper(this.ids),\n          _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var id = _step.value;\n          var currenElement = Elements.get(id);\n          currenElement && labels.push(currenElement.label);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      return labels;\n    }\n  }, {\n    key: \"label\",\n    value: function label() {\n      var label = '[' + this.labelList().join(',') + ']';\n      if (this.notList) {\n        label = '!' + label;\n      }\n      return label;\n    }\n  }, {\n    key: \"equals\",\n    value: function equals(atomList) {\n      return this.notList === atomList.notList && (this.ids || []).sort().toString() === (atomList.ids || []).sort().toString();\n    }\n  }]);\n  return AtomList;\n}();\n\nfunction _createForOfIteratorHelper$1(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray$1(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray$1(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray$1(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray$1(o, minLen); }\nfunction _arrayLikeToArray$1(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\nvar Pile = function (_Set) {\n  _inherits(Pile, _Set);\n  var _super = _createSuper(Pile);\n  function Pile() {\n    _classCallCheck(this, Pile);\n    return _super.apply(this, arguments);\n  }\n  _createClass(Pile, [{\n    key: \"find\",\n    value: function find(predicate) {\n      var _iterator = _createForOfIteratorHelper$1(this),\n          _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var item = _step.value;\n          if (predicate(item)) return item;\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      return null;\n    }\n  }, {\n    key: \"equals\",\n    value: function equals(setB) {\n      return this.isSuperset(setB) && setB.isSuperset(this);\n    }\n  }, {\n    key: \"isSuperset\",\n    value: function isSuperset(subset) {\n      var _iterator2 = _createForOfIteratorHelper$1(subset),\n          _step2;\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var item = _step2.value;\n          if (!this.has(item)) return false;\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n      return true;\n    }\n  }, {\n    key: \"filter\",\n    value: function filter(expression) {\n      return new Pile(Array.from(this).filter(expression));\n    }\n  }, {\n    key: \"union\",\n    value: function union(setB) {\n      var union = new Pile(this);\n      var _iterator3 = _createForOfIteratorHelper$1(setB),\n          _step3;\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var item = _step3.value;\n          union.add(item);\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n      return union;\n    }\n  }]);\n  return Pile;\n}( _wrapNativeSuper(Set));\n\nvar Vec2 = function () {\n  function Vec2() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _classCallCheck(this, Vec2);\n    _defineProperty(this, \"x\", void 0);\n    _defineProperty(this, \"y\", void 0);\n    _defineProperty(this, \"z\", void 0);\n    if (args.length === 0) {\n      this.x = 0;\n      this.y = 0;\n      this.z = 0;\n    } else if (arguments.length === 1) {\n      this.x = parseFloat(args[0].x || 0);\n      this.y = parseFloat(args[0].y || 0);\n      this.z = parseFloat(args[0].z || 0);\n    } else if (arguments.length === 2) {\n      this.x = parseFloat(args[0] || 0);\n      this.y = parseFloat(args[1] || 0);\n      this.z = 0;\n    } else if (arguments.length === 3) {\n      this.x = parseFloat(args[0]);\n      this.y = parseFloat(args[1]);\n      this.z = parseFloat(args[2]);\n    } else {\n      throw new Error('Vec2(): invalid arguments');\n    }\n  }\n  _createClass(Vec2, [{\n    key: \"length\",\n    value: function length() {\n      return Math.sqrt(this.x * this.x + this.y * this.y);\n    }\n  }, {\n    key: \"equals\",\n    value: function equals(v) {\n      return this.x === v.x && this.y === v.y;\n    }\n  }, {\n    key: \"add\",\n    value: function add(v) {\n      return new Vec2(this.x + v.x, this.y + v.y, this.z + v.z);\n    }\n  }, {\n    key: \"add_\",\n    value: function add_(v) {\n      this.x += v.x;\n      this.y += v.y;\n      this.z += v.z;\n    }\n  }, {\n    key: \"get_xy0\",\n    value: function get_xy0() {\n      return new Vec2(this.x, this.y);\n    }\n  }, {\n    key: \"sub\",\n    value: function sub(v) {\n      return new Vec2(this.x - v.x, this.y - v.y, this.z - v.z);\n    }\n  }, {\n    key: \"scaled\",\n    value: function scaled(s) {\n      return new Vec2(this.x * s, this.y * s, this.z * s);\n    }\n  }, {\n    key: \"negated\",\n    value: function negated() {\n      return new Vec2(-this.x, -this.y, -this.z);\n    }\n  }, {\n    key: \"yComplement\",\n    value: function yComplement(y1) {\n      y1 = y1 || 0;\n      return new Vec2(this.x, y1 - this.y, this.z);\n    }\n  }, {\n    key: \"addScaled\",\n    value: function addScaled(v, f) {\n      return new Vec2(this.x + v.x * f, this.y + v.y * f, this.z + v.z * f);\n    }\n  }, {\n    key: \"normalized\",\n    value: function normalized() {\n      return this.scaled(1 / this.length());\n    }\n  }, {\n    key: \"normalize\",\n    value: function normalize() {\n      var l = this.length();\n      if (l < 0.000001) return false;\n      this.x /= l;\n      this.y /= l;\n      return true;\n    }\n  }, {\n    key: \"turnLeft\",\n    value: function turnLeft() {\n      return new Vec2(-this.y, this.x, this.z);\n    }\n  }, {\n    key: \"coordStr\",\n    value: function coordStr() {\n      return this.x.toString() + ' , ' + this.y.toString();\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return '(' + this.x.toFixed(2) + ',' + this.y.toFixed(2) + ')';\n    }\n  }, {\n    key: \"max\",\n    value: function max(v) {\n      console.assert(!!v);\n      return Vec2.max(this, v);\n    }\n  }, {\n    key: \"min\",\n    value: function min(v) {\n      return Vec2.min(this, v);\n    }\n  }, {\n    key: \"ceil\",\n    value: function ceil() {\n      return new Vec2(Math.ceil(this.x), Math.ceil(this.y), Math.ceil(this.z));\n    }\n  }, {\n    key: \"floor\",\n    value: function floor() {\n      return new Vec2(Math.floor(this.x), Math.floor(this.y), Math.floor(this.z));\n    }\n  }, {\n    key: \"rotate\",\n    value: function rotate(angle) {\n      var sin = Math.sin(angle);\n      var cos = Math.cos(angle);\n      return this.rotateSC(sin, cos);\n    }\n  }, {\n    key: \"rotateSC\",\n    value: function rotateSC(sin, cos) {\n      console.assert(sin === 0 || !!sin);\n      console.assert(cos === 0 || !!cos);\n      return new Vec2(this.x * cos - this.y * sin, this.x * sin + this.y * cos, this.z);\n    }\n  }, {\n    key: \"oxAngle\",\n    value: function oxAngle() {\n      return Math.atan2(this.y, this.x);\n    }\n  }], [{\n    key: \"dist\",\n    value: function dist(a, b) {\n      return Vec2.diff(a, b).length();\n    }\n  }, {\n    key: \"max\",\n    value: function max(v1, v2) {\n      return new Vec2(Math.max(v1.x, v2.x), Math.max(v1.y, v2.y), Math.max(v1.z, v2.z));\n    }\n  }, {\n    key: \"min\",\n    value: function min(v1, v2) {\n      return new Vec2(Math.min(v1.x, v2.x), Math.min(v1.y, v2.y), Math.min(v1.z, v2.z));\n    }\n  }, {\n    key: \"sum\",\n    value: function sum(v1, v2) {\n      return new Vec2(v1.x + v2.x, v1.y + v2.y, v1.z + v2.z);\n    }\n  }, {\n    key: \"dot\",\n    value: function dot(v1, v2) {\n      return v1.x * v2.x + v1.y * v2.y;\n    }\n  }, {\n    key: \"cross\",\n    value: function cross(v1, v2) {\n      return v1.x * v2.y - v1.y * v2.x;\n    }\n  }, {\n    key: \"angle\",\n    value: function angle(v1, v2) {\n      return Math.atan2(Vec2.cross(v1, v2), Vec2.dot(v1, v2));\n    }\n  }, {\n    key: \"diff\",\n    value: function diff(v1, v2) {\n      return new Vec2(v1.x - v2.x, v1.y - v2.y, v1.z - v2.z);\n    }\n  }, {\n    key: \"lc\",\n    value: function lc() {\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n      var v = new Vec2();\n      for (var i = 0; i < arguments.length / 2; ++i) {\n        v = v.addScaled(args[2 * i], args[2 * i + 1]);\n      }\n      return v;\n    }\n  }, {\n    key: \"lc2\",\n    value: function lc2(v1, f1, v2, f2) {\n      return new Vec2(v1.x * f1 + v2.x * f2, v1.y * f1 + v2.y * f2, v1.z * f1 + v2.z * f2);\n    }\n  }, {\n    key: \"centre\",\n    value: function centre(v1, v2) {\n      return Vec2.lc2(v1, 0.5, v2, 0.5);\n    }\n  }]);\n  return Vec2;\n}();\n_defineProperty(Vec2, \"ZERO\", new Vec2(0, 0));\n_defineProperty(Vec2, \"UNIT\", new Vec2(1, 1));\n\nfunction getValueOrDefault(value, defaultValue) {\n  return typeof value !== 'undefined' ? value : defaultValue;\n}\nfunction getPseudo(label) {\n  return !Elements.get(label) && label !== 'L' && label !== 'L#' && label !== 'R#' ? label : '';\n}\nfunction radicalElectrons(radical) {\n  radical -= 0;\n  if (radical === Atom.PATTERN.RADICAL.DOUPLET) return 1;else if (radical === Atom.PATTERN.RADICAL.SINGLET || radical === Atom.PATTERN.RADICAL.TRIPLET) return 2;else {\n    return 0;\n  }\n}\nvar StereoLabel;\n(function (StereoLabel) {\n  StereoLabel[\"Abs\"] = \"abs\";\n  StereoLabel[\"And\"] = \"&\";\n  StereoLabel[\"Or\"] = \"or\";\n})(StereoLabel || (StereoLabel = {}));\nvar Atom = function () {\n  function Atom(params) {\n    _classCallCheck(this, Atom);\n    _defineProperty(this, \"label\", void 0);\n    _defineProperty(this, \"fragment\", void 0);\n    _defineProperty(this, \"atomList\", void 0);\n    _defineProperty(this, \"attpnt\", void 0);\n    _defineProperty(this, \"isotope\", void 0);\n    _defineProperty(this, \"hCount\", void 0);\n    _defineProperty(this, \"radical\", void 0);\n    _defineProperty(this, \"charge\", void 0);\n    _defineProperty(this, \"explicitValence\", void 0);\n    _defineProperty(this, \"ringBondCount\", void 0);\n    _defineProperty(this, \"unsaturatedAtom\", void 0);\n    _defineProperty(this, \"substitutionCount\", void 0);\n    _defineProperty(this, \"valence\", void 0);\n    _defineProperty(this, \"implicitH\", void 0);\n    _defineProperty(this, \"pp\", void 0);\n    _defineProperty(this, \"neighbors\", void 0);\n    _defineProperty(this, \"sgs\", void 0);\n    _defineProperty(this, \"badConn\", void 0);\n    _defineProperty(this, \"alias\", void 0);\n    _defineProperty(this, \"rglabel\", void 0);\n    _defineProperty(this, \"aam\", void 0);\n    _defineProperty(this, \"invRet\", void 0);\n    _defineProperty(this, \"exactChangeFlag\", void 0);\n    _defineProperty(this, \"rxnFragmentType\", void 0);\n    _defineProperty(this, \"stereoLabel\", void 0);\n    _defineProperty(this, \"stereoParity\", void 0);\n    _defineProperty(this, \"hasImplicitH\", void 0);\n    _defineProperty(this, \"pseudo\", void 0);\n    this.label = params.label;\n    this.fragment = getValueOrDefault(params.fragment, -1);\n    this.alias = getValueOrDefault(params.alias, Atom.attrlist.alias);\n    this.isotope = getValueOrDefault(params.isotope, Atom.attrlist.isotope);\n    this.radical = getValueOrDefault(params.radical, Atom.attrlist.radical);\n    this.charge = getValueOrDefault(params.charge, Atom.attrlist.charge);\n    this.rglabel = getValueOrDefault(params.rglabel, Atom.attrlist.rglabel);\n    this.attpnt = getValueOrDefault(params.attpnt, Atom.attrlist.attpnt);\n    this.explicitValence = getValueOrDefault(params.explicitValence, Atom.attrlist.explicitValence);\n    this.valence = 0;\n    this.implicitH = params.implicitH || 0;\n    this.pp = params.pp ? new Vec2(params.pp) : new Vec2();\n    this.sgs = new Pile();\n    this.ringBondCount = getValueOrDefault(params.ringBondCount, Atom.attrlist.ringBondCount);\n    this.substitutionCount = getValueOrDefault(params.substitutionCount, Atom.attrlist.substitutionCount);\n    this.unsaturatedAtom = getValueOrDefault(params.unsaturatedAtom, Atom.attrlist.unsaturatedAtom);\n    this.hCount = getValueOrDefault(params.hCount, Atom.attrlist.hCount);\n    this.aam = getValueOrDefault(params.aam, Atom.attrlist.aam);\n    this.invRet = getValueOrDefault(params.invRet, Atom.attrlist.invRet);\n    this.exactChangeFlag = getValueOrDefault(params.exactChangeFlag, Atom.attrlist.exactChangeFlag);\n    this.rxnFragmentType = getValueOrDefault(params.rxnFragmentType, -1);\n    this.stereoLabel = getValueOrDefault(params.stereoLabel, Atom.attrlist.stereoLabel);\n    this.stereoParity = getValueOrDefault(params.stereoParity, Atom.attrlist.stereoParity);\n    this.atomList = params.atomList ? new AtomList(params.atomList) : null;\n    this.neighbors = [];\n    this.badConn = false;\n    Object.defineProperty(this, 'pseudo', {\n      enumerable: true,\n      get: function get() {\n        return getPseudo(this.label);\n      }\n    });\n  }\n  _createClass(Atom, [{\n    key: \"clone\",\n    value: function clone(fidMap) {\n      var ret = new Atom(this);\n      if (fidMap && fidMap.has(this.fragment)) ret.fragment = fidMap.get(this.fragment);\n      return ret;\n    }\n  }, {\n    key: \"isQuery\",\n    value: function isQuery() {\n      return this.atomList !== null || this.label === 'A' || this.attpnt || this.hCount;\n    }\n  }, {\n    key: \"pureHydrogen\",\n    value: function pureHydrogen() {\n      return this.label === 'H' && this.isotope === 0;\n    }\n  }, {\n    key: \"isPlainCarbon\",\n    value: function isPlainCarbon() {\n      return this.label === 'C' && this.isotope === 0 && this.radical === 0 && this.charge === 0 && this.explicitValence < 0 && this.ringBondCount === 0 && this.substitutionCount === 0 && this.unsaturatedAtom === 0 && this.hCount === 0 && !this.atomList;\n    }\n  }, {\n    key: \"isPseudo\",\n    value: function isPseudo() {\n      return !this.atomList && !this.rglabel && !Elements.get(this.label);\n    }\n  }, {\n    key: \"hasRxnProps\",\n    value: function hasRxnProps() {\n      return !!(this.invRet || this.exactChangeFlag || this.attpnt !== null || this.aam);\n    }\n  }, {\n    key: \"calcValence\",\n    value: function calcValence(conn) {\n      var label = this.label;\n      var charge = this.charge;\n      if (this.isQuery()) {\n        this.implicitH = 0;\n        return true;\n      }\n      var element = Elements.get(label);\n      if (!element) {\n        this.implicitH = 0;\n        return true;\n      }\n      var groupno = element.group;\n      var rad = radicalElectrons(this.radical);\n      var valence = conn;\n      var hyd = 0;\n      var absCharge = Math.abs(charge);\n      if (groupno === 1) {\n        if (label === 'H' || label === 'Li' || label === 'Na' || label === 'K' || label === 'Rb' || label === 'Cs' || label === 'Fr') {\n          valence = 1;\n          hyd = 1 - rad - conn - absCharge;\n        }\n      } else if (groupno === 2) {\n        if (conn + rad + absCharge === 2 || conn + rad + absCharge === 0) valence = 2;else hyd = -1;\n      } else if (groupno === 3) {\n        if (label === 'B' || label === 'Al' || label === 'Ga' || label === 'In') {\n          if (charge === -1) {\n            valence = 4;\n            hyd = 4 - rad - conn;\n          } else {\n            valence = 3;\n            hyd = 3 - rad - conn - absCharge;\n          }\n        } else if (label === 'Tl') {\n          if (charge === -1) {\n            if (rad + conn <= 2) {\n              valence = 2;\n              hyd = 2 - rad - conn;\n            } else {\n              valence = 4;\n              hyd = 4 - rad - conn;\n            }\n          } else if (charge === -2) {\n            if (rad + conn <= 3) {\n              valence = 3;\n              hyd = 3 - rad - conn;\n            } else {\n              valence = 5;\n              hyd = 5 - rad - conn;\n            }\n          } else if (rad + conn + absCharge <= 1) {\n            valence = 1;\n            hyd = 1 - rad - conn - absCharge;\n          } else {\n            valence = 3;\n            hyd = 3 - rad - conn - absCharge;\n          }\n        }\n      } else if (groupno === 4) {\n        if (label === 'C' || label === 'Si' || label === 'Ge') {\n          valence = 4;\n          hyd = 4 - rad - conn - absCharge;\n        } else if (label === 'Sn' || label === 'Pb') {\n          if (conn + rad + absCharge <= 2) {\n            valence = 2;\n            hyd = 2 - rad - conn - absCharge;\n          } else {\n            valence = 4;\n            hyd = 4 - rad - conn - absCharge;\n          }\n        }\n      } else if (groupno === 5) {\n        if (label === 'N' || label === 'P') {\n          if (charge === 1) {\n            valence = 4;\n            hyd = 4 - rad - conn;\n          } else if (charge === 2) {\n            valence = 3;\n            hyd = 3 - rad - conn;\n          } else if (label === 'N' || rad + conn + absCharge <= 3) {\n            valence = 3;\n            hyd = 3 - rad - conn - absCharge;\n          } else {\n            valence = 5;\n            hyd = 5 - rad - conn - absCharge;\n          }\n        } else if (label === 'Bi' || label === 'Sb' || label === 'As') {\n          if (charge === 1) {\n            if (rad + conn <= 2 && label !== 'As') {\n              valence = 2;\n              hyd = 2 - rad - conn;\n            } else {\n              valence = 4;\n              hyd = 4 - rad - conn;\n            }\n          } else if (charge === 2) {\n            valence = 3;\n            hyd = 3 - rad - conn;\n          } else if (rad + conn <= 3) {\n            valence = 3;\n            hyd = 3 - rad - conn - absCharge;\n          } else {\n            valence = 5;\n            hyd = 5 - rad - conn - absCharge;\n          }\n        }\n      } else if (groupno === 6) {\n        if (label === 'O') {\n          if (charge >= 1) {\n            valence = 3;\n            hyd = 3 - rad - conn;\n          } else {\n            valence = 2;\n            hyd = 2 - rad - conn - absCharge;\n          }\n        } else if (label === 'S' || label === 'Se' || label === 'Po') {\n          if (charge === 1) {\n            if (conn <= 3) {\n              valence = 3;\n              hyd = 3 - rad - conn;\n            } else {\n              valence = 5;\n              hyd = 5 - rad - conn;\n            }\n          } else if (conn + rad + absCharge <= 2) {\n            valence = 2;\n            hyd = 2 - rad - conn - absCharge;\n          } else if (conn + rad + absCharge <= 4) {\n            valence = 4;\n            hyd = 4 - rad - conn - absCharge;\n          } else {\n            valence = 6;\n            hyd = 6 - rad - conn - absCharge;\n          }\n        } else if (label === 'Te') {\n          if (charge === -1) {\n            if (conn <= 2) {\n              valence = 2;\n              hyd = 2 - rad - conn - absCharge;\n            }\n          } else if (charge === 0 || charge === 2) {\n            if (conn <= 2) {\n              valence = 2;\n              hyd = 2 - rad - conn - absCharge;\n            } else if (conn <= 4) {\n              valence = 4;\n              hyd = 4 - rad - conn - absCharge;\n            } else if (charge === 0 && conn <= 6) {\n              valence = 6;\n              hyd = 6 - rad - conn - absCharge;\n            } else {\n              hyd = -1;\n            }\n          }\n        }\n      } else if (groupno === 7) {\n        if (label === 'F') {\n          valence = 1;\n          hyd = 1 - rad - conn - absCharge;\n        } else if (label === 'Cl' || label === 'Br' || label === 'I' || label === 'At') {\n          if (charge === 1) {\n            if (conn <= 2) {\n              valence = 2;\n              hyd = 2 - rad - conn;\n            } else if (conn === 3 || conn === 5 || conn >= 7) {\n              hyd = -1;\n            }\n          } else if (charge === 0) {\n            if (conn <= 1) {\n              valence = 1;\n              hyd = 1 - rad - conn;\n            } else if (conn === 2 || conn === 4 || conn === 6) {\n              if (rad === 1) {\n                valence = conn;\n                hyd = 0;\n              } else {\n                hyd = -1;\n              }\n            } else if (conn > 7) {\n              hyd = -1;\n            }\n          }\n        }\n      } else if (groupno === 8) {\n        if (conn + rad + absCharge === 0) valence = 1;else hyd = -1;\n      }\n      this.valence = valence;\n      this.implicitH = hyd;\n      if (this.implicitH < 0) {\n        this.valence = conn;\n        this.implicitH = 0;\n        this.badConn = true;\n        return false;\n      }\n      return true;\n    }\n  }, {\n    key: \"calcValenceMinusHyd\",\n    value: function calcValenceMinusHyd(conn) {\n      var charge = this.charge;\n      var label = this.label;\n      var element = Elements.get(this.label);\n      if (!element) {\n        console.assert('Element ' + label + ' unknown');\n        this.implicitH = 0;\n        return 0;\n      }\n      var groupno = element.group;\n      var rad = radicalElectrons(this.radical);\n      if (groupno === 3) {\n        if (label === 'B' || label === 'Al' || label === 'Ga' || label === 'In') {\n          if (charge === -1) {\n            if (rad + conn <= 4) return rad + conn;\n          }\n        }\n      } else if (groupno === 5) {\n        if (label === 'N' || label === 'P') {\n          if (charge === 1) return rad + conn;\n          if (charge === 2) return rad + conn;\n        } else if (label === 'Sb' || label === 'Bi' || label === 'As') {\n          if (charge === 1) return rad + conn;else if (charge === 2) return rad + conn;\n        }\n      } else if (groupno === 6) {\n        if (label === 'O') {\n          if (charge >= 1) return rad + conn;\n        } else if (label === 'S' || label === 'Se' || label === 'Po') {\n          if (charge === 1) return rad + conn;\n        }\n      } else if (groupno === 7) {\n        if (label === 'Cl' || label === 'Br' || label === 'I' || label === 'At') {\n          if (charge === 1) return rad + conn;\n        }\n      }\n      return rad + conn + Math.abs(charge);\n    }\n  }], [{\n    key: \"getAttrHash\",\n    value: function getAttrHash(atom) {\n      var attrs = {};\n      for (var attr in Atom.attrlist) {\n        if (typeof atom[attr] !== 'undefined') attrs[attr] = atom[attr];\n      }\n      return attrs;\n    }\n  }, {\n    key: \"attrGetDefault\",\n    value: function attrGetDefault(attr) {\n      if (attr in Atom.attrlist) return Atom.attrlist[attr];\n      return console.assert(false, 'Attribute unknown');\n    }\n  }]);\n  return Atom;\n}();\n_defineProperty(Atom, \"PATTERN\", {\n  RADICAL: {\n    NONE: 0,\n    SINGLET: 1,\n    DOUPLET: 2,\n    TRIPLET: 3\n  },\n  STEREO_PARITY: {\n    NONE: 0,\n    ODD: 1,\n    EVEN: 2,\n    EITHER: 3\n  }\n});\n_defineProperty(Atom, \"attrlist\", {\n  alias: null,\n  label: 'C',\n  isotope: 0,\n  radical: 0,\n  charge: 0,\n  explicitValence: -1,\n  ringBondCount: 0,\n  substitutionCount: 0,\n  unsaturatedAtom: 0,\n  hCount: 0,\n  atomList: null,\n  invRet: 0,\n  exactChangeFlag: 0,\n  rglabel: null,\n  attpnt: null,\n  aam: 0,\n  stereoLabel: null,\n  stereoParity: 0\n});\n\nvar Bond = function () {\n  function Bond(params) {\n    _classCallCheck(this, Bond);\n    _defineProperty(this, \"begin\", void 0);\n    _defineProperty(this, \"end\", void 0);\n    _defineProperty(this, \"type\", void 0);\n    _defineProperty(this, \"xxx\", void 0);\n    _defineProperty(this, \"stereo\", void 0);\n    _defineProperty(this, \"topology\", void 0);\n    _defineProperty(this, \"reactingCenterStatus\", void 0);\n    _defineProperty(this, \"len\", void 0);\n    _defineProperty(this, \"sb\", void 0);\n    _defineProperty(this, \"sa\", void 0);\n    _defineProperty(this, \"hb1\", void 0);\n    _defineProperty(this, \"hb2\", void 0);\n    _defineProperty(this, \"angle\", void 0);\n    _defineProperty(this, \"center\", void 0);\n    this.begin = params.begin;\n    this.end = params.end;\n    this.type = params.type;\n    this.xxx = params.xxx || '';\n    this.stereo = Bond.PATTERN.STEREO.NONE;\n    this.topology = Bond.PATTERN.TOPOLOGY.EITHER;\n    this.reactingCenterStatus = 0;\n    this.len = 0;\n    this.sb = 0;\n    this.sa = 0;\n    this.angle = 0;\n    if (params.stereo) this.stereo = params.stereo;\n    if (params.topology) this.topology = params.topology;\n    if (params.reactingCenterStatus) this.reactingCenterStatus = params.reactingCenterStatus;\n    this.center = new Vec2();\n  }\n  _createClass(Bond, [{\n    key: \"hasRxnProps\",\n    value: function hasRxnProps() {\n      return !!this.reactingCenterStatus;\n    }\n  }, {\n    key: \"getCenter\",\n    value: function getCenter(struct) {\n      var p1 = struct.atoms.get(this.begin).pp;\n      var p2 = struct.atoms.get(this.end).pp;\n      return Vec2.lc2(p1, 0.5, p2, 0.5);\n    }\n  }, {\n    key: \"getDir\",\n    value: function getDir(struct) {\n      var p1 = struct.atoms.get(this.begin).pp;\n      var p2 = struct.atoms.get(this.end).pp;\n      return p2.sub(p1).normalized();\n    }\n  }, {\n    key: \"clone\",\n    value: function clone(aidMap) {\n      var cp = new Bond(this);\n      if (aidMap) {\n        cp.begin = aidMap.get(cp.begin);\n        cp.end = aidMap.get(cp.end);\n      }\n      return cp;\n    }\n  }], [{\n    key: \"getAttrHash\",\n    value: function getAttrHash(bond) {\n      var attrs = {};\n      for (var attr in Bond.attrlist) {\n        if (bond[attr]) {\n          attrs[attr] = bond[attr];\n        }\n      }\n      return attrs;\n    }\n  }, {\n    key: \"attrGetDefault\",\n    value: function attrGetDefault(attr) {\n      if (attr in Bond.attrlist) {\n        return Bond.attrlist[attr];\n      }\n    }\n  }]);\n  return Bond;\n}();\n_defineProperty(Bond, \"PATTERN\", {\n  TYPE: {\n    SINGLE: 1,\n    DOUBLE: 2,\n    TRIPLE: 3,\n    AROMATIC: 4,\n    SINGLE_OR_DOUBLE: 5,\n    SINGLE_OR_AROMATIC: 6,\n    DOUBLE_OR_AROMATIC: 7,\n    ANY: 8,\n    DATIVE: 9,\n    HYDROGEN: 10\n  },\n  STEREO: {\n    NONE: 0,\n    UP: 1,\n    EITHER: 4,\n    DOWN: 6,\n    CIS_TRANS: 3\n  },\n  TOPOLOGY: {\n    EITHER: 0,\n    RING: 1,\n    CHAIN: 2\n  },\n  REACTING_CENTER: {\n    NOT_CENTER: -1,\n    UNMARKED: 0,\n    CENTER: 1,\n    UNCHANGED: 2,\n    MADE_OR_BROKEN: 4,\n    ORDER_CHANGED: 8,\n    MADE_OR_BROKEN_AND_CHANGED: 12\n  }\n});\n_defineProperty(Bond, \"attrlist\", {\n  type: Bond.PATTERN.TYPE.SINGLE,\n  stereo: Bond.PATTERN.STEREO.NONE,\n  topology: Bond.PATTERN.TOPOLOGY.EITHER,\n  reactingCenterStatus: Bond.PATTERN.REACTING_CENTER.UNMARKED\n});\n\nvar StereoFlag;\n(function (StereoFlag) {\n  StereoFlag[\"Mixed\"] = \"MIXED\";\n  StereoFlag[\"Abs\"] = \"ABS\";\n  StereoFlag[\"And\"] = \"AND\";\n  StereoFlag[\"Or\"] = \"OR\";\n})(StereoFlag || (StereoFlag = {}));\nfunction calcStereoFlag(struct, stereoAids) {\n  if (!stereoAids || stereoAids.length === 0) return undefined;\n  var filteredStereoAtoms = stereoAids.map(function (aid) {\n    return struct.atoms.get(aid);\n  }).filter(function (atom) {\n    return atom === null || atom === void 0 ? void 0 : atom.stereoLabel;\n  });\n  if (!filteredStereoAtoms.length) return undefined;\n  var atom = filteredStereoAtoms[0];\n  var stereoLabel = atom.stereoLabel;\n  var hasAnotherLabel = filteredStereoAtoms.some(function (atom) {\n    return (atom === null || atom === void 0 ? void 0 : atom.stereoLabel) !== stereoLabel;\n  });\n  var stereoFlag;\n  if (hasAnotherLabel) {\n    stereoFlag = StereoFlag.Mixed;\n  } else {\n    var _stereoLabel$match;\n    var label = (_stereoLabel$match = stereoLabel.match(/\\D+/g)) === null || _stereoLabel$match === void 0 ? void 0 : _stereoLabel$match[0];\n    switch (label) {\n      case StereoLabel.Abs:\n        {\n          stereoFlag = StereoFlag.Abs;\n          break;\n        }\n      case StereoLabel.And:\n        {\n          stereoFlag = StereoFlag.And;\n          break;\n        }\n      case StereoLabel.Or:\n        {\n          stereoFlag = StereoFlag.Or;\n          break;\n        }\n      default:\n        {\n          throw new Error(\"Unsupported stereo label: \".concat(label, \".\"));\n        }\n    }\n  }\n  return stereoFlag;\n}\nvar _enhancedStereoFlag = new WeakMap();\nvar Fragment = function () {\n  _createClass(Fragment, [{\n    key: \"enhancedStereoFlag\",\n    get: function get() {\n      return _classPrivateFieldGet(this, _enhancedStereoFlag);\n    }\n  }]);\n  function Fragment(stereoFlagPosition) {\n    _classCallCheck(this, Fragment);\n    _enhancedStereoFlag.set(this, {\n      writable: true,\n      value: void 0\n    });\n    _defineProperty(this, \"stereoFlagPosition\", void 0);\n    _defineProperty(this, \"stereoAtoms\", []);\n    this.stereoFlagPosition = stereoFlagPosition;\n  }\n  _createClass(Fragment, [{\n    key: \"clone\",\n    value: function clone(aidMap) {\n      var fr = new Fragment(this.stereoFlagPosition);\n      fr.stereoAtoms = this.stereoAtoms.map(function (aid) {\n        return aidMap.get(aid);\n      });\n      _classPrivateFieldSet(fr, _enhancedStereoFlag, _classPrivateFieldGet(this, _enhancedStereoFlag));\n      return fr;\n    }\n  }, {\n    key: \"updateStereoFlag\",\n    value: function updateStereoFlag(struct) {\n      _classPrivateFieldSet(this, _enhancedStereoFlag, calcStereoFlag(struct, this.stereoAtoms));\n      return _classPrivateFieldGet(this, _enhancedStereoFlag);\n    }\n  }, {\n    key: \"updateStereoAtom\",\n    value: function updateStereoAtom(struct, aid, frId, isAdd) {\n      var _struct$atoms$get;\n      if (isAdd && !this.stereoAtoms.includes(aid)) this.stereoAtoms.push(aid);\n      if (!isAdd && (((_struct$atoms$get = struct.atoms.get(aid)) === null || _struct$atoms$get === void 0 ? void 0 : _struct$atoms$get.fragment) !== frId || !Array.from(struct.bonds.values()).filter(function (bond) {\n        return bond.stereo && bond.type !== Bond.PATTERN.TYPE.DOUBLE;\n      }).some(function (bond) {\n        return bond.begin === aid;\n      }))) {\n        this.stereoAtoms = this.stereoAtoms.filter(function (item) {\n          return item !== aid;\n        });\n      }\n      _classPrivateFieldSet(this, _enhancedStereoFlag, calcStereoFlag(struct, this.stereoAtoms));\n    }\n  }], [{\n    key: \"getDefaultStereoFlagPosition\",\n    value: function getDefaultStereoFlagPosition(struct, fragmentId) {\n      var fragment = struct.getFragment(fragmentId);\n      if (!fragment) return undefined;\n      var bb = fragment.getCoordBoundingBox();\n      return new Vec2(bb.max.x, bb.min.y - 1);\n    }\n  }]);\n  return Fragment;\n}();\n\nvar HalfBond = function HalfBond(begin, end, bid) {\n  _classCallCheck(this, HalfBond);\n  _defineProperty(this, \"begin\", void 0);\n  _defineProperty(this, \"end\", void 0);\n  _defineProperty(this, \"bid\", void 0);\n  _defineProperty(this, \"dir\", void 0);\n  _defineProperty(this, \"norm\", void 0);\n  _defineProperty(this, \"ang\", void 0);\n  _defineProperty(this, \"p\", void 0);\n  _defineProperty(this, \"loop\", void 0);\n  _defineProperty(this, \"contra\", void 0);\n  _defineProperty(this, \"next\", void 0);\n  _defineProperty(this, \"leftSin\", void 0);\n  _defineProperty(this, \"leftCos\", void 0);\n  _defineProperty(this, \"leftNeighbor\", void 0);\n  _defineProperty(this, \"rightSin\", void 0);\n  _defineProperty(this, \"rightCos\", void 0);\n  _defineProperty(this, \"rightNeighbor\", void 0);\n  console.assert(arguments.length === 3, 'Invalid parameter number!');\n  this.begin = begin;\n  this.end = end;\n  this.bid = bid;\n  this.dir = new Vec2();\n  this.norm = new Vec2();\n  this.ang = 0;\n  this.p = new Vec2();\n  this.loop = -1;\n  this.contra = -1;\n  this.next = -1;\n  this.leftSin = 0;\n  this.leftCos = 0;\n  this.leftNeighbor = 0;\n  this.rightSin = 0;\n  this.rightCos = 0;\n  this.rightNeighbor = 0;\n};\n\nvar Loop = function Loop(hbs, struct, isConvex) {\n  var _this = this;\n  _classCallCheck(this, Loop);\n  _defineProperty(this, \"hbs\", void 0);\n  _defineProperty(this, \"dblBonds\", void 0);\n  _defineProperty(this, \"aromatic\", void 0);\n  _defineProperty(this, \"convex\", void 0);\n  this.hbs = hbs;\n  this.dblBonds = 0;\n  this.aromatic = true;\n  this.convex = isConvex || false;\n  hbs.forEach(function (hb) {\n    var bond = struct.bonds.get(struct.halfBonds.get(hb).bid);\n    if (bond.type !== Bond.PATTERN.TYPE.AROMATIC) _this.aromatic = false;\n    if (bond.type === Bond.PATTERN.TYPE.DOUBLE) _this.dblBonds++;\n  });\n};\n\nvar RGroup = function () {\n  function RGroup(params) {\n    _classCallCheck(this, RGroup);\n    _defineProperty(this, \"frags\", void 0);\n    _defineProperty(this, \"resth\", void 0);\n    _defineProperty(this, \"range\", void 0);\n    _defineProperty(this, \"ifthen\", void 0);\n    this.frags = new Pile();\n    this.resth = (params === null || params === void 0 ? void 0 : params.resth) || false;\n    this.range = (params === null || params === void 0 ? void 0 : params.range) || '';\n    this.ifthen = (params === null || params === void 0 ? void 0 : params.ifthen) || 0;\n  }\n  _createClass(RGroup, [{\n    key: \"getAttrs\",\n    value: function getAttrs() {\n      return {\n        resth: this.resth,\n        range: this.range,\n        ifthen: this.ifthen\n      };\n    }\n  }, {\n    key: \"clone\",\n    value: function clone(fidMap) {\n      var ret = new RGroup(this);\n      this.frags.forEach(function (fid) {\n        ret.frags.add(fidMap ? fidMap.get(fid) : fid);\n      });\n      return ret;\n    }\n  }], [{\n    key: \"findRGroupByFragment\",\n    value: function findRGroupByFragment(rgroups, frid) {\n      return rgroups.find(function (_rgid, rgroup) {\n        return rgroup.frags.has(frid);\n      });\n    }\n  }]);\n  return RGroup;\n}();\n\nvar RxnArrowMode;\n(function (RxnArrowMode) {\n  RxnArrowMode[\"simple\"] = \"simple\";\n  RxnArrowMode[\"equilibrium\"] = \"equilibrium\";\n})(RxnArrowMode || (RxnArrowMode = {}));\nvar RxnArrow = function () {\n  function RxnArrow(pp) {\n    var mode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : RxnArrowMode.simple;\n    _classCallCheck(this, RxnArrow);\n    _defineProperty(this, \"pp\", void 0);\n    _defineProperty(this, \"mode\", void 0);\n    this.pp = pp;\n    this.mode = mode;\n  }\n  _createClass(RxnArrow, [{\n    key: \"clone\",\n    value: function clone() {\n      return new RxnArrow(this.pp, this.mode);\n    }\n  }]);\n  return RxnArrow;\n}();\n\nvar RxnPlus = function () {\n  function RxnPlus(params) {\n    _classCallCheck(this, RxnPlus);\n    _defineProperty(this, \"pp\", void 0);\n    this.pp = params !== null && params !== void 0 && params.pp ? new Vec2(params.pp) : new Vec2();\n  }\n  _createClass(RxnPlus, [{\n    key: \"clone\",\n    value: function clone() {\n      return new RxnPlus(this);\n    }\n  }]);\n  return RxnPlus;\n}();\n\nvar Box2Abs = function () {\n  function Box2Abs() {\n    _classCallCheck(this, Box2Abs);\n    _defineProperty(this, \"p0\", void 0);\n    _defineProperty(this, \"p1\", void 0);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    if (args.length === 1 && 'min' in args[0] && 'max' in args[0]) {\n      this.p0 = args[0].min;\n      this.p1 = args[0].max;\n    }\n    if (args.length === 2) {\n      this.p0 = args[0];\n      this.p1 = args[1];\n    } else if (args.length === 4) {\n      this.p0 = new Vec2(args[0], args[1]);\n      this.p1 = new Vec2(args[2], args[3]);\n    } else if (args.length === 0) {\n      this.p0 = new Vec2();\n      this.p1 = new Vec2();\n    } else {\n      throw new Error('Box2Abs constructor only accepts 4 numbers or 2 vectors or no args!');\n    }\n  }\n  _createClass(Box2Abs, [{\n    key: \"toString\",\n    value: function toString() {\n      return this.p0.toString() + ' ' + this.p1.toString();\n    }\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      return new Box2Abs(this.p0, this.p1);\n    }\n  }, {\n    key: \"extend\",\n    value: function extend(lp, rb) {\n      rb = rb || lp;\n      return new Box2Abs(this.p0.sub(lp), this.p1.add(rb));\n    }\n  }, {\n    key: \"include\",\n    value: function include(p) {\n      console.assert(!!p);\n      return new Box2Abs(this.p0.min(p), this.p1.max(p));\n    }\n  }, {\n    key: \"contains\",\n    value: function contains(p) {\n      var ext = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0.0;\n      console.assert(!!p);\n      return p.x >= this.p0.x - ext && p.x <= this.p1.x + ext && p.y >= this.p0.y - ext && p.y <= this.p1.y + ext;\n    }\n  }, {\n    key: \"translate\",\n    value: function translate(d) {\n      return new Box2Abs(this.p0.add(d), this.p1.add(d));\n    }\n  }, {\n    key: \"transform\",\n    value: function transform(f, options) {\n      console.assert(!!f);\n      return new Box2Abs(f(this.p0, options), f(this.p1, options));\n    }\n  }, {\n    key: \"sz\",\n    value: function sz() {\n      return this.p1.sub(this.p0);\n    }\n  }, {\n    key: \"centre\",\n    value: function centre() {\n      return Vec2.centre(this.p0, this.p1);\n    }\n  }, {\n    key: \"pos\",\n    value: function pos() {\n      return this.p0;\n    }\n  }], [{\n    key: \"fromRelBox\",\n    value: function fromRelBox(relBox) {\n      return new Box2Abs(relBox.x, relBox.y, relBox.x + relBox.width, relBox.y + relBox.height);\n    }\n  }, {\n    key: \"union\",\n    value: function union(b1, b2) {\n      return new Box2Abs(Vec2.min(b1.p0, b2.p0), Vec2.max(b1.p1, b2.p1));\n    }\n  }, {\n    key: \"segmentIntersection\",\n    value: function segmentIntersection(a, b, c, d) {\n      var dc = (a.x - c.x) * (b.y - c.y) - (a.y - c.y) * (b.x - c.x);\n      var dd = (a.x - d.x) * (b.y - d.y) - (a.y - d.y) * (b.x - d.x);\n      var da = (c.x - a.x) * (d.y - a.y) - (c.y - a.y) * (d.x - a.x);\n      var db = (c.x - b.x) * (d.y - b.y) - (c.y - b.y) * (d.x - b.x);\n      return dc * dd <= 0 && da * db <= 0;\n    }\n  }]);\n  return Box2Abs;\n}();\n\nvar SGroupBracketParams = function SGroupBracketParams(c, d, w, h) {\n  _classCallCheck(this, SGroupBracketParams);\n  _defineProperty(this, \"c\", void 0);\n  _defineProperty(this, \"d\", void 0);\n  _defineProperty(this, \"n\", void 0);\n  _defineProperty(this, \"w\", void 0);\n  _defineProperty(this, \"h\", void 0);\n  this.c = c;\n  this.d = d;\n  this.n = d.rotateSC(1, 0);\n  this.w = w;\n  this.h = h;\n};\nvar SGroup = function () {\n  function SGroup(type) {\n    _classCallCheck(this, SGroup);\n    _defineProperty(this, \"type\", void 0);\n    _defineProperty(this, \"id\", void 0);\n    _defineProperty(this, \"label\", void 0);\n    _defineProperty(this, \"bracketBox\", void 0);\n    _defineProperty(this, \"bracketDir\", void 0);\n    _defineProperty(this, \"areas\", void 0);\n    _defineProperty(this, \"highlight\", void 0);\n    _defineProperty(this, \"highlighting\", void 0);\n    _defineProperty(this, \"selected\", void 0);\n    _defineProperty(this, \"selectionPlate\", void 0);\n    _defineProperty(this, \"atoms\", void 0);\n    _defineProperty(this, \"atomSet\", void 0);\n    _defineProperty(this, \"parentAtomSet\", void 0);\n    _defineProperty(this, \"patoms\", void 0);\n    _defineProperty(this, \"allAtoms\", void 0);\n    _defineProperty(this, \"bonds\", void 0);\n    _defineProperty(this, \"xBonds\", void 0);\n    _defineProperty(this, \"neiAtoms\", void 0);\n    _defineProperty(this, \"pp\", void 0);\n    _defineProperty(this, \"data\", void 0);\n    this.type = type;\n    this.id = -1;\n    this.label = -1;\n    this.bracketBox = null;\n    this.bracketDir = new Vec2(1, 0);\n    this.areas = [];\n    this.highlight = false;\n    this.highlighting = null;\n    this.selected = false;\n    this.selectionPlate = null;\n    this.atoms = [];\n    this.patoms = [];\n    this.bonds = [];\n    this.xBonds = [];\n    this.neiAtoms = [];\n    this.pp = null;\n    this.data = {\n      mul: 1,\n      connectivity: 'ht',\n      name: '',\n      subscript: 'n',\n      attached: false,\n      absolute: true,\n      showUnits: false,\n      nCharsToDisplay: -1,\n      tagChar: '',\n      daspPos: 1,\n      fieldType: 'F',\n      fieldName: '',\n      fieldValue: '',\n      units: '',\n      query: '',\n      queryOp: ''\n    };\n  }\n  _createClass(SGroup, [{\n    key: \"getAttr\",\n    value: function getAttr(attr) {\n      return this.data[attr];\n    }\n  }, {\n    key: \"getAttrs\",\n    value: function getAttrs() {\n      var _this = this;\n      var attrs = {};\n      Object.keys(this.data).forEach(function (attr) {\n        attrs[attr] = _this.data[attr];\n      });\n      return attrs;\n    }\n  }, {\n    key: \"setAttr\",\n    value: function setAttr(attr, value) {\n      var oldValue = this.data[attr];\n      this.data[attr] = value;\n      return oldValue;\n    }\n  }, {\n    key: \"checkAttr\",\n    value: function checkAttr(attr, value) {\n      return this.data[attr] === value;\n    }\n  }, {\n    key: \"updateOffset\",\n    value: function updateOffset(offset) {\n      this.pp = Vec2.sum(this.bracketBox.p1, offset);\n    }\n  }, {\n    key: \"calculatePP\",\n    value: function calculatePP(struct) {\n      var topLeftPoint = this.bracketBox.p1.add(new Vec2(0.5, 0.5));\n      var sgroups = Array.from(struct.sgroups.values());\n      for (var i = 0; i < struct.sgroups.size; ++i) {\n        if (!descriptorIntersects(sgroups, topLeftPoint)) break;\n        topLeftPoint = topLeftPoint.add(new Vec2(0, 0.5));\n      }\n      if (this.data.fieldName === 'INDIGO_CIP_DESC' && this.atoms.length === 1) {\n        var _struct$atoms$get;\n        var sAtom = this.atoms[0];\n        var sAtomPP = (_struct$atoms$get = struct.atoms.get(sAtom)) === null || _struct$atoms$get === void 0 ? void 0 : _struct$atoms$get.pp;\n        if (sAtomPP) {\n          topLeftPoint = sAtomPP;\n        }\n      }\n      this.pp = topLeftPoint;\n    }\n  }], [{\n    key: \"getOffset\",\n    value: function getOffset(sgroup) {\n      if (!sgroup.pp) return null;\n      return Vec2.diff(sgroup.pp, sgroup.bracketBox.p1);\n    }\n  }, {\n    key: \"filterAtoms\",\n    value: function filterAtoms(atoms, map) {\n      var newAtoms = [];\n      for (var i = 0; i < atoms.length; ++i) {\n        var aid = atoms[i];\n        if (typeof map[aid] !== 'number') newAtoms.push(aid);else if (map[aid] >= 0) newAtoms.push(map[aid]);else newAtoms.push(-1);\n      }\n      return newAtoms;\n    }\n  }, {\n    key: \"removeNegative\",\n    value: function removeNegative(atoms) {\n      var newAtoms = [];\n      for (var j = 0; j < atoms.length; ++j) {\n        if (atoms[j] >= 0) newAtoms.push(atoms[j]);\n      }\n      return newAtoms;\n    }\n  }, {\n    key: \"filter\",\n    value: function filter(_mol, sg, atomMap) {\n      sg.atoms = SGroup.removeNegative(SGroup.filterAtoms(sg.atoms, atomMap));\n    }\n  }, {\n    key: \"clone\",\n    value: function clone(sgroup, aidMap) {\n      var cp = new SGroup(sgroup.type);\n      Object.keys(sgroup.data).forEach(function (field) {\n        cp.data[field] = sgroup.data[field];\n      });\n      cp.atoms = sgroup.atoms.map(function (elem) {\n        return aidMap.get(elem);\n      });\n      cp.pp = sgroup.pp;\n      cp.bracketBox = sgroup.bracketBox;\n      cp.patoms = null;\n      cp.bonds = null;\n      cp.allAtoms = sgroup.allAtoms;\n      return cp;\n    }\n  }, {\n    key: \"addAtom\",\n    value: function addAtom(sgroup, aid) {\n      sgroup.atoms.push(aid);\n    }\n  }, {\n    key: \"removeAtom\",\n    value: function removeAtom(sgroup, aid) {\n      for (var i = 0; i < sgroup.atoms.length; ++i) {\n        if (sgroup.atoms[i] === aid) {\n          sgroup.atoms.splice(i, 1);\n          return;\n        }\n      }\n    }\n  }, {\n    key: \"getCrossBonds\",\n    value: function getCrossBonds(mol, parentAtomSet) {\n      var crossBonds = {};\n      mol.bonds.forEach(function (bond, bid) {\n        if (parentAtomSet.has(bond.begin) && !parentAtomSet.has(bond.end)) {\n          if (!crossBonds[bond.begin]) {\n            crossBonds[bond.begin] = [];\n          }\n          crossBonds[bond.begin].push(bid);\n        } else if (parentAtomSet.has(bond.end) && !parentAtomSet.has(bond.begin)) {\n          if (!crossBonds[bond.end]) {\n            crossBonds[bond.end] = [];\n          }\n          crossBonds[bond.end].push(bid);\n        }\n      });\n      return crossBonds;\n    }\n  }, {\n    key: \"bracketPos\",\n    value: function bracketPos(sGroup, mol, crossBondsPerAtom) {\n      var atoms = sGroup.atoms;\n      var crossBonds = Object.values(crossBondsPerAtom).flat();\n      if (!crossBonds || crossBonds.length !== 2) {\n        sGroup.bracketDir = new Vec2(1, 0);\n      } else {\n        var p1 = mol.bonds.get(crossBonds[0]).getCenter(mol);\n        var p2 = mol.bonds.get(crossBonds[1]).getCenter(mol);\n        sGroup.bracketDir = Vec2.diff(p2, p1).normalized();\n      }\n      var d = sGroup.bracketDir;\n      var braketBox = null;\n      var contentBoxes = [];\n      atoms.forEach(function (aid) {\n        var atom = mol.atoms.get(aid);\n        var pos = new Vec2(atom.pp);\n        var ext = new Vec2(0.05 * 3, 0.05 * 3);\n        var bba = new Box2Abs(pos, pos).extend(ext, ext);\n        contentBoxes.push(bba);\n      });\n      contentBoxes.forEach(function (bba) {\n        var bbb = null;\n        [bba.p0.x, bba.p1.x].forEach(function (x) {\n          [bba.p0.y, bba.p1.y].forEach(function (y) {\n            var v = new Vec2(x, y);\n            var p = new Vec2(Vec2.dot(v, d), Vec2.dot(v, d.rotateSC(1, 0)));\n            bbb = !bbb ? new Box2Abs(p, p) : bbb.include(p);\n          });\n        });\n        braketBox = !braketBox ? bbb : Box2Abs.union(braketBox, bbb);\n      });\n      var vext = new Vec2(0.2, 0.4);\n      if (braketBox) braketBox = braketBox.extend(vext, vext);\n      sGroup.bracketBox = braketBox;\n    }\n  }, {\n    key: \"getBracketParameters\",\n    value: function getBracketParameters(mol, crossBondsPerAtom, atomSet, bb, d, n) {\n      var brackets = [];\n      var crossBondsPerAtomValues = Object.values(crossBondsPerAtom);\n      var crossBonds = crossBondsPerAtomValues.flat();\n      if (crossBonds.length < 2) {\n        (function () {\n          d = d || new Vec2(1, 0);\n          n = n || d.rotateSC(1, 0);\n          var bracketWidth = Math.min(0.25, bb.sz().x * 0.3);\n          var cl = Vec2.lc2(d, bb.p0.x, n, 0.5 * (bb.p0.y + bb.p1.y));\n          var cr = Vec2.lc2(d, bb.p1.x, n, 0.5 * (bb.p0.y + bb.p1.y));\n          var bracketHeight = bb.sz().y;\n          brackets.push(new SGroupBracketParams(cl, d.negated(), bracketWidth, bracketHeight), new SGroupBracketParams(cr, d, bracketWidth, bracketHeight));\n        })();\n      } else if (crossBonds.length === 2 && crossBondsPerAtomValues.length === 2) {\n        (function () {\n          var b1 = mol.bonds.get(crossBonds[0]);\n          var b2 = mol.bonds.get(crossBonds[1]);\n          var cl0 = b1.getCenter(mol);\n          var cr0 = b2.getCenter(mol);\n          var dr = Vec2.diff(cr0, cl0).normalized();\n          var dl = dr.negated();\n          var bracketWidth = 0.25;\n          var bracketHeight = 1.5;\n          brackets.push(new SGroupBracketParams(cl0.addScaled(dl, 0), dl, bracketWidth, bracketHeight), new SGroupBracketParams(cr0.addScaled(dr, 0), dr, bracketWidth, bracketHeight));\n        })();\n      } else {\n        (function () {\n          for (var i = 0; i < crossBonds.length; ++i) {\n            var b = mol.bonds.get(crossBonds[i]);\n            var c = b.getCenter(mol);\n            var d = atomSet.has(b.begin) ? b.getDir(mol) : b.getDir(mol).negated();\n            brackets.push(new SGroupBracketParams(c, d, 0.2, 1.0));\n          }\n        })();\n      }\n      return brackets;\n    }\n  }, {\n    key: \"getObjBBox\",\n    value: function getObjBBox(atoms, mol) {\n      var a0 = mol.atoms.get(atoms[0]).pp;\n      var bb = new Box2Abs(a0, a0);\n      for (var i = 1; i < atoms.length; ++i) {\n        var aid = atoms[i];\n        var atom = mol.atoms.get(aid);\n        var p = atom.pp;\n        bb = bb.include(p);\n      }\n      return bb;\n    }\n  }, {\n    key: \"getAtoms\",\n    value: function getAtoms(mol, sg) {\n      if (!sg.allAtoms) return sg.atoms;\n      var atoms = [];\n      mol.atoms.forEach(function (_atom, aid) {\n        atoms.push(aid);\n      });\n      return atoms;\n    }\n  }, {\n    key: \"getBonds\",\n    value: function getBonds(mol, sg) {\n      var atoms = SGroup.getAtoms(mol, sg);\n      var bonds = [];\n      mol.bonds.forEach(function (bond, bid) {\n        if (atoms.indexOf(bond.begin) >= 0 && atoms.indexOf(bond.end) >= 0) bonds.push(bid);\n      });\n      return bonds;\n    }\n  }, {\n    key: \"prepareMulForSaving\",\n    value: function prepareMulForSaving(sgroup, mol) {\n      sgroup.atoms.sort(function (a, b) {\n        return a - b;\n      });\n      sgroup.atomSet = new Pile(sgroup.atoms);\n      sgroup.parentAtomSet = new Pile(sgroup.atomSet);\n      var inBonds = [];\n      var xBonds = [];\n      mol.bonds.forEach(function (bond, bid) {\n        if (sgroup.parentAtomSet.has(bond.begin) && sgroup.parentAtomSet.has(bond.end)) inBonds.push(bid);else if (sgroup.parentAtomSet.has(bond.begin) || sgroup.parentAtomSet.has(bond.end)) xBonds.push(bid);\n      });\n      if (xBonds.length !== 0 && xBonds.length !== 2) throw Error('Unsupported cross-bonds number');\n      var xAtom1 = -1;\n      var xAtom2 = -1;\n      var crossBond = null;\n      if (xBonds.length === 2) {\n        var bond1 = mol.bonds.get(xBonds[0]);\n        xAtom1 = sgroup.parentAtomSet.has(bond1.begin) ? bond1.begin : bond1.end;\n        var bond2 = mol.bonds.get(xBonds[1]);\n        xAtom2 = sgroup.parentAtomSet.has(bond2.begin) ? bond2.begin : bond2.end;\n        crossBond = bond2;\n      }\n      var tailAtom = xAtom2;\n      var newAtoms = [];\n      var _loop = function _loop() {\n        var amap = {};\n        sgroup.atoms.forEach(function (aid) {\n          var atom = mol.atoms.get(aid);\n          var aid2 = mol.atoms.add(new Atom(atom));\n          newAtoms.push(aid2);\n          sgroup.atomSet.add(aid2);\n          amap[aid] = aid2;\n        });\n        inBonds.forEach(function (bid) {\n          var bond = mol.bonds.get(bid);\n          var newBond = new Bond(bond);\n          newBond.begin = amap[newBond.begin];\n          newBond.end = amap[newBond.end];\n          mol.bonds.add(newBond);\n        });\n        if (crossBond !== null) {\n          newCrossBond = new Bond(crossBond);\n          newCrossBond.begin = tailAtom;\n          newCrossBond.end = amap[xAtom1];\n          mol.bonds.add(newCrossBond);\n          tailAtom = amap[xAtom2];\n        }\n      };\n      for (var j = 0; j < sgroup.data.mul - 1; j++) {\n        var newCrossBond;\n        _loop();\n      }\n      if (tailAtom >= 0) {\n        var xBond2 = mol.bonds.get(xBonds[1]);\n        if (xBond2.begin === xAtom2) xBond2.begin = tailAtom;else xBond2.end = tailAtom;\n      }\n      sgroup.bonds = xBonds;\n      newAtoms.forEach(function (aid) {\n        mol.sGroupForest.getPathToRoot(sgroup.id).reverse().forEach(function (sgid) {\n          mol.atomAddToSGroup(sgid, aid);\n        });\n      });\n    }\n  }, {\n    key: \"getMassCentre\",\n    value: function getMassCentre(mol, atoms) {\n      var c = new Vec2();\n      for (var i = 0; i < atoms.length; ++i) {\n        c = c.addScaled(mol.atoms.get(atoms[i]).pp, 1.0 / atoms.length);\n      }\n      return c;\n    }\n  }]);\n  return SGroup;\n}();\n_defineProperty(SGroup, \"TYPES\", {\n  MUL: 1,\n  SRU: 2,\n  SUP: 3,\n  DAT: 4,\n  GEN: 5\n});\nfunction descriptorIntersects(sgroups, topLeftPoint) {\n  return sgroups.some(function (sg) {\n    if (!sg.pp) return false;\n    var sgBottomRightPoint = sg.pp.add(new Vec2(0.5, 0.5));\n    var bottomRightPoint = topLeftPoint.add(new Vec2(0.5, 0.5));\n    return Box2Abs.segmentIntersection(sg.pp, sgBottomRightPoint, topLeftPoint, bottomRightPoint);\n  });\n}\n\nvar SGroupForest = function () {\n  function SGroupForest() {\n    _classCallCheck(this, SGroupForest);\n    _defineProperty(this, \"parent\", void 0);\n    _defineProperty(this, \"children\", void 0);\n    _defineProperty(this, \"atomSets\", void 0);\n    this.parent = new Map();\n    this.children = new Map();\n    this.children.set(-1, []);\n    this.atomSets = new Map();\n  }\n  _createClass(SGroupForest, [{\n    key: \"getSGroupsBFS\",\n    value: function getSGroupsBFS() {\n      var order = [];\n      var id = -1;\n      var queue = Array.from(this.children.get(-1));\n      while (queue.length > 0) {\n        id = queue.shift();\n        queue = queue.concat(this.children.get(id));\n        order.push(id);\n      }\n      return order;\n    }\n  }, {\n    key: \"getAtomSetRelations\",\n    value: function getAtomSetRelations(newId, atoms) {\n      var _this = this;\n      var isStrictSuperset = new Map();\n      var isSubset = new Map();\n      this.atomSets[\"delete\"](newId);\n      this.atomSets.forEach(function (atomSet, id) {\n        isSubset.set(id, atomSet.isSuperset(atoms));\n        isStrictSuperset.set(id, atoms.isSuperset(atomSet) && !atomSet.equals(atoms));\n      });\n      var parents = Array.from(this.atomSets.keys()).filter(function (sgid) {\n        if (!isSubset.get(sgid)) {\n          return false;\n        }\n        var childs = _this.children.get(sgid);\n        return childs && childs.findIndex(function (childId) {\n          return isSubset.get(childId);\n        }) < 0;\n      });\n      var children = Array.from(this.atomSets.keys()).filter(function (id) {\n        return isStrictSuperset.get(id) && !isStrictSuperset.get(_this.parent.get(id));\n      });\n      return {\n        children: children,\n        parent: parents.length === 0 ? -1 : parents[0]\n      };\n    }\n  }, {\n    key: \"getPathToRoot\",\n    value: function getPathToRoot(sgid) {\n      var path = [];\n      for (var id = sgid; id >= 0; id = this.parent.get(id)) {\n        console.assert(path.indexOf(id) < 0, 'SGroupForest: loop detected');\n        path.push(id);\n      }\n      return path;\n    }\n  }, {\n    key: \"insert\",\n    value: function insert(_ref, parent, children) {\n      var _this2 = this,\n          _this$children$get;\n      var id = _ref.id,\n          atoms = _ref.atoms;\n      console.assert(!this.parent.has(id), 'sgid already present in the forest');\n      console.assert(!this.children.has(id), 'sgid already present in the forest');\n      if (!parent || !children) {\n        var guess = this.getAtomSetRelations(id, new Pile(atoms));\n        parent = guess.parent;\n        children = guess.children;\n      }\n      children.forEach(function (childId) {\n        _this2.resetParentLink(childId, id);\n      });\n      this.children.set(id, children);\n      this.parent.set(id, parent);\n      (_this$children$get = this.children.get(parent)) === null || _this$children$get === void 0 ? void 0 : _this$children$get.push(id);\n      this.atomSets.set(id, new Pile(atoms));\n      return {\n        parent: parent,\n        children: children\n      };\n    }\n  }, {\n    key: \"resetParentLink\",\n    value: function resetParentLink(childId, id) {\n      var parentId = this.parent.get(childId);\n      if (typeof parentId === 'undefined') {\n        return;\n      }\n      var childs = this.children.get(parentId);\n      if (!childs) {\n        return;\n      }\n      var childIndex = childs.indexOf(childId);\n      childs.splice(childIndex, 1);\n      this.parent.set(childId, id);\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(id) {\n      var _this$children$get2,\n          _this3 = this;\n      console.assert(this.parent.has(id), 'sgid is not in the forest');\n      console.assert(this.children.has(id), 'sgid is not in the forest');\n      var parentId = this.parent.get(id);\n      var childs = this.children.get(parentId);\n      (_this$children$get2 = this.children.get(id)) === null || _this$children$get2 === void 0 ? void 0 : _this$children$get2.forEach(function (childId) {\n        var _this3$children$get;\n        _this3.parent.set(childId, parentId);\n        (_this3$children$get = _this3.children.get(parentId)) === null || _this3$children$get === void 0 ? void 0 : _this3$children$get.push(childId);\n      });\n      var i = childs.indexOf(id);\n      childs.splice(i, 1);\n      this.children[\"delete\"](id);\n      this.parent[\"delete\"](id);\n      this.atomSets[\"delete\"](id);\n    }\n  }]);\n  return SGroupForest;\n}();\nfunction checkOverlapping(struct, atoms) {\n  var sgroups = atoms.reduce(function (res, aid) {\n    var atom = struct.atoms.get(aid);\n    return res.union(atom.sgs);\n  }, new Pile());\n  return Array.from(sgroups).some(function (sid) {\n    var sg = struct.sgroups.get(sid);\n    if (sg.type === 'DAT') return false;\n    var sgAtoms = SGroup.getAtoms(struct, sg);\n    return sgAtoms.length < atoms.length ? sgAtoms.findIndex(function (aid) {\n      return atoms.indexOf(aid) === -1;\n    }) >= 0 : atoms.findIndex(function (aid) {\n      return sgAtoms.indexOf(aid) === -1;\n    }) >= 0;\n  });\n}\n\nvar SimpleObjectMode;\n(function (SimpleObjectMode) {\n  SimpleObjectMode[\"ellipse\"] = \"ellipse\";\n  SimpleObjectMode[\"rectangle\"] = \"rectangle\";\n  SimpleObjectMode[\"line\"] = \"line\";\n})(SimpleObjectMode || (SimpleObjectMode = {}));\nvar SimpleObject = function () {\n  function SimpleObject(params) {\n    _classCallCheck(this, SimpleObject);\n    _defineProperty(this, \"pos\", void 0);\n    _defineProperty(this, \"mode\", void 0);\n    params = params || {};\n    this.pos = [];\n    if (params.pos) {\n      for (var i = 0; i < params.pos.length; i++) {\n        var currentP = params.pos[i];\n        this.pos[i] = currentP ? new Vec2(params.pos[i]) : new Vec2();\n      }\n    }\n    this.mode = params.mode;\n  }\n  _createClass(SimpleObject, [{\n    key: \"clone\",\n    value: function clone() {\n      return new SimpleObject(this);\n    }\n  }, {\n    key: \"center\",\n    value: function center() {\n      switch (this.mode) {\n        case SimpleObjectMode.rectangle:\n          {\n            return Vec2.centre(this.pos[0], this.pos[1]);\n          }\n        default:\n          return this.pos[0];\n      }\n    }\n  }]);\n  return SimpleObject;\n}();\n\nfunction _createForOfIteratorHelper$2(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray$2(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray$2(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray$2(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray$2(o, minLen); }\nfunction _arrayLikeToArray$2(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\nfunction _createSuper$1(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct$1(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct$1() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\nvar Pool = function (_Map) {\n  _inherits(Pool, _Map);\n  var _super = _createSuper$1(Pool);\n  function Pool() {\n    var _this;\n    _classCallCheck(this, Pool);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"nextId\", 0);\n    return _this;\n  }\n  _createClass(Pool, [{\n    key: \"add\",\n    value: function add(item) {\n      var id = this.nextId++;\n      _get(_getPrototypeOf(Pool.prototype), \"set\", this).call(this, id, item);\n      return id;\n    }\n  }, {\n    key: \"newId\",\n    value: function newId() {\n      return this.nextId++;\n    }\n  }, {\n    key: \"keyOf\",\n    value: function keyOf(item) {\n      var _iterator = _createForOfIteratorHelper$2(this.entries()),\n          _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var _step$value = _slicedToArray(_step.value, 2),\n              key = _step$value[0],\n              value = _step$value[1];\n          if (value === item) return key;\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      return null;\n    }\n  }, {\n    key: \"find\",\n    value: function find(predicate) {\n      var _iterator2 = _createForOfIteratorHelper$2(this.entries()),\n          _step2;\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var _step2$value = _slicedToArray(_step2.value, 2),\n              key = _step2$value[0],\n              value = _step2$value[1];\n          if (predicate(key, value)) return key;\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n      return null;\n    }\n  }, {\n    key: \"filter\",\n    value: function filter(predicate) {\n      return new Pool(Array.from(this).filter(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n            key = _ref2[0],\n            value = _ref2[1];\n        return predicate(key, value);\n      }));\n    }\n  }]);\n  return Pool;\n}( _wrapNativeSuper(Map));\n\nfunction arrayAddIfMissing(array, item) {\n  for (var i = 0; i < array.length; ++i) {\n    if (array[i] === item) return false;\n  }\n  array.push(item);\n  return true;\n}\nvar Struct = function () {\n  function Struct() {\n    _classCallCheck(this, Struct);\n    _defineProperty(this, \"atoms\", void 0);\n    _defineProperty(this, \"bonds\", void 0);\n    _defineProperty(this, \"sgroups\", void 0);\n    _defineProperty(this, \"halfBonds\", void 0);\n    _defineProperty(this, \"loops\", void 0);\n    _defineProperty(this, \"isReaction\", void 0);\n    _defineProperty(this, \"rxnArrows\", void 0);\n    _defineProperty(this, \"rxnPluses\", void 0);\n    _defineProperty(this, \"frags\", void 0);\n    _defineProperty(this, \"rgroups\", void 0);\n    _defineProperty(this, \"name\", void 0);\n    _defineProperty(this, \"sGroupForest\", void 0);\n    _defineProperty(this, \"simpleObjects\", void 0);\n    _defineProperty(this, \"texts\", void 0);\n    this.atoms = new Pool();\n    this.bonds = new Pool();\n    this.sgroups = new Pool();\n    this.halfBonds = new Pool();\n    this.loops = new Pool();\n    this.isReaction = false;\n    this.rxnArrows = new Pool();\n    this.rxnPluses = new Pool();\n    this.frags = new Pool();\n    this.rgroups = new Pool();\n    this.name = '';\n    this.sGroupForest = new SGroupForest();\n    this.simpleObjects = new Pool();\n    this.texts = new Pool();\n  }\n  _createClass(Struct, [{\n    key: \"hasRxnProps\",\n    value: function hasRxnProps() {\n      return !!(this.atoms.find(function (_aid, atom) {\n        return atom.hasRxnProps();\n      }) || this.bonds.find(function (_bid, bond) {\n        return bond.hasRxnProps();\n      }));\n    }\n  }, {\n    key: \"hasRxnArrow\",\n    value: function hasRxnArrow() {\n      return this.rxnArrows.size === 1;\n    }\n  }, {\n    key: \"hasRxnPluses\",\n    value: function hasRxnPluses() {\n      return this.rxnPluses.size > 0;\n    }\n  }, {\n    key: \"isRxn\",\n    value: function isRxn() {\n      return this.hasRxnArrow() || this.hasRxnPluses();\n    }\n  }, {\n    key: \"isBlank\",\n    value: function isBlank() {\n      return this.atoms.size === 0 && this.rxnArrows.size === 0 && this.rxnPluses.size === 0 && this.simpleObjects.size === 0 && this.texts.size === 0;\n    }\n  }, {\n    key: \"clone\",\n    value: function clone(atomSet, bondSet, dropRxnSymbols, aidMap, simpleObjectsSet, textsSet) {\n      return this.mergeInto(new Struct(), atomSet, bondSet, dropRxnSymbols, false, aidMap, simpleObjectsSet, textsSet);\n    }\n  }, {\n    key: \"getScaffold\",\n    value: function getScaffold() {\n      var _this = this;\n      var atomSet = new Pile();\n      this.atoms.forEach(function (_atom, aid) {\n        atomSet.add(aid);\n      });\n      this.rgroups.forEach(function (rg) {\n        rg.frags.forEach(function (_fnum, fid) {\n          _this.atoms.forEach(function (atom, aid) {\n            if (atom.fragment === fid) atomSet[\"delete\"](aid);\n          });\n        });\n      });\n      return this.clone(atomSet);\n    }\n  }, {\n    key: \"getFragmentIds\",\n    value: function getFragmentIds(fid) {\n      var atomSet = new Pile();\n      this.atoms.forEach(function (atom, aid) {\n        if (atom.fragment === fid) atomSet.add(aid);\n      });\n      return atomSet;\n    }\n  }, {\n    key: \"getFragment\",\n    value: function getFragment(fid) {\n      return this.clone(this.getFragmentIds(fid), null, true);\n    }\n  }, {\n    key: \"mergeInto\",\n    value: function mergeInto(cp, atomSet, bondSet, dropRxnSymbols, keepAllRGroups, aidMap, simpleObjectsSet, textsSet) {\n      var _this2 = this;\n      atomSet = atomSet || new Pile(this.atoms.keys());\n      bondSet = bondSet || new Pile(this.bonds.keys());\n      simpleObjectsSet = simpleObjectsSet || new Pile(this.simpleObjects.keys());\n      textsSet = textsSet || new Pile(this.texts.keys());\n      aidMap = aidMap || new Map();\n      bondSet = bondSet.filter(function (bid) {\n        var bond = _this2.bonds.get(bid);\n        return atomSet.has(bond.begin) && atomSet.has(bond.end);\n      });\n      var fidMask = new Pile();\n      this.atoms.forEach(function (atom, aid) {\n        if (atomSet.has(aid)) fidMask.add(atom.fragment);\n      });\n      var fidMap = new Map();\n      this.frags.forEach(function (_frag, fid) {\n        if (fidMask.has(fid)) fidMap.set(fid, cp.frags.add(null));\n      });\n      var rgroupsIds = [];\n      this.rgroups.forEach(function (rgroup, rgid) {\n        var keepGroup = keepAllRGroups;\n        if (!keepGroup) {\n          rgroup.frags.forEach(function (_fnum, fid) {\n            rgroupsIds.push(fid);\n            if (fidMask.has(fid)) keepGroup = true;\n          });\n          if (!keepGroup) return;\n        }\n        var rg = cp.rgroups.get(rgid);\n        if (rg) {\n          rgroup.frags.forEach(function (_fnum, fid) {\n            rgroupsIds.push(fid);\n            if (fidMask.has(fid)) rg.frags.add(fidMap.get(fid));\n          });\n        } else {\n          cp.rgroups.set(rgid, rgroup.clone(fidMap));\n        }\n      });\n      this.atoms.forEach(function (atom, aid) {\n        if (atomSet.has(aid) && rgroupsIds.indexOf(atom.fragment) === -1) aidMap.set(aid, cp.atoms.add(atom.clone(fidMap)));\n      });\n      this.atoms.forEach(function (atom, aid) {\n        if (atomSet.has(aid) && rgroupsIds.indexOf(atom.fragment) !== -1) aidMap.set(aid, cp.atoms.add(atom.clone(fidMap)));\n      });\n      fidMap.forEach(function (newfid, oldfid) {\n        var frags = JSON.parse(JSON.stringify(_this2.frags.get(oldfid)));\n        if (frags && Object.keys(frags).length !== 0) {\n          cp.frags.set(newfid, _this2.frags.get(oldfid).clone(aidMap));\n        }\n      });\n      var bidMap = new Map();\n      this.bonds.forEach(function (bond, bid) {\n        if (bondSet.has(bid)) bidMap.set(bid, cp.bonds.add(bond.clone(aidMap)));\n      });\n      this.sgroups.forEach(function (sg) {\n        if (sg.atoms.some(function (aid) {\n          return !atomSet.has(aid);\n        })) return;\n        sg = SGroup.clone(sg, aidMap);\n        var id = cp.sgroups.add(sg);\n        sg.id = id;\n        sg.atoms.forEach(function (aid) {\n          cp.atoms.get(aid).sgs.add(id);\n        });\n        if (sg.type === 'DAT') cp.sGroupForest.insert(sg, -1, []);else cp.sGroupForest.insert(sg);\n      });\n      simpleObjectsSet.forEach(function (soid) {\n        cp.simpleObjects.add(_this2.simpleObjects.get(soid).clone());\n      });\n      textsSet.forEach(function (id) {\n        cp.texts.add(_this2.texts.get(id).clone());\n      });\n      if (!dropRxnSymbols) {\n        cp.isReaction = this.isReaction;\n        this.rxnArrows.forEach(function (item) {\n          cp.rxnArrows.add(item.clone());\n        });\n        this.rxnPluses.forEach(function (item) {\n          cp.rxnPluses.add(item.clone());\n        });\n      }\n      return cp;\n    }\n  }, {\n    key: \"prepareLoopStructure\",\n    value: function prepareLoopStructure() {\n      this.initHalfBonds();\n      this.initNeighbors();\n      this.updateHalfBonds(Array.from(this.atoms.keys()));\n      this.sortNeighbors(Array.from(this.atoms.keys()));\n      this.findLoops();\n    }\n  }, {\n    key: \"atomAddToSGroup\",\n    value: function atomAddToSGroup(sgid, aid) {\n      SGroup.addAtom(this.sgroups.get(sgid), aid);\n      this.atoms.get(aid).sgs.add(sgid);\n    }\n  }, {\n    key: \"calcConn\",\n    value: function calcConn(atom) {\n      var conn = 0;\n      for (var i = 0; i < atom.neighbors.length; ++i) {\n        var hb = this.halfBonds.get(atom.neighbors[i]);\n        var bond = this.bonds.get(hb.bid);\n        switch (bond.type) {\n          case Bond.PATTERN.TYPE.SINGLE:\n            conn += 1;\n            break;\n          case Bond.PATTERN.TYPE.DOUBLE:\n            conn += 2;\n            break;\n          case Bond.PATTERN.TYPE.TRIPLE:\n            conn += 3;\n            break;\n          case Bond.PATTERN.TYPE.DATIVE:\n            break;\n          case Bond.PATTERN.TYPE.HYDROGEN:\n            break;\n          case Bond.PATTERN.TYPE.AROMATIC:\n            if (atom.neighbors.length === 1) return [-1, true];\n            return [atom.neighbors.length, true];\n          default:\n            return [-1, false];\n        }\n      }\n      return [conn, false];\n    }\n  }, {\n    key: \"findBondId\",\n    value: function findBondId(begin, end) {\n      return this.bonds.find(function (_bid, bond) {\n        return bond.begin === begin && bond.end === end || bond.begin === end && bond.end === begin;\n      });\n    }\n  }, {\n    key: \"initNeighbors\",\n    value: function initNeighbors() {\n      var _this3 = this;\n      this.atoms.forEach(function (atom) {\n        atom.neighbors = [];\n      });\n      this.bonds.forEach(function (bond) {\n        var a1 = _this3.atoms.get(bond.begin);\n        var a2 = _this3.atoms.get(bond.end);\n        a1.neighbors.push(bond.hb1);\n        a2.neighbors.push(bond.hb2);\n      });\n    }\n  }, {\n    key: \"bondInitHalfBonds\",\n    value: function bondInitHalfBonds(bid, bond) {\n      bond = bond || this.bonds.get(bid);\n      bond.hb1 = 2 * bid;\n      bond.hb2 = 2 * bid + 1;\n      this.halfBonds.set(bond.hb1, new HalfBond(bond.begin, bond.end, bid));\n      this.halfBonds.set(bond.hb2, new HalfBond(bond.end, bond.begin, bid));\n      var hb1 = this.halfBonds.get(bond.hb1);\n      var hb2 = this.halfBonds.get(bond.hb2);\n      hb1.contra = bond.hb2;\n      hb2.contra = bond.hb1;\n    }\n  }, {\n    key: \"halfBondUpdate\",\n    value: function halfBondUpdate(hbid) {\n      var hb = this.halfBonds.get(hbid);\n      var p1 = this.atoms.get(hb.begin).pp;\n      var p2 = this.atoms.get(hb.end).pp;\n      var d = Vec2.diff(p2, p1).normalized();\n      hb.dir = Vec2.dist(p2, p1) > 1e-4 ? d : new Vec2(1, 0);\n      hb.norm = hb.dir.turnLeft();\n      hb.ang = hb.dir.oxAngle();\n      if (hb.loop < 0) hb.loop = -1;\n    }\n  }, {\n    key: \"initHalfBonds\",\n    value: function initHalfBonds() {\n      var _this4 = this;\n      this.halfBonds.clear();\n      this.bonds.forEach(function (bond, bid) {\n        _this4.bondInitHalfBonds(bid, bond);\n      });\n    }\n  }, {\n    key: \"setHbNext\",\n    value: function setHbNext(hbid, next) {\n      this.halfBonds.get(this.halfBonds.get(hbid).contra).next = next;\n    }\n  }, {\n    key: \"halfBondSetAngle\",\n    value: function halfBondSetAngle(hbid, left) {\n      var hb = this.halfBonds.get(hbid);\n      var hbl = this.halfBonds.get(left);\n      hbl.rightCos = Vec2.dot(hbl.dir, hb.dir);\n      hb.leftCos = Vec2.dot(hbl.dir, hb.dir);\n      hbl.rightSin = Vec2.cross(hbl.dir, hb.dir);\n      hb.leftSin = Vec2.cross(hbl.dir, hb.dir);\n      hb.leftNeighbor = left;\n      hbl.rightNeighbor = hbid;\n    }\n  }, {\n    key: \"atomAddNeighbor\",\n    value: function atomAddNeighbor(hbid) {\n      var hb = this.halfBonds.get(hbid);\n      var atom = this.atoms.get(hb.begin);\n      for (var i = 0; i < atom.neighbors.length; ++i) {\n        if (this.halfBonds.get(atom.neighbors[i]).ang > hb.ang) break;\n      }\n      atom.neighbors.splice(i, 0, hbid);\n      var ir = atom.neighbors[(i + 1) % atom.neighbors.length];\n      var il = atom.neighbors[(i + atom.neighbors.length - 1) % atom.neighbors.length];\n      this.setHbNext(il, hbid);\n      this.setHbNext(hbid, ir);\n      this.halfBondSetAngle(hbid, il);\n      this.halfBondSetAngle(ir, hbid);\n    }\n  }, {\n    key: \"atomSortNeighbors\",\n    value: function atomSortNeighbors(aid) {\n      var _this5 = this;\n      var atom = this.atoms.get(aid);\n      var halfBonds = this.halfBonds;\n      atom.neighbors.sort(function (nei, nei2) {\n        return halfBonds.get(nei).ang - halfBonds.get(nei2).ang;\n      }).forEach(function (nei, i) {\n        var nextNei = atom.neighbors[(i + 1) % atom.neighbors.length];\n        _this5.halfBonds.get(_this5.halfBonds.get(nei).contra).next = nextNei;\n        _this5.halfBondSetAngle(nextNei, nei);\n      });\n    }\n  }, {\n    key: \"sortNeighbors\",\n    value: function sortNeighbors(list) {\n      var _this6 = this;\n      if (!list) {\n        this.atoms.forEach(function (_atom, aid) {\n          _this6.atomSortNeighbors(aid);\n        });\n      } else {\n        list.forEach(function (aid) {\n          _this6.atomSortNeighbors(aid);\n        });\n      }\n    }\n  }, {\n    key: \"atomUpdateHalfBonds\",\n    value: function atomUpdateHalfBonds(aid) {\n      var _this7 = this;\n      this.atoms.get(aid).neighbors.forEach(function (hbid) {\n        _this7.halfBondUpdate(hbid);\n        _this7.halfBondUpdate(_this7.halfBonds.get(hbid).contra);\n      });\n    }\n  }, {\n    key: \"updateHalfBonds\",\n    value: function updateHalfBonds(list) {\n      var _this8 = this;\n      if (!list) {\n        this.atoms.forEach(function (_atom, aid) {\n          _this8.atomUpdateHalfBonds(aid);\n        });\n      } else {\n        list.forEach(function (aid) {\n          _this8.atomUpdateHalfBonds(aid);\n        });\n      }\n    }\n  }, {\n    key: \"sGroupsRecalcCrossBonds\",\n    value: function sGroupsRecalcCrossBonds() {\n      var _this9 = this;\n      this.sgroups.forEach(function (sg) {\n        sg.xBonds = [];\n        sg.neiAtoms = [];\n      });\n      this.bonds.forEach(function (bond, bid) {\n        var a1 = _this9.atoms.get(bond.begin);\n        var a2 = _this9.atoms.get(bond.end);\n        a1.sgs.forEach(function (sgid) {\n          if (!a2.sgs.has(sgid)) {\n            var sg = _this9.sgroups.get(sgid);\n            sg.xBonds.push(bid);\n            arrayAddIfMissing(sg.neiAtoms, bond.end);\n          }\n        });\n        a2.sgs.forEach(function (sgid) {\n          if (!a1.sgs.has(sgid)) {\n            var sg = _this9.sgroups.get(sgid);\n            sg.xBonds.push(bid);\n            arrayAddIfMissing(sg.neiAtoms, bond.begin);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"sGroupDelete\",\n    value: function sGroupDelete(sgid) {\n      var _this10 = this;\n      this.sgroups.get(sgid).atoms.forEach(function (atom) {\n        _this10.atoms.get(atom).sgs[\"delete\"](sgid);\n      });\n      this.sGroupForest.remove(sgid);\n      this.sgroups[\"delete\"](sgid);\n    }\n  }, {\n    key: \"atomSetPos\",\n    value: function atomSetPos(id, pp) {\n      var item = this.atoms.get(id);\n      item.pp = pp;\n    }\n  }, {\n    key: \"rxnPlusSetPos\",\n    value: function rxnPlusSetPos(id, pp) {\n      var item = this.rxnPluses.get(id);\n      item.pp = pp;\n    }\n  }, {\n    key: \"rxnArrowSetPos\",\n    value: function rxnArrowSetPos(id, pp) {\n      var item = this.rxnArrows.get(id);\n      if (item) {\n        item.pp = pp;\n      }\n    }\n  }, {\n    key: \"simpleObjectSetPos\",\n    value: function simpleObjectSetPos(id, pos) {\n      var item = this.simpleObjects.get(id);\n      item.pos = pos;\n    }\n  }, {\n    key: \"textSetPosition\",\n    value: function textSetPosition(id, position) {\n      var item = this.texts.get(id);\n      if (item) {\n        item.position = position;\n      }\n    }\n  }, {\n    key: \"getCoordBoundingBox\",\n    value: function getCoordBoundingBox(atomSet) {\n      var bb = null;\n      function extend(pp) {\n        if (!bb) {\n          bb = {\n            min: pp,\n            max: pp\n          };\n        } else {\n          bb.min = Vec2.min(bb.min, pp);\n          bb.max = Vec2.max(bb.max, pp);\n        }\n      }\n      var global = !atomSet || atomSet.size === 0;\n      this.atoms.forEach(function (atom, aid) {\n        if (global || atomSet.has(aid)) extend(atom.pp);\n      });\n      if (global) {\n        this.rxnPluses.forEach(function (item) {\n          extend(item.pp);\n        });\n        this.rxnArrows.forEach(function (item) {\n          extend(item.pp);\n        });\n      }\n      if (!bb && global) {\n        bb = {\n          min: new Vec2(0, 0),\n          max: new Vec2(1, 1)\n        };\n      }\n      return bb;\n    }\n  }, {\n    key: \"getCoordBoundingBoxObj\",\n    value: function getCoordBoundingBoxObj() {\n      var bb = null;\n      function extend(pp) {\n        if (!bb) {\n          bb = {\n            min: new Vec2(pp),\n            max: new Vec2(pp)\n          };\n        } else {\n          bb.min = Vec2.min(bb.min, pp);\n          bb.max = Vec2.max(bb.max, pp);\n        }\n      }\n      this.atoms.forEach(function (atom) {\n        extend(atom.pp);\n      });\n      return bb;\n    }\n  }, {\n    key: \"getBondLengthData\",\n    value: function getBondLengthData() {\n      var _this11 = this;\n      var totalLength = 0;\n      var cnt = 0;\n      this.bonds.forEach(function (bond) {\n        totalLength += Vec2.dist(_this11.atoms.get(bond.begin).pp, _this11.atoms.get(bond.end).pp);\n        cnt++;\n      });\n      return {\n        cnt: cnt,\n        totalLength: totalLength\n      };\n    }\n  }, {\n    key: \"getAvgBondLength\",\n    value: function getAvgBondLength() {\n      var bld = this.getBondLengthData();\n      return bld.cnt > 0 ? bld.totalLength / bld.cnt : -1;\n    }\n  }, {\n    key: \"getAvgClosestAtomDistance\",\n    value: function getAvgClosestAtomDistance() {\n      var totalDist = 0;\n      var minDist;\n      var dist = 0;\n      var keys = Array.from(this.atoms.keys());\n      var k;\n      var j;\n      for (k = 0; k < keys.length; ++k) {\n        minDist = -1;\n        for (j = 0; j < keys.length; ++j) {\n          if (j === k) continue;\n          dist = Vec2.dist(this.atoms.get(keys[j]).pp, this.atoms.get(keys[k]).pp);\n          if (minDist < 0 || minDist > dist) minDist = dist;\n        }\n        totalDist += minDist;\n      }\n      return keys.length > 0 ? totalDist / keys.length : -1;\n    }\n  }, {\n    key: \"checkBondExists\",\n    value: function checkBondExists(begin, end) {\n      var key = this.bonds.find(function (_bid, bond) {\n        return bond.begin === begin && bond.end === end || bond.end === begin && bond.begin === end;\n      });\n      return key !== undefined;\n    }\n  }, {\n    key: \"findConnectedComponent\",\n    value: function findConnectedComponent(firstaid) {\n      var _this12 = this;\n      var list = [firstaid];\n      var ids = new Pile();\n      while (list.length > 0) {\n        var aid = list.pop();\n        ids.add(aid);\n        var atom = this.atoms.get(aid);\n        atom.neighbors.forEach(function (nei) {\n          var neiId = _this12.halfBonds.get(nei).end;\n          if (!ids.has(neiId)) list.push(neiId);\n        });\n      }\n      return ids;\n    }\n  }, {\n    key: \"findConnectedComponents\",\n    value: function findConnectedComponents(discardExistingFragments) {\n      var _this13 = this;\n      if (!this.halfBonds.size) {\n        this.initHalfBonds();\n        this.initNeighbors();\n        this.updateHalfBonds(Array.from(this.atoms.keys()));\n        this.sortNeighbors(Array.from(this.atoms.keys()));\n      }\n      var addedAtoms = new Pile();\n      var components = [];\n      this.atoms.forEach(function (atom, aid) {\n        if ((discardExistingFragments || atom.fragment < 0) && !addedAtoms.has(aid)) {\n          var component = _this13.findConnectedComponent(aid);\n          components.push(component);\n          addedAtoms = addedAtoms.union(component);\n        }\n      });\n      return components;\n    }\n  }, {\n    key: \"markFragment\",\n    value: function markFragment(idSet) {\n      var _this14 = this;\n      var frag = new Fragment();\n      var fid = this.frags.add(frag);\n      idSet.forEach(function (aid) {\n        var atom = _this14.atoms.get(aid);\n        if (atom.stereoLabel) frag.updateStereoAtom(_this14, aid, fid, true);\n        atom.fragment = fid;\n      });\n    }\n  }, {\n    key: \"markFragments\",\n    value: function markFragments() {\n      var _this15 = this;\n      var components = this.findConnectedComponents();\n      components.forEach(function (comp) {\n        _this15.markFragment(comp);\n      });\n    }\n  }, {\n    key: \"scale\",\n    value: function scale(_scale) {\n      if (_scale === 1) return;\n      this.atoms.forEach(function (atom) {\n        atom.pp = atom.pp.scaled(_scale);\n      });\n      this.rxnPluses.forEach(function (item) {\n        item.pp = item.pp.scaled(_scale);\n      });\n      this.rxnArrows.forEach(function (item) {\n        item.pp = item.pp.scaled(_scale);\n      });\n      this.sgroups.forEach(function (item) {\n        item.pp = item.pp ? item.pp.scaled(_scale) : null;\n      });\n    }\n  }, {\n    key: \"rescale\",\n    value: function rescale() {\n      var avg = this.getAvgBondLength();\n      if (avg < 0 && !this.isReaction)\n        avg = this.getAvgClosestAtomDistance();\n      if (avg < 1e-3) avg = 1;\n      var scale = 1 / avg;\n      this.scale(scale);\n    }\n  }, {\n    key: \"loopHasSelfIntersections\",\n    value: function loopHasSelfIntersections(hbs) {\n      for (var i = 0; i < hbs.length; ++i) {\n        var hbi = this.halfBonds.get(hbs[i]);\n        var ai = this.atoms.get(hbi.begin).pp;\n        var bi = this.atoms.get(hbi.end).pp;\n        var set = new Pile([hbi.begin, hbi.end]);\n        for (var j = i + 2; j < hbs.length; ++j) {\n          var hbj = this.halfBonds.get(hbs[j]);\n          if (set.has(hbj.begin) || set.has(hbj.end)) continue;\n          var aj = this.atoms.get(hbj.begin).pp;\n          var bj = this.atoms.get(hbj.end).pp;\n          if (Box2Abs.segmentIntersection(ai, bi, aj, bj)) return true;\n        }\n      }\n      return false;\n    }\n  }, {\n    key: \"partitionLoop\",\n    value: function partitionLoop(loop) {\n      var subloops = [];\n      var continueFlag = true;\n      while (continueFlag) {\n        var atomToHalfBond = {};\n        continueFlag = false;\n        for (var l = 0; l < loop.length; ++l) {\n          var hbid = loop[l];\n          var aid1 = this.halfBonds.get(hbid).begin;\n          var aid2 = this.halfBonds.get(hbid).end;\n          if (aid2 in atomToHalfBond) {\n            var s = atomToHalfBond[aid2];\n            var subloop = loop.slice(s, l + 1);\n            subloops.push(subloop);\n            if (l < loop.length)\n              loop.splice(s, l - s + 1);\n            continueFlag = true;\n            break;\n          }\n          atomToHalfBond[aid1] = l;\n        }\n        if (!continueFlag) subloops.push(loop);\n      }\n      return subloops;\n    }\n  }, {\n    key: \"halfBondAngle\",\n    value: function halfBondAngle(hbid1, hbid2) {\n      var hba = this.halfBonds.get(hbid1);\n      var hbb = this.halfBonds.get(hbid2);\n      return Math.atan2(Vec2.cross(hba.dir, hbb.dir), Vec2.dot(hba.dir, hbb.dir));\n    }\n  }, {\n    key: \"loopIsConvex\",\n    value: function loopIsConvex(loop) {\n      var _this16 = this;\n      return loop.every(function (item, k, loopArr) {\n        var angle = _this16.halfBondAngle(item, loopArr[(k + 1) % loopArr.length]);\n        return angle <= 0;\n      });\n    }\n  }, {\n    key: \"loopIsInner\",\n    value: function loopIsInner(loop) {\n      var _this17 = this;\n      var totalAngle = 2 * Math.PI;\n      loop.forEach(function (hbida, k, loopArr) {\n        var hbidb = loopArr[(k + 1) % loopArr.length];\n        var hbb = _this17.halfBonds.get(hbidb);\n        var angle = _this17.halfBondAngle(hbida, hbidb);\n        totalAngle += hbb.contra === hbida ? Math.PI : angle;\n      });\n      return Math.abs(totalAngle) < Math.PI;\n    }\n  }, {\n    key: \"findLoops\",\n    value: function findLoops() {\n      var _this18 = this;\n      var newLoops = [];\n      var bondsToMark = new Pile();\n      var hbIdNext, c, loop;\n      this.halfBonds.forEach(function (hb, hbId) {\n        if (hb.loop !== -1) return;\n        for (hbIdNext = hbId, c = 0, loop = []; c <= _this18.halfBonds.size; hbIdNext = _this18.halfBonds.get(hbIdNext).next, ++c) {\n          if (!(c > 0 && hbIdNext === hbId)) {\n            loop.push(hbIdNext);\n            continue;\n          }\n          var subloops = _this18.partitionLoop(loop);\n          subloops.forEach(function (loop) {\n            var loopId;\n            if (_this18.loopIsInner(loop) && !_this18.loopHasSelfIntersections(loop)) {\n              loopId = Math.min.apply(Math, _toConsumableArray(loop));\n              _this18.loops.set(loopId, new Loop(loop, _this18, _this18.loopIsConvex(loop)));\n            } else {\n              loopId = -2;\n            }\n            loop.forEach(function (hbid) {\n              _this18.halfBonds.get(hbid).loop = loopId;\n              bondsToMark.add(_this18.halfBonds.get(hbid).bid);\n            });\n            if (loopId >= 0) newLoops.push(loopId);\n          });\n          break;\n        }\n      });\n      return {\n        newLoops: newLoops,\n        bondsToMark: Array.from(bondsToMark)\n      };\n    }\n  }, {\n    key: \"calcImplicitHydrogen\",\n    value: function calcImplicitHydrogen(aid) {\n      var atom = this.atoms.get(aid);\n      var _this$calcConn = this.calcConn(atom),\n          _this$calcConn2 = _slicedToArray(_this$calcConn, 2),\n          conn = _this$calcConn2[0],\n          isAromatic = _this$calcConn2[1];\n      var correctConn = conn;\n      atom.badConn = false;\n      if (isAromatic) {\n        if (atom.label === 'C' && atom.charge === 0) {\n          if (conn === 3) {\n            atom.implicitH = -radicalElectrons(atom.radical);\n            return;\n          }\n          if (conn === 2) {\n            atom.implicitH = 1 - radicalElectrons(atom.radical);\n            return;\n          }\n        } else if (atom.label === 'O' && atom.charge === 0 || atom.label === 'N' && atom.charge === 0 && conn === 3 || atom.label === 'N' && atom.charge === 1 && conn === 3 || atom.label === 'S' && atom.charge === 0 && conn === 3) {\n          atom.implicitH = 0;\n          return;\n        } else if (!atom.hasImplicitH) {\n          correctConn++;\n        }\n      }\n      if (correctConn < 0 || atom.isQuery()) {\n        atom.implicitH = 0;\n        return;\n      }\n      if (atom.explicitValence >= 0) {\n        var elem = Elements.get(atom.label);\n        atom.implicitH = !!elem ? atom.explicitValence - atom.calcValenceMinusHyd(correctConn) : 0;\n        if (atom.implicitH < 0) {\n          atom.implicitH = 0;\n          atom.badConn = true;\n        }\n      } else {\n        atom.calcValence(correctConn);\n      }\n    }\n  }, {\n    key: \"setImplicitHydrogen\",\n    value: function setImplicitHydrogen(list) {\n      var _this19 = this;\n      this.sgroups.forEach(function (item) {\n        if (item.data.fieldName === 'MRV_IMPLICIT_H') _this19.atoms.get(item.atoms[0]).hasImplicitH = true;\n      });\n      if (!list) {\n        this.atoms.forEach(function (_atom, aid) {\n          _this19.calcImplicitHydrogen(aid);\n        });\n      } else {\n        list.forEach(function (aid) {\n          if (_this19.atoms.get(aid)) {\n            _this19.calcImplicitHydrogen(aid);\n          }\n        });\n      }\n    }\n  }, {\n    key: \"atomGetNeighbors\",\n    value: function atomGetNeighbors(aid) {\n      var _this$atoms$get,\n          _this20 = this;\n      return (_this$atoms$get = this.atoms.get(aid)) === null || _this$atoms$get === void 0 ? void 0 : _this$atoms$get.neighbors.map(function (nei) {\n        var hb = _this20.halfBonds.get(nei);\n        return {\n          aid: hb.end,\n          bid: hb.bid\n        };\n      });\n    }\n  }, {\n    key: \"getComponents\",\n    value: function getComponents() {\n      var _this21 = this;\n      var connectedComponents = this.findConnectedComponents(true);\n      var barriers = [];\n      var arrowPos = null;\n      this.rxnArrows.forEach(function (item) {\n        arrowPos = item.pp.x;\n      });\n      this.rxnPluses.forEach(function (item) {\n        barriers.push(item.pp.x);\n      });\n      if (arrowPos !== null) barriers.push(arrowPos);\n      barriers.sort(function (a, b) {\n        return a - b;\n      });\n      var components = [];\n      connectedComponents.forEach(function (component) {\n        var bb = _this21.getCoordBoundingBox(component);\n        var c = Vec2.lc2(bb.min, 0.5, bb.max, 0.5);\n        var j = 0;\n        while (c.x > barriers[j]) {\n          ++j;\n        }\n        components[j] = components[j] || new Pile();\n        components[j] = components[j].union(component);\n      });\n      var reactants = [];\n      var products = [];\n      components.forEach(function (component) {\n        if (!component) {\n          return;\n        }\n        var rxnFragmentType = _this21.defineRxnFragmentTypeForAtomset(component, arrowPos || 0);\n        if (rxnFragmentType === 1) reactants.push(component);else products.push(component);\n      });\n      return {\n        reactants: reactants,\n        products: products\n      };\n    }\n  }, {\n    key: \"defineRxnFragmentTypeForAtomset\",\n    value: function defineRxnFragmentTypeForAtomset(atomset, arrowpos) {\n      var bb = this.getCoordBoundingBox(atomset);\n      var c = Vec2.lc2(bb.min, 0.5, bb.max, 0.5);\n      return c.x < arrowpos ? 1 : 2;\n    }\n  }, {\n    key: \"getBondFragment\",\n    value: function getBondFragment(bid) {\n      var _this$bonds$get, _this$atoms$get2;\n      var aid = (_this$bonds$get = this.bonds.get(bid)) === null || _this$bonds$get === void 0 ? void 0 : _this$bonds$get.begin;\n      return aid && ((_this$atoms$get2 = this.atoms.get(aid)) === null || _this$atoms$get2 === void 0 ? void 0 : _this$atoms$get2.fragment);\n    }\n  }]);\n  return Struct;\n}();\n\nvar TextCommand;\n(function (TextCommand) {\n  TextCommand[\"Bold\"] = \"BOLD\";\n  TextCommand[\"Italic\"] = \"ITALIC\";\n  TextCommand[\"Subscript\"] = \"SUBSCRIPT\";\n  TextCommand[\"Superscript\"] = \"SUPERSCRIPT\";\n})(TextCommand || (TextCommand = {}));\nvar Text = function () {\n  function Text(params) {\n    _classCallCheck(this, Text);\n    _defineProperty(this, \"content\", void 0);\n    _defineProperty(this, \"position\", void 0);\n    params = params || {};\n    this.content = params.content || '';\n    this.position = params.position ? new Vec2(params.position) : new Vec2();\n  }\n  _createClass(Text, [{\n    key: \"clone\",\n    value: function clone() {\n      return new Text(this);\n    }\n  }]);\n  return Text;\n}();\n\nfunction arrowToGraph(arrowNode) {\n  var coord = arrowNode.center;\n  return {\n    type: 'arrow',\n    location: [coord.x, coord.y, coord.z],\n    prop: arrowNode.data,\n    mode: arrowNode.mode\n  };\n}\nfunction plusToGraph(plusNode) {\n  var coord = plusNode.center;\n  return {\n    type: 'plus',\n    location: [coord.x, coord.y, coord.z],\n    prop: plusNode.data\n  };\n}\n\nfunction ifDef(target, key, value, defaultValue) {\n  if (value !== undefined && value !== null && value !== defaultValue && !(Array.isArray(value) && value.length === 0)) target[key] = value;\n}\n\nfunction headerToGraph(struct) {\n  var header = {};\n  ifDef(header, 'moleculeName', struct.name, '');\n  ifDef(header, 'creatorProgram', null, '');\n  ifDef(header, 'comment', null, '');\n  return Object.keys(header).length !== 0 ? header : null;\n}\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\nfunction fromRlabel(rg) {\n  var res = [];\n  var rgi;\n  var val;\n  for (rgi = 0; rgi < 32; rgi++) {\n    if (rg & 1 << rgi) {\n      val = rgi + 1;\n      res.push(val);\n    }\n  }\n  return res;\n}\nfunction moleculeToGraph(struct) {\n  var body = {\n    atoms: Array.from(struct.atoms.values()).map(function (atom) {\n      if (atom.label === 'R#') return rglabelToGraph(atom);\n      if (atom.label === 'L#') return atomListToGraph(atom);\n      return atomToGraph(atom);\n    })\n  };\n  if (struct.bonds.size !== 0) body.bonds = Array.from(struct.bonds.values()).map(bondToGraph);\n  if (struct.sgroups.size !== 0) body.sgroups = Array.from(struct.sgroups.values()).map(function (sGroup) {\n    return sgroupToGraph(struct, sGroup);\n  });\n  var fragment = struct.frags.get(0);\n  if (fragment) {\n    ifDef(body, 'stereoFlagPosition', fragment.stereoFlagPosition, null);\n  }\n  return _objectSpread({\n    type: 'molecule'\n  }, body);\n}\nfunction atomToGraph(source) {\n  var result = {};\n  ifDef(result, 'label', source.label);\n  ifDef(result, 'alias', source.alias);\n  ifDef(result, 'location', [source.pp.x, source.pp.y, source.pp.z]);\n  ifDef(result, 'charge', source.charge, 0);\n  ifDef(result, 'explicitValence', source.explicitValence, -1);\n  ifDef(result, 'isotope', source.isotope, 0);\n  ifDef(result, 'radical', source.radical, 0);\n  ifDef(result, 'attachmentPoints', source.attpnt, 0);\n  ifDef(result, 'stereoLabel', source.stereoLabel, null);\n  ifDef(result, 'stereoParity', source.stereoCare, 0);\n  ifDef(result, 'weight', source.weight, 0);\n  ifDef(result, 'ringBondCount', source.ringBondCount, 0);\n  ifDef(result, 'substitutionCount', source.substitutionCount, 0);\n  ifDef(result, 'unsaturatedAtom', !!source.unsaturatedAtom, false);\n  ifDef(result, 'hCount', source.hCount, 0);\n  ifDef(result, 'mapping', parseInt(source.aam), 0);\n  ifDef(result, 'invRet', source.invRet, 0);\n  ifDef(result, 'exactChangeFlag', !!source.exactChangeFlag, false);\n  return result;\n}\nfunction rglabelToGraph(source) {\n  var result = {\n    type: 'rg-label'\n  };\n  ifDef(result, 'location', [source.pp.x, source.pp.y, source.pp.z]);\n  ifDef(result, 'attachmentPoints', source.attpnt, 0);\n  var refsToRGroups = fromRlabel(source.rglabel).map(function (rgnumber) {\n    return \"rg-\".concat(rgnumber);\n  });\n  ifDef(result, '$refs', refsToRGroups);\n  return result;\n}\nfunction atomListToGraph(source) {\n  var result = {\n    type: 'atom-list'\n  };\n  ifDef(result, 'location', [source.pp.x, source.pp.y, source.pp.z]);\n  ifDef(result, 'attachmentPoints', source.attpnt, 0);\n  ifDef(result, 'elements', source.atomList.labelList());\n  ifDef(result, 'notList', source.atomList.notList, false);\n  return result;\n}\nfunction bondToGraph(source) {\n  var result = {};\n  ifDef(result, 'type', source.type);\n  ifDef(result, 'atoms', [source.begin, source.end]);\n  ifDef(result, 'stereo', source.stereo, 0);\n  ifDef(result, 'topology', source.topology, 0);\n  ifDef(result, 'center', source.reactingCenterStatus, 0);\n  return result;\n}\nfunction sgroupToGraph(struct, source) {\n  var result = {};\n  ifDef(result, 'type', source.type);\n  ifDef(result, 'atoms', source.atoms);\n  switch (source.type) {\n    case 'GEN':\n      break;\n    case 'MUL':\n      {\n        ifDef(result, 'mul', source.data.mul || 1);\n        break;\n      }\n    case 'SRU':\n      {\n        ifDef(result, 'subscript', source.data.subscript || 'n');\n        ifDef(result, 'connectivity', source.data.connectivity.toUpperCase() || 'ht');\n        break;\n      }\n    case 'SUP':\n      {\n        ifDef(result, 'name', source.data.name || '');\n        break;\n      }\n    case 'DAT':\n      {\n        var data = source.data;\n        ifDef(result, 'placement', data.absolute, true);\n        ifDef(result, 'display', data.attached, false);\n        ifDef(result, 'context', data.context);\n        ifDef(result, 'fieldName', data.fieldName);\n        ifDef(result, 'fieldData', data.fieldValue);\n        ifDef(result, 'bonds', SGroup.getBonds(struct, source));\n        break;\n      }\n  }\n  return result;\n}\n\nfunction toRlabel(values) {\n  var res = 0;\n  values.forEach(function (val) {\n    var rgi = val - 1;\n    res |= 1 << rgi;\n  });\n  return res;\n}\nfunction moleculeToStruct(graphItem) {\n  var struct = new Struct();\n  graphItem.atoms.forEach(function (atom) {\n    if (atom.type === 'rg-label') struct.atoms.add(rglabelToStruct(atom));\n    if (atom.type === 'atom-list') struct.atoms.add(atomListToStruct(atom));\n    if (!atom.type) struct.atoms.add(atomToStruct(atom));\n  });\n  if (graphItem.bonds) graphItem.bonds.forEach(function (bond) {\n    return struct.bonds.add(bondToStruct(bond));\n  });\n  if (graphItem.sgroups) graphItem.sgroups.forEach(function (sgroup) {\n    return struct.sgroups.add(sgroupToStruct(sgroup));\n  });\n  struct.initHalfBonds();\n  struct.initNeighbors();\n  struct.markFragments();\n  return struct;\n}\nfunction atomToStruct(source) {\n  var params = {};\n  ifDef(params, 'label', source.label);\n  ifDef(params, 'alias', source.alias);\n  ifDef(params, 'pp', {\n    x: source.location[0],\n    y: source.location[1],\n    z: source.location[2] || 0.0\n  });\n  ifDef(params, 'charge', source.charge);\n  ifDef(params, 'explicitValence', source.explicitValence);\n  ifDef(params, 'isotope', source.isotope);\n  ifDef(params, 'radical', source.radical);\n  ifDef(params, 'attpnt', source.attachmentPoints);\n  ifDef(params, 'stereoLabel', source.stereoLabel);\n  ifDef(params, 'stereoParity', source.stereoParity);\n  ifDef(params, 'weight', source.weight);\n  ifDef(params, 'ringBondCount', source.ringBondCount);\n  ifDef(params, 'substitutionCount', source.substitutionCount);\n  ifDef(params, 'unsaturatedAtom', source.unsaturatedAtom);\n  ifDef(params, 'hCount', source.hCount);\n  ifDef(params, 'aam', source.mapping);\n  ifDef(params, 'invRet', source.invRet);\n  ifDef(params, 'exactChangeFlag', !!source.exactChangeFlag);\n  return new Atom(params);\n}\nfunction rglabelToStruct(source) {\n  var params = {};\n  params.label = 'R#';\n  ifDef(params, 'pp', {\n    x: source.location[0],\n    y: source.location[1],\n    z: source.location[2] || 0.0\n  });\n  ifDef(params, 'attpnt', source.attachmentPoints);\n  var rglabel = toRlabel(source.$refs.map(function (el) {\n    return parseInt(el.slice(3));\n  }));\n  ifDef(params, 'rglabel', rglabel);\n  return new Atom(params);\n}\nfunction atomListToStruct(source) {\n  var params = {};\n  params.label = 'L#';\n  ifDef(params, 'pp', {\n    x: source.location[0],\n    y: source.location[1],\n    z: source.location[2] || 0.0\n  });\n  ifDef(params, 'attpnt', source.attachmentPoints);\n  var ids = source.elements.map(function (el) {\n    var _Elements$get;\n    return (_Elements$get = Elements.get(el)) === null || _Elements$get === void 0 ? void 0 : _Elements$get.number;\n  }).filter(function (id) {\n    return id;\n  });\n  ifDef(params, 'atomList', {\n    ids: ids,\n    notList: source.notList\n  });\n  return new Atom(params);\n}\nfunction bondToStruct(source) {\n  var params = {};\n  ifDef(params, 'type', source.type);\n  ifDef(params, 'topology', source.topology);\n  ifDef(params, 'reactingCenterStatus', source.center);\n  ifDef(params, 'stereo', source.stereo);\n  ifDef(params, 'begin', source.atoms[0]);\n  ifDef(params, 'end', source.atoms[1]);\n  return new Bond(params);\n}\nfunction sgroupToStruct(source) {\n  var sgroup = new SGroup(source.type);\n  ifDef(sgroup, 'atoms', source.atoms);\n  switch (source.type) {\n    case 'GEN':\n      break;\n    case 'MUL':\n      {\n        ifDef(sgroup.data, 'mul', source.mul);\n        break;\n      }\n    case 'SRU':\n      {\n        ifDef(sgroup.data, 'subscript', source.subscript);\n        ifDef(sgroup.data, 'connectivity', source.connectivity.toLowerCase());\n        break;\n      }\n    case 'SUP':\n      {\n        ifDef(sgroup.data, 'name', source.name);\n        break;\n      }\n    case 'DAT':\n      {\n        ifDef(sgroup.data, 'absolute', source.placement);\n        ifDef(sgroup.data, 'attached', source.display);\n        ifDef(sgroup.data, 'context', source.context);\n        ifDef(sgroup.data, 'fieldName', source.fieldName);\n        ifDef(sgroup.data, 'fieldValue', source.fieldData);\n        break;\n      }\n  }\n  return sgroup;\n}\n\nfunction _createForOfIteratorHelper$3(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray$3(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray$3(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray$3(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray$3(o, minLen); }\nfunction _arrayLikeToArray$3(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\nfunction prepareStructForGraph(struct) {\n  var graphNodes = [];\n  var rgFrags = new Set();\n  var _iterator = _createForOfIteratorHelper$3(struct.rgroups.entries()),\n      _step;\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var _step$value = _slicedToArray(_step.value, 2),\n          rgnumber = _step$value[0],\n          rgroup = _step$value[1];\n      rgroup.frags.forEach(function (frid) {\n        return rgFrags.add(frid);\n      });\n      var fragsAtoms = Array.from(rgroup.frags.values()).reduce(function (res, frid) {\n        return res.union(struct.getFragmentIds(frid));\n      }, new Pile());\n      graphNodes.push({\n        type: 'rgroup',\n        fragment: struct.clone(fragsAtoms),\n        center: getFragmentCenter(struct, fragsAtoms),\n        data: {\n          rgnumber: rgnumber,\n          rgroup: rgroup\n        }\n      });\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n  Array.from(struct.frags.keys()).filter(function (fid) {\n    return !rgFrags.has(fid);\n  }).forEach(function (fid) {\n    var fragAtoms = struct.getFragmentIds(fid);\n    graphNodes.push({\n      type: 'molecule',\n      fragment: struct.clone(fragAtoms),\n      center: getFragmentCenter(struct, fragAtoms)\n    });\n  });\n  struct.rxnArrows.forEach(function (item) {\n    graphNodes.push({\n      type: 'arrow',\n      center: item.pp,\n      data: {},\n      mode: item.mode\n    });\n  });\n  struct.rxnPluses.forEach(function (item) {\n    graphNodes.push({\n      type: 'plus',\n      center: item.pp,\n      data: {}\n    });\n  });\n  struct.simpleObjects.forEach(function (item) {\n    graphNodes.push({\n      type: 'simpleObject',\n      center: item.pos[0],\n      data: {\n        mode: item.mode,\n        pos: item.pos\n      }\n    });\n  });\n  struct.texts.forEach(function (item) {\n    graphNodes.push({\n      type: 'text',\n      center: item.position,\n      data: {\n        content: item.content,\n        position: item.position\n      }\n    });\n  });\n  return graphNodes.sort(function (a, b) {\n    return a.center.x - b.center.x;\n  });\n}\nfunction getFragmentCenter(struct, atomSet) {\n  var bb = struct.getCoordBoundingBox(atomSet);\n  return Vec2.centre(bb.min, bb.max);\n}\n\nfunction ownKeys$1(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread$1(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$1(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$1(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\nfunction rgroupToGraph(struct, data) {\n  var body = _objectSpread$1({\n    rlogic: rgroupLogicToGraph(data.rgnumber, data.rgroup)\n  }, moleculeToGraph(struct));\n  return _objectSpread$1(_objectSpread$1({}, body), {}, {\n    type: 'rgroup'\n  });\n}\nfunction rgroupLogicToGraph(rgnumber, rglogic) {\n  var result = {};\n  ifDef(result, 'number', rgnumber);\n  ifDef(result, 'range', rglogic.range, '');\n  ifDef(result, 'resth', rglogic.resth, false);\n  ifDef(result, 'ifthen', rglogic.ifthen, 0);\n  return result;\n}\n\nfunction rgroupToStruct(graphItem) {\n  var struct = moleculeToStruct(graphItem);\n  var rgroup = rgroupLogicToStruct(graphItem.rlogic);\n  struct.frags.forEach(function (_value, key) {\n    rgroup.frags.add(key);\n  });\n  if (graphItem.rlogic) struct.rgroups.set(graphItem.rlogic.number, rgroup);\n  return struct;\n}\nfunction rgroupLogicToStruct(rglogic) {\n  var params = {};\n  ifDef(params, 'range', rglogic.range);\n  ifDef(params, 'resth', rglogic.resth);\n  ifDef(params, 'ifthen', rglogic.ifthen);\n  return new RGroup(params);\n}\n\nfunction rxnToStruct(graphItem, struct) {\n  if (graphItem.type === 'arrow') {\n    struct.rxnArrows.add(new RxnArrow(new Vec2(graphItem.location[0], graphItem.location[1], graphItem.location[2]), graphItem.mode));\n  } else {\n    struct.rxnPluses.add(new RxnPlus({\n      pp: {\n        x: graphItem.location[0],\n        y: graphItem.location[1],\n        z: graphItem.location[2]\n      }\n    }));\n  }\n  return struct;\n}\n\nfunction simpleObjectToGraph(simpleObjectNode) {\n  return {\n    type: 'simpleObject',\n    data: simpleObjectNode.data\n  };\n}\n\nfunction simpleObjectToStruct(graphItem, struct) {\n  var object = graphItem.data.mode === 'circle' ? circleToEllipse(graphItem) : graphItem.data;\n  struct.simpleObjects.add(new SimpleObject(object));\n  return struct;\n}\nfunction circleToEllipse(graphItem) {\n  var radius = Vec2.dist(graphItem.data.pos[1], graphItem.data.pos[0]);\n  var pos0 = graphItem.data.pos[0];\n  return {\n    mode: SimpleObjectMode.ellipse,\n    pos: [{\n      x: pos0.x - Math.abs(radius),\n      y: pos0.y - Math.abs(radius),\n      z: pos0.z - Math.abs(radius)\n    }, {\n      x: pos0.x + Math.abs(radius),\n      y: pos0.y + Math.abs(radius),\n      z: pos0.z + Math.abs(radius)\n    }]\n  };\n}\n\nfunction textToGraph(textNode) {\n  return {\n    type: 'text',\n    data: textNode.data\n  };\n}\n\nfunction textToStruct(graphItem, struct) {\n  var object = graphItem.data;\n  struct.texts.add(new Text(object));\n  return struct;\n}\n\nvar $schema = \"http://json-schema.org/draft-07/schema#\";\nvar title = \"ket\";\nvar description = \"Ketcher format schema\";\nvar type = \"object\";\nvar required = [\n\t\"root\"\n];\nvar properties = {\n\troot: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"nodes\"\n\t\t],\n\t\tproperties: {\n\t\t\tnodes: {\n\t\t\t\ttype: \"array\",\n\t\t\t\tminItems: 1,\n\t\t\t\titems: {\n\t\t\t\t\toneOf: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$ref: \"#/definitions/simpleObject\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$ref: \"#/definitions/text\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$ref: \"#/definitions/arrow\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$ref: \"#/definitions/plus\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\"$ref\"\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t$ref: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\tpattern: \"^(mol\\\\d+|rg[1-9]\\\\d*)\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\nvar patternProperties = {\n\t\"^rg[1-9]\\\\d*\": {\n\t\t$ref: \"#/definitions/rgroup\"\n\t},\n\t\"^mol\\\\d+\": {\n\t\t$ref: \"#/definitions/molecule\"\n\t}\n};\nvar additionalProperties = false;\nvar definitions = {\n\trsite: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"type\",\n\t\t\t\"location\"\n\t\t],\n\t\tproperties: {\n\t\t\ttype: {\n\t\t\t\t\"const\": \"rg-label\"\n\t\t\t},\n\t\t\tlocation: {\n\t\t\t\ttype: \"array\",\n\t\t\t\tminItems: 2,\n\t\t\t\tmaxItems: 3,\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"number\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t$refs: {\n\t\t\t\ttype: \"array\",\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tpattern: \"^rg-[1-9]\\\\d*\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tattachmentPoints: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t1,\n\t\t\t\t\t2,\n\t\t\t\t\t3\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t},\n\tatom: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"label\"\n\t\t],\n\t\tproperties: {\n\t\t\tlabel: {\n\t\t\t\ttype: \"string\"\n\t\t\t},\n\t\t\tlocation: {\n\t\t\t\ttype: \"array\",\n\t\t\t\tminItems: 2,\n\t\t\t\tmaxItems: 3,\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"number\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tcharge: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\tminimum: -1000,\n\t\t\t\tmaximum: 1000\n\t\t\t},\n\t\t\texplicitValence: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t-1,\n\t\t\t\t\t0,\n\t\t\t\t\t1,\n\t\t\t\t\t2,\n\t\t\t\t\t3,\n\t\t\t\t\t4,\n\t\t\t\t\t5,\n\t\t\t\t\t6,\n\t\t\t\t\t7,\n\t\t\t\t\t8,\n\t\t\t\t\t9,\n\t\t\t\t\t10,\n\t\t\t\t\t11,\n\t\t\t\t\t12\n\t\t\t\t]\n\t\t\t},\n\t\t\tisotope: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\tminimum: 0,\n\t\t\t\tmaximum: 1000\n\t\t\t},\n\t\t\tradical: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t2,\n\t\t\t\t\t1,\n\t\t\t\t\t3\n\t\t\t\t]\n\t\t\t},\n\t\t\tattachmentPoints: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t1,\n\t\t\t\t\t2,\n\t\t\t\t\t3\n\t\t\t\t]\n\t\t\t},\n\t\t\tstereoLabel: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tpattern: \"(?:(?:^&|or)[0-9]+$)|(?:^abs$)\"\n\t\t\t},\n\t\t\tstereoParity: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t1,\n\t\t\t\t\t2,\n\t\t\t\t\t3\n\t\t\t\t]\n\t\t\t},\n\t\t\tringBondCount: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t-2,\n\t\t\t\t\t-1,\n\t\t\t\t\t2,\n\t\t\t\t\t3,\n\t\t\t\t\t4\n\t\t\t\t]\n\t\t\t},\n\t\t\tsubstitutionCount: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t-2,\n\t\t\t\t\t-1,\n\t\t\t\t\t1,\n\t\t\t\t\t2,\n\t\t\t\t\t3,\n\t\t\t\t\t4,\n\t\t\t\t\t5,\n\t\t\t\t\t6\n\t\t\t\t]\n\t\t\t},\n\t\t\tunsaturatedAtom: {\n\t\t\t\ttype: \"boolean\"\n\t\t\t},\n\t\t\thCount: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t-1,\n\t\t\t\t\t0,\n\t\t\t\t\t1,\n\t\t\t\t\t2,\n\t\t\t\t\t3,\n\t\t\t\t\t4,\n\t\t\t\t\t5\n\t\t\t\t]\n\t\t\t},\n\t\t\tmapping: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\tminimum: 0\n\t\t\t},\n\t\t\tinvRet: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t1,\n\t\t\t\t\t2\n\t\t\t\t]\n\t\t\t},\n\t\t\texactChangeFlag: {\n\t\t\t\ttype: \"boolean\"\n\t\t\t}\n\t\t},\n\t\tadditionalProperties: false\n\t},\n\tatomlist: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"type\",\n\t\t\t\"location\"\n\t\t],\n\t\tproperties: {\n\t\t\ttype: {\n\t\t\t\t\"enum\": [\n\t\t\t\t\t\"atom-list\"\n\t\t\t\t]\n\t\t\t},\n\t\t\tnotList: {\n\t\t\t\ttype: \"boolean\"\n\t\t\t},\n\t\t\tlocation: {\n\t\t\t\ttype: \"array\",\n\t\t\t\tminItems: 2,\n\t\t\t\tmaxItems: 3,\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"number\"\n\t\t\t\t}\n\t\t\t},\n\t\t\telements: {\n\t\t\t\ttype: \"array\",\n\t\t\t\tminItems: 2,\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tminLength: 1\n\t\t\t\t}\n\t\t\t},\n\t\t\tattachmentPoints: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t1,\n\t\t\t\t\t2,\n\t\t\t\t\t3\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t},\n\tbond: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"atoms\",\n\t\t\t\"type\"\n\t\t],\n\t\tproperties: {\n\t\t\ttype: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t1,\n\t\t\t\t\t2,\n\t\t\t\t\t3,\n\t\t\t\t\t4,\n\t\t\t\t\t5,\n\t\t\t\t\t6,\n\t\t\t\t\t7,\n\t\t\t\t\t8,\n\t\t\t\t\t9,\n\t\t\t\t\t10,\n\t\t\t\t\t11,\n\t\t\t\t\t12\n\t\t\t\t]\n\t\t\t},\n\t\t\tatoms: {\n\t\t\t\ttype: \"array\",\n\t\t\t\tminItems: 2,\n\t\t\t\tmaxItems: 2,\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"integer\",\n\t\t\t\t\tminimum: 0,\n\t\t\t\t\tuniqueItems: true\n\t\t\t\t}\n\t\t\t},\n\t\t\tstereo: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t1,\n\t\t\t\t\t3,\n\t\t\t\t\t4,\n\t\t\t\t\t6\n\t\t\t\t]\n\t\t\t},\n\t\t\ttopology: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t1,\n\t\t\t\t\t2\n\t\t\t\t]\n\t\t\t},\n\t\t\tcenter: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t-1,\n\t\t\t\t\t1,\n\t\t\t\t\t2,\n\t\t\t\t\t4,\n\t\t\t\t\t8,\n\t\t\t\t\t12\n\t\t\t\t]\n\t\t\t},\n\t\t\tstereobox: {\n\t\t\t\ttype: \"integer\",\n\t\t\t\t\"enum\": [\n\t\t\t\t\t0,\n\t\t\t\t\t1\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t},\n\trgroup: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"rlogic\",\n\t\t\t\"type\"\n\t\t],\n\t\tproperties: {\n\t\t\ttype: {\n\t\t\t\t\"const\": \"rgroup\"\n\t\t\t},\n\t\t\trlogic: {\n\t\t\t\ttype: \"object\",\n\t\t\t\trequired: [\n\t\t\t\t\t\"number\"\n\t\t\t\t],\n\t\t\t\tproperties: {\n\t\t\t\t\tnumber: {\n\t\t\t\t\t\ttype: \"integer\",\n\t\t\t\t\t\tminimum: 1\n\t\t\t\t\t},\n\t\t\t\t\trange: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tmaxLength: 50,\n\t\t\t\t\t\t\"default\": \"\"\n\t\t\t\t\t},\n\t\t\t\t\tresth: {\n\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\"default\": false\n\t\t\t\t\t},\n\t\t\t\t\tifthen: {\n\t\t\t\t\t\ttype: \"integer\",\n\t\t\t\t\t\tminimum: 0,\n\t\t\t\t\t\t\"default\": 0\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tallOf: [\n\t\t\t{\n\t\t\t\t$ref: \"#/definitions/structure\"\n\t\t\t}\n\t\t]\n\t},\n\tmolecule: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"type\"\n\t\t],\n\t\tproperties: {\n\t\t\ttype: {\n\t\t\t\t\"const\": \"molecule\"\n\t\t\t}\n\t\t},\n\t\tallOf: [\n\t\t\t{\n\t\t\t\t$ref: \"#/definitions/structure\"\n\t\t\t}\n\t\t]\n\t},\n\tstructure: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"atoms\"\n\t\t],\n\t\tproperties: {\n\t\t\tstereoFlagPosition: {\n\t\t\t\ttype: \"object\",\n\t\t\t\trequired: [\n\t\t\t\t\t\"x\",\n\t\t\t\t\t\"y\"\n\t\t\t\t],\n\t\t\t\tproperties: {\n\t\t\t\t\tx: {\n\t\t\t\t\t\ttype: \"number\"\n\t\t\t\t\t},\n\t\t\t\t\ty: {\n\t\t\t\t\t\ttype: \"number\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tatoms: {\n\t\t\t\ttype: \"array\",\n\t\t\t\titems: {\n\t\t\t\t\toneOf: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$ref: \"#/definitions/atom\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$ref: \"#/definitions/rsite\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$ref: \"#/definitions/atomlist\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t},\n\t\t\tbonds: {\n\t\t\t\ttype: \"array\",\n\t\t\t\titems: {\n\t\t\t\t\t$ref: \"#/definitions/bond\"\n\t\t\t\t}\n\t\t\t},\n\t\t\thighlight: {\n\t\t\t\t$ref: \"#/definitions/subset\"\n\t\t\t},\n\t\t\tselection: {\n\t\t\t\t$ref: \"#/definitions/subset\"\n\t\t\t},\n\t\t\tsgroups: {\n\t\t\t\t$ref: \"#/definitions/sgroups\"\n\t\t\t}\n\t\t}\n\t},\n\tsubset: {\n\t\ttype: \"array\",\n\t\tminItems: 1,\n\t\tmaxItems: 2,\n\t\titems: {\n\t\t\toneOf: [\n\t\t\t\t{\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"entityType\",\n\t\t\t\t\t\t\"items\"\n\t\t\t\t\t],\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tentityType: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\"const\": \"atoms\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\ttype: \"integer\",\n\t\t\t\t\t\t\t\tminimum: 0,\n\t\t\t\t\t\t\t\tuniqueItems: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"entityType\",\n\t\t\t\t\t\t\"items\"\n\t\t\t\t\t],\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tentityType: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\"const\": \"bonds\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\ttype: \"integer\",\n\t\t\t\t\t\t\t\tminimum: 0,\n\t\t\t\t\t\t\t\tuniqueItems: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t},\n\tsgroups: {\n\t\ttype: \"array\",\n\t\titems: {\n\t\t\trequired: [\n\t\t\t\t\"atoms\",\n\t\t\t\t\"type\"\n\t\t\t],\n\t\t\tproperties: {\n\t\t\t\tatoms: {\n\t\t\t\t\ttype: \"array\",\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: \"integer\",\n\t\t\t\t\t\tminimum: 0\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttype: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\"enum\": [\n\t\t\t\t\t\t\"GEN\",\n\t\t\t\t\t\t\"MUL\",\n\t\t\t\t\t\t\"SRU\",\n\t\t\t\t\t\t\"SUP\",\n\t\t\t\t\t\t\"DAT\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"if\": {\n\t\t\t\tproperties: {\n\t\t\t\t\ttype: {\n\t\t\t\t\t\t\"const\": \"DAT\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tthen: {\n\t\t\t\trequired: [\n\t\t\t\t\t\"fieldName\"\n\t\t\t\t],\n\t\t\t\tproperties: {\n\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\"enum\": [\n\t\t\t\t\t\t\t\"Fragment\",\n\t\t\t\t\t\t\t\"Multifragment\",\n\t\t\t\t\t\t\t\"Bond\",\n\t\t\t\t\t\t\t\"Atom\",\n\t\t\t\t\t\t\t\"Group\"\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\tfieldName: {\n\t\t\t\t\t\ttype: \"string\"\n\t\t\t\t\t},\n\t\t\t\t\tfieldValue: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tminLength: 1\n\t\t\t\t\t},\n\t\t\t\t\tdisplay: {\n\t\t\t\t\t\ttype: \"boolean\"\n\t\t\t\t\t},\n\t\t\t\t\tplacement: {\n\t\t\t\t\t\ttype: \"boolean\"\n\t\t\t\t\t},\n\t\t\t\t\tbonds: {\n\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\ttype: \"integer\",\n\t\t\t\t\t\t\tminimum: 0\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tplus: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"type\",\n\t\t\t\"location\"\n\t\t],\n\t\tproperties: {\n\t\t\ttype: {\n\t\t\t\t\"const\": \"plus\"\n\t\t\t},\n\t\t\tlocation: {\n\t\t\t\ttype: \"array\",\n\t\t\t\tminItems: 2,\n\t\t\t\tmaxItems: 3,\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"number\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tarrow: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"type\",\n\t\t\t\"location\"\n\t\t],\n\t\tproperties: {\n\t\t\ttype: {\n\t\t\t\t\"const\": \"arrow\"\n\t\t\t},\n\t\t\tlocation: {\n\t\t\t\ttype: \"array\",\n\t\t\t\tminItems: 2,\n\t\t\t\tmaxItems: 3,\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"number\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tsimpleObject: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"type\",\n\t\t\t\"data\"\n\t\t],\n\t\tproperties: {\n\t\t\ttype: {\n\t\t\t\t\"const\": \"simpleObject\"\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: \"object\",\n\t\t\t\trequired: [\n\t\t\t\t\t\"mode\"\n\t\t\t\t],\n\t\t\t\tproperties: {\n\t\t\t\t\tmode: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\"enum\": [\n\t\t\t\t\t\t\t\"line\",\n\t\t\t\t\t\t\t\"rectangle\",\n\t\t\t\t\t\t\t\"circle\",\n\t\t\t\t\t\t\t\"ellipse\",\n\t\t\t\t\t\t\t\"polyline\"\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"if\": {\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tmode: {\n\t\t\t\t\t\t\t\"const\": \"polyline\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tthen: {\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"pos\"\n\t\t\t\t\t],\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tpos: {\n\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\tminItems: 2,\n\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\"x\",\n\t\t\t\t\t\t\t\t\t\"y\"\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\ttype: \"number\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ty: {\n\t\t\t\t\t\t\t\t\t\ttype: \"number\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tz: {\n\t\t\t\t\t\t\t\t\t\ttype: \"number\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"else\": {\n\t\t\t\t\trequired: [\n\t\t\t\t\t\t\"pos\"\n\t\t\t\t\t],\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tpos: {\n\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\tminItems: 2,\n\t\t\t\t\t\t\tmaxItems: 2,\n\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\"x\",\n\t\t\t\t\t\t\t\t\t\"y\"\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\ttype: \"number\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ty: {\n\t\t\t\t\t\t\t\t\t\ttype: \"number\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tz: {\n\t\t\t\t\t\t\t\t\t\ttype: \"number\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\ttext: {\n\t\ttype: \"object\",\n\t\trequired: [\n\t\t\t\"type\",\n\t\t\t\"data\"\n\t\t],\n\t\tproperties: {\n\t\t\ttype: {\n\t\t\t\t\"const\": \"text\"\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: \"object\",\n\t\t\t\trequired: [\n\t\t\t\t\t\"content\",\n\t\t\t\t\t\"position\"\n\t\t\t\t],\n\t\t\t\tproperties: {\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\ttype: \"string\"\n\t\t\t\t\t},\n\t\t\t\t\tposition: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\"x\",\n\t\t\t\t\t\t\t\"y\"\n\t\t\t\t\t\t],\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\ttype: \"number\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ty: {\n\t\t\t\t\t\t\t\ttype: \"number\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\nvar schema = {\n\t$schema: $schema,\n\ttitle: title,\n\tdescription: description,\n\ttype: type,\n\trequired: required,\n\tproperties: properties,\n\tpatternProperties: patternProperties,\n\tadditionalProperties: additionalProperties,\n\tdefinitions: definitions\n};\n\nfunction validate(graph) {\n  var validator = new Validator();\n  var result = validator.validate(graph, schema);\n  return result.valid;\n}\n\nfunction parseNode(node, struct) {\n  var type = node.type;\n  switch (type) {\n    case 'arrow':\n      rxnToStruct(node, struct);\n      break;\n    case 'plus':\n      rxnToStruct(node, struct);\n      break;\n    case 'simpleObject':\n      simpleObjectToStruct(node, struct);\n      break;\n    case 'molecule':\n      var currentStruct = moleculeToStruct(node);\n      if (node.stereoFlagPosition) {\n        var fragment = currentStruct.frags.get(0);\n        fragment.stereoFlagPosition = new Vec2(node.stereoFlagPosition);\n      }\n      currentStruct.mergeInto(struct);\n      break;\n    case 'rgroup':\n      rgroupToStruct(node).mergeInto(struct);\n      break;\n    case 'text':\n      textToStruct(node, struct);\n      break;\n  }\n}\nvar KetSerializer = function () {\n  function KetSerializer() {\n    _classCallCheck(this, KetSerializer);\n  }\n  _createClass(KetSerializer, [{\n    key: \"deserialize\",\n    value: function deserialize(content) {\n      var resultingStruct = new Struct();\n      var graph = JSON.parse(content);\n      if (!validate(graph)) {\n        throw new Error('Cannot deserialize input JSON.');\n      }\n      resultingStruct.name = graph.header ? graph.header.moleculeName : null;\n      var nodes = graph.root.nodes;\n      Object.keys(nodes).forEach(function (i) {\n        if (nodes[i].type) parseNode(nodes[i], resultingStruct);else if (nodes[i].$ref) parseNode(graph[nodes[i].$ref], resultingStruct);\n      });\n      return resultingStruct;\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize(struct) {\n      var result = {\n        root: {\n          nodes: []\n        }\n      };\n      var header = headerToGraph(struct);\n      if (header) result.header = header;\n      var graphNodes = prepareStructForGraph(struct);\n      var moleculeId = 0;\n      graphNodes.forEach(function (item) {\n        switch (item.type) {\n          case 'molecule':\n            {\n              result.root.nodes.push({\n                $ref: \"mol\".concat(moleculeId)\n              });\n              result[\"mol\".concat(moleculeId++)] = moleculeToGraph(item.fragment);\n              break;\n            }\n          case 'rgroup':\n            {\n              result.root.nodes.push({\n                $ref: \"rg\".concat(item.data.rgnumber)\n              });\n              result[\"rg\".concat(item.data.rgnumber)] = rgroupToGraph(item.fragment, item.data);\n              break;\n            }\n          case 'plus':\n            {\n              result.root.nodes.push(plusToGraph(item));\n              break;\n            }\n          case 'arrow':\n            {\n              result.root.nodes.push(arrowToGraph(item));\n              break;\n            }\n          case 'simpleObject':\n            {\n              result.root.nodes.push(simpleObjectToGraph(item));\n              break;\n            }\n          case 'text':\n            {\n              result.root.nodes.push(textToGraph(item));\n              break;\n            }\n        }\n      });\n      return JSON.stringify(result, null, 4);\n    }\n  }]);\n  return KetSerializer;\n}();\n\nfunction paddedNum(number, width, precision) {\n  number = parseFloat(number);\n  var numStr = number.toFixed(precision || 0).replace(',', '.');\n  if (numStr.length > width) throw new Error('number does not fit');\n  return numStr.padStart(width);\n}\nfunction parseDecimalInt(str) {\n  var val = parseInt(str, 10);\n  return isNaN(val) ? 0 : val;\n}\nfunction partitionLine(\nstr,\nparts,\nwithspace) {\n  var res = [];\n  for (var i = 0, shift = 0; i < parts.length; ++i) {\n    res.push(str.slice(shift, shift + parts[i]));\n    if (withspace) shift++;\n    shift += parts[i];\n  }\n  return res;\n}\nfunction partitionLineFixed(\nstr,\nitemLength,\nwithspace) {\n  var res = [];\n  for (var shift = 0; shift < str.length; shift += itemLength) {\n    res.push(str.slice(shift, shift + itemLength));\n    if (withspace) shift++;\n  }\n  return res;\n}\nvar fmtInfo = {\n  bondTypeMap: {\n    1: Bond.PATTERN.TYPE.SINGLE,\n    2: Bond.PATTERN.TYPE.DOUBLE,\n    3: Bond.PATTERN.TYPE.TRIPLE,\n    4: Bond.PATTERN.TYPE.AROMATIC,\n    5: Bond.PATTERN.TYPE.SINGLE_OR_DOUBLE,\n    6: Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC,\n    7: Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC,\n    8: Bond.PATTERN.TYPE.ANY,\n    9: Bond.PATTERN.TYPE.DATIVE,\n    10: Bond.PATTERN.TYPE.HYDROGEN\n  },\n  bondStereoMap: {\n    0: Bond.PATTERN.STEREO.NONE,\n    1: Bond.PATTERN.STEREO.UP,\n    4: Bond.PATTERN.STEREO.EITHER,\n    6: Bond.PATTERN.STEREO.DOWN,\n    3: Bond.PATTERN.STEREO.CIS_TRANS\n  },\n  v30bondStereoMap: {\n    0: Bond.PATTERN.STEREO.NONE,\n    1: Bond.PATTERN.STEREO.UP,\n    2: Bond.PATTERN.STEREO.EITHER,\n    3: Bond.PATTERN.STEREO.DOWN\n  },\n  bondTopologyMap: {\n    0: Bond.PATTERN.TOPOLOGY.EITHER,\n    1: Bond.PATTERN.TOPOLOGY.RING,\n    2: Bond.PATTERN.TOPOLOGY.CHAIN\n  },\n  countsLinePartition: [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 6],\n  atomLinePartition: [10, 10, 10, 1, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],\n  bondLinePartition: [3, 3, 3, 3, 3, 3, 3],\n  atomListHeaderPartition: [3, 1, 1, 4, 1, 1],\n  atomListHeaderLength: 11,\n  atomListHeaderItemLength: 4,\n  chargeMap: [0, +3, +2, +1, 0, -1, -2, -3],\n  valenceMap: [undefined, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 0],\n  implicitHydrogenMap: [undefined, 0, 1, 2, 3, 4],\n  v30atomPropMap: {\n    CHG: 'charge',\n    RAD: 'radical',\n    MASS: 'isotope',\n    VAL: 'explicitValence',\n    HCOUNT: 'hCount',\n    INVRET: 'invRet',\n    SUBST: 'substitutionCount',\n    UNSAT: 'unsaturatedAtom',\n    RBCNT: 'ringBondCount'\n  },\n  rxnItemsPartition: [3, 3, 3]\n};\nvar FRAGMENT = {\n  NONE: 0,\n  REACTANT: 1,\n  PRODUCT: 2,\n  AGENT: 3\n};\nfunction rxnMerge(mols, nReactants, nProducts, nAgents, shouldReactionRelayout)\n{\n  var ret = new Struct();\n  var bbReact = [],\n      bbAgent = [],\n      bbProd = [];\n  var molReact = [],\n      molAgent = [],\n      molProd = [];\n  var j;\n  var bondLengthData = {\n    cnt: 0,\n    totalLength: 0\n  };\n  for (j = 0; j < mols.length; ++j) {\n    var mol = mols[j];\n    var bondLengthDataMol = mol.getBondLengthData();\n    bondLengthData.cnt += bondLengthDataMol.cnt;\n    bondLengthData.totalLength += bondLengthDataMol.totalLength;\n  }\n  {\n    var avgBondLength = 1 / (bondLengthData.cnt == 0 ? 1 : bondLengthData.totalLength / bondLengthData.cnt);\n    for (j = 0; j < mols.length; ++j) {\n      mol = mols[j];\n      mol.scale(avgBondLength);\n    }\n  }\n  for (j = 0; j < mols.length; ++j) {\n    mol = mols[j];\n    var bb = mol.getCoordBoundingBoxObj();\n    if (!bb) continue;\n    var fragmentType = j < nReactants ? FRAGMENT.REACTANT\n    : j < nReactants + nProducts ? FRAGMENT.PRODUCT : FRAGMENT.AGENT;\n    if (fragmentType == FRAGMENT.REACTANT) {\n      bbReact.push(bb);\n      molReact.push(mol);\n    } else if (fragmentType == FRAGMENT.AGENT) {\n      bbAgent.push(bb);\n      molAgent.push(mol);\n    } else if (fragmentType == FRAGMENT.PRODUCT) {\n      bbProd.push(bb);\n      molProd.push(mol);\n    }\n    mol.atoms.forEach(function (atom) {\n      atom.rxnFragmentType = fragmentType;\n    });\n  }\n  function shiftMol(ret, mol, bb, xorig, over) {\n    var d = new Vec2(xorig - bb.min.x, over ? 1 - bb.min.y : -(bb.min.y + bb.max.y) / 2);\n    mol.atoms.forEach(function (atom) {\n      atom.pp.add_(d);\n    });\n    mol.sgroups.forEach(function (item) {\n      if (item.pp) item.pp.add_(d);\n    });\n    bb.min.add_(d);\n    bb.max.add_(d);\n    mol.mergeInto(ret);\n    return bb.max.x - bb.min.x;\n  }\n  if (shouldReactionRelayout) {\n    var xorig = 0;\n    for (j = 0; j < molReact.length; ++j) {\n      xorig += shiftMol(ret, molReact[j], bbReact[j], xorig, false) + 2.0;\n    }\n    xorig += 2.0;\n    for (j = 0; j < molAgent.length; ++j) {\n      xorig += shiftMol(ret, molAgent[j], bbAgent[j], xorig, true) + 2.0;\n    }\n    xorig += 2.0;\n    for (j = 0; j < molProd.length; ++j) {\n      xorig += shiftMol(ret, molProd[j], bbProd[j], xorig, false) + 2.0;\n    }\n  } else {\n    for (j = 0; j < molReact.length; ++j) {\n      molReact[j].mergeInto(ret);\n    }\n    for (j = 0; j < molAgent.length; ++j) {\n      molAgent[j].mergeInto(ret);\n    }\n    for (j = 0; j < molProd.length; ++j) {\n      molProd[j].mergeInto(ret);\n    }\n  }\n  var bb1;\n  var bb2;\n  var x;\n  var y;\n  var bbReactAll = null;\n  var bbProdAll = null;\n  for (j = 0; j < bbReact.length - 1; ++j) {\n    bb1 = bbReact[j];\n    bb2 = bbReact[j + 1];\n    x = (bb1.max.x + bb2.min.x) / 2;\n    y = (bb1.max.y + bb1.min.y + bb2.max.y + bb2.min.y) / 4;\n    ret.rxnPluses.add(new RxnPlus({\n      pp: new Vec2(x, y)\n    }));\n  }\n  for (j = 0; j < bbReact.length; ++j) {\n    if (j == 0) {\n      bbReactAll = {};\n      bbReactAll.max = new Vec2(bbReact[j].max);\n      bbReactAll.min = new Vec2(bbReact[j].min);\n    } else {\n      bbReactAll.max = Vec2.max(bbReactAll.max, bbReact[j].max);\n      bbReactAll.min = Vec2.min(bbReactAll.min, bbReact[j].min);\n    }\n  }\n  for (j = 0; j < bbProd.length - 1; ++j) {\n    bb1 = bbProd[j];\n    bb2 = bbProd[j + 1];\n    x = (bb1.max.x + bb2.min.x) / 2;\n    y = (bb1.max.y + bb1.min.y + bb2.max.y + bb2.min.y) / 4;\n    ret.rxnPluses.add(new RxnPlus({\n      pp: new Vec2(x, y)\n    }));\n  }\n  for (j = 0; j < bbProd.length; ++j) {\n    if (j == 0) {\n      bbProdAll = {};\n      bbProdAll.max = new Vec2(bbProd[j].max);\n      bbProdAll.min = new Vec2(bbProd[j].min);\n    } else {\n      bbProdAll.max = Vec2.max(bbProdAll.max, bbProd[j].max);\n      bbProdAll.min = Vec2.min(bbProdAll.min, bbProd[j].min);\n    }\n  }\n  bb1 = bbReactAll;\n  bb2 = bbProdAll;\n  if (!bb1 && !bb2) {\n    ret.rxnArrows.add(new RxnArrow(new Vec2(0, 0)));\n  } else {\n    var v1 = bb1 ? new Vec2(bb1.max.x, (bb1.max.y + bb1.min.y) / 2) : null;\n    var v2 = bb2 ? new Vec2(bb2.min.x, (bb2.max.y + bb2.min.y) / 2) : null;\n    var defaultOffset = 3;\n    if (!v1) v1 = new Vec2(v2.x - defaultOffset, v2.y);\n    if (!v2) v2 = new Vec2(v1.x + defaultOffset, v1.y);\n    ret.rxnArrows.add(new RxnArrow(Vec2.lc2(v1, 0.5, v2, 0.5)));\n  }\n  ret.isReaction = true;\n  return ret;\n}\nvar utils = {\n  fmtInfo: fmtInfo,\n  paddedNum: paddedNum,\n  parseDecimalInt: parseDecimalInt,\n  partitionLine: partitionLine,\n  partitionLineFixed: partitionLineFixed,\n  rxnMerge: rxnMerge\n};\n\nfunction _createForOfIteratorHelper$4(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray$4(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray$4(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray$4(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray$4(o, minLen); }\nfunction _arrayLikeToArray$4(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\nfunction readKeyValuePairs(str, valueString) {\n  var ret = new Pool();\n  var partition = utils.partitionLineFixed(str, 3, true);\n  var count = utils.parseDecimalInt(partition[0]);\n  for (var i = 0; i < count; ++i) {\n    var key = utils.parseDecimalInt(partition[2 * i + 1]) - 1;\n    var value = valueString ? partition[2 * i + 2].trim() : utils.parseDecimalInt(partition[2 * i + 2]);\n    ret.set(key, value);\n  }\n  return ret;\n}\nfunction readKeyMultiValuePairs(str, valueString) {\n  var ret = [];\n  var partition = utils.partitionLineFixed(str, 3, true);\n  var count = utils.parseDecimalInt(partition[0]);\n  for (var i = 0; i < count; ++i) {\n    ret.push([\n    utils.parseDecimalInt(partition[2 * i + 1]) - 1, valueString ? partition[2 * i + 2].trim() : utils.parseDecimalInt(partition[2 * i + 2])\n    ]);\n  }\n  return ret;\n}\nfunction postLoadMul(sgroup, mol, atomMap) {\n  sgroup.data.mul = sgroup.data.subscript - 0;\n  var atomReductionMap = {};\n  sgroup.atoms = SGroup.filterAtoms(sgroup.atoms, atomMap);\n  sgroup.patoms = SGroup.filterAtoms(sgroup.patoms, atomMap);\n  for (var k = 1; k < sgroup.data.mul; ++k) {\n    for (var m = 0; m < sgroup.patoms.length; ++m) {\n      var raid = sgroup.atoms[k * sgroup.patoms.length + m];\n      if (raid < 0) continue;\n      if (sgroup.patoms[m] < 0) throw new Error('parent atom missing');\n      atomReductionMap[raid] = sgroup.patoms[m];\n    }\n  }\n  sgroup.patoms = SGroup.removeNegative(sgroup.patoms);\n  var patomsMap = identityMap(sgroup.patoms);\n  var bondsToRemove = [];\n  mol.bonds.forEach(function (bond, bid) {\n    var beginIn = (bond.begin in atomReductionMap);\n    var endIn = (bond.end in atomReductionMap);\n    if (beginIn && endIn || beginIn && bond.end in patomsMap || endIn && bond.begin in patomsMap) bondsToRemove.push(bid);\n    else if (beginIn) bond.begin = atomReductionMap[bond.begin];else if (endIn) bond.end = atomReductionMap[bond.end];\n  }, sgroup);\n  for (var b = 0; b < bondsToRemove.length; ++b) {\n    mol.bonds[\"delete\"](bondsToRemove[b]);\n  }\n  for (var a in atomReductionMap) {\n    mol.atoms[\"delete\"](+a);\n    atomMap[a] = -1;\n  }\n  sgroup.atoms = sgroup.patoms;\n  sgroup.patoms = null;\n}\nfunction postLoadSru(sgroup) {\n  sgroup.data.connectivity = (sgroup.data.connectivity || 'EU').trim().toLowerCase();\n}\nfunction postLoadSup(sgroup) {\n  sgroup.data.name = (sgroup.data.subscript || '').trim();\n  sgroup.data.subscript = '';\n}\nfunction postLoadGen(sgroup, mol, atomMap) {\n}\nfunction postLoadDat(sgroup, mol) {\n  if (!sgroup.data.absolute) sgroup.pp = sgroup.pp.add(SGroup.getMassCentre(mol, sgroup.atoms));\n}\nfunction loadSGroup(mol, sg, atomMap) {\n  var postLoadMap = {\n    MUL: postLoadMul,\n    SRU: postLoadSru,\n    SUP: postLoadSup,\n    DAT: postLoadDat,\n    GEN: postLoadGen\n  };\n  sg.id = mol.sgroups.add(sg);\n  postLoadMap[sg.type](sg, mol, atomMap);\n  for (var s = 0; s < sg.atoms.length; ++s) {\n    if (mol.atoms.has(sg.atoms[s])) mol.atoms.get(sg.atoms[s]).sgs.add(sg.id);\n  }\n  if (sg.type === 'DAT') mol.sGroupForest.insert(sg, -1, []);else mol.sGroupForest.insert(sg);\n  return sg.id;\n}\nfunction initSGroup(sGroups, propData) {\n  var kv = readKeyValuePairs(propData, true);\n  var _iterator = _createForOfIteratorHelper$4(kv),\n      _step;\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var _step$value = _slicedToArray(_step.value, 2),\n          key = _step$value[0],\n          type = _step$value[1];\n      if (!(type in SGroup.TYPES)) throw new Error('Unsupported S-group type');\n      var sg = new SGroup(type);\n      sg.number = key;\n      sGroups[key] = sg;\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n}\nfunction applySGroupProp(sGroups, propName, propData, numeric, core) {\n  var kv = readKeyValuePairs(propData, !numeric);\n  var _iterator2 = _createForOfIteratorHelper$4(kv.keys()),\n      _step2;\n  try {\n    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n      var key = _step2.value;\n      (core ? sGroups[key] : sGroups[key].data)[propName] = kv.get(key);\n    }\n  } catch (err) {\n    _iterator2.e(err);\n  } finally {\n    _iterator2.f();\n  }\n}\nfunction applySGroupArrayProp(sGroups, propName, propData, shift) {\n  var sid = utils.parseDecimalInt(propData.slice(1, 4)) - 1;\n  var num = utils.parseDecimalInt(propData.slice(4, 8));\n  var part = toIntArray(utils.partitionLineFixed(propData.slice(8), 3, true));\n  if (part.length !== num) throw new Error('File format invalid');\n  if (shift) part = part.map(function (v) {\n    return v + shift;\n  });\n  sGroups[sid][propName] = sGroups[sid][propName].concat(part);\n}\nfunction applyDataSGroupName(sg, name) {\n  sg.data.fieldName = name;\n}\nfunction applyDataSGroupQuery(sg, query) {\n  sg.data.query = query;\n}\nfunction applyDataSGroupQueryOp(sg, queryOp) {\n  sg.data.queryOp = queryOp;\n}\nfunction applyDataSGroupDesc(sGroups, propData) {\n  var split = utils.partitionLine(propData, [4, 31, 2, 20, 2, 3], false);\n  var id = utils.parseDecimalInt(split[0]) - 1;\n  var fieldName = split[1].trim();\n  var fieldType = split[2].trim();\n  var units = split[3].trim();\n  var query = split[4].trim();\n  var queryOp = split[5].trim();\n  var sGroup = sGroups[id];\n  sGroup.data.fieldType = fieldType;\n  sGroup.data.fieldName = fieldName;\n  sGroup.data.units = units;\n  sGroup.data.query = query;\n  sGroup.data.queryOp = queryOp;\n}\nfunction applyDataSGroupInfo(sg, propData) {\n  var split = utils.partitionLine(propData, [10\n  , 10\n  , 4\n  , 1\n  , 1\n  , 1\n  , 3\n  , 3\n  , 3\n  , 3\n  , 2\n  , 3\n  , 2\n  ], false);\n  var x = parseFloat(split[0]);\n  var y = parseFloat(split[1]);\n  var attached = split[3].trim() == 'A';\n  var absolute = split[4].trim() == 'A';\n  var showUnits = split[5].trim() == 'U';\n  var nCharsToDisplay = split[7].trim();\n  nCharsToDisplay = nCharsToDisplay == 'ALL' ? -1 : utils.parseDecimalInt(nCharsToDisplay);\n  var tagChar = split[10].trim();\n  var daspPos = utils.parseDecimalInt(split[11].trim());\n  sg.pp = new Vec2(x, -y);\n  sg.data.attached = attached;\n  sg.data.absolute = absolute;\n  sg.data.showUnits = showUnits;\n  sg.data.nCharsToDisplay = nCharsToDisplay;\n  sg.data.tagChar = tagChar;\n  sg.data.daspPos = daspPos;\n}\nfunction applyDataSGroupInfoLine(sGroups, propData) {\n  var id = utils.parseDecimalInt(propData.substr(0, 4)) - 1;\n  var sg = sGroups[id];\n  applyDataSGroupInfo(sg, propData.substr(5));\n}\nfunction applyDataSGroupData(sg, data, finalize) {\n  sg.data.fieldValue = (sg.data.fieldValue || '') + data;\n  if (finalize) {\n    sg.data.fieldValue = trimRight(sg.data.fieldValue);\n    if (sg.data.fieldValue.startsWith('\"') && sg.data.fieldValue.endsWith('\"')) sg.data.fieldValue = sg.data.fieldValue.substr(1, sg.data.fieldValue.length - 2);\n  }\n}\nfunction applyDataSGroupDataLine(sGroups, propData, finalize) {\n  var id = utils.parseDecimalInt(propData.substr(0, 5)) - 1;\n  var data = propData.substr(5);\n  var sg = sGroups[id];\n  applyDataSGroupData(sg, data, finalize);\n}\nfunction toIntArray(strArray) {\n  var ret = [];\n  for (var j = 0; j < strArray.length; ++j) {\n    ret[j] = utils.parseDecimalInt(strArray[j]);\n  }\n  return ret;\n}\nfunction trimRight(str) {\n  return str.replace(/\\s+$/, '');\n}\nfunction identityMap(array) {\n  var map = {};\n  for (var i = 0; i < array.length; ++i) {\n    map[array[i]] = array[i];\n  }\n  return map;\n}\nvar sGroup = {\n  readKeyValuePairs: readKeyValuePairs,\n  readKeyMultiValuePairs: readKeyMultiValuePairs,\n  loadSGroup: loadSGroup,\n  initSGroup: initSGroup,\n  applySGroupProp: applySGroupProp,\n  applySGroupArrayProp: applySGroupArrayProp,\n  applyDataSGroupName: applyDataSGroupName,\n  applyDataSGroupQuery: applyDataSGroupQuery,\n  applyDataSGroupQueryOp: applyDataSGroupQueryOp,\n  applyDataSGroupDesc: applyDataSGroupDesc,\n  applyDataSGroupInfo: applyDataSGroupInfo,\n  applyDataSGroupData: applyDataSGroupData,\n  applyDataSGroupInfoLine: applyDataSGroupInfoLine,\n  applyDataSGroupDataLine: applyDataSGroupDataLine\n};\n\nfunction parseAtomLine(atomLine) {\n  var atomSplit = utils.partitionLine(atomLine, utils.fmtInfo.atomLinePartition);\n  var params = {\n    pp: new Vec2(parseFloat(atomSplit[0]), -parseFloat(atomSplit[1]), parseFloat(atomSplit[2])),\n    label: atomSplit[4].trim(),\n    explicitValence: utils.fmtInfo.valenceMap[utils.parseDecimalInt(atomSplit[10])],\n    massDifference: utils.parseDecimalInt(atomSplit[5]),\n    charge: utils.fmtInfo.chargeMap[utils.parseDecimalInt(atomSplit[6])],\n    hCount: utils.parseDecimalInt(utils.parseDecimalInt(atomSplit[8])),\n    stereoCare: utils.parseDecimalInt(atomSplit[9]) != 0,\n    aam: utils.parseDecimalInt(atomSplit[14]),\n    invRet: utils.parseDecimalInt(atomSplit[15]),\n    exactChangeFlag: utils.parseDecimalInt(atomSplit[16]) != 0\n  };\n  return new Atom(params);\n}\nfunction parseBondLine(bondLine) {\n  var bondSplit = utils.partitionLine(bondLine, utils.fmtInfo.bondLinePartition);\n  var params = {\n    begin: utils.parseDecimalInt(bondSplit[0]) - 1,\n    end: utils.parseDecimalInt(bondSplit[1]) - 1,\n    type: utils.fmtInfo.bondTypeMap[utils.parseDecimalInt(bondSplit[2])],\n    stereo: utils.fmtInfo.bondStereoMap[utils.parseDecimalInt(bondSplit[3])],\n    xxx: bondSplit[4],\n    topology: utils.fmtInfo.bondTopologyMap[utils.parseDecimalInt(bondSplit[5])],\n    reactingCenterStatus: utils.parseDecimalInt(bondSplit[6])\n  };\n  return new Bond(params);\n}\nfunction parseAtomListLine(\natomListLine) {\n  var split = utils.partitionLine(atomListLine, utils.fmtInfo.atomListHeaderPartition);\n  var number = utils.parseDecimalInt(split[0]) - 1;\n  var notList = split[2].trim() == 'T';\n  var count = utils.parseDecimalInt(split[4].trim());\n  var ids = atomListLine.slice(utils.fmtInfo.atomListHeaderLength);\n  var list = [];\n  var itemLength = utils.fmtInfo.atomListHeaderItemLength;\n  for (var i = 0; i < count; ++i) {\n    list[i] = utils.parseDecimalInt(ids.slice(i * itemLength, (i + 1) * itemLength - 1));\n  }\n  return {\n    aid: number,\n    atomList: new AtomList({\n      notList: notList,\n      ids: list\n    })\n  };\n}\nfunction parsePropertyLines(ctab, ctabLines, shift, end, sGroups, rLogic) {\n  var props = new Pool();\n  while (shift < end) {\n    var line = ctabLines[shift];\n    if (line.charAt(0) == 'A') {\n      var propValue = ctabLines[++shift];\n      var isPseudo = /'.+'/.test(propValue);\n      if (isPseudo && !props.get('pseudo')) props.set('pseudo', new Pool());\n      if (!isPseudo && !props.get('alias')) props.set('alias', new Pool());\n      if (isPseudo) propValue = propValue.replace(/'/g, '');\n      props.get(isPseudo ? 'pseudo' : 'alias').set(utils.parseDecimalInt(line.slice(3, 6)) - 1, propValue);\n    } else if (line.charAt(0) == 'M') {\n      var type = line.slice(3, 6);\n      var propertyData = line.slice(6);\n      if (type == 'END') {\n        break;\n      } else if (type == 'CHG') {\n        if (!props.get('charge')) props.set('charge', sGroup.readKeyValuePairs(propertyData));\n      } else if (type == 'RAD') {\n        if (!props.get('radical')) props.set('radical', sGroup.readKeyValuePairs(propertyData));\n      } else if (type == 'ISO') {\n        if (!props.get('isotope')) props.set('isotope', sGroup.readKeyValuePairs(propertyData));\n      } else if (type == 'RBC') {\n        if (!props.get('ringBondCount')) props.set('ringBondCount', sGroup.readKeyValuePairs(propertyData));\n      } else if (type == 'SUB') {\n        if (!props.get('substitutionCount')) props.set('substitutionCount', sGroup.readKeyValuePairs(propertyData));\n      } else if (type == 'UNS') {\n        if (!props.get('unsaturatedAtom')) props.set('unsaturatedAtom', sGroup.readKeyValuePairs(propertyData));\n      } else if (type == 'RGP') {\n        if (!props.get('rglabel')) props.set('rglabel', new Pool());\n        var rglabels = props.get('rglabel');\n        var a2rs = sGroup.readKeyMultiValuePairs(propertyData);\n        for (var a2ri = 0; a2ri < a2rs.length; a2ri++) {\n          var a2r = a2rs[a2ri];\n          rglabels.set(a2r[0], (rglabels.get(a2r[0]) || 0) | 1 << a2r[1] - 1);\n        }\n      } else if (type == 'LOG') {\n        propertyData = propertyData.slice(4);\n        var rgid = utils.parseDecimalInt(propertyData.slice(0, 3).trim());\n        var iii = utils.parseDecimalInt(propertyData.slice(4, 7).trim());\n        var hhh = utils.parseDecimalInt(propertyData.slice(8, 11).trim());\n        var ooo = propertyData.slice(12).trim();\n        var logic = {};\n        if (iii > 0) logic.ifthen = iii;\n        logic.resth = hhh == 1;\n        logic.range = ooo;\n        rLogic[rgid] = logic;\n      } else if (type == 'APO') {\n        if (!props.get('attpnt')) props.set('attpnt', sGroup.readKeyValuePairs(propertyData));\n      } else if (type == 'ALS') {\n        var pool = parsePropertyLineAtomList(utils.partitionLine(propertyData, [1, 3, 3, 1, 1, 1]), utils.partitionLineFixed(propertyData.slice(10), 4, false));\n        if (!props.get('atomList')) props.set('atomList', new Pool());\n        if (!props.get('label')) props.set('label', new Pool());\n        pool.forEach(function (atomList, aid) {\n          props.get('label').set(aid, 'L#');\n          props.get('atomList').set(aid, atomList);\n        });\n      } else if (type == 'STY') {\n        sGroup.initSGroup(sGroups, propertyData);\n      } else if (type == 'SST') {\n        sGroup.applySGroupProp(sGroups, 'subtype', propertyData);\n      } else if (type == 'SLB') {\n        sGroup.applySGroupProp(sGroups, 'label', propertyData, true);\n      } else if (type == 'SPL') {\n        sGroup.applySGroupProp(sGroups, 'parent', propertyData, true, true);\n      } else if (type == 'SCN') {\n        sGroup.applySGroupProp(sGroups, 'connectivity', propertyData);\n      } else if (type == 'SAL') {\n        sGroup.applySGroupArrayProp(sGroups, 'atoms', propertyData, -1);\n      } else if (type == 'SBL') {\n        sGroup.applySGroupArrayProp(sGroups, 'bonds', propertyData, -1);\n      } else if (type == 'SPA') {\n        sGroup.applySGroupArrayProp(sGroups, 'patoms', propertyData, -1);\n      } else if (type == 'SMT') {\n        var sid = utils.parseDecimalInt(propertyData.slice(0, 4)) - 1;\n        sGroups[sid].data.subscript = propertyData.slice(4).trim();\n      } else if (type == 'SDT') {\n        sGroup.applyDataSGroupDesc(sGroups, propertyData);\n      } else if (type == 'SDD') {\n        sGroup.applyDataSGroupInfoLine(sGroups, propertyData);\n      } else if (type == 'SCD') {\n        sGroup.applyDataSGroupDataLine(sGroups, propertyData, false);\n      } else if (type == 'SED') {\n        sGroup.applyDataSGroupDataLine(sGroups, propertyData, true);\n      }\n    }\n    ++shift;\n  }\n  return props;\n}\nfunction applyAtomProp(atoms, values, propId) {\n  values.forEach(function (propVal, aid) {\n    atoms.get(aid)[propId] = propVal;\n  });\n}\nfunction parseCTabV2000(ctabLines, countsSplit) {\n  var ctab = new Struct();\n  var i;\n  var atomCount = utils.parseDecimalInt(countsSplit[0]);\n  var bondCount = utils.parseDecimalInt(countsSplit[1]);\n  var atomListCount = utils.parseDecimalInt(countsSplit[2]);\n  var isAbs = utils.parseDecimalInt(countsSplit[4]) === 1;\n  var isAnd = utils.parseDecimalInt(countsSplit[4]) === 0;\n  var stextLinesCount = utils.parseDecimalInt(countsSplit[5]);\n  var propertyLinesCount = utils.parseDecimalInt(countsSplit[10]);\n  var shift = 0;\n  var atomLines = ctabLines.slice(shift, shift + atomCount);\n  shift += atomCount;\n  var bondLines = ctabLines.slice(shift, shift + bondCount);\n  shift += bondCount;\n  var atomListLines = ctabLines.slice(shift, shift + atomListCount);\n  shift += atomListCount + stextLinesCount;\n  var atoms = atomLines.map(parseAtomLine);\n  atoms.forEach(function (atom) {\n    return ctab.atoms.add(atom);\n  });\n  var bonds = bondLines.map(parseBondLine);\n  bonds.forEach(function (bond) {\n    if (bond.stereo && isAbs) ctab.atoms.get(bond.begin).stereoLabel = StereoLabel.Abs;\n    if (bond.stereo && isAnd) ctab.atoms.get(bond.begin).stereoLabel = \"\".concat(StereoLabel.And, \"1\");\n    ctab.bonds.add(bond);\n  });\n  var atomLists = atomListLines.map(parseAtomListLine);\n  atomLists.forEach(function (pair) {\n    ctab.atoms.get(pair.aid).atomList = pair.atomList;\n    ctab.atoms.get(pair.aid).label = 'L#';\n  });\n  var sGroups = {};\n  var rLogic = {};\n  var props = parsePropertyLines(ctab, ctabLines, shift, Math.min(ctabLines.length, shift + propertyLinesCount), sGroups, rLogic);\n  props.forEach(function (values, propId) {\n    applyAtomProp(ctab.atoms, values, propId);\n  });\n  var atomMap = {};\n  var sid;\n  for (sid in sGroups) {\n    var sg = sGroups[sid];\n    if (sg.type === 'DAT' && sg.atoms.length === 0) {\n      var parent = sGroups[sid].parent;\n      if (parent >= 0) {\n        var psg = sGroups[parent - 1];\n        if (psg.type === 'GEN') sg.atoms = [].slice.call(psg.atoms);\n      }\n    }\n  }\n  for (sid in sGroups) {\n    sGroup.loadSGroup(ctab, sGroups[sid], atomMap);\n  }\n  var emptyGroups = [];\n  for (sid in sGroups) {\n    SGroup.filter(ctab, sGroups[sid], atomMap);\n    if (sGroups[sid].atoms.length === 0 && !sGroups[sid].allAtoms) emptyGroups.push(+sid);\n  }\n  for (i = 0; i < emptyGroups.length; ++i) {\n    ctab.sGroupForest.remove(emptyGroups[i]);\n    ctab.sgroups[\"delete\"](emptyGroups[i]);\n  }\n  for (var id in rLogic) {\n    var rgid = parseInt(id, 10);\n    ctab.rgroups.set(rgid, new RGroup(rLogic[rgid]));\n  }\n  return ctab;\n}\nfunction parseRg2000(\nctabLines)\n{\n  ctabLines = ctabLines.slice(7);\n  if (ctabLines[0].trim() !== '$CTAB') throw new Error('RGFile format invalid');\n  var i = 1;\n  while (ctabLines[i].charAt(0) !== '$') {\n    i++;\n  }\n  if (ctabLines[i].trim() !== '$END CTAB') throw new Error('RGFile format invalid');\n  var coreLines = ctabLines.slice(1, i);\n  ctabLines = ctabLines.slice(i + 1);\n  var fragmentLines = {};\n  while (true) {\n    if (ctabLines.length === 0) throw new Error('Unexpected end of file');\n    var line = ctabLines[0].trim();\n    if (line === '$END MOL') {\n      ctabLines = ctabLines.slice(1);\n      break;\n    }\n    if (line !== '$RGP') throw new Error('RGFile format invalid');\n    var rgid = parseInt(ctabLines[1].trim(), 10);\n    fragmentLines[rgid] = [];\n    ctabLines = ctabLines.slice(2);\n    while (true) {\n      if (ctabLines.length === 0) throw new Error('Unexpected end of file');\n      line = ctabLines[0].trim();\n      if (line === '$END RGP') {\n        ctabLines = ctabLines.slice(1);\n        break;\n      }\n      if (line !== '$CTAB') throw new Error('RGFile format invalid');\n      i = 1;\n      while (ctabLines[i].charAt(0) !== '$') {\n        i++;\n      }\n      if (ctabLines[i].trim() !== '$END CTAB') throw new Error('RGFile format invalid');\n      fragmentLines[rgid].push(ctabLines.slice(1, i));\n      ctabLines = ctabLines.slice(i + 1);\n    }\n  }\n  var core = parseCTab(coreLines);\n  var frag = {};\n  {\n    for (var strId in fragmentLines) {\n      var id = parseInt(strId, 10);\n      frag[id] = [];\n      for (var j = 0; j < fragmentLines[id].length; ++j) {\n        frag[id].push(parseCTab(fragmentLines[id][j]));\n      }\n    }\n  }\n  return rgMerge(core, frag);\n}\nfunction parseRxn2000(\nctabLines, shouldReactionRelayout)\n{\n  ctabLines = ctabLines.slice(4);\n  var countsSplit = utils.partitionLine(ctabLines[0], utils.fmtInfo.rxnItemsPartition);\n  var nReactants = countsSplit[0] - 0,\n      nProducts = countsSplit[1] - 0,\n      nAgents = countsSplit[2] - 0;\n  ctabLines = ctabLines.slice(1);\n  var mols = [];\n  while (ctabLines.length > 0 && ctabLines[0].substr(0, 4) == '$MOL') {\n    ctabLines = ctabLines.slice(1);\n    var n = 0;\n    while (n < ctabLines.length && ctabLines[n].substr(0, 4) != '$MOL') {\n      n++;\n    }\n    var lines = ctabLines.slice(0, n);\n    var struct;\n    if (lines[0].search('\\\\$MDL') == 0) {\n      struct = parseRg2000(lines);\n    } else {\n      struct = parseCTab(lines.slice(3));\n      struct.name = lines[0].trim();\n    }\n    mols.push(struct);\n    ctabLines = ctabLines.slice(n);\n  }\n  return utils.rxnMerge(mols, nReactants, nProducts, nAgents, shouldReactionRelayout);\n}\nfunction parseCTab(\nctabLines)\n{\n  var countsSplit = utils.partitionLine(ctabLines[0], utils.fmtInfo.countsLinePartition);\n  ctabLines = ctabLines.slice(1);\n  return parseCTabV2000(ctabLines, countsSplit);\n}\nfunction rgMerge(scaffold, rgroups)\n{\n  var ret = new Struct();\n  scaffold.mergeInto(ret, null, null, false, true);\n  Object.keys(rgroups).forEach(function (id) {\n    var rgid = parseInt(id, 10);\n    var _loop = function _loop(j) {\n      var ctab = rgroups[rgid][j];\n      ctab.rgroups.set(rgid, new RGroup());\n      var frag = {};\n      var frid = ctab.frags.add(frag);\n      ctab.rgroups.get(rgid).frags.add(frid);\n      ctab.atoms.forEach(function (atom) {\n        atom.fragment = frid;\n      });\n      ctab.mergeInto(ret);\n    };\n    for (var j = 0; j < rgroups[rgid].length; ++j) {\n      _loop(j);\n    }\n  });\n  return ret;\n}\nfunction labelsListToIds(labels) {\n  var ids = [];\n  for (var i = 0; i < labels.length; ++i) {\n    var element = Elements.get(labels[i].trim());\n    if (element) {\n      ids.push(element.number);\n    }\n  }\n  return ids;\n}\nfunction parsePropertyLineAtomList(hdr, lst) {\n  var aid = utils.parseDecimalInt(hdr[1]) - 1;\n  var count = utils.parseDecimalInt(hdr[2]);\n  var notList = hdr[4].trim() == 'T';\n  var ids = labelsListToIds(lst.slice(0, count));\n  var ret = new Pool();\n  ret.set(aid, new AtomList({\n    notList: notList,\n    ids: ids\n  }));\n  return ret;\n}\nvar v2000 = {\n  parseCTabV2000: parseCTabV2000,\n  parseRg2000: parseRg2000,\n  parseRxn2000: parseRxn2000\n};\n\nfunction parseAtomLineV3000(line) {\n  var split, subsplit, key, value, i;\n  split = spaceparsplit(line);\n  var params = {\n    pp: new Vec2(parseFloat(split[2]), -parseFloat(split[3]), parseFloat(split[4])),\n    aam: split[5].trim()\n  };\n  var label = split[1].trim();\n  if (label.charAt(0) == '\"' && label.charAt(label.length - 1) == '\"') label = label.substr(1, label.length - 2);\n  if (label.charAt(label.length - 1) == ']') {\n    label = label.substr(0, label.length - 1);\n    var atomListParams = {};\n    atomListParams.notList = false;\n    if (label.substr(0, 5) == 'NOT [') {\n      atomListParams.notList = true;\n      label = label.substr(5);\n    } else if (label.charAt(0) != '[') {\n      throw new Error(\"Error: atom list expected, found '\" + label + \"'\");\n    } else {\n      label = label.substr(1);\n    }\n    atomListParams.ids = labelsListToIds$1(label.split(','));\n    params['atomList'] = new AtomList(atomListParams);\n    params['label'] = 'L#';\n  } else {\n    params['label'] = label;\n  }\n  split.splice(0, 6);\n  for (i = 0; i < split.length; ++i) {\n    subsplit = splitonce(split[i], '=');\n    key = subsplit[0];\n    value = subsplit[1];\n    if (key in utils.fmtInfo.v30atomPropMap) {\n      var ival = utils.parseDecimalInt(value);\n      if (key == 'VAL') {\n        if (ival == 0) continue;\n        if (ival == -1) ival = 0;\n      }\n      params[utils.fmtInfo.v30atomPropMap[key]] = ival;\n    } else if (key == 'RGROUPS') {\n      value = value.trim().substr(1, value.length - 2);\n      var rgrsplit = value.split(' ').slice(1);\n      params.rglabel = 0;\n      for (var j = 0; j < rgrsplit.length; ++j) {\n        params.rglabel |= 1 << rgrsplit[j] - 1;\n      }\n    } else if (key == 'ATTCHPT') {\n      params.attpnt = value.trim() - 0;\n    }\n  }\n  return new Atom(params);\n}\nfunction parseBondLineV3000(line) {\n  var split, subsplit, key, value, i;\n  split = spaceparsplit(line);\n  var params = {\n    begin: utils.parseDecimalInt(split[2]) - 1,\n    end: utils.parseDecimalInt(split[3]) - 1,\n    type: utils.fmtInfo.bondTypeMap[utils.parseDecimalInt(split[1])]\n  };\n  split.splice(0, 4);\n  for (i = 0; i < split.length; ++i) {\n    subsplit = splitonce(split[i], '=');\n    key = subsplit[0];\n    value = subsplit[1];\n    if (key == 'CFG') {\n      params.stereo = utils.fmtInfo.v30bondStereoMap[utils.parseDecimalInt(value)];\n      if (params.type == Bond.PATTERN.TYPE.DOUBLE && params.stereo == Bond.PATTERN.STEREO.EITHER) params.stereo = Bond.PATTERN.STEREO.CIS_TRANS;\n    } else if (key == 'TOPO') {\n      params.topology = utils.fmtInfo.bondTopologyMap[utils.parseDecimalInt(value)];\n    } else if (key == 'RXCTR') {\n      params.reactingCenterStatus = utils.parseDecimalInt(value);\n    } else if (key == 'STBOX') {\n      params.stereoCare = utils.parseDecimalInt(value);\n    }\n  }\n  return new Bond(params);\n}\nfunction v3000parseCollection(ctab, ctabLines, shift) {\n  shift++;\n  while (ctabLines[shift].trim() != 'M  V30 END COLLECTION') {\n    shift++;\n  }\n  shift++;\n  return shift;\n}\nfunction v3000parseSGroup(ctab, ctabLines, sgroups, atomMap, shift) {\n  var line = '';\n  shift++;\n  while (shift < ctabLines.length) {\n    line = stripV30(ctabLines[shift++]).trim();\n    if (line.trim() == 'END SGROUP') return shift;\n    while (line.charAt(line.length - 1) == '-') {\n      line = (line.substr(0, line.length - 1) + stripV30(ctabLines[shift++])).trim();\n    }\n    var split = splitSGroupDef(line);\n    var type = split[1];\n    var sg = new SGroup(type);\n    sg.number = split[0] - 0;\n    sg.type = type;\n    sg.label = split[2] - 0;\n    sgroups[sg.number] = sg;\n    var props = {};\n    for (var i = 3; i < split.length; ++i) {\n      var subsplit = splitonce(split[i], '=');\n      if (subsplit.length != 2) throw new Error(\"A record of form AAA=BBB or AAA=(...) expected, got '\" + split[i] + \"'\");\n      var name = subsplit[0];\n      if (!(name in props)) props[name] = [];\n      props[name].push(subsplit[1]);\n    }\n    sg.atoms = parseBracedNumberList(props['ATOMS'][0], -1);\n    if (props['PATOMS']) sg.patoms = parseBracedNumberList(props['PATOMS'][0], -1);\n    sg.bonds = props['BONDS'] ? parseBracedNumberList(props['BONDS'][0], -1) : [];\n    var brkxyzStrs = props['BRKXYZ'];\n    sg.brkxyz = [];\n    if (brkxyzStrs) {\n      for (var j = 0; j < brkxyzStrs.length; ++j) {\n        sg.brkxyz.push(parseBracedNumberList(brkxyzStrs[j]));\n      }\n    }\n    if (props['MULT']) sg.data.subscript = props['MULT'][0] - 0;\n    if (props['LABEL']) sg.data.subscript = props['LABEL'][0].trim();\n    if (props['CONNECT']) sg.data.connectivity = props['CONNECT'][0].toLowerCase();\n    if (props['FIELDDISP']) sGroup.applyDataSGroupInfo(sg, stripQuotes(props['FIELDDISP'][0]));\n    if (props['FIELDDATA']) sGroup.applyDataSGroupData(sg, props['FIELDDATA'][0], true);\n    if (props['FIELDNAME']) sGroup.applyDataSGroupName(sg, props['FIELDNAME'][0]);\n    if (props['QUERYTYPE']) sGroup.applyDataSGroupQuery(sg, props['QUERYTYPE'][0]);\n    if (props['QUERYOP']) sGroup.applyDataSGroupQueryOp(sg, props['QUERYOP'][0]);\n    sGroup.loadSGroup(ctab, sg, atomMap);\n  }\n  throw new Error('S-group declaration incomplete.');\n}\nfunction parseCTabV3000(ctabLines, norgroups) {\n  var ctab = new Struct();\n  var shift = 0;\n  if (ctabLines[shift++].trim() != 'M  V30 BEGIN CTAB') throw Error('CTAB V3000 invalid');\n  if (ctabLines[shift].slice(0, 13) != 'M  V30 COUNTS') throw Error('CTAB V3000 invalid');\n  var vals = ctabLines[shift].slice(14).split(' ');\n  var isAbs = utils.parseDecimalInt(vals[4]) === 1;\n  shift++;\n  if (ctabLines[shift].trim() == 'M  V30 BEGIN ATOM') {\n    shift++;\n    var line;\n    while (shift < ctabLines.length) {\n      line = stripV30(ctabLines[shift++]).trim();\n      if (line == 'END ATOM') break;\n      while (line.charAt(line.length - 1) == '-') {\n        line = (line.substring(0, line.length - 1) + stripV30(ctabLines[shift++])).trim();\n      }\n      ctab.atoms.add(parseAtomLineV3000(line));\n    }\n    if (ctabLines[shift].trim() == 'M  V30 BEGIN BOND') {\n      shift++;\n      while (shift < ctabLines.length) {\n        line = stripV30(ctabLines[shift++]).trim();\n        if (line == 'END BOND') break;\n        while (line.charAt(line.length - 1) == '-') {\n          line = (line.substring(0, line.length - 1) + stripV30(ctabLines[shift++])).trim();\n        }\n        var bond = parseBondLineV3000(line);\n        if (bond.stereo && isAbs) ctab.atoms.get(bond.begin).stereoLabel = 'abs';\n        ctab.bonds.add(bond);\n      }\n    }\n    var sgroups = {};\n    var atomMap = {};\n    while (ctabLines[shift].trim() != 'M  V30 END CTAB') {\n      if (ctabLines[shift].trim() == 'M  V30 BEGIN COLLECTION')\n        shift = v3000parseCollection(ctab, ctabLines, shift);else if (ctabLines[shift].trim() == 'M  V30 BEGIN SGROUP') shift = v3000parseSGroup(ctab, ctabLines, sgroups, atomMap, shift);else throw Error('CTAB V3000 invalid');\n    }\n  }\n  if (ctabLines[shift++].trim() != 'M  V30 END CTAB') throw Error('CTAB V3000 invalid');\n  if (!norgroups) readRGroups3000(ctab, ctabLines.slice(shift));\n  return ctab;\n}\nfunction readRGroups3000(ctab,\nctabLines)\n{\n  var rfrags = {};\n  var rLogic = {};\n  var shift = 0;\n  while (shift < ctabLines.length && ctabLines[shift].search('M  V30 BEGIN RGROUP') == 0) {\n    var id = ctabLines[shift++].split(' ').pop();\n    rfrags[id] = [];\n    rLogic[id] = {};\n    while (true) {\n      var line = ctabLines[shift].trim();\n      if (line.search('M  V30 RLOGIC') == 0) {\n        line = line.slice(13);\n        var rlsplit = line.trim().split(/\\s+/g);\n        var iii = utils.parseDecimalInt(rlsplit[0]);\n        var hhh = utils.parseDecimalInt(rlsplit[1]);\n        var ooo = rlsplit.slice(2).join(' ');\n        var logic = {};\n        if (iii > 0) logic.ifthen = iii;\n        logic.resth = hhh == 1;\n        logic.range = ooo;\n        rLogic[id] = logic;\n        shift++;\n        continue;\n      }\n      if (line != 'M  V30 BEGIN CTAB') throw Error('CTAB V3000 invalid');\n      for (var i = 0; i < ctabLines.length; ++i) {\n        if (ctabLines[shift + i].trim() == 'M  V30 END CTAB') break;\n      }\n      var lines = ctabLines.slice(shift, shift + i + 1);\n      var rfrag = parseCTabV3000(lines, true);\n      rfrags[id].push(rfrag);\n      shift = shift + i + 1;\n      if (ctabLines[shift].trim() == 'M  V30 END RGROUP') {\n        shift++;\n        break;\n      }\n    }\n  }\n  Object.keys(rfrags).forEach(function (rgid) {\n    rfrags[rgid].forEach(function (rg) {\n      rg.rgroups.set(rgid, new RGroup(rLogic[rgid]));\n      var frid = rg.frags.add({});\n      rg.rgroups.get(rgid).frags.add(frid);\n      rg.atoms.forEach(function (atom) {\n        atom.fragment = frid;\n      });\n      rg.mergeInto(ctab);\n    });\n  });\n}\nfunction parseRxn3000(\nctabLines, shouldReactionRelayout)\n{\n  ctabLines = ctabLines.slice(4);\n  var countsSplit = ctabLines[0].split(/\\s+/g).slice(3);\n  var nReactants = countsSplit[0] - 0,\n      nProducts = countsSplit[1] - 0,\n      nAgents = countsSplit.length > 2 ? countsSplit[2] - 0 : 0;\n  function findCtabEnd(i) {\n    for (var j = i; j < ctabLines.length; ++j) {\n      if (ctabLines[j].trim() == 'M  V30 END CTAB') return j;\n    }\n    return void 0;\n  }\n  function findRGroupEnd(i) {\n    for (var j = i; j < ctabLines.length; ++j) {\n      if (ctabLines[j].trim() == 'M  V30 END RGROUP') return j;\n    }\n    return void 0;\n  }\n  var molLinesReactants = [];\n  var molLinesProducts = [];\n  var current = null;\n  var rGroups = [];\n  for (var i = 0; i < ctabLines.length; ++i) {\n    var line = ctabLines[i].trim();\n    var j;\n    if (line.startsWith('M  V30 COUNTS')) ; else if (line == 'M  END') {\n      break;\n    } else if (line == 'M  V30 BEGIN PRODUCT') {\n      current = molLinesProducts;\n    } else if (line == 'M  V30 END PRODUCT') {\n      current = null;\n    } else if (line == 'M  V30 BEGIN REACTANT') {\n      current = molLinesReactants;\n    } else if (line == 'M  V30 END REACTANT') {\n      current = null;\n    } else if (line.startsWith('M  V30 BEGIN RGROUP')) {\n      j = findRGroupEnd(i);\n      rGroups.push(ctabLines.slice(i, j + 1));\n      i = j;\n    } else if (line == 'M  V30 BEGIN CTAB') {\n      j = findCtabEnd(i);\n      current.push(ctabLines.slice(i, j + 1));\n      i = j;\n    } else {\n      throw new Error('line unrecognized: ' + line);\n    }\n  }\n  var mols = [];\n  var molLines = molLinesReactants.concat(molLinesProducts);\n  for (j = 0; j < molLines.length; ++j) {\n    var mol = parseCTabV3000(molLines[j], countsSplit);\n    mols.push(mol);\n  }\n  var ctab = utils.rxnMerge(mols, nReactants, nProducts, nAgents, shouldReactionRelayout);\n  readRGroups3000(ctab, function (array) {\n    var res = [];\n    for (var k = 0; k < array.length; ++k) {\n      res = res.concat(array[k]);\n    }\n    return res;\n  }(rGroups));\n  return ctab;\n}\nfunction spaceparsplit(line) {\n  var split = [];\n  var pc = 0;\n  var c;\n  var i;\n  var i0 = -1;\n  var quoted = false;\n  for (i = 0; i < line.length; ++i) {\n    c = line[i];\n    if (c == '(') pc++;else if (c == ')') pc--;\n    if (c == '\"') quoted = !quoted;\n    if (!quoted && line[i] == ' ' && pc == 0) {\n      if (i > i0 + 1) split.push(line.slice(i0 + 1, i));\n      i0 = i;\n    }\n  }\n  if (i > i0 + 1) split.push(line.slice(i0 + 1, i));\n  return split;\n}\nfunction stripQuotes(str) {\n  if (str[0] === '\"' && str[str.length - 1] === '\"') return str.substr(1, str.length - 2);\n  return str;\n}\nfunction splitonce(line, delim) {\n  var p = line.indexOf(delim);\n  return [line.slice(0, p), line.slice(p + 1)];\n}\nfunction splitSGroupDef(line) {\n  var split = [];\n  var braceBalance = 0;\n  var quoted = false;\n  for (var i = 0; i < line.length; ++i) {\n    var c = line.charAt(i);\n    if (c == '\"') {\n      quoted = !quoted;\n    } else if (!quoted) {\n      if (c == '(') {\n        braceBalance++;\n      } else if (c == ')') {\n        braceBalance--;\n      } else if (c == ' ' && braceBalance == 0) {\n        split.push(line.slice(0, i));\n        line = line.slice(i + 1).trim();\n        i = 0;\n      }\n    }\n  }\n  if (braceBalance != 0) throw new Error('Brace balance broken. S-group properies invalid!');\n  if (line.length > 0) split.push(line.trim());\n  return split;\n}\nfunction parseBracedNumberList(line, shift) {\n  if (!line) return null;\n  var list = [];\n  line = line.trim();\n  line = line.substr(1, line.length - 2);\n  var split = line.split(' ');\n  shift = shift || 0;\n  for (var i = 1; i < split.length; ++i) {\n    var value = parseInt(split[i]);\n    if (!isNaN(value))\n      list.push(value + shift);\n  }\n  return list;\n}\nfunction stripV30(line) {\n  if (line.slice(0, 7) != 'M  V30 ') throw new Error('Prefix invalid');\n  return line.slice(7);\n}\nfunction labelsListToIds$1(labels) {\n  var ids = [];\n  for (var i = 0; i < labels.length; ++i) {\n    var element = Elements.get(labels[i].trim());\n    if (element) {\n      ids.push(element.number);\n    }\n  }\n  return ids;\n}\nvar v3000 = {\n  parseCTabV3000: parseCTabV3000,\n  readRGroups3000: readRGroups3000,\n  parseRxn3000: parseRxn3000\n};\n\nvar loadRGroupFragments = true;\nfunction parseMol(\nctabLines)\n{\n  if (ctabLines[0].search('\\\\$MDL') === 0) {\n    var _struct = v2000.parseRg2000(ctabLines);\n    _struct.name = ctabLines[3].trim();\n    return _struct;\n  }\n  var struct = parseCTab$1(ctabLines.slice(3));\n  struct.name = ctabLines[0].trim();\n  return struct;\n}\nfunction parseCTab$1(\nctabLines)\n{\n  var countsSplit = partitionLine$1(ctabLines[0], utils.fmtInfo.countsLinePartition);\n  var version = countsSplit[11].trim();\n  ctabLines = ctabLines.slice(1);\n  if (version === 'V2000') return v2000.parseCTabV2000(ctabLines, countsSplit);else if (version === 'V3000') return v3000.parseCTabV3000(ctabLines, !loadRGroupFragments);else throw new Error('Molfile version unknown: ' + version);\n}\nfunction parseRxn(\nctabLines, shouldReactionRelayout)\n{\n  var split = ctabLines[0].trim().split(' ');\n  if (split.length > 1 && split[1] === 'V3000') return v3000.parseRxn3000(ctabLines, shouldReactionRelayout);\n  var struct = v2000.parseRxn2000(ctabLines, shouldReactionRelayout);\n  struct.name = ctabLines[1].trim();\n  return struct;\n}\nvar prepareForSaving = {\n  MUL: SGroup.prepareMulForSaving,\n  SRU: prepareSruForSaving,\n  SUP: prepareSupForSaving,\n  DAT: prepareDatForSaving,\n  GEN: prepareGenForSaving\n};\nfunction prepareSruForSaving(sgroup, mol) {\n  var xBonds = [];\n  mol.bonds.forEach(function (bond, bid) {\n    var a1 = mol.atoms.get(bond.begin);\n    var a2 = mol.atoms.get(bond.end);\n    if (a1.sgs.has(sgroup.id) && !a2.sgs.has(sgroup.id) || a2.sgs.has(sgroup.id) && !a1.sgs.has(sgroup.id))\n      xBonds.push(bid);\n  }, sgroup);\n  if (xBonds.length !== 0 && xBonds.length !== 2) {\n    throw {\n      id: sgroup.id,\n      'error-type': 'cross-bond-number',\n      message: 'Unsupported cross-bonds number'\n    };\n  }\n  sgroup.bonds = xBonds;\n}\nfunction prepareSupForSaving(sgroup, mol) {\n  var xBonds = [];\n  mol.bonds.forEach(function (bond, bid) {\n    var a1 = mol.atoms.get(bond.begin);\n    var a2 = mol.atoms.get(bond.end);\n    if (a1.sgs.has(sgroup.id) && !a2.sgs.has(sgroup.id) || a2.sgs.has(sgroup.id) && !a1.sgs.has(sgroup.id))\n      xBonds.push(bid);\n  }, sgroup);\n  sgroup.bonds = xBonds;\n}\nfunction prepareGenForSaving(sgroup, mol) {\n}\nfunction prepareDatForSaving(sgroup, mol) {\n  sgroup.atoms = SGroup.getAtoms(mol, sgroup);\n}\nvar saveToMolfile = {\n  MUL: saveMulToMolfile,\n  SRU: saveSruToMolfile,\n  SUP: saveSupToMolfile,\n  DAT: saveDatToMolfile,\n  GEN: saveGenToMolfile\n};\nfunction saveMulToMolfile(sgroup, mol, sgMap, atomMap, bondMap) {\n  var idstr = (sgMap[sgroup.id] + '').padStart(3);\n  var lines = [];\n  lines = lines.concat(makeAtomBondLines('SAL', idstr, Array.from(sgroup.atomSet.values()), atomMap));\n  lines = lines.concat(makeAtomBondLines('SPA', idstr, Array.from(sgroup.parentAtomSet.values()), atomMap));\n  lines = lines.concat(makeAtomBondLines('SBL', idstr, sgroup.bonds, bondMap));\n  var smtLine = 'M  SMT ' + idstr + ' ' + sgroup.data.mul;\n  lines.push(smtLine);\n  lines = lines.concat(bracketsToMolfile(mol, sgroup, idstr));\n  return lines.join('\\n');\n}\nfunction saveSruToMolfile(sgroup, mol, sgMap, atomMap, bondMap) {\n  var idstr = (sgMap[sgroup.id] + '').padStart(3);\n  var lines = [];\n  lines = lines.concat(makeAtomBondLines('SAL', idstr, sgroup.atoms, atomMap));\n  lines = lines.concat(makeAtomBondLines('SBL', idstr, sgroup.bonds, bondMap));\n  lines = lines.concat(bracketsToMolfile(mol, sgroup, idstr));\n  return lines.join('\\n');\n}\nfunction saveSupToMolfile(sgroup, mol, sgMap, atomMap, bondMap) {\n  var idstr = (sgMap[sgroup.id] + '').padStart(3);\n  var lines = [];\n  lines = lines.concat(makeAtomBondLines('SAL', idstr, sgroup.atoms, atomMap));\n  lines = lines.concat(makeAtomBondLines('SBL', idstr, sgroup.bonds, bondMap));\n  if (sgroup.data.name && sgroup.data.name !== '') lines.push('M  SMT ' + idstr + ' ' + sgroup.data.name);\n  return lines.join('\\n');\n}\nfunction saveDatToMolfile(sgroup, mol, sgMap, atomMap) {\n  var idstr = (sgMap[sgroup.id] + '').padStart(3);\n  var data = sgroup.data;\n  var pp = sgroup.pp;\n  if (!data.absolute) pp = pp.sub(SGroup.getMassCentre(mol, sgroup.atoms));\n  var lines = [];\n  lines = lines.concat(makeAtomBondLines('SAL', idstr, sgroup.atoms, atomMap));\n  var sdtLine = 'M  SDT ' + idstr + ' ' + (data.fieldName || '').padEnd(30) + (data.fieldType || '').padStart(2) + (data.units || '').padEnd(20) + (data.query || '').padStart(2);\n  if (data.queryOp)\n    sdtLine += data.queryOp.padEnd(80 - 65);\n  lines.push(sdtLine);\n  var sddLine = 'M  SDD ' + idstr + ' ' + utils.paddedNum(pp.x, 10, 4) + utils.paddedNum(-pp.y, 10, 4) + '    ' + (\n  data.attached ? 'A' : 'D') + (\n  data.absolute ? 'A' : 'R') + (\n  data.showUnits ? 'U' : ' ') +\n  '   ' + (\n  data.nCharnCharsToDisplay >= 0 ? utils.paddedNum(data.nCharnCharsToDisplay, 3) : 'ALL') +\n  '  1   ' + (\n  data.tagChar || ' ') +\n  '  ' + utils.paddedNum(data.daspPos, 1) +\n  '  ';\n  lines.push(sddLine);\n  var val = normalizeNewlines(data.fieldValue).replace(/\\n*$/, '');\n  var charsPerLine = 69;\n  val.split('\\n').forEach(function (chars) {\n    while (chars.length > charsPerLine) {\n      lines.push('M  SCD ' + idstr + ' ' + chars.slice(0, charsPerLine));\n      chars = chars.slice(charsPerLine);\n    }\n    lines.push('M  SED ' + idstr + ' ' + chars);\n  });\n  return lines.join('\\n');\n}\nfunction saveGenToMolfile(sgroup, mol, sgMap, atomMap, bondMap) {\n  var idstr = (sgMap[sgroup.id] + '').padStart(3);\n  var lines = [];\n  lines = lines.concat(makeAtomBondLines('SAL', idstr, sgroup.atoms, atomMap));\n  lines = lines.concat(makeAtomBondLines('SBL', idstr, sgroup.bonds, bondMap));\n  lines = lines.concat(bracketsToMolfile(mol, sgroup, idstr));\n  return lines.join('\\n');\n}\nfunction makeAtomBondLines(prefix, idstr, ids, map) {\n  if (!ids) return [];\n  var lines = [];\n  for (var i = 0; i < Math.floor((ids.length + 14) / 15); ++i) {\n    var rem = Math.min(ids.length - 15 * i, 15);\n    var salLine = 'M  ' + prefix + ' ' + idstr + ' ' + utils.paddedNum(rem, 2);\n    for (var j = 0; j < rem; ++j) {\n      salLine += ' ' + utils.paddedNum(map[ids[i * 15 + j]], 3);\n    }\n    lines.push(salLine);\n  }\n  return lines;\n}\nfunction bracketsToMolfile(mol, sg, idstr) {\n  var atomSet = new Pile(sg.atoms);\n  var crossBonds = SGroup.getCrossBonds(mol, atomSet);\n  SGroup.bracketPos(sg, mol, crossBonds);\n  var bb = sg.bracketBox;\n  var d = sg.bracketDir;\n  var n = d.rotateSC(1, 0);\n  var brackets = SGroup.getBracketParameters(mol, crossBonds, atomSet, bb, d, n);\n  var lines = [];\n  for (var i = 0; i < brackets.length; ++i) {\n    var bracket = brackets[i];\n    var a0 = bracket.c.addScaled(bracket.n, -0.5 * bracket.h).yComplement();\n    var a1 = bracket.c.addScaled(bracket.n, 0.5 * bracket.h).yComplement();\n    var line = 'M  SDI ' + idstr + utils.paddedNum(4, 3);\n    var coord = [a0.x, a0.y, a1.x, a1.y];\n    for (var j = 0; j < coord.length; ++j) {\n      line += utils.paddedNum(coord[j], 10, 4);\n    }\n    lines.push(line);\n  }\n  return lines;\n}\nvar nlRe = /\\r\\n|[\\n\\r]/g;\nfunction normalizeNewlines(str) {\n  return str.replace(nlRe, '\\n');\n}\nfunction partitionLine$1(\nstr,\nparts,\nwithspace) {\n  var res = [];\n  for (var i = 0, shift = 0; i < parts.length; ++i) {\n    res.push(str.slice(shift, shift + parts[i]));\n    if (withspace) shift++;\n    shift += parts[i];\n  }\n  return res;\n}\nvar common = {\n  parseCTab: parseCTab$1,\n  parseMol: parseMol,\n  parseRxn: parseRxn,\n  prepareForSaving: prepareForSaving,\n  saveToMolfile: saveToMolfile\n};\n\nvar END_V2000 = '2D 1   1.00000     0.00000     0';\nvar Molfile = function () {\n  function Molfile() {\n    _classCallCheck(this, Molfile);\n    _defineProperty(this, \"molecule\", void 0);\n    _defineProperty(this, \"molfile\", void 0);\n    _defineProperty(this, \"reaction\", void 0);\n    _defineProperty(this, \"mapping\", void 0);\n    _defineProperty(this, \"bondMapping\", void 0);\n    this.molecule = null;\n    this.molfile = null;\n    this.reaction = false;\n    this.mapping = {};\n    this.bondMapping = {};\n  }\n  _createClass(Molfile, [{\n    key: \"parseCTFile\",\n    value: function parseCTFile(molfileLines, shouldReactionRelayout) {\n      var ret;\n      if (molfileLines[0].search('\\\\$RXN') === 0) {\n        ret = common.parseRxn(molfileLines, shouldReactionRelayout);\n      } else {\n        ret = common.parseMol(molfileLines);\n      }\n      ret.initHalfBonds();\n      ret.initNeighbors();\n      return ret;\n    }\n  }, {\n    key: \"prepareSGroups\",\n    value: function prepareSGroups(skipErrors, preserveIndigoDesc) {\n      var mol = this.molecule;\n      var toRemove = [];\n      var errors = 0;\n      this.molecule.sGroupForest.getSGroupsBFS().reverse().forEach(function (id) {\n        var sgroup = mol.sgroups.get(id);\n        var errorIgnore = false;\n        try {\n          common.prepareForSaving[sgroup.type](sgroup, mol);\n        } catch (ex) {\n          if (!skipErrors || typeof ex.id != 'number') {\n            throw new Error(\"Error: \".concat(ex.message));\n          }\n          errorIgnore = true;\n        }\n        if (errorIgnore || !preserveIndigoDesc && /^INDIGO_.+_DESC$/i.test(sgroup.data.fieldName)) {\n          errors += errorIgnore;\n          toRemove.push(sgroup.id);\n        }\n      }, this);\n      if (errors) {\n        throw new Error('Warning: ' + errors + ' invalid S-groups were detected. They will be omitted.');\n      }\n      for (var i = 0; i < toRemove.length; ++i) {\n        mol.sGroupDelete(toRemove[i]);\n      }\n    }\n  }, {\n    key: \"getCTab\",\n    value: function getCTab(molecule, rgroups) {\n      this.molecule = molecule.clone();\n      this.prepareSGroups(false, false);\n      this.molfile = '';\n      this.writeCTab2000(rgroups);\n      return this.molfile;\n    }\n  }, {\n    key: \"saveMolecule\",\n    value: function saveMolecule(molecule, skipSGroupErrors, norgroups, preserveIndigoDesc) {\n      var _this = this;\n      this.reaction = molecule.hasRxnArrow();\n      this.molfile = '' + molecule.name;\n      if (this.reaction) {\n        if (molecule.rgroups.size > 0) {\n          throw new Error('Reactions with r-groups are not supported at the moment');\n        }\n        var components = molecule.getComponents();\n        var reactants = components.reactants;\n        var products = components.products;\n        var all = reactants.concat(products);\n        this.molfile = '$RXN\\n' + molecule.name + '\\n\\n\\n' + utils.paddedNum(reactants.length, 3) + utils.paddedNum(products.length, 3) + utils.paddedNum(0, 3) + '\\n';\n        for (var i = 0; i < all.length; ++i) {\n          var saver = new Molfile();\n          var submol = molecule.clone(all[i], null, true);\n          var molfile = saver.saveMolecule(submol, false, true);\n          this.molfile += '$MOL\\n' + molfile;\n        }\n        return this.molfile;\n      }\n      if (molecule.rgroups.size > 0) {\n        if (norgroups) {\n          molecule = molecule.getScaffold();\n        } else {\n          var scaffold = new Molfile().getCTab(molecule.getScaffold(), molecule.rgroups);\n          this.molfile = '$MDL  REV  1\\n$MOL\\n$HDR\\n' + molecule.name + '\\n\\n\\n$END HDR\\n';\n          this.molfile += '$CTAB\\n' + scaffold + '$END CTAB\\n';\n          molecule.rgroups.forEach(function (rg, rgid) {\n            _this.molfile += '$RGP\\n';\n            _this.writePaddedNumber(rgid, 3);\n            _this.molfile += '\\n';\n            rg.frags.forEach(function (fid) {\n              var group = new Molfile().getCTab(molecule.getFragment(fid));\n              _this.molfile += '$CTAB\\n' + group + '$END CTAB\\n';\n            });\n            _this.molfile += '$END RGP\\n';\n          });\n          this.molfile += '$END MOL\\n';\n          return this.molfile;\n        }\n      }\n      this.molecule = molecule.clone();\n      this.prepareSGroups(skipSGroupErrors, preserveIndigoDesc);\n      this.writeHeader();\n      this.writeCTab2000();\n      return this.molfile;\n    }\n  }, {\n    key: \"writeHeader\",\n    value: function writeHeader() {\n      var date = new Date();\n      this.writeCR();\n      this.writeWhiteSpace(2);\n      this.write('Ketcher');\n      this.writeWhiteSpace();\n      this.writeCR((date.getMonth() + 1 + '').padStart(2) + (date.getDate() + '').padStart(2) + (date.getFullYear() % 100 + '').padStart(2) + (date.getHours() + '').padStart(2) + (date.getMinutes() + '').padStart(2) + END_V2000);\n      this.writeCR();\n    }\n  }, {\n    key: \"write\",\n    value: function write(str) {\n      this.molfile += str;\n    }\n  }, {\n    key: \"writeCR\",\n    value: function writeCR(str) {\n      if (arguments.length === 0) {\n        str = '';\n      }\n      this.molfile += str + '\\n';\n    }\n  }, {\n    key: \"writeWhiteSpace\",\n    value: function writeWhiteSpace() {\n      var length = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      if (arguments.length === 0) {\n        length = 1;\n      }\n      this.write(' '.repeat(Math.max(length, 0)));\n    }\n  }, {\n    key: \"writePadded\",\n    value: function writePadded(str, width) {\n      this.write(str);\n      this.writeWhiteSpace(width - str.length);\n    }\n  }, {\n    key: \"writePaddedNumber\",\n    value: function writePaddedNumber(number, width) {\n      var str = (number - 0).toString();\n      this.writeWhiteSpace(width - str.length);\n      this.write(str);\n    }\n  }, {\n    key: \"writePaddedFloat\",\n    value: function writePaddedFloat(number, width, precision) {\n      this.write(utils.paddedNum(number, width, precision));\n    }\n  }, {\n    key: \"writeCTab2000Header\",\n    value: function writeCTab2000Header() {\n      this.writePaddedNumber(this.molecule.atoms.size, 3);\n      this.writePaddedNumber(this.molecule.bonds.size, 3);\n      this.writePaddedNumber(0, 3);\n      this.writePaddedNumber(0, 3);\n      var isAbsFlag = Array.from(this.molecule.frags.values()).some(function (fr) {\n        return fr ? fr.enhancedStereoFlag === StereoFlag.Abs : false;\n      });\n      this.writePaddedNumber(isAbsFlag ? 1 : 0, 3);\n      this.writePaddedNumber(0, 3);\n      this.writeWhiteSpace(12);\n      this.writePaddedNumber(999, 3);\n      this.writeCR(' V2000');\n    }\n  }, {\n    key: \"writeCTab2000\",\n    value: function writeCTab2000(rgroups) {\n      var _this2 = this;\n      this.writeCTab2000Header();\n      this.mapping = {};\n      var i = 1;\n      var atomsIds = [];\n      var atomsProps = [];\n      this.molecule.atoms.forEach(function (atom, id) {\n        var label = atom.label;\n        if (atom.atomList != null) {\n          label = 'L';\n          atomsIds.push(id);\n        } else if (atom['pseudo']) {\n          if (atom['pseudo'].length > 3) {\n            label = 'A';\n            atomsProps.push({\n              id: id,\n              value: \"'\".concat(atom['pseudo'], \"'\")\n            });\n          }\n        } else if (atom['alias']) {\n          atomsProps.push({\n            id: id,\n            value: atom['alias']\n          });\n        } else if (!Elements.get(atom.label) && ['A', 'Q', 'X', '*', 'R#'].indexOf(atom.label) === -1) {\n          label = 'C';\n          atomsProps.push({\n            id: id,\n            value: atom.label\n          });\n        }\n        _this2.writeAtom(atom, label);\n        _this2.mapping[id] = i++;\n      }, this);\n      this.bondMapping = {};\n      i = 1;\n      this.molecule.bonds.forEach(function (bond, id) {\n        _this2.bondMapping[id] = i++;\n        _this2.writeBond(bond);\n      }, this);\n      while (atomsProps.length > 0) {\n        this.writeAtomProps(atomsProps[0]);\n        atomsProps.splice(0, 1);\n      }\n      var chargeList = [];\n      var isotopeList = [];\n      var radicalList = [];\n      var rglabelList = [];\n      var rglogicList = [];\n      var aplabelList = [];\n      var rbcountList = [];\n      var unsaturatedList = [];\n      var substcountList = [];\n      this.molecule.atoms.forEach(function (atom, id) {\n        if (atom.charge !== 0) {\n          chargeList.push([id, atom.charge]);\n        }\n        if (atom.isotope !== 0) {\n          isotopeList.push([id, atom.isotope]);\n        }\n        if (atom.radical !== 0) {\n          radicalList.push([id, atom.radical]);\n        }\n        if (atom.rglabel != null && atom.label === 'R#') {\n          for (var rgi = 0; rgi < 32; rgi++) {\n            if (atom.rglabel & 1 << rgi) {\n              rglabelList.push([id, rgi + 1]);\n            }\n          }\n        }\n        if (atom.attpnt != null) {\n          aplabelList.push([id, atom.attpnt]);\n        }\n        if (atom.ringBondCount !== 0) {\n          rbcountList.push([id, atom.ringBondCount]);\n        }\n        if (atom.substitutionCount !== 0) {\n          substcountList.push([id, atom.substitutionCount]);\n        }\n        if (atom.unsaturatedAtom !== 0) {\n          unsaturatedList.push([id, atom.unsaturatedAtom]);\n        }\n      });\n      if (rgroups) {\n        rgroups.forEach(function (rg, rgid) {\n          if (rg.resth || rg.ifthen > 0 || rg.range.length > 0) {\n            var line = '  1 ' + utils.paddedNum(rgid, 3) + ' ' + utils.paddedNum(rg.ifthen, 3) + ' ' + utils.paddedNum(rg.resth ? 1 : 0, 3) + '   ' + rg.range;\n            rglogicList.push(line);\n          }\n        });\n      }\n      this.writeAtomPropList('M  CHG', chargeList);\n      this.writeAtomPropList('M  ISO', isotopeList);\n      this.writeAtomPropList('M  RAD', radicalList);\n      this.writeAtomPropList('M  RGP', rglabelList);\n      for (var j = 0; j < rglogicList.length; ++j) {\n        this.write('M  LOG' + rglogicList[j] + '\\n');\n      }\n      this.writeAtomPropList('M  APO', aplabelList);\n      this.writeAtomPropList('M  RBC', rbcountList);\n      this.writeAtomPropList('M  SUB', substcountList);\n      this.writeAtomPropList('M  UNS', unsaturatedList);\n      if (atomsIds.length > 0) {\n        for (var _j = 0; _j < atomsIds.length; ++_j) {\n          var atomId = atomsIds[_j];\n          var atomList = this.molecule.atoms.get(atomId).atomList;\n          this.write('M  ALS');\n          this.writePaddedNumber(atomId + 1, 4);\n          this.writePaddedNumber(atomList.ids.length, 3);\n          this.writeWhiteSpace();\n          this.write(atomList.notList ? 'T' : 'F');\n          var labelList = atomList.labelList();\n          for (var k = 0; k < labelList.length; ++k) {\n            this.writeWhiteSpace();\n            this.writePadded(labelList[k], 3);\n          }\n          this.writeCR();\n        }\n      }\n      var sgmap = {};\n      var cnt = 1;\n      var sgmapback = {};\n      var sgorder = this.molecule.sGroupForest.getSGroupsBFS();\n      sgorder.forEach(function (id) {\n        sgmapback[cnt] = id;\n        sgmap[id] = cnt++;\n      });\n      for (var q = 1; q < cnt; ++q) {\n        var id = sgmapback[q];\n        var sgroup = this.molecule.sgroups.get(id);\n        this.write('M  STY');\n        this.writePaddedNumber(1, 3);\n        this.writeWhiteSpace(1);\n        this.writePaddedNumber(q, 3);\n        this.writeWhiteSpace(1);\n        this.writePadded(sgroup.type, 3);\n        this.writeCR();\n        this.write('M  SLB');\n        this.writePaddedNumber(1, 3);\n        this.writeWhiteSpace(1);\n        this.writePaddedNumber(q, 3);\n        this.writeWhiteSpace(1);\n        this.writePaddedNumber(q, 3);\n        this.writeCR();\n        var parentId = this.molecule.sGroupForest.parent.get(id);\n        if (parentId >= 0) {\n          this.write('M  SPL');\n          this.writePaddedNumber(1, 3);\n          this.writeWhiteSpace(1);\n          this.writePaddedNumber(q, 3);\n          this.writeWhiteSpace(1);\n          this.writePaddedNumber(sgmap[parentId], 3);\n          this.writeCR();\n        }\n        if (sgroup.type === 'SRU' && sgroup.data.connectivity) {\n          var connectivity = \" \".concat(q.toString().padStart(3), \" \").concat((sgroup.data.connectivity || '').padEnd(3));\n          this.write('M  SCN');\n          this.writePaddedNumber(1, 3);\n          this.write(connectivity.toUpperCase());\n          this.writeCR();\n        }\n        if (sgroup.type === 'SRU') {\n          this.write('M  SMT ');\n          this.writePaddedNumber(q, 3);\n          this.writeWhiteSpace();\n          this.write(sgroup.data.subscript || 'n');\n          this.writeCR();\n        }\n        this.writeCR(common.saveToMolfile[sgroup.type](sgroup, this.molecule, sgmap, this.mapping, this.bondMapping));\n      }\n      this.writeCR('M  END');\n    }\n  }, {\n    key: \"writeAtom\",\n    value: function writeAtom(atom, atomLabel) {\n      this.writePaddedFloat(atom.pp.x, 10, 4);\n      this.writePaddedFloat(-atom.pp.y, 10, 4);\n      this.writePaddedFloat(atom.pp.z, 10, 4);\n      this.writeWhiteSpace();\n      this.writePadded(atomLabel, 3);\n      this.writePaddedNumber(0, 2);\n      this.writePaddedNumber(0, 3);\n      this.writePaddedNumber(0, 3);\n      if (typeof atom.hCount === 'undefined') {\n        atom.hCount = 0;\n      }\n      this.writePaddedNumber(atom.hCount, 3);\n      if (typeof atom.stereoCare === 'undefined') {\n        atom.stereoCare = 0;\n      }\n      this.writePaddedNumber(atom.stereoCare, 3);\n      var number;\n      if (atom.explicitValence < 0) {\n        number = 0;\n      } else if (atom.explicitValence === 0) {\n        number = 15;\n      } else {\n        number = atom.explicitValence;\n      }\n      this.writePaddedNumber(number, 3);\n      this.writePaddedNumber(0, 3);\n      this.writePaddedNumber(0, 3);\n      this.writePaddedNumber(0, 3);\n      if (typeof atom.aam === 'undefined') {\n        atom.aam = 0;\n      }\n      this.writePaddedNumber(atom.aam, 3);\n      if (typeof atom.invRet === 'undefined') {\n        atom.invRet = 0;\n      }\n      this.writePaddedNumber(atom.invRet, 3);\n      if (typeof atom.exactChangeFlag === 'undefined') {\n        atom.exactChangeFlag = 0;\n      }\n      this.writePaddedNumber(atom.exactChangeFlag, 3);\n      this.writeCR();\n    }\n  }, {\n    key: \"writeBond\",\n    value: function writeBond(bond) {\n      this.writePaddedNumber(this.mapping[bond.begin], 3);\n      this.writePaddedNumber(this.mapping[bond.end], 3);\n      this.writePaddedNumber(bond.type, 3);\n      if (typeof bond.stereo === 'undefined') {\n        bond.stereo = 0;\n      }\n      this.writePaddedNumber(bond.stereo, 3);\n      this.writePadded(bond.xxx, 3);\n      if (typeof bond.topology === 'undefined') {\n        bond.topology = 0;\n      }\n      this.writePaddedNumber(bond.topology, 3);\n      if (typeof bond.reactingCenterStatus === 'undefined') {\n        bond.reactingCenterStatus = 0;\n      }\n      this.writePaddedNumber(bond.reactingCenterStatus, 3);\n      this.writeCR();\n    }\n  }, {\n    key: \"writeAtomProps\",\n    value: function writeAtomProps(props) {\n      this.write('A  ');\n      this.writePaddedNumber(props.id + 1, 3);\n      this.writeCR();\n      this.writeCR(props.value);\n    }\n  }, {\n    key: \"writeAtomPropList\",\n    value: function writeAtomPropList(propId, values) {\n      var _this3 = this;\n      while (values.length > 0) {\n        var part = [];\n        while (values.length > 0 && part.length < 8) {\n          part.push(values[0]);\n          values.splice(0, 1);\n        }\n        this.write(propId);\n        this.writePaddedNumber(part.length, 3);\n        part.forEach(function (value) {\n          _this3.writeWhiteSpace();\n          _this3.writePaddedNumber(_this3.mapping[value[0]], 3);\n          _this3.writeWhiteSpace();\n          _this3.writePaddedNumber(value[1], 3);\n        });\n        this.writeCR();\n      }\n    }\n  }]);\n  return Molfile;\n}();\n\nfunction ownKeys$2(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread$2(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$2(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$2(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\nvar MolSerializer = function () {\n  function MolSerializer(options) {\n    _classCallCheck(this, MolSerializer);\n    _defineProperty(this, \"options\", void 0);\n    this.options = _objectSpread$2(_objectSpread$2({}, MolSerializer.DefaultOptions), options);\n  }\n  _createClass(MolSerializer, [{\n    key: \"deserialize\",\n    value: function deserialize(content) {\n      var molfile = new Molfile();\n      var lines = content === null || content === void 0 ? void 0 : content.split(/\\r\\n|[\\n\\r]/g);\n      try {\n        return molfile.parseCTFile(lines, this.options.reactionRelayout);\n      } catch (ex) {\n        if (this.options.badHeaderRecover) {\n          try {\n            return molfile.parseCTFile(lines.slice(1), this.options.reactionRelayout);\n          } catch (ex1) {\n          }\n          try {\n            return molfile.parseCTFile([''].concat(lines), this.options.reactionRelayout);\n          } catch (ex2) {\n          }\n        }\n        throw ex;\n      }\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize(struct) {\n      return new Molfile().saveMolecule(struct, this.options.ignoreErrors, this.options.noRgroups, this.options.preserveIndigoDesc);\n    }\n  }]);\n  return MolSerializer;\n}();\n_defineProperty(MolSerializer, \"DefaultOptions\", {\n  badHeaderRecover: false,\n  ignoreErrors: false,\n  noRgroups: false,\n  preserveIndigoDesc: false,\n  reactionRelayout: false\n});\n\nfunction CisTrans(mol, neighborsFunc, context) {\n  this.molecule = mol;\n  this.bonds = new Pool();\n  this.getNeighbors = neighborsFunc;\n  this.context = context;\n}\nCisTrans.PARITY = {\n  NONE: 0,\n  CIS: 1,\n  TRANS: 2\n};\nCisTrans.prototype.each = function (func) {\n  this.bonds.forEach(func);\n};\nCisTrans.prototype.getParity = function (idx) {\n  return this.bonds.get(idx).parity;\n};\nCisTrans.prototype.getSubstituents = function (idx) {\n  return this.bonds.get(idx).substituents;\n};\nCisTrans.prototype.sameside = function (beg, end, neiBeg, neiEnd) {\n  var diff = Vec2.diff(beg, end);\n  var norm = new Vec2(-diff.y, diff.x);\n  if (!norm.normalize()) return 0;\n  var normBeg = Vec2.diff(neiBeg, beg);\n  var normEnd = Vec2.diff(neiEnd, end);\n  if (!normBeg.normalize()) return 0;\n  if (!normEnd.normalize()) return 0;\n  var prodBeg = Vec2.dot(normBeg, norm);\n  var prodEnd = Vec2.dot(normEnd, norm);\n  if (Math.abs(prodBeg) < 0.001 || Math.abs(prodEnd) < 0.001) return 0;\n  return prodBeg * prodEnd > 0 ? 1 : -1;\n};\nCisTrans.prototype.samesides = function (iBeg, iEnd, iNeiBeg, iNeiEnd) {\n  return this.sameside(this.molecule.atoms.get(iBeg).pp, this.molecule.atoms.get(iEnd).pp, this.molecule.atoms.get(iNeiBeg).pp, this.molecule.atoms.get(iNeiEnd).pp);\n};\nCisTrans.prototype.sortSubstituents = function (substituents) {\n  var h0 = this.molecule.atoms.get(substituents[0]).pureHydrogen();\n  var h1 = substituents[1] < 0 || this.molecule.atoms.get(substituents[1]).pureHydrogen();\n  var h2 = this.molecule.atoms.get(substituents[2]).pureHydrogen();\n  var h3 = substituents[3] < 0 || this.molecule.atoms.get(substituents[3]).pureHydrogen();\n  if (h0 && h1) return false;\n  if (h2 && h3) return false;\n  if (h1) {\n    substituents[1] = -1;\n  } else if (h0) {\n    substituents[0] = substituents[1];\n    substituents[1] = -1;\n  } else if (substituents[0] > substituents[1]) {\n    swap(substituents, 0, 1);\n  }\n  if (h3) {\n    substituents[3] = -1;\n  } else if (h2) {\n    substituents[2] = substituents[3];\n    substituents[3] = -1;\n  } else if (substituents[2] > substituents[3]) {\n    swap(substituents, 2, 3);\n  }\n  return true;\n};\nCisTrans.prototype.isGeomStereoBond = function (bondIdx, substituents) {\n  var bond = this.molecule.bonds.get(bondIdx);\n  if (bond.type != Bond.PATTERN.TYPE.DOUBLE) return false;\n  var label1 = this.molecule.atoms.get(bond.begin).label;\n  var label2 = this.molecule.atoms.get(bond.end).label;\n  if (label1 != 'C' && label1 != 'N' && label1 != 'Si' && label1 != 'Ge') return false;\n  if (label2 != 'C' && label2 != 'N' && label2 != 'Si' && label2 != 'Ge') return false;\n  var neiBegin = this.getNeighbors.call(this.context, bond.begin);\n  var neiЕnd = this.getNeighbors.call(this.context, bond.end);\n  if (neiBegin.length < 2 || neiBegin.length > 3 || neiЕnd.length < 2 || neiЕnd.length > 3) return false;\n  substituents[0] = -1;\n  substituents[1] = -1;\n  substituents[2] = -1;\n  substituents[3] = -1;\n  var i;\n  var nei;\n  for (i = 0; i < neiBegin.length; i++) {\n    nei = neiBegin[i];\n    if (nei.bid == bondIdx) continue;\n    if (this.molecule.bonds.get(nei.bid).type != Bond.PATTERN.TYPE.SINGLE) return false;\n    if (substituents[0] == -1) substituents[0] = nei.aid;\n    else substituents[1] = nei.aid;\n  }\n  for (i = 0; i < neiЕnd.length; i++) {\n    nei = neiЕnd[i];\n    if (nei.bid == bondIdx) continue;\n    if (this.molecule.bonds.get(nei.bid).type != Bond.PATTERN.TYPE.SINGLE) return false;\n    if (substituents[2] == -1) substituents[2] = nei.aid;\n    else substituents[3] = nei.aid;\n  }\n  if (substituents[1] != -1 && this.samesides(bond.begin, bond.end, substituents[0], substituents[1]) != -1) return false;\n  if (substituents[3] != -1 && this.samesides(bond.begin, bond.end, substituents[2], substituents[3]) != -1) return false;\n  return true;\n};\nCisTrans.prototype.build = function (excludeBonds) {\n  var _this = this;\n  this.molecule.bonds.forEach(function (bond, bid) {\n    var ct = {\n      parity: 0,\n      substituents: []\n    };\n    _this.bonds.set(bid, ct);\n    if (Array.isArray(excludeBonds) && excludeBonds[bid]) return;\n    if (!_this.isGeomStereoBond(bid, ct.substituents)) return;\n    if (!_this.sortSubstituents(ct.substituents)) return;\n    var sign = _this.samesides(bond.begin, bond.end, ct.substituents[0], ct.substituents[2]);\n    if (sign === 1) ct.parity = CisTrans.PARITY.CIS;else if (sign === -1) ct.parity = CisTrans.PARITY.TRANS;\n  });\n};\nfunction swap(arr, i1, i2) {\n  var tmp = arr[i1];\n  arr[i1] = arr[i2];\n  arr[i2] = tmp;\n}\n\nfunction Dfs(mol, atomData, components, nReactants) {\n  var _this = this;\n  this.molecule = mol;\n  this.atom_data = atomData;\n  this.components = components;\n  this.nComponentsInReactants = -1;\n  this.nReactants = nReactants;\n  this.vertices = new Array(this.molecule.atoms.size);\n  this.molecule.atoms.forEach(function (atom, aid) {\n    _this.vertices[aid] = new Dfs.VertexDesc();\n  }, this);\n  this.edges = new Array(this.molecule.bonds.size);\n  this.molecule.bonds.forEach(function (bond, bid) {\n    _this.edges[bid] = new Dfs.EdgeDesc();\n  }, this);\n  this.v_seq = [];\n}\nDfs.VertexDesc = function () {\n  this.dfs_state = 0;\n  this.parent_vertex = 0;\n  this.parent_edge = 0;\n  this.branches = 0;\n};\nDfs.EdgeDesc = function () {\n  this.opening_cycles = 0;\n  this.closing_cycle = 0;\n};\nDfs.SeqElem = function (vIdx, parVertex, parEdge) {\n  this.idx = vIdx;\n  this.parent_vertex = parVertex;\n  this.parent_edge = parEdge;\n};\nDfs.prototype.walk = function () {\n  var _this2 = this;\n  var vStack = [];\n  var i, j;\n  var cid = 0;\n  var component = 0;\n  while (true) {\n    if (vStack.length < 1) {\n      var selected = -1;\n      while (cid < this.components.length && selected == -1) {\n        selected = this.components[cid].find(function (aid) {\n          if (_this2.vertices[aid].dfs_state === 0) {\n            selected = aid;\n            return true;\n          }\n          return false;\n        });\n        if (selected === null) {\n          selected = -1;\n          cid++;\n        }\n        if (cid == this.nReactants) this.nComponentsInReactants = component;\n      }\n      if (selected < -1) {\n        this.molecule.atoms.find(function (aid) {\n          if (_this2.vertices[aid].dfs_state === 0) {\n            selected = aid;\n            return true;\n          }\n          return false;\n        });\n      }\n      if (selected == -1) break;\n      this.vertices[selected].parent_vertex = -1;\n      this.vertices[selected].parent_edge = -1;\n      vStack.push(selected);\n      component++;\n    }\n    var vIdx = vStack.pop();\n    var parentVertex = this.vertices[vIdx].parent_vertex;\n    var seqElem = new Dfs.SeqElem(vIdx, parentVertex, this.vertices[vIdx].parent_edge);\n    this.v_seq.push(seqElem);\n    this.vertices[vIdx].dfs_state = 2;\n    var atomD = this.atom_data[vIdx];\n    for (i = 0; i < atomD.neighbours.length; i++) {\n      var neiIdx = atomD.neighbours[i].aid;\n      var edgeIdx = atomD.neighbours[i].bid;\n      if (neiIdx == parentVertex) continue;\n      if (this.vertices[neiIdx].dfs_state == 2) {\n        this.edges[edgeIdx].closing_cycle = 1;\n        j = vIdx;\n        while (j != -1 && this.vertices[j].parent_vertex != neiIdx) {\n          j = this.vertices[j].parent_vertex;\n        }\n        if (j == -1) throw new Error('cycle unwind error');\n        this.edges[this.vertices[j].parent_edge].opening_cycles++;\n        this.vertices[vIdx].branches++;\n        seqElem = new Dfs.SeqElem(neiIdx, vIdx, edgeIdx);\n        this.v_seq.push(seqElem);\n      } else {\n        if (this.vertices[neiIdx].dfs_state == 1) {\n          j = vStack.indexOf(neiIdx);\n          if (j == -1)\n            throw new Error('internal: removing vertex from stack');\n          vStack.splice(j, 1);\n          var parent = this.vertices[neiIdx].parent_vertex;\n          if (parent >= 0)\n            this.vertices[parent].branches--;\n        }\n        this.vertices[vIdx].branches++;\n        this.vertices[neiIdx].parent_vertex = vIdx;\n        this.vertices[neiIdx].parent_edge = edgeIdx;\n        this.vertices[neiIdx].dfs_state = 1;\n        vStack.push(neiIdx);\n      }\n    }\n  }\n};\nDfs.prototype.edgeClosingCycle = function (eIdx) {\n  return this.edges[eIdx].closing_cycle !== 0;\n};\nDfs.prototype.numBranches = function (vIdx) {\n  return this.vertices[vIdx].branches;\n};\nDfs.prototype.numOpeningCycles = function (eIdx) {\n  return this.edges[eIdx].opening_cycles;\n};\nDfs.prototype.toString = function () {\n  var str = '';\n  this.v_seq.forEach(function (seqElem) {\n    str += seqElem.idx + ' -> ';\n  });\n  str += '*';\n  return str;\n};\n\nfunction Stereocenters(mol, neighborsFunc, context) {\n  this.molecule = mol;\n  this.atoms = new Pool();\n  this.getNeighbors = neighborsFunc;\n  this.context = context;\n}\nStereocenters.prototype.each = function (func, context) {\n  this.atoms.forEach(func, context);\n};\nStereocenters.prototype.buildFromBonds = function (\nignoreErrors) {\n  var _this = this;\n  var atoms = this.molecule.atoms;\n  var bonds = this.molecule.bonds;\n  var alleneMask = new Pile();\n  atoms.forEach(function (atom, aid) {\n    var neiList = _this.getNeighbors.call(_this.context, aid);\n    if (neiList.length !== 2) return false;\n    var nei1 = neiList[0];\n    var nei2 = neiList[1];\n    if ([aid, nei1.aid, nei2.aid].findIndex(function (aid) {\n      return ['C', 'Si'].indexOf(atoms.get(aid).label) < 0;\n    }, _this) >= 0) return false;\n    if ([nei1.bid, nei2.bid].findIndex(function (bid) {\n      return bonds.get(bid).type !== Bond.PATTERN.TYPE.DOUBLE;\n    }, _this) >= 0) return false;\n    var nei1nei = _this.getNeighbors.call(_this.context, nei1.aid).filter(function (nei) {\n      return nei.aid != aid;\n    });\n    var nei2nei = _this.getNeighbors.call(_this.context, nei2.aid).filter(function (nei) {\n      return nei.aid != aid;\n    });\n    if (nei1nei.length < 1 || nei1nei.length > 2 || nei2nei.length < 1 || nei2nei.length > 2) return false;\n    if (nei1nei.concat(nei2nei).findIndex(function (nei) {\n      return bonds.get(nei.bid).type != Bond.PATTERN.TYPE.SINGLE;\n    }, _this) >= 0) return false;\n    if (nei1nei.concat(nei2nei).findIndex(function (nei) {\n      return bonds.get(nei.bid).stereo == Bond.PATTERN.STEREO.EITHER;\n    }, _this) >= 0) return false;\n    alleneMask.add(nei1.aid).add(nei2.aid);\n    return true;\n  });\n  if (alleneMask.size > 0)\n    atoms.forEach(function (atom, aid) {\n      if (alleneMask.has(aid)) return;\n      var neiList = _this.getNeighbors.call(_this.context, aid);\n      var stereocenter = false;\n      neiList.find(function (nei) {\n        var bond = this.molecule.bonds.get(nei.bid);\n        if (bond.type === Bond.PATTERN.TYPE.SINGLE && bond.begin == aid) {\n          if (bond.stereo === Bond.PATTERN.STEREO.UP || bond.stereo == Bond.PATTERN.STEREO.DOWN) {\n            stereocenter = true;\n            return true;\n          }\n        }\n        return false;\n      }, _this);\n      if (!stereocenter) return;\n      if (ignoreErrors) _this.buildOneCenter(aid\n      );else _this.buildOneCenter(aid\n      );\n    });\n};\nStereocenters.allowed_stereocenters = [{\n  elem: 'C',\n  charge: 0,\n  degree: 3,\n  n_double_bonds: 0,\n  implicit_degree: 4\n}, {\n  elem: 'C',\n  charge: 0,\n  degree: 4,\n  n_double_bonds: 0,\n  implicit_degree: 4\n}, {\n  elem: 'Si',\n  charge: 0,\n  degree: 3,\n  n_double_bonds: 0,\n  implicit_degree: 4\n}, {\n  elem: 'Si',\n  charge: 0,\n  degree: 4,\n  n_double_bonds: 0,\n  implicit_degree: 4\n}, {\n  elem: 'N',\n  charge: 1,\n  degree: 3,\n  n_double_bonds: 0,\n  implicit_degree: 4\n}, {\n  elem: 'N',\n  charge: 1,\n  degree: 4,\n  n_double_bonds: 0,\n  implicit_degree: 4\n}, {\n  elem: 'N',\n  charge: 0,\n  degree: 3,\n  n_double_bonds: 0,\n  implicit_degree: 3\n}, {\n  elem: 'S',\n  charge: 0,\n  degree: 4,\n  n_double_bonds: 2,\n  implicit_degree: 4\n}, {\n  elem: 'S',\n  charge: 1,\n  degree: 3,\n  n_double_bonds: 0,\n  implicit_degree: 3\n}, {\n  elem: 'S',\n  charge: 0,\n  degree: 3,\n  n_double_bonds: 1,\n  implicit_degree: 3\n}, {\n  elem: 'P',\n  charge: 0,\n  degree: 3,\n  n_double_bonds: 0,\n  implicit_degree: 3\n}, {\n  elem: 'P',\n  charge: 1,\n  degree: 4,\n  n_double_bonds: 0,\n  implicit_degree: 4\n}, {\n  elem: 'P',\n  charge: 0,\n  degree: 4,\n  n_double_bonds: 1,\n  implicit_degree: 4\n}];\nStereocenters.prototype.buildOneCenter = function (atomIdx\n) {\n  var _this2 = this;\n  var atom = this.molecule.atoms.get(atomIdx);\n  var neiList = this.getNeighbors.call(this.context, atomIdx);\n  var degree = neiList.length;\n  var implicitDegree = -1;\n  var stereocenter = {\n    group: 0,\n    type: 0,\n    pyramid: []\n  };\n  var edgeIds = [];\n  var lastAtomDir = 0;\n  var nDoubleBonds = 0;\n  stereocenter.pyramid[0] = -1;\n  stereocenter.pyramid[1] = -1;\n  stereocenter.pyramid[2] = -1;\n  stereocenter.pyramid[3] = -1;\n  var nPureHydrogens = 0;\n  if (degree > 4) throw new Error('stereocenter with %d bonds are not supported' + degree);\n  neiList.forEach(function (nei, neiIdx) {\n    var neiAtom = _this2.molecule.atoms.get(nei.aid);\n    var bond = _this2.molecule.bonds.get(nei.bid);\n    edgeIds[neiIdx] = {\n      edge_idx: nei.bid,\n      nei_idx: nei.aid,\n      rank: nei.aid,\n      vec: Vec2.diff(neiAtom.pp, atom.pp).yComplement()\n    };\n    if (neiAtom.pureHydrogen()) {\n      nPureHydrogens++;\n      edgeIds[neiIdx].rank = 10000;\n    } else if (neiAtom.label === 'H') {\n      edgeIds[neiIdx].rank = 5000;\n    }\n    if (!edgeIds[neiIdx].vec.normalize()) throw new Error('zero bond length');\n    if (bond.type === Bond.PATTERN.TYPE.TRIPLE) throw new Error('non-single bonds not allowed near stereocenter');else if (bond.type === Bond.PATTERN.TYPE.AROMATIC) throw new Error('aromatic bonds not allowed near stereocenter');else if (bond.type === Bond.PATTERN.TYPE.DOUBLE) nDoubleBonds++;\n  });\n  Stereocenters.allowed_stereocenters.find(function (as) {\n    if (as.elem === atom.label && as.charge === atom.charge && as.degree === degree && as.n_double_bonds === nDoubleBonds) {\n      implicitDegree = as.implicit_degree;\n      return true;\n    }\n    return false;\n  });\n  if (implicitDegree === -1) throw new Error('unknown stereocenter configuration: ' + atom.label + ', charge ' + atom.charge + ', ' + degree + ' bonds (' + nDoubleBonds + ' double)');\n  if (degree === 4 && nPureHydrogens > 1) throw new Error(nPureHydrogens + ' hydrogens near stereocenter');\n  if (degree === 3 && implicitDegree === 4 && nPureHydrogens > 0) throw new Error('have hydrogen(s) besides implicit hydrogen near stereocenter');\n  if (degree === 4) {\n    if (edgeIds[0].rank > edgeIds[1].rank) swap$1(edgeIds, 0, 1);\n    if (edgeIds[1].rank > edgeIds[2].rank) swap$1(edgeIds, 1, 2);\n    if (edgeIds[2].rank > edgeIds[3].rank) swap$1(edgeIds, 2, 3);\n    if (edgeIds[1].rank > edgeIds[2].rank) swap$1(edgeIds, 1, 2);\n    if (edgeIds[0].rank > edgeIds[1].rank) swap$1(edgeIds, 0, 1);\n    if (edgeIds[1].rank > edgeIds[2].rank) swap$1(edgeIds, 1, 2);\n    var main1 = -1;\n    var main2 = -1;\n    var side1 = -1;\n    var side2 = -1;\n    var mainDir = 0;\n    for (var neiIdx = 0; neiIdx < 4; neiIdx++) {\n      var stereo = this.getBondStereo(atomIdx, edgeIds[neiIdx].edge_idx);\n      if (stereo === Bond.PATTERN.STEREO.UP || stereo == Bond.PATTERN.STEREO.DOWN) {\n        main1 = neiIdx;\n        mainDir = stereo;\n        break;\n      }\n    }\n    if (main1 === -1) throw new Error('none of 4 bonds going from stereocenter is stereobond');\n    var xyz1, xyz2;\n    if (main2 === -1) {\n      xyz1 = Stereocenters.xyzzy(edgeIds[main1].vec, edgeIds[(main1 + 1) % 4].vec, edgeIds[(main1 + 2) % 4].vec);\n      xyz2 = Stereocenters.xyzzy(edgeIds[main1].vec, edgeIds[(main1 + 1) % 4].vec, edgeIds[(main1 + 3) % 4].vec);\n      if (xyz1 + xyz2 == 3 || xyz1 + xyz2 == 12) {\n        main2 = (main1 + 1) % 4;\n        side1 = (main1 + 2) % 4;\n        side2 = (main1 + 3) % 4;\n      }\n    }\n    if (main2 == -1) {\n      xyz1 = Stereocenters.xyzzy(edgeIds[main1].vec, edgeIds[(main1 + 2) % 4].vec, edgeIds[(main1 + 1) % 4].vec);\n      xyz2 = Stereocenters.xyzzy(edgeIds[main1].vec, edgeIds[(main1 + 2) % 4].vec, edgeIds[(main1 + 3) % 4].vec);\n      if (xyz1 + xyz2 == 3 || xyz1 + xyz2 == 12) {\n        main2 = (main1 + 2) % 4;\n        side1 = (main1 + 1) % 4;\n        side2 = (main1 + 3) % 4;\n      }\n    }\n    if (main2 == -1) {\n      xyz1 = Stereocenters.xyzzy(edgeIds[main1].vec, edgeIds[(main1 + 3) % 4].vec, edgeIds[(main1 + 1) % 4].vec);\n      xyz2 = Stereocenters.xyzzy(edgeIds[main1].vec, edgeIds[(main1 + 3) % 4].vec, edgeIds[(main1 + 2) % 4].vec);\n      if (xyz1 + xyz2 == 3 || xyz1 + xyz2 == 12) {\n        main2 = (main1 + 3) % 4;\n        side1 = (main1 + 2) % 4;\n        side2 = (main1 + 1) % 4;\n      }\n    }\n    if (main2 == -1) throw new Error('internal error: can not find opposite bond');\n    if (mainDir == Bond.PATTERN.STEREO.UP && this.getBondStereo(atomIdx, edgeIds[main2].edge_idx) == Bond.PATTERN.STEREO.DOWN) throw new Error('stereo types of the opposite bonds mismatch');\n    if (mainDir == Bond.PATTERN.STEREO.DOWN && this.getBondStereo(atomIdx, edgeIds[main2].edge_idx) == Bond.PATTERN.STEREO.UP) throw new Error('stereo types of the opposite bonds mismatch');\n    if (mainDir == this.getBondStereo(atomIdx, edgeIds[side1].edge_idx)) throw new Error('stereo types of non-opposite bonds match');\n    if (mainDir == this.getBondStereo(atomIdx, edgeIds[side2].edge_idx)) throw new Error('stereo types of non-opposite bonds match');\n    if (main1 == 3 || main2 == 3) lastAtomDir = mainDir;else lastAtomDir = mainDir == Bond.PATTERN.STEREO.UP ? Bond.PATTERN.STEREO.DOWN : Bond.PATTERN.STEREO.UP;\n    sign = Stereocenters.sign(edgeIds[0].vec, edgeIds[1].vec, edgeIds[2].vec);\n    if (lastAtomDir == Bond.PATTERN.STEREO.UP && sign > 0 || lastAtomDir == Bond.PATTERN.STEREO.DOWN && sign < 0) {\n      stereocenter.pyramid[0] = edgeIds[0].nei_idx;\n      stereocenter.pyramid[1] = edgeIds[1].nei_idx;\n      stereocenter.pyramid[2] = edgeIds[2].nei_idx;\n    } else {\n      stereocenter.pyramid[0] = edgeIds[0].nei_idx;\n      stereocenter.pyramid[1] = edgeIds[2].nei_idx;\n      stereocenter.pyramid[2] = edgeIds[1].nei_idx;\n    }\n    stereocenter.pyramid[3] = edgeIds[3].nei_idx;\n  } else if (degree === 3) {\n    if (edgeIds[0].rank > edgeIds[1].rank) swap$1(edgeIds, 0, 1);\n    if (edgeIds[1].rank > edgeIds[2].rank) swap$1(edgeIds, 1, 2);\n    if (edgeIds[0].rank > edgeIds[1].rank) swap$1(edgeIds, 0, 1);\n    var stereo0 = this.getBondStereo(atomIdx, edgeIds[0].edge_idx);\n    var stereo1 = this.getBondStereo(atomIdx, edgeIds[1].edge_idx);\n    var stereo2 = this.getBondStereo(atomIdx, edgeIds[2].edge_idx);\n    var nUp = 0;\n    var nDown = 0;\n    nUp += stereo0 === Bond.PATTERN.STEREO.UP ? 1 : 0;\n    nUp += stereo1 === Bond.PATTERN.STEREO.UP ? 1 : 0;\n    nUp += stereo2 === Bond.PATTERN.STEREO.UP ? 1 : 0;\n    nDown += stereo0 === Bond.PATTERN.STEREO.DOWN ? 1 : 0;\n    nDown += stereo1 === Bond.PATTERN.STEREO.DOWN ? 1 : 0;\n    nDown += stereo2 === Bond.PATTERN.STEREO.DOWN ? 1 : 0;\n    if (implicitDegree == 4) {\n      if (nUp == 3) throw new Error('all 3 bonds up near stereoatom');\n      if (nDown == 3) throw new Error('all 3 bonds down near stereoatom');\n      if (nUp == 0 && nDown == 0) throw new Error('no up/down bonds near stereoatom -- indefinite case');\n      if (nUp == 1 && nDown == 1) throw new Error('one bond up, one bond down -- indefinite case');\n      mainDir = 0;\n      if (nUp == 2) {\n        lastAtomDir = Bond.PATTERN.STEREO.DOWN;\n      } else if (nDown == 2) {\n        lastAtomDir = Bond.PATTERN.STEREO.UP;\n      } else {\n        main1 = -1;\n        side1 = -1;\n        side2 = -1;\n        for (neiIdx = 0; neiIdx < 3; neiIdx++) {\n          dir = this.getBondStereo(atomIdx, edgeIds[neiIdx].edge_idx);\n          if (dir == Bond.PATTERN.STEREO.UP || dir == Bond.PATTERN.STEREO.DOWN) {\n            main1 = neiIdx;\n            mainDir = dir;\n            side1 = (neiIdx + 1) % 3;\n            side2 = (neiIdx + 2) % 3;\n            break;\n          }\n        }\n        if (main1 == -1) throw new Error('internal error: can not find up or down bond');\n        var xyz = Stereocenters.xyzzy(edgeIds[side1].vec, edgeIds[side2].vec, edgeIds[main1].vec);\n        if (xyz == 3 || xyz == 4) throw new Error('degenerate case for 3 bonds near stereoatom');\n        if (xyz == 1) lastAtomDir = mainDir;else lastAtomDir = mainDir == Bond.PATTERN.STEREO.UP ? Bond.PATTERN.STEREO.DOWN : Bond.PATTERN.STEREO.UP;\n      }\n      var sign = Stereocenters.sign(edgeIds[0].vec, edgeIds[1].vec, edgeIds[2].vec);\n      if (lastAtomDir == Bond.PATTERN.STEREO.UP && sign > 0 || lastAtomDir == Bond.PATTERN.STEREO.DOWN && sign < 0) {\n        stereocenter.pyramid[0] = edgeIds[0].nei_idx;\n        stereocenter.pyramid[1] = edgeIds[1].nei_idx;\n        stereocenter.pyramid[2] = edgeIds[2].nei_idx;\n      } else {\n        stereocenter.pyramid[0] = edgeIds[0].nei_idx;\n        stereocenter.pyramid[1] = edgeIds[2].nei_idx;\n        stereocenter.pyramid[2] = edgeIds[1].nei_idx;\n      }\n      stereocenter.pyramid[3] = -1;\n    } else {\n      var dir;\n      if (nDown > 0 && nUp > 0) throw new Error('one bond up, one bond down -- indefinite case');else if (nDown == 0 && nUp == 0) throw new Error('no up-down bonds attached to stereocenter');else if (nUp > 0) dir = 1;else dir = -1;\n      if (Stereocenters.xyzzy(edgeIds[0].vec, edgeIds[1].vec, edgeIds[2].vec) === 1 || Stereocenters.xyzzy(edgeIds[0].vec, edgeIds[2].vec, edgeIds[1].vec) === 1 || Stereocenters.xyzzy(edgeIds[2].vec, edgeIds[1].vec, edgeIds[0].vec) === 1)\n        dir = -dir;\n      sign = Stereocenters.sign(edgeIds[0].vec, edgeIds[1].vec, edgeIds[2].vec);\n      if (sign == dir) {\n        stereocenter.pyramid[0] = edgeIds[0].nei_idx;\n        stereocenter.pyramid[1] = edgeIds[2].nei_idx;\n        stereocenter.pyramid[2] = edgeIds[1].nei_idx;\n      } else {\n        stereocenter.pyramid[0] = edgeIds[0].nei_idx;\n        stereocenter.pyramid[1] = edgeIds[1].nei_idx;\n        stereocenter.pyramid[2] = edgeIds[2].nei_idx;\n      }\n      stereocenter.pyramid[3] = -1;\n    }\n  }\n  this.atoms.set(atomIdx, stereocenter);\n};\nStereocenters.prototype.getBondStereo = function (centerIdx, edgeIdx) {\n  var bond = this.molecule.bonds.get(edgeIdx);\n  if (centerIdx != bond.begin)\n    return 0;\n  return bond.stereo;\n};\nStereocenters.xyzzy = function (v1, v2, u) {\n  var eps = 0.001;\n  var sine1 = Vec2.cross(v1, v2);\n  var cosine1 = Vec2.dot(v1, v2);\n  var sine2 = Vec2.cross(v1, u);\n  var cosine2 = Vec2.dot(v1, u);\n  if (Math.abs(sine1) < eps) {\n    if (Math.abs(sine2) < eps) throw new Error('degenerate case -- bonds overlap');\n    return sine2 > 0 ? 4 : 8;\n  }\n  if (sine1 * sine2 < -eps * eps) return 2;\n  if (cosine2 < cosine1) return 2;\n  return 1;\n};\nStereocenters.sign = function (v1, v2, v3) {\n  var res = (v1.x - v3.x) * (v2.y - v3.y) - (v1.y - v3.y) * (v2.x - v3.x);\n  var eps = 0.001;\n  if (res > eps) return 1;\n  if (res < -eps) return -1;\n  throw new Error('degenerate triangle');\n};\nStereocenters.isPyramidMappingRigid = function (mapping) {\n  var arr = mapping.slice();\n  var rigid = true;\n  if (arr[0] > arr[1]) {\n    swap$1(arr, 0, 1);\n    rigid = !rigid;\n  }\n  if (arr[1] > arr[2]) {\n    swap$1(arr, 1, 2);\n    rigid = !rigid;\n  }\n  if (arr[2] > arr[3]) {\n    swap$1(arr, 2, 3);\n    rigid = !rigid;\n  }\n  if (arr[1] > arr[2]) {\n    swap$1(arr, 1, 2);\n    rigid = !rigid;\n  }\n  if (arr[0] > arr[1]) {\n    swap$1(arr, 0, 1);\n    rigid = !rigid;\n  }\n  if (arr[1] > arr[2]) {\n    swap$1(arr, 1, 2);\n    rigid = !rigid;\n  }\n  return rigid;\n};\nfunction swap$1(arr, i1, i2) {\n  var tmp = arr[i1];\n  arr[i1] = arr[i2];\n  arr[i2] = tmp;\n}\n\nfunction Smiles() {\n  this.smiles = '';\n  this.writtenAtoms = [];\n  this.writtenComponents = 0;\n  this.ignoreErrors = false;\n}\nSmiles._Atom = function (hСount) {\n  this.neighbours = [];\n  this.aromatic = false;\n  this.lowercase = false;\n  this.chirality = 0;\n  this.branch_cnt = 0;\n  this.paren_written = false;\n  this.h_count = hСount;\n  this.parent = -1;\n};\nSmiles.prototype.isBondInRing = function (bid) {\n  return this.inLoop[bid];\n};\nSmiles.prototype.saveMolecule = function (struct, ignoreErrors) {\n  var _this = this;\n  var i, j, k;\n  if (!ignoreErrors) this.ignoreErrors = ignoreErrors;\n  struct = struct.clone(undefined, undefined, !struct.hasRxnArrow(),\n  undefined, undefined, undefined);\n  struct.initHalfBonds();\n  struct.initNeighbors();\n  struct.sortNeighbors();\n  struct.setImplicitHydrogen();\n  struct.sgroups.forEach(function (sg) {\n    if (sg.type === 'MUL') {\n      try {\n        SGroup.prepareMulForSaving(sg, struct);\n      } catch (ex) {\n        throw Error('Bad s-group (' + ex.message + ')');\n      }\n    }\n  });\n  this.atoms = new Array(struct.atoms.size);\n  struct.atoms.forEach(function (atom, aid) {\n    _this.atoms[aid] = new Smiles._Atom(atom.implicitH);\n  });\n  var allowedLowercase = ['B', 'C', 'N', 'O', 'P', 'S', 'Se', 'As'];\n  struct.bonds.forEach(function (bond, bid) {\n    if (bond.type === Bond.PATTERN.TYPE.AROMATIC) {\n      _this.atoms[bond.begin].aromatic = true;\n      if (allowedLowercase.indexOf(struct.atoms.get(bond.begin).label) !== -1) _this.atoms[bond.begin].lowercase = true;\n      _this.atoms[bond.end].aromatic = true;\n      if (allowedLowercase.indexOf(struct.atoms.get(bond.end).label) !== -1) _this.atoms[bond.end].lowercase = true;\n    }\n    _this.atoms[bond.begin].neighbours.push({\n      aid: bond.end,\n      bid: bid\n    });\n    _this.atoms[bond.end].neighbours.push({\n      aid: bond.begin,\n      bid: bid\n    });\n  });\n  this.inLoop = function () {\n    struct.prepareLoopStructure();\n    var bondsInLoops = new Pile();\n    struct.loops.forEach(function (loop) {\n      if (loop.hbs.length <= 6) {\n        var hbids = loop.hbs.map(function (hbid) {\n          return struct.halfBonds.get(hbid).bid;\n        });\n        bondsInLoops = bondsInLoops.union(new Pile(hbids));\n      }\n    });\n    var inLoop = {};\n    bondsInLoops.forEach(function (bid) {\n      inLoop[bid] = 1;\n    });\n    return inLoop;\n  }();\n  this.touchedCistransbonds = 0;\n  this.markCisTrans(struct);\n  var components = struct.getComponents();\n  var componentsAll = components.reactants.concat(components.products);\n  var walk = new Dfs(struct, this.atoms, componentsAll, components.reactants.length);\n  walk.walk();\n  this.atoms.forEach(function (atom) {\n    atom.neighbours = [];\n  });\n  for (i = 0; i < walk.v_seq.length; i++) {\n    var seqEl = walk.v_seq[i];\n    var vIdx = seqEl.idx;\n    var eIdx = seqEl.parent_edge;\n    var vPrevIdx = seqEl.parent_vertex;\n    if (eIdx >= 0) {\n      var atom = this.atoms[vIdx];\n      var openingCycles = walk.numOpeningCycles(eIdx);\n      for (j = 0; j < openingCycles; j++) {\n        this.atoms[vPrevIdx].neighbours.push({\n          aid: -1,\n          bid: -1\n        });\n      }\n      if (walk.edgeClosingCycle(eIdx)) {\n        for (k = 0; k < atom.neighbours.length; k++) {\n          if (atom.neighbours[k].aid === -1) {\n            atom.neighbours[k].aid = vPrevIdx;\n            atom.neighbours[k].bid = eIdx;\n            break;\n          }\n        }\n        if (k === atom.neighbours.length) throw new Error('internal: can not put closing bond to its place');\n      } else {\n        atom.neighbours.push({\n          aid: vPrevIdx,\n          bid: eIdx\n        });\n        atom.parent = vPrevIdx;\n      }\n      this.atoms[vPrevIdx].neighbours.push({\n        aid: vIdx,\n        bid: eIdx\n      });\n    }\n  }\n  try {\n    var stereocenters = new Stereocenters(struct, function (idx) {\n      return this.atoms[idx].neighbours;\n    }, this);\n    stereocenters.buildFromBonds(this.ignoreErrors);\n    stereocenters.each(function (sc, atomIdx) {\n      var implicitHIdx = -1;\n      if (sc.pyramid[3] == -1) implicitHIdx = 3;\n      var pyramidMapping = [];\n      var counter = 0;\n      var atom = _this.atoms[atomIdx];\n      if (atom.parent != -1) {\n        for (k = 0; k < 4; k++) {\n          if (sc.pyramid[k] == atom.parent) {\n            pyramidMapping[counter++] = k;\n            break;\n          }\n        }\n      }\n      if (implicitHIdx != -1) pyramidMapping[counter++] = implicitHIdx;\n      for (j = 0; j != atom.neighbours.length; j++) {\n        if (atom.neighbours[j].aid == atom.parent) continue;\n        for (k = 0; k < 4; k++) {\n          if (atom.neighbours[j].aid == sc.pyramid[k]) {\n            if (counter >= 4) throw new Error('internal: pyramid overflow');\n            pyramidMapping[counter++] = k;\n            break;\n          }\n        }\n      }\n      if (counter == 4) {\n        counter = pyramidMapping[0];\n        pyramidMapping[0] = pyramidMapping[1];\n        pyramidMapping[1] = pyramidMapping[2];\n        pyramidMapping[2] = pyramidMapping[3];\n        pyramidMapping[3] = counter;\n      } else if (counter != 3) {\n        throw new Error('cannot calculate chirality');\n      }\n      if (Stereocenters.isPyramidMappingRigid(pyramidMapping)) _this.atoms[atomIdx].chirality = 1;else _this.atoms[atomIdx].chirality = 2;\n    });\n  } catch (ex) {\n  }\n  var cycleNumbers = [];\n  cycleNumbers.push(0);\n  var firstComponent = true;\n  for (i = 0; i < walk.v_seq.length; i++) {\n    seqEl = walk.v_seq[i];\n    vIdx = seqEl.idx;\n    eIdx = seqEl.parent_edge;\n    vPrevIdx = seqEl.parent_vertex;\n    var writeAtom = true;\n    if (vPrevIdx >= 0) {\n      if (walk.numBranches(vPrevIdx) > 1) {\n        if (this.atoms[vPrevIdx].branch_cnt > 0 && this.atoms[vPrevIdx].paren_written) this.smiles += ')';\n      }\n      openingCycles = walk.numOpeningCycles(eIdx);\n      for (j = 0; j < openingCycles; j++) {\n        for (k = 1; k < cycleNumbers.length; k++) {\n          if (cycleNumbers[k] == -1)\n            break;\n        }\n        if (k == cycleNumbers.length) cycleNumbers.push(vPrevIdx);else cycleNumbers[k] = vPrevIdx;\n        this.writeCycleNumber(k);\n      }\n      if (vPrevIdx >= 0) {\n        var branches = walk.numBranches(vPrevIdx);\n        if (branches > 1 && this.atoms[vPrevIdx].branch_cnt < branches - 1) {\n          if (walk.edgeClosingCycle(eIdx)) {\n            this.atoms[vPrevIdx].paren_written = false;\n          } else {\n            this.smiles += '(';\n            this.atoms[vPrevIdx].paren_written = true;\n          }\n        }\n        this.atoms[vPrevIdx].branch_cnt++;\n        if (this.atoms[vPrevIdx].branch_cnt > branches) throw new Error('unexpected branch');\n      }\n      var bond = struct.bonds.get(eIdx);\n      var dir = 0;\n      if (bond.type == Bond.PATTERN.TYPE.SINGLE) dir = this.calcBondDirection(struct, eIdx, vPrevIdx);\n      if (dir == 1 && vIdx == bond.end || dir == 2 && vIdx == bond.begin) this.smiles += '/';else if (dir == 2 && vIdx == bond.end || dir == 1 && vIdx == bond.begin) this.smiles += '\\\\';else if (bond.type == Bond.PATTERN.TYPE.ANY) {\n        this.smiles += '~';\n      } else if (bond.type == Bond.PATTERN.TYPE.DOUBLE) {\n        this.smiles += '=';\n      } else if (bond.type == Bond.PATTERN.TYPE.TRIPLE) {\n        this.smiles += '#';\n      } else if (bond.type == Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC) {\n        this.smiles += '-,:';\n      } else if (bond.type == Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC) {\n        this.smiles += '=,:';\n      } else if (bond.type == Bond.PATTERN.TYPE.SINGLE_OR_DOUBLE) {\n        this.smiles += '-,=';\n      } else if (bond.type == Bond.PATTERN.TYPE.AROMATIC && (!this.atoms[bond.begin].lowercase || !this.atoms[bond.end].lowercase || !this.isBondInRing(eIdx))) this.smiles += ':';\n      else if (bond.type == Bond.PATTERN.TYPE.SINGLE && this.atoms[bond.begin].aromatic && this.atoms[bond.end].aromatic) this.smiles += '-';\n      if (walk.edgeClosingCycle(eIdx)) {\n        for (j = 1; j < cycleNumbers.length; j++) {\n          if (cycleNumbers[j] == vIdx) break;\n        }\n        if (j == cycleNumbers.length) throw new Error('cycle number not found');\n        this.writeCycleNumber(j);\n        cycleNumbers[j] = -1;\n        writeAtom = false;\n      }\n    } else {\n      if (!firstComponent) {\n        this.smiles += this.writtenComponents === walk.nComponentsInReactants && walk.nReactants !== 0 ? '>>' : '.';\n      }\n      firstComponent = false;\n      this.writtenComponents++;\n    }\n    if (writeAtom) {\n      this.writeAtom(struct, vIdx, this.atoms[vIdx].aromatic, this.atoms[vIdx].lowercase, this.atoms[vIdx].chirality);\n      this.writtenAtoms.push(seqEl.idx);\n    }\n  }\n  this.comma = false;\n  this.writeRadicals(struct);\n  if (this.comma) this.smiles += '|';\n  return this.smiles;\n};\nSmiles.prototype.writeCycleNumber = function (n) {\n  if (n > 0 && n < 10) this.smiles += n;else if (n >= 10 && n < 100) this.smiles += '%' + n;else if (n >= 100 && n < 1000) this.smiles += '%%' + n;else throw new Error('bad cycle number: ' + n);\n};\nSmiles.prototype.writeAtom = function (mol, idx, aromatic, lowercase, chirality) {\n  var atom = mol.atoms.get(idx);\n  var needBrackets = false;\n  var hydro = -1;\n  var aam = 0;\n  if (atom.label == 'A') {\n    this.smiles += '*';\n    return;\n  }\n  if (atom.label == 'R' || atom.label == 'R#') {\n    this.smiles += '[*]';\n    return;\n  }\n  aam = atom.aam;\n  if (atom.label != 'C' && atom.label != 'P' && atom.label != 'N' && atom.label != 'S' && atom.label != 'O' && atom.label != 'Cl' && atom.label != 'F' && atom.label != 'Br' && atom.label != 'B' && atom.label != 'I') needBrackets = true;\n  if (atom.explicitValence >= 0 || atom.radical != 0 || chirality > 0 || aromatic && atom.label != 'C' && atom.label != 'O' || aromatic && atom.label == 'C' && this.atoms[idx].neighbours.length < 3 && this.atoms[idx].h_count == 0) hydro = this.atoms[idx].h_count;\n  var label = atom.label;\n  if (atom.atomList && !atom.atomList.notList) {\n    label = atom.atomList.label();\n    needBrackets = false;\n  } else if (atom.isPseudo() || atom.atomList && atom.atomList.notList) {\n    label = '*';\n    needBrackets = true;\n  } else if (chirality || atom.charge != 0 || atom.isotope > 0 || hydro >= 0 || aam > 0) {\n    needBrackets = true;\n  }\n  if (needBrackets) {\n    if (hydro == -1) hydro = this.atoms[idx].h_count;\n    this.smiles += '[';\n  }\n  if (atom.isotope > 0) this.smiles += atom.isotope;\n  if (lowercase) this.smiles += label.toLowerCase();else this.smiles += label;\n  if (chirality > 0) {\n    if (chirality == 1) this.smiles += '@';\n    else this.smiles += '@@';\n    if (atom.implicitH > 1) throw new Error(atom.implicitH + ' implicit H near stereocenter');\n  }\n  if (atom.label != 'H') {\n    if (hydro > 1 || hydro == 0 && !needBrackets) this.smiles += 'H' + hydro;else if (hydro == 1) this.smiles += 'H';\n  }\n  if (atom.charge > 1) this.smiles += '+' + atom.charge;else if (atom.charge < -1) this.smiles += atom.charge;else if (atom.charge == 1) this.smiles += '+';else if (atom.charge == -1) this.smiles += '-';\n  if (aam > 0) this.smiles += ':' + aam;\n  if (needBrackets) this.smiles += ']';\n};\nSmiles.prototype.markCisTrans = function (mol) {\n  var _this2 = this;\n  this.cis_trans = new CisTrans(mol, function (idx) {\n    return this.atoms[idx].neighbours;\n  }, this);\n  this.cis_trans.build();\n  this.dbonds = new Array(mol.bonds.size);\n  mol.bonds.forEach(function (bond, bid) {\n    _this2.dbonds[bid] = {\n      ctbond_beg: -1,\n      ctbond_end: -1,\n      saved: 0\n    };\n  });\n  this.cis_trans.each(function (ct, bid) {\n    var bond = mol.bonds.get(bid);\n    if (ct.parity !== 0 && !_this2.isBondInRing(bid)) {\n      var neiBeg = _this2.atoms[bond.begin].neighbours;\n      var neiEnd = _this2.atoms[bond.end].neighbours;\n      var aromFailBeg = true;\n      var aromFailEnd = true;\n      neiBeg.forEach(function (nei) {\n        if (nei.bid !== bid && mol.bonds.get(nei.bid).type === Bond.PATTERN.TYPE.SINGLE) aromFailBeg = false;\n      });\n      neiEnd.forEach(function (nei) {\n        if (nei.bid !== bid && mol.bonds.get(nei.bid).type === Bond.PATTERN.TYPE.SINGLE) aromFailEnd = false;\n      });\n      if (aromFailBeg || aromFailEnd) return;\n      neiBeg.forEach(function (nei) {\n        if (nei.bid === bid) return;\n        if (mol.bonds.get(nei.bid).begin === bond.begin) _this2.dbonds[nei.bid].ctbond_beg = bid;else _this2.dbonds[nei.bid].ctbond_end = bid;\n      });\n      neiEnd.forEach(function (nei) {\n        if (nei.bid === bid) return;\n        if (mol.bonds.get(nei.bid).begin === bond.end) _this2.dbonds[nei.bid].ctbond_beg = bid;else _this2.dbonds[nei.bid].ctbond_end = bid;\n      });\n    }\n  });\n};\nSmiles.prototype.updateSideBonds = function (mol, bondIdx) {\n  var bond = mol.bonds.get(bondIdx);\n  var subst = this.cis_trans.getSubstituents(bondIdx);\n  var parity = this.cis_trans.getParity(bondIdx);\n  var sidebonds = [-1, -1, -1, -1];\n  sidebonds[0] = mol.findBondId(subst[0], bond.begin);\n  if (subst[1] != -1) sidebonds[1] = mol.findBondId(subst[1], bond.begin);\n  sidebonds[2] = mol.findBondId(subst[2], bond.end);\n  if (subst[3] != -1) sidebonds[3] = mol.findBondId(subst[3], bond.end);\n  var n1 = 0;\n  var n2 = 0;\n  var n3 = 0;\n  var n4 = 0;\n  if (this.dbonds[sidebonds[0]].saved != 0) {\n    if (this.dbonds[sidebonds[0]].saved == 1 && mol.bonds.get(sidebonds[0]).begin == bond.begin || this.dbonds[sidebonds[0]].saved == 2 && mol.bonds.get(sidebonds[0]).end == bond.begin) n1++;else n2++;\n  }\n  if (sidebonds[1] != -1 && this.dbonds[sidebonds[1]].saved != 0) {\n    if (this.dbonds[sidebonds[1]].saved == 2 && mol.bonds.get(sidebonds[1]).begin == bond.begin || this.dbonds[sidebonds[1]].saved == 1 && mol.bonds.get(sidebonds[1]).end == bond.begin) n1++;else n2++;\n  }\n  if (this.dbonds[sidebonds[2]].saved != 0) {\n    if (this.dbonds[sidebonds[2]].saved == 1 && mol.bonds.get(sidebonds[2]).begin == bond.end || this.dbonds[sidebonds[2]].saved == 2 && mol.bonds.get(sidebonds[2]).end == bond.end) n3++;else n4++;\n  }\n  if (sidebonds[3] != -1 && this.dbonds[sidebonds[3]].saved != 0) {\n    if (this.dbonds[sidebonds[3]].saved == 2 && mol.bonds.get(sidebonds[3]).begin == bond.end || this.dbonds[sidebonds[3]].saved == 1 && mol.bonds.get(sidebonds[3]).end == bond.end) n3++;else n4++;\n  }\n  if (parity == CisTrans.PARITY.CIS) {\n    n1 += n3;\n    n2 += n4;\n  } else {\n    n1 += n4;\n    n2 += n3;\n  }\n  if (n1 > 0 && n2 > 0) throw new Error('incompatible cis-trans configuration');\n  if (n1 == 0 && n2 == 0) return false;\n  if (n1 > 0) {\n    this.dbonds[sidebonds[0]].saved = mol.bonds.get(sidebonds[0]).begin == bond.begin ? 1 : 2;\n    if (sidebonds[1] != -1) {\n      this.dbonds[sidebonds[1]].saved = mol.bonds.get(sidebonds[1]).begin == bond.begin ? 2 : 1;\n    }\n    this.dbonds[sidebonds[2]].saved = mol.bonds.get(sidebonds[2]).begin == bond.end == (parity == CisTrans.PARITY.CIS) ? 1 : 2;\n    if (sidebonds[3] != -1) {\n      this.dbonds[sidebonds[3]].saved = mol.bonds.get(sidebonds[3]).begin == bond.end == (parity == CisTrans.PARITY.CIS) ? 2 : 1;\n    }\n  }\n  if (n2 > 0) {\n    this.dbonds[sidebonds[0]].saved = mol.bonds.get(sidebonds[0]).begin == bond.begin ? 2 : 1;\n    if (sidebonds[1] != -1) {\n      this.dbonds[sidebonds[1]].saved = mol.bonds.get(sidebonds[1]).begin == bond.begin ? 1 : 2;\n    }\n    this.dbonds[sidebonds[2]].saved = mol.bonds.get(sidebonds[2]).begin == bond.end == (parity == CisTrans.PARITY.CIS) ? 2 : 1;\n    if (sidebonds[3] != -1) {\n      this.dbonds[sidebonds[3]].saved = mol.bonds.get(sidebonds[3]).begin == bond.end == (parity == CisTrans.PARITY.CIS) ? 1 : 2;\n    }\n  }\n  return true;\n};\nSmiles.prototype.calcBondDirection = function (mol, idx, vprev) {\n  var _this3 = this;\n  var ntouched;\n  if (this.dbonds[idx].ctbond_beg == -1 && this.dbonds[idx].ctbond_end == -1) return 0;\n  if (mol.bonds.get(idx).type != Bond.PATTERN.TYPE.SINGLE) throw new Error('internal: directed bond type ' + mol.bonds.get(idx).type);\n  while (true) {\n    ntouched = 0;\n    this.cis_trans.each(function (ct, bid) {\n      if (ct.parity !== 0 && !_this3.isBondInRing(bid)) {\n        if (_this3.updateSideBonds(mol, bid)) ntouched++;\n      }\n    });\n    if (ntouched === this.touchedCistransbonds) break;\n    this.touchedCistransbonds = ntouched;\n  }\n  if (this.dbonds[idx].saved === 0) {\n    if (vprev === mol.bonds.get(idx).begin) this.dbonds[idx].saved = 1;else this.dbonds[idx].saved = 2;\n  }\n  return this.dbonds[idx].saved;\n};\nSmiles.prototype.writeRadicals = function (mol) {\n  var marked = new Array(this.writtenAtoms.length);\n  var i, j;\n  for (i = 0; i < this.writtenAtoms.length; i++) {\n    if (marked[i]) continue;\n    var radical = mol.atoms.get(this.writtenAtoms[i]).radical;\n    if (radical == 0) continue;\n    if (this.comma) {\n      this.smiles += ',';\n    } else {\n      this.smiles += ' |';\n      this.comma = true;\n    }\n    if (radical == Atom.PATTERN.RADICAL.SINGLET) this.smiles += '^3:';else if (radical == Atom.PATTERN.RADICAL.DOUPLET) this.smiles += '^1:';\n    else this.smiles += '^4:';\n    this.smiles += i;\n    for (j = i + 1; j < this.writtenAtoms.length; j++) {\n      if (mol.atoms.get(this.writtenAtoms[j]).radical == radical) {\n        marked[j] = true;\n        this.smiles += ',' + j;\n      }\n    }\n  }\n};\n\nfunction ownKeys$3(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread$3(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$3(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$3(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\nvar SmiSerializer = function () {\n  function SmiSerializer(options) {\n    _classCallCheck(this, SmiSerializer);\n    _defineProperty(this, \"options\", void 0);\n    this.options = _objectSpread$3(_objectSpread$3({}, SmiSerializer.DefaultOptions), options);\n  }\n  _createClass(SmiSerializer, [{\n    key: \"deserialize\",\n    value: function deserialize(_content) {\n      throw new Error('Not implemented yet.');\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize(struct) {\n      return new Smiles().saveMolecule(struct, this.options.ignoreErrors);\n    }\n  }]);\n  return SmiSerializer;\n}();\n_defineProperty(SmiSerializer, \"DefaultOptions\", {\n  ignoreErrors: false\n});\n\nvar DelimeterRegex = /^[^]+?\\$\\$\\$\\$$/gm;\nvar SdfSerializer = function () {\n  function SdfSerializer() {\n    _classCallCheck(this, SdfSerializer);\n  }\n  _createClass(SdfSerializer, [{\n    key: \"deserialize\",\n    value: function deserialize(content) {\n      var m;\n      var result = [];\n      var molSerializer = new MolSerializer();\n      while ((m = DelimeterRegex.exec(content)) !== null) {\n        var chunk = m[0].replace(/\\r/g, '').trim();\n        var end = chunk.indexOf('M  END');\n        if (end !== -1) {\n          var propChunks = chunk.substr(end + 7).trim().split(/^$\\n?/m);\n          var struct = molSerializer.deserialize(chunk.substring(0, end + 6));\n          var props = propChunks.reduce(function (acc, pc) {\n            var m = pc.match(/^> [ \\d]*<(\\S+)>/);\n            if (m) {\n              var field = m[1];\n              var value = pc.split('\\n')[1].trim();\n              acc[field] = Number.isFinite(value) ? +value : value.toString();\n            }\n            return acc;\n          }, {});\n          result.push({\n            struct: struct,\n            props: props\n          });\n        }\n      }\n      return result;\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize(sdfItems) {\n      var molSerializer = new MolSerializer();\n      return sdfItems.reduce(function (res, item) {\n        res += molSerializer.serialize(item.struct);\n        Object.keys(item.props).forEach(function (prop) {\n          res += '> <' + prop + '>\\n';\n          res += item.props[prop] + '\\n\\n';\n        });\n        return res + '$$$$';\n      }, '');\n    }\n  }]);\n  return SdfSerializer;\n}();\n\nvar ChemicalMimeType;\n(function (ChemicalMimeType) {\n  ChemicalMimeType[\"Mol\"] = \"chemical/x-mdl-molfile\";\n  ChemicalMimeType[\"Rxn\"] = \"chemical/x-mdl-rxnfile\";\n  ChemicalMimeType[\"DaylightSmiles\"] = \"chemical/x-daylight-smiles\";\n  ChemicalMimeType[\"ExtendedSmiles\"] = \"chemical/x-chemaxon-cxsmiles\";\n  ChemicalMimeType[\"DaylightSmarts\"] = \"chemical/x-daylight-smarts\";\n  ChemicalMimeType[\"InChI\"] = \"chemical/x-inchi\";\n  ChemicalMimeType[\"InChIAuxInfo\"] = \"chemical/x-inchi-aux\";\n  ChemicalMimeType[\"CML\"] = \"chemical/x-cml\";\n  ChemicalMimeType[\"KET\"] = \"application/json\";\n})(ChemicalMimeType || (ChemicalMimeType = {}));\n\nfunction scaled2obj(v, options) {\n  return v.scaled(1 / options.scale);\n}\nfunction obj2scaled(v, options) {\n  return v.scaled(options.scale);\n}\nvar Scale = {\n  scaled2obj: scaled2obj,\n  obj2scaled: obj2scaled\n};\n\nfunction isCorrectStereoCenter(bond, beginNeighs, endNeighs, struct) {\n  var beginAtom = struct.atoms.get(bond.begin);\n  var EndAtomNeigh = NaN;\n  if ((endNeighs === null || endNeighs === void 0 ? void 0 : endNeighs.length) === 2) {\n    EndAtomNeigh = endNeighs[0].aid === bond.begin ? endNeighs[1].aid : endNeighs[0].aid;\n  }\n  if (bond.stereo > 0) {\n    var _struct$atomGetNeighb;\n    if ((endNeighs === null || endNeighs === void 0 ? void 0 : endNeighs.length) === 1 && (beginNeighs === null || beginNeighs === void 0 ? void 0 : beginNeighs.length) === 2 && Number(beginAtom === null || beginAtom === void 0 ? void 0 : beginAtom.implicitH) % 2 === 0) {\n      return false;\n    }\n    if ((endNeighs === null || endNeighs === void 0 ? void 0 : endNeighs.length) === 2 && (beginNeighs === null || beginNeighs === void 0 ? void 0 : beginNeighs.length) === 2 && Number(beginAtom === null || beginAtom === void 0 ? void 0 : beginAtom.implicitH) % 2 === 0 && ((_struct$atomGetNeighb = struct.atomGetNeighbors(EndAtomNeigh)) === null || _struct$atomGetNeighb === void 0 ? void 0 : _struct$atomGetNeighb.length) === 1) {\n      return false;\n    }\n    if ((beginNeighs === null || beginNeighs === void 0 ? void 0 : beginNeighs.length) === 1) {\n      return false;\n    }\n    return true;\n  } else {\n    return false;\n  }\n}\nvar StereoValidator = {\n  isCorrectStereoCenter: isCorrectStereoCenter\n};\n\nfunction pollDeferred(process, complete, timeGap, startTimeGap) {\n  return new Promise(function (resolve, reject) {\n    function iterate() {\n      process().then(function (val) {\n        try {\n          if (complete(val)) resolve(val);else setTimeout(iterate, timeGap);\n        } catch (e) {\n          reject(e);\n        }\n      }, function (err) {\n        return reject(err);\n      });\n    }\n    setTimeout(iterate, startTimeGap || 0);\n  });\n}\nfunction parametrizeUrl(url, params) {\n  return url.replace(/:(\\w+)/g, function (_, val) {\n    return params[val];\n  });\n}\nfunction request(method, url, data, headers, responseHandler) {\n  var requestUrl = url;\n  if (data && method === 'GET') requestUrl = parametrizeUrl(url, data);\n  var response = fetch(requestUrl, {\n    method: method,\n    headers: Object.assign({\n      Accept: 'application/json'\n    }, headers),\n    body: method !== 'GET' ? data : undefined,\n    credentials: 'same-origin'\n  });\n  if (responseHandler) {\n    response = responseHandler(response);\n  } else {\n    response = response.then(function (response) {\n      return response.json().then(function (res) {\n        return response.ok ? res : Promise.reject(res.error);\n      });\n    });\n  }\n  return response[\"catch\"](function (err) {\n    throw Error(err);\n  });\n}\nfunction indigoCall(method, url, baseUrl, defaultOptions) {\n  return function (data, options, responseHandler) {\n    var body = Object.assign({}, data);\n    body.options = Object.assign(body.options || {}, defaultOptions, options);\n    return request(method, baseUrl + url, JSON.stringify(body), {\n      'Content-Type': 'application/json'\n    }, responseHandler);\n  };\n}\nvar RemoteStructService = function () {\n  function RemoteStructService(apiPath, defaultOptions) {\n    _classCallCheck(this, RemoteStructService);\n    _defineProperty(this, \"apiPath\", void 0);\n    _defineProperty(this, \"defaultOptions\", void 0);\n    this.apiPath = apiPath;\n    this.defaultOptions = defaultOptions;\n  }\n  _createClass(RemoteStructService, [{\n    key: \"info\",\n    value: function () {\n      var _info = _asyncToGenerator( _regeneratorRuntime.mark(function _callee() {\n        var indigoVersion, imagoVersions, isAvailable, response;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                isAvailable = false;\n                _context.prev = 1;\n                _context.next = 4;\n                return request('GET', this.apiPath + 'info');\n              case 4:\n                response = _context.sent;\n                indigoVersion = response['indigo_version'];\n                imagoVersions = response['imago_versions'];\n                isAvailable = true;\n                _context.next = 15;\n                break;\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](1);\n                indigoVersion = '';\n                imagoVersions = [];\n                isAvailable = false;\n              case 15:\n                return _context.abrupt(\"return\", {\n                  indigoVersion: indigoVersion,\n                  imagoVersions: imagoVersions,\n                  isAvailable: isAvailable\n                });\n              case 16:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[1, 10]]);\n      }));\n      function info() {\n        return _info.apply(this, arguments);\n      }\n      return info;\n    }()\n  }, {\n    key: \"convert\",\n    value: function convert(data, options) {\n      return indigoCall('POST', 'indigo/convert', this.apiPath, this.defaultOptions)(data, options);\n    }\n  }, {\n    key: \"layout\",\n    value: function layout(data, options) {\n      return indigoCall('POST', 'indigo/layout', this.apiPath, this.defaultOptions)(data, options);\n    }\n  }, {\n    key: \"clean\",\n    value: function clean(data, options) {\n      return indigoCall('POST', 'indigo/clean', this.apiPath, this.defaultOptions)(data, options);\n    }\n  }, {\n    key: \"aromatize\",\n    value: function aromatize(data, options) {\n      return indigoCall('POST', 'indigo/aromatize', this.apiPath, this.defaultOptions)(data, options);\n    }\n  }, {\n    key: \"dearomatize\",\n    value: function dearomatize(data, options) {\n      return indigoCall('POST', 'indigo/dearomatize', this.apiPath, this.defaultOptions)(data, options);\n    }\n  }, {\n    key: \"calculateCip\",\n    value: function calculateCip(data, options) {\n      return indigoCall('POST', 'indigo/calculate_cip', this.apiPath, this.defaultOptions)(data, options);\n    }\n  }, {\n    key: \"automap\",\n    value: function automap(data, options) {\n      return indigoCall('POST', 'indigo/automap', this.apiPath, this.defaultOptions)(data, options);\n    }\n  }, {\n    key: \"check\",\n    value: function check(data, options) {\n      return indigoCall('POST', 'indigo/check', this.apiPath, this.defaultOptions)(data, options);\n    }\n  }, {\n    key: \"calculate\",\n    value: function calculate(data, options) {\n      return indigoCall('POST', 'indigo/calculate', this.apiPath, this.defaultOptions)(data, options);\n    }\n  }, {\n    key: \"recognize\",\n    value: function recognize(blob, version) {\n      var parVersion = version ? \"?version=\".concat(version) : '';\n      var req = request('POST', this.apiPath + \"imago/uploads\".concat(parVersion), blob, {\n        'Content-Type': blob.type || 'application/octet-stream'\n      });\n      var status = request.bind(null, 'GET', this.apiPath + 'imago/uploads/:id');\n      return req.then(function (data) {\n        return pollDeferred(status.bind(null, {\n          id: data.upload_id\n        }), function (response) {\n          if (response.state === 'FAILURE') throw response;\n          return response.state === 'SUCCESS';\n        }, 500, 300);\n      }).then(function (response) {\n        return {\n          struct: response.metadata.mol_str\n        };\n      });\n    }\n  }, {\n    key: \"generateImageAsBase64\",\n    value: function generateImageAsBase64(data, options) {\n      var outputFormat = (options === null || options === void 0 ? void 0 : options.outputFormat) || 'png';\n      return indigoCall('POST', 'indigo/render', this.apiPath, this.defaultOptions)({\n        struct: data\n      }, {\n        'render-output-format': outputFormat\n      }, function (response) {\n        return response.then(function (resp) {\n          return resp.text();\n        })\n        .then(function (text) {\n          if (outputFormat === 'svg') {\n            return btoa(text);\n          } else {\n            return text;\n          }\n        });\n      });\n    }\n  }]);\n  return RemoteStructService;\n}();\n\nvar RemoteStructServiceProvider = function () {\n  function RemoteStructServiceProvider(apiPath) {\n    _classCallCheck(this, RemoteStructServiceProvider);\n    _defineProperty(this, \"apiPath\", void 0);\n    _defineProperty(this, \"mode\", 'remote');\n    var currentApiPath = apiPath;\n    var params = new URLSearchParams(document.location.search);\n    if (params.has('api_path')) {\n      currentApiPath = params.get('api_path');\n    }\n    this.apiPath = !currentApiPath || /\\/$/.test(currentApiPath) ? currentApiPath : currentApiPath + '/';\n  }\n  _createClass(RemoteStructServiceProvider, [{\n    key: \"createStructService\",\n    value: function createStructService(options) {\n      return new RemoteStructService(this.apiPath, options);\n    }\n  }]);\n  return RemoteStructServiceProvider;\n}();\n\nvar SupportedFormatProperties = function SupportedFormatProperties(name, mime, extensions, supportsCoords, options) {\n  _classCallCheck(this, SupportedFormatProperties);\n  _defineProperty(this, \"name\", void 0);\n  _defineProperty(this, \"mime\", void 0);\n  _defineProperty(this, \"extensions\", void 0);\n  _defineProperty(this, \"supportsCoords\", void 0);\n  _defineProperty(this, \"options\", void 0);\n  this.name = name;\n  this.mime = mime;\n  this.extensions = extensions;\n  this.supportsCoords = supportsCoords || false;\n  this.options = options || {};\n};\n\nvar formatProperties = {\n  mol: new SupportedFormatProperties('MDL Molfile V2000', ChemicalMimeType.Mol, ['.mol'], true),\n  molV3000: new SupportedFormatProperties('MDL Molfile V3000', ChemicalMimeType.Mol, ['.mol'], true, {\n    'molfile-saving-mode': '3000'\n  }),\n  rxn: new SupportedFormatProperties('MDL Rxnfile V2000', ChemicalMimeType.Rxn, ['.rxn'], true),\n  rxnV3000: new SupportedFormatProperties('MDL Rxnfile V3000', ChemicalMimeType.Rxn, ['.rxn'], true, {\n    'molfile-saving-mode': '3000'\n  }),\n  smiles: new SupportedFormatProperties('Daylight SMILES', ChemicalMimeType.DaylightSmiles, ['.smi', '.smiles']),\n  smilesExt: new SupportedFormatProperties('Extended SMILES', ChemicalMimeType.ExtendedSmiles, ['.cxsmi', '.cxsmiles']),\n  smarts: new SupportedFormatProperties('Daylight SMARTS', ChemicalMimeType.DaylightSmarts, ['.smarts']),\n  inChI: new SupportedFormatProperties('InChI', ChemicalMimeType.InChI, ['.inchi']),\n  inChIAuxInfo: new SupportedFormatProperties('InChI AuxInfo', ChemicalMimeType.InChIAuxInfo, ['.inchi']),\n  cml: new SupportedFormatProperties('CML', ChemicalMimeType.CML, ['.cml', '.mrv'], true),\n  graph: new SupportedFormatProperties('Graph Format', ChemicalMimeType.KET, ['.ket'])\n};\nfunction getPropertiesByFormat(format) {\n  return formatProperties[format];\n}\n\nvar GraphFormatter = function () {\n  function GraphFormatter(serializer) {\n    _classCallCheck(this, GraphFormatter);\n    _defineProperty(this, \"serializer\", void 0);\n    this.serializer = serializer;\n  }\n  _createClass(GraphFormatter, [{\n    key: \"getStructureFromStructAsync\",\n    value: function () {\n      var _getStructureFromStructAsync = _asyncToGenerator( _regeneratorRuntime.mark(function _callee(struct) {\n        var graph;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                graph = this.serializer.serialize(struct);\n                return _context.abrupt(\"return\", graph);\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n      function getStructureFromStructAsync(_x) {\n        return _getStructureFromStructAsync.apply(this, arguments);\n      }\n      return getStructureFromStructAsync;\n    }()\n  }, {\n    key: \"getStructureFromStringAsync\",\n    value: function () {\n      var _getStructureFromStringAsync = _asyncToGenerator( _regeneratorRuntime.mark(function _callee2(content) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", this.serializer.deserialize(content));\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n      function getStructureFromStringAsync(_x2) {\n        return _getStructureFromStringAsync.apply(this, arguments);\n      }\n      return getStructureFromStringAsync;\n    }()\n  }]);\n  return GraphFormatter;\n}();\n\nvar MolfileV2000Formatter = function () {\n  function MolfileV2000Formatter(molfileManager) {\n    _classCallCheck(this, MolfileV2000Formatter);\n    _defineProperty(this, \"molfileManager\", void 0);\n    this.molfileManager = molfileManager;\n  }\n  _createClass(MolfileV2000Formatter, [{\n    key: \"getStructureFromStructAsync\",\n    value: function () {\n      var _getStructureFromStructAsync = _asyncToGenerator( _regeneratorRuntime.mark(function _callee(struct) {\n        var stringifiedMolfile;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                stringifiedMolfile = this.molfileManager.serialize(struct);\n                return _context.abrupt(\"return\", stringifiedMolfile);\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n      function getStructureFromStructAsync(_x) {\n        return _getStructureFromStructAsync.apply(this, arguments);\n      }\n      return getStructureFromStructAsync;\n    }()\n  }, {\n    key: \"getStructureFromStringAsync\",\n    value: function () {\n      var _getStructureFromStringAsync = _asyncToGenerator( _regeneratorRuntime.mark(function _callee2(stringifiedStruct) {\n        var struct;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                struct = this.molfileManager.deserialize(stringifiedStruct);\n                return _context2.abrupt(\"return\", struct);\n              case 2:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n      function getStructureFromStringAsync(_x2) {\n        return _getStructureFromStringAsync.apply(this, arguments);\n      }\n      return getStructureFromStringAsync;\n    }()\n  }]);\n  return MolfileV2000Formatter;\n}();\n\nvar RxnFormatter = function () {\n  function RxnFormatter(molfileManager) {\n    _classCallCheck(this, RxnFormatter);\n    _defineProperty(this, \"molfileManager\", void 0);\n    this.molfileManager = molfileManager;\n  }\n  _createClass(RxnFormatter, [{\n    key: \"getStructureFromStructAsync\",\n    value: function () {\n      var _getStructureFromStructAsync = _asyncToGenerator( _regeneratorRuntime.mark(function _callee(struct) {\n        var stringifiedMolfile;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                stringifiedMolfile = this.molfileManager.serialize(struct);\n                return _context.abrupt(\"return\", stringifiedMolfile);\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n      function getStructureFromStructAsync(_x) {\n        return _getStructureFromStructAsync.apply(this, arguments);\n      }\n      return getStructureFromStructAsync;\n    }()\n  }, {\n    key: \"getStructureFromStringAsync\",\n    value: function () {\n      var _getStructureFromStringAsync = _asyncToGenerator( _regeneratorRuntime.mark(function _callee2(stringifiedStruct) {\n        var struct;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                struct = this.molfileManager.deserialize(stringifiedStruct);\n                return _context2.abrupt(\"return\", struct);\n              case 2:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n      function getStructureFromStringAsync(_x2) {\n        return _getStructureFromStringAsync.apply(this, arguments);\n      }\n      return getStructureFromStringAsync;\n    }()\n  }]);\n  return RxnFormatter;\n}();\n\nfunction ownKeys$4(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread$4(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$4(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$4(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\nvar ServerFormatter = function () {\n  function ServerFormatter(structService, molfileManager, format, options) {\n    _classCallCheck(this, ServerFormatter);\n    _defineProperty(this, \"structService\", void 0);\n    _defineProperty(this, \"molfileManager\", void 0);\n    _defineProperty(this, \"format\", void 0);\n    _defineProperty(this, \"options\", void 0);\n    this.structService = structService;\n    this.molfileManager = molfileManager;\n    this.format = format;\n    this.options = options;\n  }\n  _createClass(ServerFormatter, [{\n    key: \"getStructureFromStructAsync\",\n    value: function () {\n      var _getStructureFromStructAsync = _asyncToGenerator( _regeneratorRuntime.mark(function _callee(struct) {\n        var infoResult, formatProperties, stringifiedStruct, convertResult, message;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.structService.info();\n              case 2:\n                infoResult = _context.sent;\n                if (infoResult.isAvailable) {\n                  _context.next = 5;\n                  break;\n                }\n                throw new Error('Server is not available');\n              case 5:\n                formatProperties = getPropertiesByFormat(this.format);\n                _context.prev = 6;\n                stringifiedStruct = this.molfileManager.serialize(struct);\n                _context.next = 10;\n                return this.structService.convert({\n                  struct: stringifiedStruct,\n                  output_format: formatProperties.mime\n                }, _objectSpread$4(_objectSpread$4({}, this.options), formatProperties.options));\n              case 10:\n                convertResult = _context.sent;\n                return _context.abrupt(\"return\", convertResult.struct);\n              case 14:\n                _context.prev = 14;\n                _context.t0 = _context[\"catch\"](6);\n                if (_context.t0.message === 'Server is not compatible') {\n                  message = \"\".concat(formatProperties.name, \" is not supported.\");\n                } else {\n                  message = \"Convert error!\\n\".concat(_context.t0.message || _context.t0);\n                }\n                throw new Error(message);\n              case 18:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[6, 14]]);\n      }));\n      function getStructureFromStructAsync(_x) {\n        return _getStructureFromStructAsync.apply(this, arguments);\n      }\n      return getStructureFromStructAsync;\n    }()\n  }, {\n    key: \"getStructureFromStringAsync\",\n    value: function () {\n      var _getStructureFromStringAsync = _asyncToGenerator( _regeneratorRuntime.mark(function _callee2(stringifiedStruct) {\n        var infoResult, promise, data, withCoords, result, parsedStruct, formatError;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.structService.info();\n              case 2:\n                infoResult = _context2.sent;\n                if (infoResult.isAvailable) {\n                  _context2.next = 5;\n                  break;\n                }\n                throw new Error('Server is not available');\n              case 5:\n                data = {\n                  struct: undefined,\n                  output_format: getPropertiesByFormat('mol').mime\n                };\n                withCoords = getPropertiesByFormat(this.format).supportsCoords;\n                if (withCoords) {\n                  promise = this.structService.convert;\n                  data.struct = stringifiedStruct;\n                } else {\n                  promise = this.structService.layout;\n                  data.struct = stringifiedStruct.trim();\n                }\n                _context2.prev = 8;\n                _context2.next = 11;\n                return promise(data, this.options);\n              case 11:\n                result = _context2.sent;\n                parsedStruct = this.molfileManager.deserialize(result.struct);\n                if (!withCoords) {\n                  parsedStruct.rescale();\n                }\n                return _context2.abrupt(\"return\", parsedStruct);\n              case 17:\n                _context2.prev = 17;\n                _context2.t0 = _context2[\"catch\"](8);\n                if (!(_context2.t0.message !== 'Server is not compatible')) {\n                  _context2.next = 21;\n                  break;\n                }\n                throw Error(\"Convert error!\\n\".concat(_context2.t0.message || _context2.t0));\n              case 21:\n                formatError = this.format === 'smiles' ? \"\".concat(getPropertiesByFormat('smilesExt').name, \" and opening of \").concat(getPropertiesByFormat('smiles').name) : getPropertiesByFormat(this.format).name;\n                throw Error(\"\".concat(formatError, \" is not supported in standalone mode.\"));\n              case 23:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[8, 17]]);\n      }));\n      function getStructureFromStringAsync(_x2) {\n        return _getStructureFromStringAsync.apply(this, arguments);\n      }\n      return getStructureFromStringAsync;\n    }()\n  }]);\n  return ServerFormatter;\n}();\n\nvar SmilesFormatter = function () {\n  function SmilesFormatter(smiSerializer,\n  structService, molfileManager, format, options) {\n    _classCallCheck(this, SmilesFormatter);\n    _defineProperty(this, \"smiSerializer\", void 0);\n    _defineProperty(this, \"structService\", void 0);\n    _defineProperty(this, \"molfileManager\", void 0);\n    _defineProperty(this, \"format\", void 0);\n    _defineProperty(this, \"options\", void 0);\n    this.smiSerializer = smiSerializer;\n    this.structService = structService;\n    this.molfileManager = molfileManager;\n    this.format = format;\n    this.options = options;\n  }\n  _createClass(SmilesFormatter, [{\n    key: \"getStructureFromStructAsync\",\n    value: function () {\n      var _getStructureFromStructAsync = _asyncToGenerator( _regeneratorRuntime.mark(function _callee(struct) {\n        var stringifiedMolfile;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                stringifiedMolfile = this.smiSerializer.serialize(struct);\n                return _context.abrupt(\"return\", stringifiedMolfile);\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n      function getStructureFromStructAsync(_x) {\n        return _getStructureFromStructAsync.apply(this, arguments);\n      }\n      return getStructureFromStructAsync;\n    }()\n  }, {\n    key: \"getStructureFromStringAsync\",\n    value: function getStructureFromStringAsync(stringifiedStruct) {\n      var serverFormatter = new ServerFormatter(this.structService, this.molfileManager, this.format, this.options);\n      return serverFormatter.getStructureFromStringAsync(stringifiedStruct);\n    }\n  }]);\n  return SmilesFormatter;\n}();\n\nvar FormatterFactory = function () {\n  function FormatterFactory(structService) {\n    _classCallCheck(this, FormatterFactory);\n    _defineProperty(this, \"structService\", void 0);\n    this.structService = structService;\n  }\n  _createClass(FormatterFactory, [{\n    key: \"separateOptions\",\n    value: function separateOptions(options) {\n      if (!options) {\n        return [{}, {}];\n      }\n      var reactionRelayout = options.reactionRelayout,\n          badHeaderRecover = options.badHeaderRecover,\n          structServiceOptions = _objectWithoutProperties(options, [\"reactionRelayout\", \"badHeaderRecover\"]);\n      var molfileParseOptions = {};\n      if (typeof reactionRelayout === 'boolean') {\n        molfileParseOptions.reactionRelayout = reactionRelayout;\n      }\n      if (typeof badHeaderRecover === 'boolean') {\n        molfileParseOptions.badHeaderRecover = badHeaderRecover;\n      }\n      return [molfileParseOptions, structServiceOptions];\n    }\n  }, {\n    key: \"create\",\n    value: function create(format, options) {\n      var _this$separateOptions = this.separateOptions(options),\n          _this$separateOptions2 = _slicedToArray(_this$separateOptions, 2),\n          molSerializerOptions = _this$separateOptions2[0],\n          structServiceOptions = _this$separateOptions2[1];\n      var formatter;\n      switch (format) {\n        case 'graph':\n          formatter = new GraphFormatter(new KetSerializer());\n          break;\n        case 'mol':\n          formatter = new MolfileV2000Formatter(new MolSerializer(molSerializerOptions));\n          break;\n        case 'rxn':\n          formatter = new RxnFormatter(new MolSerializer(molSerializerOptions));\n          break;\n        case 'smiles':\n          formatter = new SmilesFormatter(new SmiSerializer(),\n          this.structService, new MolSerializer(molSerializerOptions), format, structServiceOptions);\n          break;\n        case 'cml':\n        case 'inChIAuxInfo':\n        case 'inChI':\n        case 'molV3000':\n        case 'rxnV3000':\n        case 'smilesExt':\n        case 'smarts':\n        default:\n          formatter = new ServerFormatter(this.structService, new MolSerializer(molSerializerOptions), format, structServiceOptions);\n      }\n      return formatter;\n    }\n  }]);\n  return FormatterFactory;\n}();\n\nfunction identifyStructFormat(stringifiedStruct) {\n  var sanitizedString = stringifiedStruct.trim();\n  try {\n    if (JSON.parse(sanitizedString)) {\n      return 'graph';\n    }\n  } catch (er) {}\n  if (sanitizedString.indexOf('$RXN') !== -1) {\n    return 'rxn';\n  }\n  var match = sanitizedString.match(/^(M {2}END|\\$END MOL)$/m);\n  if (match) {\n    var end = (match.index || 0) + match[0].length;\n    if (end === sanitizedString.length || sanitizedString.slice(end, end + 20).search(/^\\$(MOL|END CTAB)$/m) !== -1) {\n      return 'mol';\n    }\n  }\n  if (sanitizedString[0] === '<' && sanitizedString.indexOf('<molecule') !== -1) {\n    return 'cml';\n  }\n  if (sanitizedString.slice(0, 5) === 'InChI') {\n    return 'inChI';\n  }\n  if (sanitizedString.indexOf('\\n') === -1) {\n    return 'smiles';\n  }\n  return 'mol';\n}\n\nexport { Atom, AtomList, Bond, Box2Abs, ChemicalMimeType, ElementColor, Elements, FormatterFactory, Fragment, Generics, HalfBond, KetSerializer, Loop, MolSerializer, Pile, Pool, RGroup, RemoteStructService, RemoteStructServiceProvider, RxnArrow, RxnArrowMode, RxnPlus, SGroup, SGroupBracketParams, SGroupForest, Scale, SdfSerializer, SimpleObject, SimpleObjectMode, SmiSerializer, StereoFlag, StereoLabel, StereoValidator, Struct, Text, TextCommand, Vec2, checkOverlapping, formatProperties, getPropertiesByFormat, identifyStructFormat, ifDef, radicalElectrons };\n//# sourceMappingURL=index.modern.js.map\n","import {\n  AromatizeCommandData,\n  AutomapCommandData,\n  CalculateCipCommandData,\n  CalculateCommandData,\n  CheckCommandData,\n  CleanCommandData,\n  Command,\n  CommandOptions,\n  ConvertCommandData,\n  DearomatizeCommandData,\n  GenerateImageCommandData,\n  InputMessage,\n  LayoutCommandData,\n  OutputMessage,\n  SupportedFormat\n} from './indigoWorker.types'\nimport {\n  AromatizeData,\n  AromatizeResult,\n  AutomapData,\n  AutomapResult,\n  CalculateCipData,\n  CalculateCipResult,\n  CalculateData,\n  CalculateResult,\n  CheckData,\n  CheckResult,\n  ChemicalMimeType,\n  CleanData,\n  CleanResult,\n  ConvertData,\n  ConvertResult,\n  DearomatizeData,\n  DearomatizeResult,\n  GenerateImageOptions,\n  InfoResult,\n  LayoutData,\n  LayoutResult,\n  RecognizeResult,\n  StructService,\n  StructServiceOptions\n} from 'ketcher-core'\n\n/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n// @ts-ignore\nimport IndigoWorker from 'web-worker:./IndigoWorker'\n\ninterface KeyValuePair {\n  [key: string]: number | string | boolean | object\n}\n\nfunction convertMimeTypeToOutputFormat(\n  mimeType: ChemicalMimeType\n): SupportedFormat {\n  let format: SupportedFormat\n  switch (mimeType) {\n    case ChemicalMimeType.Mol: {\n      format = SupportedFormat.Mol\n      break\n    }\n    case ChemicalMimeType.Rxn: {\n      format = SupportedFormat.Rxn\n      break\n    }\n    case ChemicalMimeType.DaylightSmiles:\n    case ChemicalMimeType.ExtendedSmiles: {\n      format = SupportedFormat.Smiles\n      break\n    }\n    case ChemicalMimeType.DaylightSmarts: {\n      format = SupportedFormat.Smarts\n      break\n    }\n    case ChemicalMimeType.InChI: {\n      format = SupportedFormat.InChI\n      break\n    }\n    case ChemicalMimeType.InChIAuxInfo: {\n      format = SupportedFormat.InChIAuxInfo\n      break\n    }\n    case ChemicalMimeType.CML: {\n      format = SupportedFormat.CML\n      break\n    }\n    default: {\n      throw new Error('Unsupported chemical mime type')\n    }\n  }\n\n  return format\n}\n\nfunction mapCalculatedPropertyName(property: string) {\n  let mappedProperty: string | undefined\n  switch (property) {\n    case 'gross-formula': {\n      mappedProperty = 'gross'\n      break\n    }\n    default:\n      mappedProperty = property\n      break\n  }\n\n  return mappedProperty\n}\n\nfunction mapWarningGroup(property: string) {\n  let mappedProperty: string | undefined\n  switch (property) {\n    case 'OVERLAP_BOND': {\n      mappedProperty = 'overlapping_bonds'\n      break\n    }\n    default:\n      mappedProperty = property.toLowerCase()\n      break\n  }\n\n  return mappedProperty\n}\n\nclass IndigoService implements StructService {\n  private readonly defaultOptions: StructServiceOptions\n\n  constructor(defaultOptions: StructServiceOptions) {\n    this.defaultOptions = defaultOptions\n  }\n\n  info(): Promise<InfoResult> {\n    return new Promise((resolve, reject) => {\n      const worker: Worker = new IndigoWorker()\n\n      worker.onmessage = (e: MessageEvent<OutputMessage<string>>) => {\n        worker.terminate()\n        const msg: OutputMessage<string> = e.data\n        if (!msg.hasError) {\n          const result: InfoResult = {\n            indigoVersion: msg.payload!,\n            imagoVersions: [],\n            isAvailable: true\n          }\n          resolve(result)\n        } else {\n          reject(msg.error)\n        }\n      }\n\n      worker.postMessage({ type: Command.Info })\n    })\n  }\n\n  convert(\n    data: ConvertData,\n    options?: StructServiceOptions\n  ): Promise<ConvertResult> {\n    const { output_format, struct } = data\n    const format = convertMimeTypeToOutputFormat(output_format)\n\n    return new Promise((resolve, reject) => {\n      const worker: Worker = new IndigoWorker()\n\n      worker.onmessage = (e: MessageEvent<OutputMessage<string>>) => {\n        worker.terminate()\n        const msg: OutputMessage<string> = e.data\n        if (!msg.hasError) {\n          const result: ConvertResult = {\n            struct: msg.payload!,\n            format: output_format\n          }\n          resolve(result)\n        } else {\n          reject(msg.error)\n        }\n      }\n\n      const commandOptions: CommandOptions = {\n        ...this.defaultOptions,\n        ...options\n      }\n\n      const commandData: ConvertCommandData = {\n        struct,\n        format,\n        options: commandOptions\n      }\n\n      const inputMessage: InputMessage<ConvertCommandData> = {\n        type: Command.Convert,\n        data: commandData\n      }\n\n      worker.postMessage(inputMessage)\n    })\n  }\n\n  layout(\n    data: LayoutData,\n    options?: StructServiceOptions\n  ): Promise<LayoutResult> {\n    const { struct } = data\n\n    return new Promise((resolve, reject) => {\n      const worker: Worker = new IndigoWorker()\n\n      worker.onmessage = (e: MessageEvent<OutputMessage<string>>) => {\n        worker.terminate()\n        const msg: OutputMessage<string> = e.data\n        if (!msg.hasError) {\n          const result: LayoutResult = {\n            struct: msg.payload!,\n            format: ChemicalMimeType.Mol\n          }\n          resolve(result)\n        } else {\n          reject(msg.error)\n        }\n      }\n\n      const commandOptions: CommandOptions = {\n        ...this.defaultOptions,\n        ...options\n      }\n\n      const commandData: LayoutCommandData = {\n        struct,\n        options: commandOptions\n      }\n\n      const inputMessage: InputMessage<LayoutCommandData> = {\n        type: Command.Layout,\n        data: commandData\n      }\n\n      worker.postMessage(inputMessage)\n    })\n  }\n\n  clean(data: CleanData, options?: StructServiceOptions): Promise<CleanResult> {\n    const { struct, selected } = data\n    return new Promise((resolve, reject) => {\n      const worker: Worker = new IndigoWorker()\n\n      worker.onmessage = (e: MessageEvent<OutputMessage<string>>) => {\n        worker.terminate()\n        const msg: OutputMessage<string> = e.data\n        if (!msg.hasError) {\n          const result: CleanResult = {\n            struct: msg.payload!,\n            format: ChemicalMimeType.Mol\n          }\n          resolve(result)\n        } else {\n          reject(msg.error)\n        }\n      }\n\n      const commandOptions: CommandOptions = {\n        ...this.defaultOptions,\n        ...options\n      }\n\n      const commandData: CleanCommandData = {\n        struct,\n        options: commandOptions,\n        selectedAtoms: selected || []\n      }\n\n      const inputMessage: InputMessage<CleanCommandData> = {\n        type: Command.Clean,\n        data: commandData\n      }\n\n      worker.postMessage(inputMessage)\n    })\n  }\n\n  aromatize(\n    data: AromatizeData,\n    options?: StructServiceOptions\n  ): Promise<AromatizeResult> {\n    const { struct } = data\n\n    return new Promise((resolve, reject) => {\n      const worker: Worker = new IndigoWorker()\n\n      worker.onmessage = (e: MessageEvent<OutputMessage<string>>) => {\n        worker.terminate()\n        const msg: OutputMessage<string> = e.data\n        if (!msg.hasError) {\n          const result: AromatizeResult = {\n            struct: msg.payload!,\n            format: ChemicalMimeType.Mol\n          }\n          resolve(result)\n        } else {\n          reject(msg.error)\n        }\n      }\n\n      const commandOptions: CommandOptions = {\n        ...this.defaultOptions,\n        ...options\n      }\n\n      const commandData: AromatizeCommandData = {\n        struct,\n        options: commandOptions\n      }\n\n      const inputMessage: InputMessage<AromatizeCommandData> = {\n        type: Command.Aromatize,\n        data: commandData\n      }\n\n      worker.postMessage(inputMessage)\n    })\n  }\n\n  dearomatize(\n    data: DearomatizeData,\n    options?: StructServiceOptions\n  ): Promise<DearomatizeResult> {\n    const { struct } = data\n\n    return new Promise((resolve, reject) => {\n      const worker: Worker = new IndigoWorker()\n\n      worker.onmessage = (e: MessageEvent<OutputMessage<string>>) => {\n        worker.terminate()\n        const msg: OutputMessage<string> = e.data\n        if (!msg.hasError) {\n          const result: AromatizeResult = {\n            struct: msg.payload!,\n            format: ChemicalMimeType.Mol\n          }\n          resolve(result)\n        } else {\n          reject(msg.error)\n        }\n      }\n\n      const commandOptions: CommandOptions = {\n        ...this.defaultOptions,\n        ...options\n      }\n\n      const commandData: DearomatizeCommandData = {\n        struct,\n        options: commandOptions\n      }\n\n      const inputMessage: InputMessage<DearomatizeCommandData> = {\n        type: Command.Dearomatize,\n        data: commandData\n      }\n\n      worker.postMessage(inputMessage)\n    })\n  }\n\n  calculateCip(\n    data: CalculateCipData,\n    options?: StructServiceOptions\n  ): Promise<CalculateCipResult> {\n    const { struct } = data\n    return new Promise((resolve, reject) => {\n      const worker: Worker = new IndigoWorker()\n\n      worker.onmessage = (e: MessageEvent<OutputMessage<string>>) => {\n        worker.terminate()\n        const msg: OutputMessage<string> = e.data\n        if (!msg.hasError) {\n          const result: CalculateCipResult = {\n            struct: msg.payload!,\n            format: ChemicalMimeType.Mol\n          }\n          resolve(result)\n        } else {\n          reject(msg.error)\n        }\n      }\n\n      const commandOptions: CommandOptions = {\n        ...this.defaultOptions,\n        ...options\n      }\n\n      const commandData: CalculateCipCommandData = {\n        struct,\n        options: commandOptions\n      }\n\n      const inputMessage: InputMessage<CalculateCipCommandData> = {\n        type: Command.CalculateCip,\n        data: commandData\n      }\n\n      worker.postMessage(inputMessage)\n    })\n  }\n\n  automap(\n    data: AutomapData,\n    options?: StructServiceOptions\n  ): Promise<AutomapResult> {\n    const { mode, struct } = data\n\n    return new Promise((resolve, reject) => {\n      const worker: Worker = new IndigoWorker()\n\n      worker.onmessage = (e: MessageEvent<OutputMessage<string>>) => {\n        worker.terminate()\n        const msg: OutputMessage<string> = e.data\n        if (!msg.hasError) {\n          const result: AutomapResult = {\n            struct: msg.payload!,\n            format: ChemicalMimeType.Mol\n          }\n          resolve(result)\n        } else {\n          reject(msg.error)\n        }\n      }\n\n      const commandOptions: CommandOptions = {\n        ...this.defaultOptions,\n        ...options\n      }\n\n      const commandData: AutomapCommandData = {\n        struct,\n        mode,\n        options: commandOptions\n      }\n\n      const inputMessage: InputMessage<CalculateCipCommandData> = {\n        type: Command.Automap,\n        data: commandData\n      }\n\n      worker.postMessage(inputMessage)\n    })\n  }\n\n  check(data: CheckData, options?: StructServiceOptions): Promise<CheckResult> {\n    const { types, struct } = data\n\n    return new Promise((resolve, reject) => {\n      const worker: Worker = new IndigoWorker()\n\n      worker.onmessage = (e: MessageEvent<OutputMessage<string>>) => {\n        worker.terminate()\n        const msg: OutputMessage<string> = e.data\n        if (!msg.hasError) {\n          const warnings = JSON.parse(msg.payload!) as KeyValuePair\n\n          const result: CheckResult = Object.entries(warnings).reduce(\n            (acc, curr) => {\n              const [key, value] = curr\n              const mappedPropertyName = mapWarningGroup(key)\n              acc[mappedPropertyName] = value\n\n              return acc\n            },\n            {}\n          )\n          resolve(result)\n        } else {\n          reject(msg.error)\n        }\n      }\n\n      const commandOptions: CommandOptions = {\n        ...this.defaultOptions,\n        ...options\n      }\n\n      const commandData: CheckCommandData = {\n        struct,\n        types,\n        options: commandOptions\n      }\n\n      const inputMessage: InputMessage<CheckCommandData> = {\n        type: Command.Check,\n        data: commandData\n      }\n\n      worker.postMessage(inputMessage)\n    })\n  }\n\n  calculate(\n    data: CalculateData,\n    options?: StructServiceOptions\n  ): Promise<CalculateResult> {\n    const { properties, struct, selected } = data\n    return new Promise((resolve, reject) => {\n      const worker: Worker = new IndigoWorker()\n\n      worker.onmessage = (e: MessageEvent<OutputMessage<string>>) => {\n        worker.terminate()\n        const msg: OutputMessage<string> = e.data\n        if (!msg.hasError) {\n          const calculatedProperties = JSON.parse(msg.payload!) as KeyValuePair\n          const result: CalculateResult = Object.entries(\n            calculatedProperties\n          ).reduce((acc, curr) => {\n            const [key, value] = curr\n            const mappedPropertyName = mapCalculatedPropertyName(key)\n            if (properties.includes(mappedPropertyName)) {\n              acc[mappedPropertyName] = value\n            }\n\n            return acc\n          }, {})\n          resolve(result)\n        } else {\n          reject(msg.error)\n        }\n      }\n\n      const commandOptions: CommandOptions = {\n        ...this.defaultOptions,\n        ...options\n      }\n\n      const commandData: CalculateCommandData = {\n        struct,\n        properties,\n        options: commandOptions,\n        selectedAtoms: selected || []\n      }\n\n      const inputMessage: InputMessage<CalculateCommandData> = {\n        type: Command.Calculate,\n        data: commandData\n      }\n\n      worker.postMessage(inputMessage)\n    })\n  }\n\n  // @ts-ignore\n  recognize(blob: Blob, version: string): Promise<RecognizeResult> {\n    return Promise.reject('Not supported in standalone mode')\n  }\n\n  generateImageAsBase64(\n    data: string,\n    options: GenerateImageOptions = { outputFormat: 'png' }\n  ): Promise<string> {\n    const { outputFormat, ...restOptions } = options\n\n    return new Promise((resolve, reject) => {\n      const worker: Worker = new IndigoWorker()\n\n      worker.onmessage = (e: MessageEvent<OutputMessage<string>>) => {\n        worker.terminate()\n        const msg: OutputMessage<string> = e.data\n        if (!msg.hasError) {\n          resolve(msg.payload!)\n        } else {\n          reject(msg.error)\n        }\n      }\n\n      const commandOptions: CommandOptions = {\n        ...this.defaultOptions,\n        ...restOptions\n      }\n\n      const commandData: GenerateImageCommandData = {\n        struct: data,\n        outputFormat: outputFormat || 'png',\n        options: commandOptions\n      }\n\n      const inputMessage: InputMessage<GenerateImageCommandData> = {\n        type: Command.GenerateImageAsBase64,\n        data: commandData\n      }\n\n      worker.postMessage(inputMessage)\n    })\n  }\n}\n\nexport default IndigoService\n","/****************************************************************************\n * Copyright 2021 EPAM Systems\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n ***************************************************************************/\n\nimport {\n  ServiceMode,\n  StructService,\n  StructServiceOptions,\n  StructServiceProvider\n} from 'ketcher-core'\n\nimport StandaloneStructService from './StandaloneStructService'\n\nclass StandaloneStructServiceProvider implements StructServiceProvider {\n  mode: ServiceMode = 'standalone'\n\n  // @ts-ignore\n  createStructService(options: StructServiceOptions): StructService {\n    return new StandaloneStructService(options)\n  }\n}\nexport default StandaloneStructServiceProvider\n"],"sourceRoot":""}