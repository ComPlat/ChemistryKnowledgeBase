<?php

namespace DIQA\ChemExtension\Experiments;

use Exception;

class ExperimentRepository
{

    private $experiments;
    private static $INSTANCE;

    public function __construct()
    {

        $this->experiments = [
            'Photocatalytic_CO2_conversion_experiments' => [
                'label' => 'Photocatalytic CO2 conversion',
                'type' => 'molecular-process',
                'rowTemplate' => 'Photocatalytic_CO2_conversion',
                'autoGeneratedProperties' => ['Selectivity', 'BasePageName'],
                'roleProperties' => [
                    'Catalyst' => ['Catalyst'],
                    'Electron donor' => ['Electron donor'],
                    'Hydrogen donor' => ['Hydrogen donor'],
                    'Photosensitizer' => ['Photosensitizer'],
                    'Solvent' => [ 'Solvent A', 'Solvent B', 'Solvent C']
                ],
                'defaultUnits' => [
                    'Additives concentration' => 'M'
                ],
                'mode' => ['list', 'link']

            ],
            'Cyclic_Voltammetry_experiments' => [
                'label' => 'Cyclic Voltammetry experiments',
                'type' => 'assay',
                'rowTemplate' => 'Cyclic_Voltammetry',
                'autoGeneratedProperties' => ['BasePageName'],
                'roleProperties' => [
                    'Analyte'  => ['Analyte'],
                    'Electrolyte'  => ['Electrolyte'],
                    'Solvent' => ['Solvent']
                ],
                'defaultUnits' => [

                ],
                'mode' => ['list', 'link']
            ],
            'Absorption_Emission_Spectroscopy_experiments' => [
                'label' => 'Absorption Emission Spectroscopy experiments',
                'type' => 'assay',
                'rowTemplate' => 'Absorption_Emission_Spectroscopy',
                'autoGeneratedProperties' => ['E0', 'BasePageName'],
                'roleProperties' => [
                ],
                'defaultUnits' => [

                ],
                'mode' => ['list', 'link']
            ],
            'Ultraviolett_Visuell_experiments' => [
                'label' => 'Ultraviolett-Visuell experiments',
                'type' => 'assay',
                'rowTemplate' => 'Ultraviolett_Visuell',
                'autoGeneratedProperties' => ['E0', 'BasePageName'],
                'roleProperties' => [
                ],
                'defaultUnits' => [
                    'Additives concentration' => 'mM'
                ],
                'mode' => ['list', 'link']
            ],
            'EC_conversion_of_CO2_experiments' => [
                'label' => 'Electrochemical conversion of CO2 experiments',
                'type' => 'assay',
                'rowTemplate' => 'EC_conversion_of_CO2',
                'autoGeneratedProperties' => ['Selectivity', 'Total faradaic efficiency', 'BasePageName'],
                'roleProperties' => [
                ],
                'defaultUnits' => [

                ],
                'mode' => ['list'],
                'headerGroups' => ['group_experiment_type' => 'Experiment type',
                    'group_cat_info' => 'Catalytic information',
                    'group_cell_setup' => 'Cell setup',
                    'group_working_electrode' => 'Working electrode',
                    'group_counter_electrode' => 'Counter electrode',
                    'group_reaction_parameters' => 'Reaction parameters',
                    'group_cat_perf' => 'Catalytic performance'
                ]
            ],
            'EC_conversion_of_CO2_overview_experiments' => [
                'label' => 'Electrochemical conversion of CO2 overview',
                'type' => 'assay',
                'rowTemplate' => 'EC_conversion_of_CO2_overview',
                'autoGeneratedProperties' => ['Selectivity', 'BasePageName'],
                'roleProperties' => [
                ],
                'defaultUnits' => [

                ],
                'mode' => ['link'],
                'headerGroups' => ['group_experiment_type' => 'Experiment type',
                    'group_cat_info' => 'Catalytic information',
                    'group_cell_setup' => 'Cell setup',
                    'group_working_electrode' => 'Working electrode',
                    'group_counter_electrode' => 'Counter electrode',
                    'group_reaction_parameters' => 'Reaction parameters',
                    'group_cat_perf' => 'Catalytic performance'
                ]
            ]
        ];

    }

    public static function getInstance(): ExperimentRepository
    {
        if (is_null(self::$INSTANCE)) {
            self::$INSTANCE = new ExperimentRepository();
        }
        return self::$INSTANCE;
    }

    public function getAll(): array
    {
        return $this->experiments;
    }

    /**
     * @param $mainTemplate
     * @return Experiment
     * @throws Exception
     */
    public function getExperimentType($mainTemplate): ExperimentType
    {
        if ($mainTemplate === '') {
            throw new Exception("Experiment type is empty. Please specify.");
        }
        if (!array_key_exists($mainTemplate, $this->experiments)) {
            throw new Exception("Experiment type '{$mainTemplate}' does not exist.");
        }
        return new ExperimentType($this->experiments[$mainTemplate], $mainTemplate);
    }

}